@using Business_Manager.Helpers
@{
    string itemName = "ViewBarcodeMoprocess";
    string itemNameText = "未刷條碼資料";
}

@Html.Resource("css",
    @<style>
         .modal-body {
             max-height: 50vh;
             overflow-y: auto;
         }


        .table-platform-sticky tr:nth-child(odd) {
            background-color: #f1f5fd;
        }
        .table-platform-sticky tr:nth-child(even) {
            background-color: #f9f9f9;
        }
</style>
)

<div class="modal fade advanced-section" style="" id="modal@(itemName)">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button class="go-back " data-dismiss="modal" type="button">
                    <span aria-hidden="true"><i class="fas fa-arrow-left"></i></span>
                </button>
            </div>
            <div class="modal-body" id="listData@(itemName)" style="padding:0;max-height:100vh;">
                <div class="table-outer table-advanced">
                    <table class="table-platform-sticky" id="tblBarcodeData@(itemName)">
                        <thead>
                            <tr class="headerrow">
                                <th scope="col" width="20%"  data-key="barcode">條碼</th>
                                <th scope="col" width="15%"  data-key="barcodestatus">狀態</th>
                                <th scope="col" width="10%"  data-key="quantity">數量</th>
                                <th scope="col" width="15%"  data-key="previousprocess">上製程</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
                <div class="close-block" style="">
                    <button class="close" data-dismiss="modal" type="button">
                        <span aria-hidden="true"><i class="fas fa-times"></i></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

@Html.Resource("js",
@<script>
    let moProcessId@(itemName);
    let woErpFullNo@(itemName);

    function Pop@(itemName)(moProcessId, woErpFullNo, processAlias) {
        moProcessId@(itemName) = moProcessId;
        woErpFullNo@(itemName) = woErpFullNo;

        $("#desWoErpFullNo@(itemName)").html(woErpFullNo);
        $("#desProcessAlias@(itemName)").html(processAlias);
        InitData@(itemName)();

        $("#modal@(itemName)").modal({
            backdrop: "static",
            keyboard: false,
            show: true
        });
    }

    function InitData@(itemName)() {
        let targetUrl = "@Url.Action("GetBarcodeMoprocess", "ProductionHistory")";
        let postData = {
            "NextMoProcessId": moProcessId@(itemName)
        };

        let data = DataAccess.Get(targetUrl, postData, false);
        let innerHtml = '';

        if (data.status == "success") {
            $.each(data.result, function (i, item) {
                innerHtml += `<tr >
                                <td >${item.BarcodeNo} </br> <code>${item.ItemValue}</code></td>
                                <td >${item.CurrentProdStatus}</td>
                                <td >${item.BarcodeQty}</td>
                                <td >${item.ProcessAlias}</td>
                              </tr>`;
            });
        }
        else {
            innerHtml += `<tr>
                            <td class="text-center" colspan="4" style="background-color: #fff3cd;">
                                    <i class="fal fa-exclamation-circle"></i>&nbsp;目前尚無資料。
                                </td>
                              </tr>`;
        }

        $("#tblBarcodeData@(itemName) tbody").html(innerHtml);
    }
</script>
)