@using Business_Manager.Helpers
@{
    string itemName = "MtlItemChange";
    string itemNameText = "品號變更";
    string authority = ViewBag.authority;

    ViewBag.Title = itemNameText;
}
@Html.Resource("css",
    @<style>
    </style>
                                                                                                                        )
<input type="hidden" id="pageAuthority" value="@authority" />
<div class="row">
    <div class="col-12 title-block">
        <h1 class="pt-2 pb-3">@(itemNameText)</h1>
        <div class="unit-block">
            <div class="button-block mb-1">
                <button type="button" class="btn btn-secondary" onclick="Return@(itemName)()"><i class="fas fa-undo"></i>返回</button>
            </div>
        </div>
    </div>
</div>
<!--搜尋-->
<div class="modal fade" id="modalQuery@(itemName)">
    <div class="modal-dialog modal-dialog-scrollable modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">搜尋</h5>
                <button class="close" data-dismiss="modal" type="button">
                    <span aria-hidden="true"><i class="fas fa-times"></i></span>
                </button>
            </div>
            <div class="modal-body">
                <fieldset>
                    <div class="form-group row">
                        <label class="col-12 col-form-label">品號</label>
                        <div class="col-12">
                            <input type="text" class="form-control" id="txtMtlItemNoQ@(itemName)" name="txtMtlItemNoQ@(itemName)" placeholder="請輸入品號">
                        </div>
                    </div>

                    <div class="form-group row">
                        <label class="col-12 col-form-label" for="txtEditionQ@(itemName)">變更版次</label>
                        <div class="col-12">
                            <input type="text" class="form-control" id="txtEditionQ@(itemName)" name="txtEditionQ@(itemName)" placeholder="請輸入變更版次">
                        </div>
                    </div>

                    <div class="form-group row">
                        <label class="col-12 col-form-label">拋轉狀態</label>
                        <div class="col-lg-3 col-md-4 col-6">
                            <label class="control control-solid control-solid-info control--checkbox">
                                已拋轉
                                <input type="checkbox" id="cbxTransferStatusQ@(itemName)Y" name="cbxTransferStatusQ@(itemName)" value="Y" />
                                <span class="control__indicator"></span>
                            </label>
                        </div>
                        <div class="col-lg-3 col-md-4 col-6">
                            <label class="control control-solid control-solid-info control--checkbox">
                                未拋轉
                                <input type="checkbox" id="cbxTransferStatusQ@(itemName)N" name="cbxTransferStatusQ@(itemName)" value="N" />
                                <span class="control__indicator"></span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group row">
                        <label class="col-12 col-form-label">狀態</label>
                        <div class="col-lg-4 col-md-4 col-6">
                            <label class="control control-solid control-solid-info control--checkbox">
                                未確認
                                <input type="checkbox" id="cbxConfirmStatusQ@(itemName)N" name="cbxConfirmStatusQ@(itemName)" value="N,R" checked />
                                <span class="control__indicator"></span>
                            </label>
                        </div>
                        <div class="col-lg-4 col-md-4 col-6">
                            <label class="control control-solid control-solid-info control--checkbox">
                                作廢
                                <input type="checkbox" id="cbxConfirmStatusQ@(itemName)V" name="cbxConfirmStatusQ@(itemName)" value="V" />
                                <span class="control__indicator"></span>
                            </label>
                        </div>
                        <div class="col-lg-4 col-md-4 col-6">
                            <label class="control control-solid control-solid-info control--checkbox">
                                已確認
                                <input type="checkbox" id="cbxConfirmStatusQ@(itemName)Y" name="cbxConfirmStatusQ@(itemName)" value="Y" checked />
                                <span class="control__indicator"></span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group row">
                        <label class="col-12 col-form-label">變更日期 <input type="checkbox" id="cbxUseDate@(itemName)" checked /></label>
                        <div class="col-6">
                            <input type="text" class="form-control" id="txtStartDateQ@(itemName)" name="txtStartDateQ@(itemName)"
                                   data-msg-extraRegex="請輸入正確的日期格式" data-rule-extraRegex="([12]\d{3}\-(0[1-9]|1[0-2])\-(0[1-9]|[12]\d|3[01]))"
                                   readonly />
                        </div>
                        <div class="col-6">
                            <input type="text" class="form-control" id="txtEndDateQ@(itemName)" name="txtEndDateQ@(itemName)"
                                   data-msg-extraRegex="請輸入正確的日期格式" data-rule-extraRegex="([12]\d{3}\-(0[1-9]|1[0-2])\-(0[1-9]|[12]\d|3[01]))"
                                   readonly />
                        </div>
                    </div>
                </fieldset>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" onclick="Query@(itemName)()" style="margin: auto;"><i class="fal fa-wrench"></i>套用</button>
            </div>
        </div>
    </div>
</div>
<!--列表-->
<div class="row" id="listData@(itemName)">
    <div class="col-12">
        <div class="card card-shadow mb-4">
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-6 col-sm-6 col-md-6">
                        <a class="btn btn-primary" data-backdrop="static" data-keyboard="false" data-toggle="modal" data-target="#modalQuery@(itemName)" href="javascript:void(0);"><i class="fal fa-search"></i>搜尋</a>
                    </div>
                    <div class="col-6 col-sm-6 col-md-6 text-right">
                        <button type="button" class="btn btn-info" onclick="Edit@(itemName)()"><i class="fas fa-plus"></i>新增</button>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12">
                        <div class="table-custom">
                            <table class="table table-bordered table-striped table-sticky" id="mainTblData@(itemName)" style="min-height: 200px;">
                                <thead>
                                    <tr>
                                        <th class="text-center" scope="col" style="min-width: 50px;">操作</th>
                                        <th class="text-center" scope="col" style="width: 20px;">#</th>
                                        <th class="text-center" scope="col" style="min-width: 200px;">品號</th>
                                        <th class="text-center" scope="col" style="min-width: 200px;">變更版次</th>
                                        <th class="text-center" scope="col" style="min-width: 200px;">原品名</th>
                                        <th class="text-center" scope="col" style="min-width: 150px;">原規格</th>
                                        <th class="text-center" scope="col" style="min-width: 200px;">新品名</th>
                                        <th class="text-center" scope="col" style="min-width: 200px;">新規格</th>
                                        <th class="text-center" scope="col" style="min-width: 200px;">修改者</th>
                                        <th class="text-center" scope="col" style="min-width: 200px;">變更日期</th>
                                        @*<th scope="col" style="max-width: 200px;">人員名稱</th>*@
                                        @*<th scope="col" style="max-width: 200px;">修改欄位類別</th>*@
                                        @*<th scope="col" style="max-width: 200px;">確認者</th>*@
                                        @*<th scope="col" style="max-width: 200px;">人員名稱</th>*@
                                        @*<th scope="col" style="max-width: 200px;">確認日期</th>*@
                                        <th class="text-center" scope="col" style="min-width:100px;">拋轉狀態</th>
                                        <th class="text-center" scope="col" style="min-width:100px;">確認狀態</th>

                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                        <div class="pagination" id="page@(itemName)"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<!--新增/編輯-->
<div class="row" id="editData@(itemName)" style="display: none;">
    <div class="col-12">
        <div class="card card-shadow mb-4">
            <div class="card-body">
                <form class="container" autocomplete="off" id="editForm@(itemName)">
                    <fieldset>
                        <input type="hidden" id="MtlItemChangeId" name="MtlItemChangeId" value="-1" />
                        <div class="row">
                            <div class="col-lg-6 col-md-12">
                                <div class="form-group row">
                                    <label class="form-label col-12" for="txtMtlItemNo@(itemName)">品號<span class="text-danger">*</span></label>
                                    <div class="col-12">
                                        <div class="input-group">
                                            <input type="hidden" id="txtMtlItemId@(itemName)" />
                                            <input type="text" class="form-control" id="txtMtlItemNo@(itemName)" name="txtMtlItemNo@(itemName)" placeholder="請輸入品號" readonly />
                                            <div class="input-group-append">
                                                <a class="btn btn-success pop-view" id="popMtl@(itemName)" href="javascript:void(0);"><i class="fal fa-search"></i></a>
                                                <a class="btn btn-outline-danger pop-clear" id="clearTxt@(itemName)" href="javascript:MtlItemNoClear@(itemName)();"><i class="fas fa-eraser"></i></a>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>

                            <div class="col-lg-6 col-md-12">
                                <div class="form-group row">
                                    <label class="form-label col-12" for="txtLastModifiedBy@(itemName)">修改者<span class="text-danger">*</span></label>
                                    <div class="col-12">
                                        <input type="text" class="form-control" id="txtLastModifiedBy@(itemName)" name="txtLastModifiedBy@(itemName)"
                                               placeholder="請輸入修改者" data-rule-required="true" readonly />
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-6 col-md-12">
                                <div class="form-group row">
                                    <label class="form-label col-12" for="txtOriginalMtlItemName@(itemName)">原品名<span class="text-danger">*</span></label>
                                    <div class="col-12">
                                        <input type="text" class="form-control" id="txtOriginalMtlItemName@(itemName)" name="txtOriginalMtlItemName@(itemName)"
                                               placeholder="請輸入原品名" readonly />
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 col-md-12">
                                <div class="form-group row">
                                    <label class="form-label col-12" for="txtNewMtlItemName@(itemName)">新品名<span class="text-danger">*</span></label>
                                    <div class="col-12">
                                        <input type="text" class="form-control" id="txtNewMtlItemName@(itemName)" name="txtNewMtlItemName@(itemName)"
                                               placeholder="請輸入新品名" data-rule-required="true" />
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-6 col-md-12">
                                <div class="form-group row">
                                    <label class="form-label col-12" for="txtOriginalMtlItemSpec@(itemName)">原規格<span class="text-danger">*</span></label>
                                    <div class="col-12">
                                        <input type="text" class="form-control" id="txtOriginalMtlItemSpec@(itemName)" name="txtOriginalMtlItemSpec@(itemName)"
                                               placeholder="請輸入原規格" readonly />
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 col-md-12">
                                <div class="form-group row">
                                    <label class="form-label col-12" for="txtNewMtlItemSpec@(itemName)">新規格<span class="text-danger">*</span></label>
                                    <div class="col-12">
                                        <input type="text" class="form-control" id="txtNewMtlItemSpec@(itemName)" name="txtNewMtlItemSpec@(itemName)"
                                               placeholder="請輸入新規格" />
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-6 col-md-12" style="max-width: 50%; flex-basis: 50%;">
                                <div class="form-group row">
                                    <label class="form-label col-12" for="txtEdition@(itemName)">變更版次<span class="text-danger">*</span></label>
                                    <div class="col-12">
                                        <input type="hidden" id="OriginalEdition" name="OriginalEdition" value="-9999" /><!--原版次-->
                                        <input type="text" class="form-control" id="txtEdition@(itemName)" name="txtEdition@(itemName)"
                                               placeholder="請輸入變更版次" data-rule-required="true" readonly />
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 col-md-12" style="max-width: 50%; flex-basis: 50%;">
                                <div class="form-group row">
                                    <label class="form-label col-12" for="txtChangeDate@(itemName)">變更日期<span class="text-danger">*</span></label>
                                    <div class="col-12">
                                        <input type="text" class="form-control" id="txtChangeDate@(itemName)" name="txtChangeDate@(itemName)"
                                               placeholder="請輸入變更日期"
                                               data-msg-required="請輸入變更日期" data-rule-required="true"
                                               @*data-msg-extraRegex="請輸入正確的日期格式" data-rule-extraRegex="([12]\d{3}\-(0[1-9]|1[0-2])\-(0[1-9]|[12]\d|3[01]))"*@
                                               readonly />
                                    </div>
                                </div>
                            </div>



                        </div>
                        <div class="row">
                            <div class="col-lg-6 col-md-12" style="max-width: 50%; flex-basis: 50%;">
                                <div class="form-group row">
                                    <label class="form-label col-12" for="txtCheckedBy@(itemName)">確認者</label>
                                    <div class="col-12">
                                        <input type="text" class="form-control" id="txtCheckedBy@(itemName)" name="txtCheckedBy@(itemName)"
                                               placeholder="請輸入確認者" readonly />
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 col-md-12" style="max-width: 50%; flex-basis: 50%;">
                                <div class="form-group row">
                                    <label class="form-label col-12" for="txtCheckedDate@(itemName)">確認日期</label>
                                    <div class="col-12">
                                        <input type="text" class="form-control" id="txtCheckedDate@(itemName)" name="txtCheckedDate@(itemName)"
                                               placeholder="請輸入日期"
                                               data-msg-required="請輸入日期"
                                               readonly />
                                    </div>
                                </div>
                            </div>
                        </div>


                        <div class="row">
                            @*<div class="col-lg-6 col-md-12">
                                    <div class="form-group row">
                                        <label class="form-label col-12" for="txtFieldType@(itemName)">修改欄位類別<span class="text-danger">*</span></label>
                                        <div class="col-12">
                                            <select class="form-control" id="cboFieldType@(itemName)" name="cboFieldType@(itemName)"></select>
                                        </div>
                                    </div>
                                </div>*@
                            <div class="col-lg-6 col-md-12">
                                <div class="form-group row">
                                    <label class="form-label col-12" for="txtRemark@(itemName)">備註</label>
                                    <div class="col-12">
                                        <input type="text" class="form-control" id="txtRemark@(itemName)" name="txtRemark@(itemName)"
                                               placeholder="請輸入備註"
                                               data-msg-maxlength="必須少於 255 個字元" maxlength="255" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </fieldset>
                </form>
            </div>

            <div class="card-footer text-center text-lg-right">
                <button type="button" class="btn btn-success" id="btnSave@(itemName)" onclick="Save@(itemName)()"><i class="fas fa-save"></i>儲存</button>
                <button type="button" class="btn btn-primary" id="btnAdd@(itemName)" onclick="Add@(itemName)()"><i class="fas fa-save"></i>建立</button>
            </div>
        </div>

        <!--列表-->
        <div class="row">
            <div class="col-12 title-block">
                @*<h1 class="pt-2 pb-3">變更欄位</h1>*@
            </div>
        </div>


    </div>
</div>

<!--新增欄位跳窗-->
<div class="modal fade" id="addModalQuery@(itemName)">
    <div class="modal-dialog modal-dialog-scrollable modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    新增欄位
                    @*<span class="sub-title">欄位編號 <span class="sub-text" id="desAddField@(itemName)"></span></span>*@
                </h5>
                <button class="close" data-dismiss="modal" type="button">
                    <span aria-hidden="true"><i class="fas fa-times"></i></span>
                </button>
            </div>
            <div class="modal-body">
                <div class="bp-mode">
                    <input type="hidden" id="MtlItemChangeDetailIdd" name="MtlItemChangeDetailIdd" value="-1" />
                    <div class="row" style="width: 60%;">
                        <div class="col-lg-12 col-md-12">
                            <div class="form-group row">
                                <div class="col-12">
                                    <select class="form-control" id="cboAddField@(itemName)" name="cboAddField@(itemName)" required>
                                        <option>請選擇</option>
                                        @*<option value="MB005">會計</option>
                                            <option value="MB006">倉管</option>
                                            <option value="MB007">業務</option>
                                            <option value="MB008">生管</option>
                                            <option value="MB009">商品描述</option>
                                            <option value="MB017">主要庫別</option>
                                            <option value="MB025">品號屬性</option>
                                            <option value="MB028">備註</option>
                                            <option value="MB030">生效日期</option>
                                            <option value="MB031">失效日期</option>
                                            <option value="MB043">檢驗方式</option>
                                            <option value="MB157">主要領料庫別</option>*@
                                    </select>

                                </div>

                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-lg-12 col-md-12">
                            <div class="form-group row">
                                <label class="form-label col-12" for="txtNewValue@(itemName)">新數值<span class="text-danger">*</span></label>
                                <div class="col-12" id="newValueType@(itemName)">
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="txtNewValue@(itemName)" name="txtNewValue@(itemName)"
                                               placeholder="請輸入新數值" data-rule-required="true" />
                                        <div class="input-group-append">
                                            <a class="btn btn-outline-danger pop-clear" id="clearTxt2@(itemName)" href="javascript:NewValueClear@(itemName)();"><i class="fas fa-eraser"></i></a>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-lg-4 col-md-12">
                            <div class="form-group row">
                                <select hidden id="OldValue" name="OldValue"></select>
                                <label class="form-label col-12" for="txtOldTxtValue@(itemName)">原文字欄位值</label>
                                <div class="col-12">
                                    <input type="text" class="form-control" id="txtOldTxtValue@(itemName)" name="txtOldTxtValue@(itemName)"
                                           placeholder="請輸入原文字欄位值"
                                           readonly />
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-4 col-md-12">
                            <div class="form-group row">
                                <label class="form-label col-12" for="txtOldValue@(itemName)">原值</label>
                                <div class="col-12">
                                    <input type="text" class="form-control" id="txtOldValue@(itemName)" name="txtOldValue@(itemName)"
                                           placeholder="請輸入原值"
                                           readonly />
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-4 col-md-12">
                            <div class="form-group row">
                                <label class="form-label col-12" for="txtOldFieldValue@(itemName)">原數值欄位值</label>
                                <div class="col-12">
                                    <input type="number" class="form-control" id="txtOldFieldValue@(itemName)" name="txtOldFieldValue@(itemName)"
                                           placeholder="請輸入原數值欄位值"
                                           readonly />
                                </div>
                            </div>
                        </div>
                    </div>



                    <div class="row">
                        <div class="col-lg-12 col-md-12">
                            <div class="form-group row">
                                <label class="form-label col-12" for="txtFieldRemark@(itemName)">備註</label>
                                <div class="col-12">
                                    <input type="text" class="form-control" id="txtFieldRemark@(itemName)" name="txtFieldRemark@(itemName)"
                                           placeholder="請輸入備註"
                                           data-msg-maxlength="必須少於 255 個字元" maxlength="255" />
                                </div>
                            </div>
                        </div>
                    </div>


                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="EditField@(itemName)()" style="margin: auto;"><i class="fal fa-check"></i>新增欄位</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!--其他分頁-->
<div class="advanced-block">
    <div class="row">
        <div class="col-12">
            <ul class="nav flag-tabs nav-fill" role="tablist">
                <li class="flag-item">
                    <a class="flag-link" data-toggle="tab" href="#tabChange@(itemName)">
                        <i class="fas fa-project-diagram"></i> 變更欄位
                    </a>
                </li>
                @*<li class="flag-item">
                        <a class="flag-link" data-toggle="tab" href="#tabMtlItemUomCalculate@(itemName)">
                            <i class="fas fa-cog"></i> 品號單位換算
                        </a>
                    </li>*@
            </ul>
        </div>
    </div>

    <div class="tab-content">
        <div class="tab-pane active" id="tabChange@(itemName)">

            <div class="row" id="fieldListData@(itemName)">
                <div class="col-12">
                    <div class="card card-shadow mb-4">
                        <div class="card-body">
                            @*<div class="row mb-3">
                                    <div class="col-6 col-sm-6 col-md-6">
                                        <a class="btn btn-primary" data-backdrop="static" data-keyboard="false" data-toggle="modal" data-target="#modalQuery@(itemName)" href="javascript:void(0);"><i class="fal fa-search"></i>搜尋</a>
                                    </div>
                                </div>*@
                            <div class="row mb-3">
                                <div class="col-6 col-sm-6 col-md-6">


                                </div>
                                <div class="col-6 col-sm-6 col-md-6 text-right">
                                    <form autocomplete="off" id="queryForm@(itemName)">
                                        <fieldset>
                                            <a class="btn btn-info" id="PopAddFieldView@(itemName)" href="javascript:PopAddFieldView@(itemName)(-1);" style=""><i class="fas fa-plus"></i>新增欄位</a>
                                        </fieldset>
                                    </form>
                                    @*<a class="btn btn-info" id="PopAddFieldView@(itemName)" href="javascript:PopAddFieldView@(itemName)();" style=""><i class="fas fa-plus"></i>新增欄位</a>*@
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-12">
                                    <div class="table-custom">
                                        <table class="table table-bordered table-striped table-sticky" id="fteldTblData@(itemName)">
                                            <thead>
                                                <tr>
                                                    <th class="text-center" scope="col" style="min-width: 150px;">欄位編號</th>
                                                    <th class="text-center" scope="col" style="min-width: 150px;">欄位名</th>
                                                    <th class="text-center" scope="col" style="min-width: 150px;">新文字欄位值</th>
                                                    <th class="text-center" scope="col" style="min-width: 150px;">新值</th>
                                                    <th class="text-center" scope="col" style="min-width: 150px;">原文字欄位值</th>
                                                    <th class="text-center" scope="col" style="min-width: 150px;">原值</th>
                                                    <th class="text-center" scope="col" style="min-width: 150px;">新數據欄位值</th>
                                                    <th class="text-center" scope="col" style="min-width: 150px;">原數據欄位值</th>
                                                    <th class="text-center" scope="col" style="min-width: 75px;">操作</th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                    <div class="pagination" id="fieldListpage@(itemName)"></div>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer text-center text-lg-right">
                            @*<button type="button" class="btn btn-success" onclick="Transfer2@(itemName)()"><i class="fas fa-redo-alt"></i>拋轉</button>*@
                        </div>
                    </div>
                </div>

            </div>
        </div>

        @*<div class="tab-pane" id="tabMtlItemUomCalculate@(itemName)">

                <div class="row" id="uomCalculatelistData@(itemName)">
                    <div class="col-12">
                        <div class="card card-shadow mb-4">
                            <div class="card-body">
                                <div class="row mb-3">
                                    <div class="col-6 col-sm-6 col-md-6">
                                        <form autocomplete="off" id="queryForm@(itemName)">
                                            <fieldset>
                                                <div class="form-row align-items-center mb-2 text-right">

                                                    <div class="col-auto">
                                                        <a class="btn btn-info" id="PopUomCalculateView@(itemName)" href="javascript:void(0);" style=""><i class="fas fa-plus"></i>單位換算調整</a>
                                                    </div>
                                                </div>
                                            </fieldset>
                                        </form>

                                    </div>
                                    <div class="col-6 col-sm-6 col-md-6 text-right">

                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-12">
                                        <div class="table-custom">
                                            <table class="table table-bordered table-striped table-sticky" id="uomCalculatetblData@(itemName)">
                                                <thead>
                                                    <tr>
                                                        <th scope="col" style="min-width: 75px;">#</th>
                                                        <th scope="col" style="min-width: 150px;">換算率分子</th>
                                                        <th scope="col" style="min-width: 150px;">換算單位</th>
                                                        <th class="text-center" scope="col" style="min-width: 50px;">等於</th>
                                                        <th scope="col" style="min-width: 150px;">換算率分母</th>
                                                        <th scope="col" style="min-width: 150px;">庫存單位</th>
                                                        <th scope="col" style="min-width: 150px; display: none;">是否拋轉</th>
                                                        <th scope="col" style="min-width: 100px; display: none;">操作</th>
                                                    </tr>
                                                </thead>
                                                <tbody></tbody>
                                            </table>
                                        </div>
                                        <div class="pagination" id="uomCalculatepage@(itemName)"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>*@
    </div>
</div>


@Html.Partial("ViewMtlItemForInvalid")
@Html.Resource("js",
@<script>
    let objPage@(itemName) = {
        "pageIndex": 0,
        "pageSize": 10
    };
    let objForm@(itemName) = "#editForm@(itemName)";
    let mtlItemId@(itemName) = 0;
    let cangeEdition@(itemName) = 0;
    let newSort@(itemName) = "0001";
    let fieldType@(itemName) = "";

    let isTransfer@(itemName) = "N";

    let isConfirm@(itemName) = "N";

    if (!isMobile) {//txtNewValue
        $("#cboAddField@(itemName)").select2({
            dropdownAutoWidth: true,
            width: "100%"
        });



    }

    $(document).ready(function () {
        let currentDate = new Date();

        @*ComboBoxs.Default("#cboFieldType@(itemName)", "@Url.Action("GetType", "BasicInformation")", { "TypeSchema": "MtlItemChange.FieldType" }, "", "HIDDEN", "", "TypeName", "TypeNo");*@
        $(".advanced-block a[data-toggle='tab']").on("shown.bs.tab", function (e) {
            InitParameter@(itemName)($(this));
        });
        Suites.DateDropper("#txtStartDateQ@(itemName), #txtEndDateQ@(itemName)");
        Suites.SetDateDropper("#txtEndDateQ@(itemName)", currentDate);
        currentDate.setDate(currentDate.getDate() - 30);
        Suites.SetDateDropper("#txtStartDateQ@(itemName)", currentDate);

        Query@(itemName)();


    });

    function Query@(itemName)() {
        objPage@(itemName).pageIndex = 0;
        InitData@(itemName)(objPage@(itemName));
        //品號彈跳視窗
        let popConfig = {
            targetSelector: "#txtMtlItemId@(itemName)",
            popFunction: "PopViewMtlItemForInvalid",
            objectMtlItemId: "#txtMtlItemId@(itemName)",
            objectMtlItemNo: "#txtMtlItemNo@(itemName)",
            objectMtlItemName: "#txtOriginalMtlItemName@(itemName),#txtNewMtlItemName@(itemName)",
            objectMtlItemSpec: "#txtOriginalMtlItemSpec@(itemName),#txtNewMtlItemSpec@(itemName)",
        };
        InitPopView(popConfig);
        $("#modalQuery@(itemName)").modal("hide");
    }

    function InitData@(itemName)(objPage) {
        let innerHtml = '';
        let pageCount = 0;

        let targetUrl = "@Url.Action("GetMtlChangeData", "Product")";
        let postData = {
            "OrderBy": "",
            "PageIndex": (objPage.pageIndex + 1),
            "PageSize": objPage.pageSize,
            "SearchKey": $("#txtMtlItemNoQ@(itemName)").val(),
            "ChangeEdition": $("#txtEditionQ@(itemName)").val(),
            "TransferStatus": $("input[name='cbxTransferStatusQ@(itemName)']:checked").toArray().map(item => item.value).join(","),
            "ConfirmStatus": $("input[name='cbxConfirmStatusQ@(itemName)']:checked").toArray().map(item => item.value).join(","),
            "StartDate": ($("#cbxUseDate@(itemName)").is(":checked") ? $("#txtStartDateQ@(itemName)").val() : ""),
            "EndDate": ($("#cbxUseDate@(itemName)").is(":checked") ? $("#txtEndDateQ@(itemName)").val() : "")
        };

        let data = DataAccess.Get(targetUrl, postData, false);

        if (data.status == "success") {
            pageCount = data.result.length > 0 ? parseInt(data.result[0]["TotalCount"]) : 0;

            if (pageCount > 0) {
                objPage = PageCaculate(pageCount, objPage);

                $.each(data.result, function (i, item) {
                    let _row = (objPage.pageSize * objPage.pageIndex + (i + 1)) + ".";


                    innerHtml += `<tr>
                                        <td class="text-center active-content">
                                            <div class="btn-group mb-4 show" style="margin-bottom: 0 !important;">
                                                <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" style="padding-top: 0; padding-bottom: 0;">動作</button>
                                                <div class="dropdown-menu btn-text-left-block" x-placement="bottom-start" style="overflow-y: auto; z-index: 999; max-height: 150px;">
                                                    <a class="dropdown-item btn-text-left" href="javascript:Detail@(itemName)(${item.MtlItemChangeId});"><i class="fas fa-list"></i><span>詳情</span></a>
                                                    <a class="dropdown-item btn-text-left" href="javascript:Edit@(itemName)(${item.MtlItemChangeId}, '${item.ChangeEdition}');"><i class="fas fa-edit"></i><span>編輯</span></a>

                                                     ${JudgeConfirm(`${item.ConfirmStatus}`, `${item.TransferStatus}`, `${item.MtlItemChangeId}`, `${item.MtlItemId}`, `${item.ChangeEdition}`)}
                                                </div>
                                            </div>
                                        </td >
                                        <td>${_row}</td>
                                        <td class="ellipsis text-center" data-toggle="tooltip" title="${item.MtlItemNo}" style="min-width: 200px;">${item.MtlItemNo}</td>
                                        <td class="ellipsis text-center" data-toggle="tooltip" title="${item.ChangeEdition}" style="min-width: 200px;">${item.ChangeEdition}</td>
                                        <td class="ellipsis text-center" data-toggle="tooltip" title="${item.OriginalMtlItemName}" style="min-width: 200px;">${item.OriginalMtlItemName}</td>
                                        <td class="ellipsis text-center" data-toggle="tooltip" title="${item.OriginalMtlItemSpec}" style="min-width: 200px;">${item.OriginalMtlItemSpec}</td>
                                        <td class="ellipsis text-center" data-toggle="tooltip" title="${item.NewMtlItemName}" style="min-width: 200px;">${item.NewMtlItemName}</td>
                                        <td class="ellipsis text-center" data-toggle="tooltip" title="${item.NewMtlItemSpec}" style="min-width: 200px;">${item.NewMtlItemSpec}</td>
                                        <td class="ellipsis text-center" data-toggle="tooltip" title="${item.UpdateUserNo}" style="min-width: 200px;">${item.UpdateUserNo + `-` + item.UpdateUserName}</td>
                                        <td class="ellipsis text-center" data-toggle="tooltip" title="${item.ChangeDate}" style="min-width: 200px;">${item.ChangeDate}</td>
                                        <td class="ellipsis text-center" data-toggle="tooltip" title="${item.MtlItemChangeId}" style="min-width: 200px;">${item.TransferStatus == `Y` ? `已拋轉` : `未拋轉`}</td>
                                        <td class="ellipsis text-center" data-toggle="tooltip" title="${item.MtlItemChangeId}" style="min-width: 200px;">${ConfirmSttus(item.ConfirmStatus)}</td>

                                      </tr>
                                      <tr data-mo-id="${item.MtlItemChangeId}" style="display: none;">
                                        <td colspan="13">
                                          <table style="width: 100%; margin: auto; border: 1px solid #d7d7e1;">
                                            <thead>
                                             <tr>
                                                <th class="thead-customized" scope="col">欄位編號</th>
                                                <th class="thead-customized" scope="col">欄位名</th>
                                                <th class="thead-customized" scope="col">新文字型欄位值</th>
                                                <th class="thead-customized" scope="col">新值名稱</th>
                                                <th class="thead-customized" scope="col">原文字型欄位值</th>
                                                <th class="thead-customized" scope="col">原值名稱</th>
                                                <th class="thead-customized" scope="col">新數值欄位值</th>
                                                <th class="thead-customized" scope="col">原數值欄位值</th>
                                                <th class="thead-customized" scope="col">備註</th>
                                              </tr>
                                           </thead>
                                            <tbody>
                                                ${MtlChangeDetailData@(itemName)(item.MtlItemChangeDetails)}
                                            </tbody>
                                          </table>
                                        </td>
                                      </tr>`;
                });
            } else {
                innerHtml += `<tr>
                                    <td class="text-center" colspan="13" style="background-color: #fff3cd;">
                                      <i class="fal fa-exclamation-circle"></i>&nbsp;目前尚無資料。
                                    </td>
                                  </tr>`;
            }
        } else {
            alert(data.msg, "alert", 0);
        }

        $("#mainTblData@(itemName) tbody").html(innerHtml);
        TableComponentInit();
        Pager("#page@(itemName)", pageCount, objPage, InitData@(itemName));

        function ConfirmSttus(confirmStatus) {
            var statusNo = ""
            switch (confirmStatus) {
                case "Y":
                    statusNo = "已確認";
                    break;
                case "N":
                    statusNo = "未確認";
                    break;
                case "R":
                    statusNo = "需重新確認";
                    break;
                case "V":
                    statusNo = "作廢";
                    break;
            }
            return statusNo;
        }

        function JudgeConfirm(confirmStatus, transferStatus, mtlItemChangeId, mtlItemId, changeEdition) {
            let innerHtml = '';
            if (transferStatus == "N") {
                innerHtml += `
                            <a class="dropdown-item btn-text-left auth-import" href="javascript:Transfer@(itemName)(${mtlItemChangeId});"><i class="fas fa-redo-alt"> </i><span>拋轉</span></a>
                            <a class="dropdown-item btn-text-left" href="javascript:Delete@(itemName)(${mtlItemChangeId}, ${mtlItemId}, '${changeEdition}');"><i class="fas fa-trash-alt"></i><span>刪除</span></a>
                            `;
            }
            else {

                switch (confirmStatus) {
                    case "V": {
                        innerHtml += ``;
                        break;
                    }
                    case "N": {
                        innerHtml += `<a class="dropdown-item btn-text-left auth-confirm" href="javascript:Confirm@(itemName)('${mtlItemChangeId}');"><i class="fas fa-check"></i><span>確認</span></a>
                                      <a class="dropdown-item btn-text-left auth-void" href="javascript:Void@(itemName)('${mtlItemChangeId}');"><i class="fas fa-ban"></i><span>作廢</span></a>`;
                        break;
                    }
                    case "R": {
                        innerHtml += `<a class="dropdown-item btn-text-left auth-confirm" href="javascript:Confirm@(itemName)('${mtlItemChangeId}');"><i class="fas fa-check"></i><span>確認</span></a>
                                      <a class="dropdown-item btn-text-left auth-void" href="javascript:Void@(itemName)('${mtlItemChangeId}');"><i class="fas fa-ban"></i><span>作廢</span></a>`;
                        break;
                    }

                    case "Y": {
                        innerHtml += ``;
                        break;
                    }
                }
            }
            return innerHtml;
        }


    }

    function MtlChangeDetailData@(itemName)(DetailData) {

            let html = '';
        let json = DetailData;

        if (json.length > 0) {


            for (let x = 0; x < json.length; x++) {

                html += `<tr>
                            <td class="tbody-customized text-center"  title="${json[x].FieldNum}">${json[x].FieldNum}</td>
                            <td class="tbody-customized text-center"  title="${json[x].FieldName}">${json[x].FieldName}</td>
                            <td class="tbody-customized text-center"  title="${json[x].NewTextField}">${json[x].NewTextField}</td>
                            <td class="tbody-customized text-center"  title="${json[x].NewFieldName}">${json[x].NewFieldName}</td>
                            <td class="tbody-customized text-center"  title="${json[x].OriginalTextField}">${json[x].OriginalTextField}</td>
                            <td class="tbody-customized text-center"  title="${json[x].OriginalFieldName}">${json[x].OriginalFieldName}</td>
                            <td class="tbody-customized text-center"  title="${json[x].NewNumericField}">${json[x].NewNumericField}</td>
                            <td class="tbody-customized text-center"  title="${json[x].OriginalNumericField}">${json[x].OriginalNumericField}</td>
                            <td class="tbody-customized text-center"  title="${json[x].Remark}">${json[x].Remark}</td>
                         </tr>`;
            }
        } else {
            html += `<tr>
                       <td class="text-center" colspan="10" style="background-color: #fff3cd;">
                           <i class="fal fa-exclamation-circle"></i>&nbsp;目前尚無單身資料。
                       </td>
                     </tr>`;

        }

            return html;
    }

    function Edit@(itemName)(mtlItemChangeId, changeEdition) {
        $("#MtlItemChangeId").val(mtlItemChangeId ? mtlItemChangeId : 0);
        Switch("#editData@(itemName), .unit-block, .advanced-block", "#listData@(itemName)");
        let currentDate = new Date();
        @*Suites.DateDropper("#txtChangeDate@(itemName)");*@
        Suites.SetDateDropper("#txtChangeDate@(itemName)", currentDate);
                    GetDetail@(itemName)(mtlItemChangeId, changeEdition);


        $("#txtLastModifiedBy@(itemName)").val($.cookie("Login"));
        if (mtlItemChangeId > 0) {

            @*$("#popMtl@(itemName)").hide();
            $("#clearTxt@(itemName)").hide();*@
            $("#btnAdd@(itemName)").hide();
            @*$("#btnSave@(itemName)").show();
            $("#PopAddFieldView@(itemName)").show();*@



            @*GetMtlItemUomCalculate@(itemName)(objPage@(itemName));*@

        } else {
            $("#popMtl@(itemName)").show();
            $("#clearTxt@(itemName)").show();
            $("#btnSave@(itemName)").hide();
            $("#btnAdd@(itemName)").show();
            $("#PopAddFieldView@(itemName)").hide();

        }
        if ($(".advanced-block .flag-tabs > .flag-item > .flag-link").first().hasClass("active")) {
            InitParameter@(itemName)($(".advanced-block .flag-tabs > .flag-item").first().find("a"));
        } else {
            $(".advanced-block .flag-tabs > .flag-item").first().find("a").trigger("click");
        }


    }

    function Save@(itemName)() {
        if ($(objForm@(itemName)).valid()) {
            let MtlItemChangeId = parseInt($("#MtlItemChangeId").val());
            if (MtlItemChangeId > 0) {
                let targetUrl = "@Url.Action("UpdateMtlItemChange", "Product")";
                let postData = {
                    "MtlItemChangeId": MtlItemChangeId,
                    "MtlItemId": $("#txtMtlItemId@(itemName)").val(),
                    "NewMtlItemName": $("#txtNewMtlItemName@(itemName)").val(),
                    "NewMtlItemSpec": $("#txtNewMtlItemSpec@(itemName)").val(),
                    "Remark": $("#txtRemark@(itemName)").val(),

                };
                let data = DataAccess.Update(targetUrl, postData, false, false);
                if (data) {

                    $("#MtlItemChangeId").val(MtlItemChangeId);
                    GetDetail@(itemName)($("#MtlItemChangeId").val(), cangeEdition@(itemName));
                    alert("修改完成", "success")
                    //ExpandMtlChangeDetail(mtlItemChangeId);
                }
            }
        }
        @*Return@(itemName)();*@
    }

    function Add@(itemName)() {
        if ($(objForm@(itemName)).valid()) {

            let MtlItemChangeId = parseInt($("#MtlItemChangeId").val());
            if (MtlItemChangeId <= 0) {
                console.log("oaddddd", MtlItemChangeId)
                let targetUrl = "@Url.Action("AddMtlItemChange", "Product")";
                let postData = {
                    "MtlItemId": $("#txtMtlItemId@(itemName)").val(),
                    "OriginalMtlItemName": $("#txtOriginalMtlItemName@(itemName)").val(),
                    "OriginalMtlItemSpec": $("#txtOriginalMtlItemSpec@(itemName)").val(),
                    "ChangeEdition": $("#txtEdition@(itemName)").val(),
                    "ChangeDate": $("#txtChangeDate@(itemName)").val(),
                    "DelMtlItemStatus": "N",
                    "NewMtlItemName": $("#txtNewMtlItemName@(itemName)").val(),
                    "NewMtlItemSpec": $("#txtNewMtlItemSpec@(itemName)").val(),
                    "UpdateBy": $("#txtLastModifiedBy@(itemName)").val(),
                    "Remark": $("#txtRemark@(itemName)").val(),
                    "FieldType": $("#cboFieldType@(itemName)").val(),
                    "ConfirmBy": $("#txtConfirmUser@(itemName)").val(),
                    "ConfirmStatus": "N",
                    "SignOffStatus": "N",
                    "PrintCount": "0",
                    "SendCount": "0",
                    "OriginalEdition": $("#OriginalEdition").val(),
                    "TransferStatus": "N",
                };
                let data = DataAccess.EditContinued(targetUrl, postData, false);
                if (data.status == "success") {
                    let mtlItemChangeId;
                    mtlItemChangeId = data.msg;
                    $("#MtlItemChangeId").val(mtlItemChangeId);
                    $("#popMtl@(itemName)").hide();
                    $("#clearTxt@(itemName)").hide();
                    $("#btnSave@(itemName)").show();
                    $("#btnAdd@(itemName)").hide();
                    $("#PopAddFieldView@(itemName)").show();
                    alert("建立完成", "success")
                    //ExpandMtlChangeDetail(mtlItemChangeId);
                    GetDetail@(itemName)($("#MtlItemChangeId").val(), $("#txtEdition@(itemName)").val());
                    Query@(itemName)();
                }
            }
        }
        @*Return@(itemName)();*@
    }

    function Delete@(itemName)(mtlItemChangeId, mtlItemId, changeEdition) {
        let edition = "";
        edition = ('0000' + changeEdition).substr(-4);
        console.log(changeEdition, edition)
        swal.fire({
             titleText: "確認要刪除該筆變更單嗎?",
             text: "此動作無法復原，請確認是否要執行!",
             icon: "warning",
             allowOutsideClick: false,
             allowEscapeKey: false,
             showCancelButton: true,
             confirmButtonColor: '#d33',
             reverseButtons: true
        }).then((pass) => {
            if (pass.isConfirmed) {
                let targetUrl = "@Url.Action("DeleteMtlItemChange", "Product")";
                let postData = {
                    "MtlItemChangeId": mtlItemChangeId,
                    "MtlItemId": mtlItemId,
                    "ChangeEdition": edition
                };

                let result = DataAccess.Delete(targetUrl, postData, false, false);

                if (result) {
                    Query@(itemName)();
                }
            }
        });
    }

    $("#txtMtlItemId@(itemName)").change(function () {
        if ($("#txtMtlItemId@(itemName)").val() > 0) {
            GetMtlChangeEdition($("#txtMtlItemId@(itemName)").val());
        console.log(MakeRandon(4));
        $("#txtEdition@(itemName)").val(MakeRandon(4));
        }
    });

    $("#cboAddField@(itemName)").change(function () {
        setInputType@(itemName)();
        GetMtlItem@(itemName)($("#txtMtlItemId@(itemName)").val());
    });

    function GetMtlChangeEdition(mtlItemId) {
        let targetUrl = "@Url.Action("GetMtlChangeEdition", "Product")";

        let postData = {
            "MtlItemId": mtlItemId
        };
        let data = DataAccess.Get(targetUrl, postData, false);
        if (data.status == "success") {
            $.each(data.result, function (i, item) {
                if (item.ChangeEdition == null) {
                    $("#OriginalEdition").val("0000");
                   // $("#txtEdition@(itemName)").val("0001");
                } else {
                    $("#OriginalEdition").val(item.ChangeEdition);
                    let Edition = parseInt(item.ChangeEdition) + 1;
                    console.log(Edition, ('000000' + Edition))
                   // $("#txtEdition@(itemName)").val(('0000' + Edition).substr(-4));
                }
            });
        } else {
            alert(data.msg, "alert", 0);
        }
    }

    function MakeRandon(length) {
        let result = '';
        const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
        const charactersLength = characters.length;
        let counter = 0;
        while (counter < length) {
            result += characters.charAt(Math.floor(Math.random() * charactersLength));
            counter += 1;
        }
        return result;
    }


    function MtlItemNoClear@(itemName)() {
        $("#txtOriginalMtlItemName@(itemName),#txtNewMtlItemName@(itemName),#txtOriginalMtlItemSpec@(itemName),#txtNewMtlItemSpec@(itemName),#txtMtlItemNo@(itemName)").val("");
    }

    function NewValueClear@(itemName)() {
        $("#txtNewValue@(itemName)").val("");
    }

    function PopAddFieldView@(itemName)(mtlItemChangeDetailIdd) {
        $("#addModalQuery@(itemName)").modal({
            backdrop: "static",
            keyboard: false,
            show: true
        });
        ComboBoxs.WithText("#cboAddField@(itemName)", "@Url.Action("GetType", "BasicInformation")", { "TypeSchema": "MtlitemChange.FieldNum" }, "", "NA", "", "TypeName", "TypeNo");
        setInputType@(itemName)()
        $("#cboAddField@(itemName)").val("");

        $("#txtNewValue@(itemName)").val("");
        $("#txtOldTxtValue@(itemName)").val("");
        $("#txtOldValue@(itemName)").val("");
        $("#txtOldFieldValue@(itemName)").val("");
        $("#txtFieldRemark@(itemName)").val("");


        $("#MtlItemChangeDetailIdd").val(mtlItemChangeDetailIdd)

        if (mtlItemChangeDetailIdd > 0) {
            console.log(99881, $("#MtlItemChangeDetailIdd").val())
            GetDetailEdit@(itemName)(mtlItemChangeDetailIdd);
        }

        //$("#cboAddField@(itemName)").val("MB005");
    }

    function Detail@(itemName)(MtlItemChangeId) {
        if ($(`tr[data-mo-id=${MtlItemChangeId}]`).css("display") == "none") {
                $("tr[data-mo-id]").hide();
            $(`tr[data-mo-id=${MtlItemChangeId}]`).show();
            } else {
                $("tr[data-mo-id]").hide();
            }
        }



    function GetDetail@(itemName)(mtlItemChangeId, changeEdition) {
        let html = '';
        let pageCount = 0;
        let edition = "";
        let sort = "";
        edition = ('0000' + changeEdition).substr(-4);

            let targetUrl = "@Url.Action("GetMtlChangeDetail", "Product")";
            let postData = {
                "MtlItemChangeId": mtlItemChangeId,
                "ChangeEdition": edition

            };

            let data = DataAccess.Get(targetUrl, postData, false);

            if (data.status == "success") {

                if (data.result.length > 0) {

                    $.each(data.result, function (i, item) {
                        mtlItemId@(itemName) = item.MtlItemId;
                        cangeEdition@(itemName) = item.ChangeEdition;

                        isTransfer@(itemName) = item.TransferStatus;

                        isConfirm@(itemName)  = item.ConfirmStatus;

                        $("#txtMtlItemId@(itemName)").val(item.MtlItemId);
                        $("#txtMtlItemNo@(itemName)").val(item.MtlItemNo);
                        $("#txtLastModifiedBy@(itemName)").val(item.UpdateUserNo != "" ? (item.UpdateUserNo + "-" + item.UpdateUserName) : "");
                        $("#txtOriginalMtlItemName@(itemName)").val(item.OriginalMtlItemName);
                        $("#txtNewMtlItemName@(itemName)").val(item.NewMtlItemName);
                        $("#txtOriginalMtlItemSpec@(itemName)").val(item.OriginalMtlItemSpec);
                        $("#txtNewMtlItemSpec@(itemName)").val(item.NewMtlItemSpec);
                        $("#txtEdition@(itemName)").val(cangeEdition@(itemName));
                        $("#txtChangeDate@(itemName)").val(item.ChangeDate);
                        $("#txtCheckedBy@(itemName)").val(item.ConfirmUserNo != "" ? (item.ConfirmUserNo + "-" + item.ConfirmUserName) : "");
                        $("#txtCheckedDate@(itemName)").val(item.ConfirmDate);
                        $("#txtRemark@(itemName)").val(item.Remark);

                        let json = item.MtlItemChangeDetails;
                        html = MtlChangeSubData@(itemName)(json);
                        $(".advanced-block").show();
                        if (item.TransferStatus == "Y") {
                            $("#txtNewMtlItemName@(itemName)").attr("readonly", true)
                            $("#txtNewMtlItemSpec@(itemName)").attr("readonly", true)
                            $("#txtRemark@(itemName)").attr("readonly", true)
                            $("#PopAddFieldView@(itemName)").hide();
                            $("#btnSave@(itemName)").hide();
                            $("#popMtl@(itemName)").hide();
                            $("#clearTxt@(itemName)").hide();

                        } else {
                            $("#txtNewMtlItemName@(itemName)").attr("readonly", false)
                            $("#txtNewMtlItemSpec@(itemName)").attr("readonly", false)
                            $("#txtRemark@(itemName)").attr("readonly", false)
                            $("#PopAddFieldView@(itemName)").show();
                            $("#btnSave@(itemName)").show();
                            $("#popMtl@(itemName)").show();
                            $("#clearTxt@(itemName)").hide();
                        }

                        @*if (isConfirm@(itemName) != "Y") {
                            $("#PopAddFieldView@(itemName)").show();
                            $("#btnSave@(itemName)").show();
                            $("#txtNewMtlItemName@(itemName)").attr("readonly", false)
                            $("#txtNewMtlItemSpec@(itemName)").attr("readonly", false)
                        } else {
                            $("#PopAddFieldView@(itemName)").hide();
                            $("#btnSave@(itemName)").hide();
                            $("#txtNewMtlItemName@(itemName)").attr("readonly", true)
                            $("#txtNewMtlItemSpec@(itemName)").attr("readonly", true)
                        }*@
                    });
                } else {
                    $(".advanced-block").hide();
                }
            } else {
                alert(data.msg, "alert", 0);
            }

        $("#fteldTblData@(itemName) tbody").html(html);
        TableComponentInit();


        function MtlChangeSubData@(itemName)(DetailData) {

            let html = '';
            let json = DetailData;
            newSort@(itemName) = ('0000' + (json.length + 1)).substr(-4);
            console.log(1254,newSort@(itemName))
            if (json.length > 0) {


                for (let x = 0; x < json.length; x++) {


                   html += `<tr>
                            <td class="tbody-customized text-center" title="${json[x].FieldNum}">${json[x].FieldNum}</td>
                            <td class="tbody-customized text-center" title="${json[x].FieldName}">${json[x].FieldName}</td>
                            <td class="tbody-customized text-center" title="${json[x].NewTextField}">${json[x].NewTextField}</td>
                            <td class="tbody-customized text-center" title="${json[x].NewFieldName}">${json[x].NewFieldName}</td>
                            <td class="tbody-customized text-center" title="${json[x].OriginalTextField}">${json[x].OriginalTextField}</td>
                            <td class="tbody-customized text-center" title="${json[x].OriginalFieldName}">${json[x].OriginalFieldName}</td>
                            <td class="tbody-customized text-center" title="${json[x].NewNumericField}">${json[x].NewNumericField}</td>
                            <td class="tbody-customized text-center" title="${json[x].OriginalNumericField}">${json[x].OriginalNumericField}</td>
                            <td class="text-center active-content">

                                ${isTransfer@(itemName) == `Y` ?
                                        `<a class="active-link detail-button active-disable" href="javascript:void();"><i class="fas fa-edit"></i></a>`
                       : `<a class="active-link detail-button" href="javascript:PopAddFieldView@(itemName)(${json[x].MtlChangeDetailId});"><i class="fas fa-edit"></i></a>`
                                 }

                                ${isTransfer@(itemName) == `Y` ?
                                        `<a class="active-link detail-button active-disable" href="javascript:void();"><i class="fas fa-trash-alt"></i></a>`
                                        : `<a class="active-link detail-button" href="javascript:DeleteField@(itemName)(${json[x].MtlChangeDetailId});"><i class="fas fa-trash-alt"></i></a>`
                                 }


                            </td >
                           </tr>`;
                }
            } else {
                html += `<tr>
                       <td class="text-center" colspan="10" style="background-color: #fff3cd;">
                           <i class="fal fa-exclamation-circle"></i>&nbsp;目前尚無單身資料。
                       </td>
                     </tr>`;

            }

            return html;
        }
    }

    function EditField@(itemName)() {
        let detailId = $("#MtlItemChangeDetailIdd").val();

        if (detailId < 0) {
            AddField@(itemName)();
        } else {
            UpdateField@(itemName)(detailId);
        }
    }

    function GetDetailEdit@(itemName)(mtlItemChangedetailId) {


            let targetUrl = "@Url.Action("GetMtlChangeDetailEdit", "Product")";
            let postData = {
                "MtlItemChangeDetailId": mtlItemChangedetailId

            };

            let data = DataAccess.Get(targetUrl, postData, false);

            if (data.status == "success") {

                if (data.result.length > 0) {

                    $.each(data.result, function (i, item) {

                        $("#cboAddField@(itemName)").val(item.FieldNum);
                        setInputType@(itemName)();

                        if (item.FieldType == "V") {
                            $("#txtNewValue@(itemName)").val(item.NewTextField);
                        } else {
                            $("#txtNewValue@(itemName)").val(item.NewNumericField);
                        }
                        $("#txtOldTxtValue@(itemName)").val(item.OriginalTextField );
                        $("#txtOldValue@(itemName)").val(item.OriginalFieldName);
                        $("#txtOldFieldValue@(itemName)").val(item.OriginalNumericField);
                        $("#txtFieldRemark@(itemName)").val(item.Remark);

                        console.log(54668, $("#cboAddField@(itemName)").val(), $("#txtNewValue@(itemName)").val(), item)
                    });

                } else {
                }
            } else {
                alert(data.msg, "alert", 0);
            }


    }

    function AddField@(itemName)() {
        if ($("#cboAddField@(itemName)").val() == "") {
            alert("請選擇欲填欄位", "alert", 0);
        }
        //ComboBoxs.WithText("#cboLotManagement@(itemName)", "@Url.Action("GetType", "BasicInformation")", { "TypeSchema": "MtlItem.LotManagement" }, "N", "NA", "", "TypeName", "TypeNo");

        if ($("#txtNewValue@(itemName)").val() != "") {
            console.log(2354, $("#txtNewValue@(itemName) option:selected").text(), $("#txtNewValue@(itemName) option:selected").val(), $("#txtNewValue@(itemName) option:selected").html())
            let newFieldName = "";

            switch ($("#cboAddField@(itemName)").val()) {//newFieldName = $("#txtNewValue@(itemName) option:selected").text().slice(1, 8);
                case 'MB005'://倉庫別 品號類別代號 下拉
                case 'MB006'://倉管別(部門) 品號類別代號 下拉
                case 'MB007'://業務 品號類別代號 下拉
                case 'MB008'://生管 品號類別代號 列表
                case 'MB017'://主要庫別 庫別 列表
                case 'MB157'://主要領料庫別 庫別 列表
                case 'MB004'://庫存單位 單位 列表
                case 'MB155'://採購單位 單位 列表
                case 'MB156'://銷售單位 單位 列表
                    fieldType@(itemName) = "V";
                    newFieldName = $("#txtNewValue@(itemName) option:selected").text().slice(4, 20);
                    break;
                case 'MB025'://品號屬性 P-採購件 M-自製件 S-託外加工件 Y-虛設件 F-Feature件 O-Option件 下拉
                case 'MB043'://檢驗方式 0-免檢 1-抽檢(減量) 2-抽檢(正常) 3-抽檢(加嚴) 4-全檢 下拉
                case 'MB019'://庫存管理

                    fieldType@(itemName) = "V";
                    newFieldName = $("#txtNewValue@(itemName) option:selected").text();
                    break;
                case 'MB068'://生產線別

                    fieldType@(itemName) = "V";
                    newFieldName = $("#txtNewValue@(itemName) option:selected").text().slice(3, 20);
                    break;
                case 'MB022'://批量管理 列表
                case 'MB034'://補貨政策

                    fieldType@(itemName) = "V";
                    newFieldName = $("#txtNewValue@(itemName) option:selected").text().slice(1, 20);
                    break;

                case 'MB039'://最低補量 MinPoQty
                case 'MB040'://補貨倍量 MultiplePoQty
                case 'MB041'://領用倍量 MultipleReqQty
                case 'MB070'://售價定價六
                case 'MB036'://固定前置天數
                case 'MB037'://變動前置天數
                    fieldType@(itemName) = "N";
                    break;

                default:
                    fieldType@(itemName) = "V";
                    newFieldName = $("#txtNewValue@(itemName)").val();
                    break;
            }

            let targetUrl = "@Url.Action("AddMtlItemChangeDetail", "Product")";
            let postData = {
                "MtlItemChangeId": $("#MtlItemChangeId").val(),
                "MtlItemId": mtlItemId@(itemName) ,
                "ChangeEdition": cangeEdition@(itemName) ,
                "FieldNum": $("#cboAddField@(itemName)").val(),
                "FieldName": $("#cboAddField@(itemName) option:selected").text().slice(6, 12),
                "NewTextField": $("#txtNewValue@(itemName)").val(),
                "NewNumericField": $("#txtNewValue@(itemName)").val(),
                "OriginalNumericField": $("#txtOldFieldValue@(itemName)").val(),
                "NewFieldName": newFieldName,
                "OriginalFieldName": $("#txtOldValue@(itemName)").val(),
                "Remark": $("#txtFieldRemark@(itemName)").val(),
                "FieldType": fieldType@(itemName),
                "SortNum": newSort@(itemName),
                "OriginalTextField": $("#txtOldTxtValue@(itemName)").val()
            };
            let data = DataAccess.EditContinued(targetUrl, postData, false);
            if (data) {

                //ExpandMtlChangeDetail(mtlItemChangeId);
                $("#addModalQuery@(itemName)").modal("hide");
                newSort@(itemName) = "";
                GetDetail@(itemName)($("#MtlItemChangeId").val(), cangeEdition@(itemName));
                $("#cboAddField@(itemName)").val("");
                $("#txtNewValue@(itemName)").val("");
            }


            $("#addModalQuery@(itemName)").modal("hide");
        } else {
            if (($("#cboAddField@(itemName)").val() != "MB030") && ($("#cboAddField@(itemName)").val() != "MB031")) {
                alert("請輸入數值!", "alert", 0);

            } else {
                fieldType@(itemName) = "V";
                newFieldName = $("#txtNewValue@(itemName)").val();

                let targetUrl = "@Url.Action("AddMtlItemChangeDetail", "Product")";
                let postData = {
                    "MtlItemChangeId": $("#MtlItemChangeId").val(),
                    "MtlItemId": mtlItemId@(itemName) ,
                    "ChangeEdition": cangeEdition@(itemName) ,
                    "FieldNum": $("#cboAddField@(itemName)").val(),
                    "FieldName": $("#cboAddField@(itemName) option:selected").text().slice(6, 12),
                    "NewTextField": $("#txtNewValue@(itemName)").val(),
                    "NewNumericField": $("#txtNewValue@(itemName)").val(),
                    "OriginalNumericField": $("#txtOldFieldValue@(itemName)").val(),
                    "NewFieldName": newFieldName,
                    "OriginalFieldName": $("#txtOldValue@(itemName)").val(),
                    "Remark": $("#txtFieldRemark@(itemName)").val(),
                    "FieldType": fieldType@(itemName),
                    "SortNum": newSort@(itemName),
                    "OriginalTextField": $("#txtOldTxtValue@(itemName)").val()
                };
                let data = DataAccess.EditContinued(targetUrl, postData, false);
                if (data) {

                    //ExpandMtlChangeDetail(mtlItemChangeId);
                    $("#addModalQuery@(itemName)").modal("hide");
                    newSort@(itemName) = "";
                    GetDetail@(itemName)($("#MtlItemChangeId").val(), cangeEdition@(itemName));
                    $("#cboAddField@(itemName)").val("");
                    $("#txtNewValue@(itemName)").val("");
                }


                $("#addModalQuery@(itemName)").modal("hide");
            }
        
        }
    }

    function UpdateField@(itemName)(mtlChangeDetailId) {
        if ($("#cboAddField@(itemName)").val() == "") {
            alert("請選擇欲填欄位", "alert", 0);
        }

        if ($("#txtNewValue@(itemName)").val() != "") {
            let newFieldName = "";

            switch ($("#cboAddField@(itemName)").val()) {
                case 'MB005'://倉庫別 品號類別代號 下拉
                case 'MB006'://倉管別(部門) 品號類別代號 下拉
                case 'MB007'://業務 品號類別代號 下拉
                case 'MB008'://生管 品號類別代號 列表
                case 'MB017'://主要庫別 庫別 列表
                case 'MB157'://主要領料庫別 庫別 列表
                case 'MB004'://庫存單位 單位 列表
                case 'MB155'://採購單位 單位 列表
                case 'MB156'://銷售單位 單位 列表
                    fieldType@(itemName) = "V";
                    newFieldName = $("#txtNewValue@(itemName) option:selected").text().slice(4, 20);
                    break;
                case 'MB025'://品號屬性 P-採購件 M-自製件 S-託外加工件 Y-虛設件 F-Feature件 O-Option件 下拉
                case 'MB043'://檢驗方式 0-免檢 1-抽檢(減量) 2-抽檢(正常) 3-抽檢(加嚴) 4-全檢 下拉
                case 'MB019'://庫存管理


                    fieldType@(itemName) = "V";
                    newFieldName = $("#txtNewValue@(itemName) option:selected").text();
                    break;
                case 'MB068'://生產線別

                    fieldType@(itemName) = "V";
                    newFieldName = $("#txtNewValue@(itemName) option:selected").text().slice(3, 20);
                    break;
                case 'MB022'://批量管理 列表
                case 'MB034'://補貨政策

                    fieldType@(itemName) = "V";
                    newFieldName = $("#txtNewValue@(itemName) option:selected").text().slice(1, 20);
                    break;

                case 'MB039'://最低補量 MinPoQty
                case 'MB040'://補貨倍量 MultiplePoQty
                case 'MB041'://領用倍量 MultipleReqQty
                case 'MB070'://售價定價六
                case 'MB036'://固定前置天數
                case 'MB037'://變動前置天數
                    fieldType@(itemName) = "N";
                    break;

                default:
                    fieldType@(itemName) = "V";
                    newFieldName = $("#txtNewValue@(itemName)").val();
                    break;
            }

            let targetUrl = "@Url.Action("UpdateMtlItemChangeDetail", "Product")";
            let postData = {
                "MtlItemChangeId": $("#MtlItemChangeId").val(),
                "MtlChangeDetailId": mtlChangeDetailId,
                "FieldNum": $("#cboAddField@(itemName)").val(),
                "FieldName": $("#cboAddField@(itemName) option:selected").text().slice(6, 12),
                "NewTextField": $("#txtNewValue@(itemName)").val(),
                "NewNumericField": $("#txtNewValue@(itemName)").val(),
                "OriginalNumericField": $("#txtOldFieldValue@(itemName)").val(),
                "NewFieldName": newFieldName,
                "OriginalFieldName": $("#txtOldValue@(itemName)").val(),
                "OriginalTextField": $("#txtOldTxtValue@(itemName)").val(),
                "FieldType": fieldType@(itemName),
                "Remark": $("#txtFieldRemark@(itemName)").val()
            };
            let data = DataAccess.EditContinued(targetUrl, postData, false);
            if (data) {

                //ExpandMtlChangeDetail(mtlItemChangeId);
                $("#addModalQuery@(itemName)").modal("hide");
                GetDetail@(itemName)($("#MtlItemChangeId").val(), cangeEdition@(itemName));
                $("#cboAddField@(itemName)").val("");
                $("#txtNewValue@(itemName)").val("");
            }


            $("#addModalQuery@(itemName)").modal("hide");
        } else {
            if (($("#cboAddField@(itemName)").val() != "MB030") && ($("#cboAddField@(itemName)").val() != "MB031")) {
                alert("請輸入數值!", "alert", 0);

            } else {
                fieldType@(itemName) = "V";
                newFieldName = $("#txtNewValue@(itemName)").val();

                let targetUrl = "@Url.Action("AddMtlItemChangeDetail", "Product")";
                let postData = {
                    "MtlItemChangeId": $("#MtlItemChangeId").val(),
                    "MtlItemId": mtlItemId@(itemName) ,
                    "ChangeEdition": cangeEdition@(itemName) ,
                    "FieldNum": $("#cboAddField@(itemName)").val(),
                    "FieldName": $("#cboAddField@(itemName) option:selected").text().slice(6, 12),
                    "NewTextField": $("#txtNewValue@(itemName)").val(),
                    "NewNumericField": $("#txtNewValue@(itemName)").val(),
                    "OriginalNumericField": $("#txtOldFieldValue@(itemName)").val(),
                    "NewFieldName": newFieldName,
                    "OriginalFieldName": $("#txtOldValue@(itemName)").val(),
                    "Remark": $("#txtFieldRemark@(itemName)").val(),
                    "FieldType": fieldType@(itemName),
                    "SortNum": newSort@(itemName),
                    "OriginalTextField": $("#txtOldTxtValue@(itemName)").val()
                };
                let data = DataAccess.EditContinued(targetUrl, postData, false);
                if (data) {

                    //ExpandMtlChangeDetail(mtlItemChangeId);
                    $("#addModalQuery@(itemName)").modal("hide");
                    newSort@(itemName) = "";
                    GetDetail@(itemName)($("#MtlItemChangeId").val(), cangeEdition@(itemName));
                    $("#cboAddField@(itemName)").val("");
                    $("#txtNewValue@(itemName)").val("");
                }


                $("#addModalQuery@(itemName)").modal("hide");
            }
        
        }
    }

    function DeleteField@(itemName)(mtlChangeDetailId) {
        swal.fire({
                    titleText: "確認要刪除嗎?",
                    text: "此動作無法復原，請確認是否要執行!",
                    icon: "warning",
                    allowOutsideClick: false,
                    allowEscapeKey: false,
                    showCancelButton: true,
                    confirmButtonColor: '#d33',
                    reverseButtons: true
        }).then((pass) => {
            if (pass.isConfirmed) {
                let targetUrl = "@Url.Action("DeleteMtlItemChangeDetail", "Product")";
                let postData = {
                    "MtlChangeDetailId": mtlChangeDetailId
                };

                let result = DataAccess.Delete(targetUrl, postData, false, false);

                if (result) {
                    GetDetail@(itemName)($("#MtlItemChangeId").val(), cangeEdition@(itemName));
                }
            }
        });
    }

    function setInputType@(itemName)() {
        let innerHtml = ""
        switch ($("#cboAddField@(itemName)").val()) {
            case 'MB005'://倉庫別 品號類別代號 下拉
            case 'MB006'://倉管別(部門) 品號類別代號 下拉
            case 'MB007'://業務 品號類別代號 下拉
            case 'MB008'://生管 品號類別代號 列表
            case 'MB017'://主要庫別 庫別 列表
            case 'MB025'://品號屬性 P-採購件 M-自製件 S-託外加工件 Y-虛設件 F-Feature件 O-Option件 下拉
            case 'MB043'://檢驗方式 0-免檢 1-抽檢(減量) 2-抽檢(正常) 3-抽檢(加嚴) 4-全檢 下拉
            case 'MB157'://主要領料庫別 庫別 列表
            case 'MB004'://庫存單位 單位 列表
            case 'MB155'://採購單位 單位 列表
            case 'MB156'://銷售單位 單位 列表
            case 'MB068'://生產線別
            case 'MB022'://批量管理 列表
            case 'MB034'://補貨管理 列表


                innerHtml += `<select class="form-control" id="txtNewValue@(itemName)" name="txtNewValue@(itemName)" data-rule-required="true" ></select>`;
                break;
            case 'MB009'://商品描述 文字
                innerHtml += `<input type="text" class="form-control" id="txtNewValue@(itemName)" name="txtNewValue@(itemName)"
                                placeholder="請輸入商品描述"
                                data-msg-maxlength="必須少於 255 個字元" maxlength="255"
                              />`;
                break;

            case 'MB028'://備註 文字
                innerHtml += `<input type="text" class="form-control" id="txtNewValue@(itemName)" name="txtNewValue@(itemName)"
                                placeholder="請輸入備註"
                                data-msg-maxlength="必須少於 255 個字元" maxlength="255"
                              />`;
                break;
            case 'MB030'://生效日期 日期套件
                innerHtml += `<input type="text" class="form-control" id="txtNewValue@(itemName)" name="txtNewValue@(itemName)"
                                placeholder="請輸入生效日期"
                                data-msg-required="請輸入生效日期" data-rule-required="true"
                                data-msg-extraRegex="請輸入正確的日期格式" data-rule-extraRegex="([12]\d{3}\-(0[1-9]|1[0-2])\-(0[1-9]|[12]\d|3[01]))"
                              />
<div class="input-group-append">
                                            <a class="btn btn-outline-danger pop-clear" id="clearTxt2@(itemName)" href="javascript:NewValueClear@(itemName)();"><i class="fas fa-eraser"></i></a>
                                        </div>`;

                break;
            case 'MB031'://失效日期 日期套件
                innerHtml += `<input type="text" class="form-control" id="txtNewValue@(itemName)" name="txtNewValue@(itemName)"
                                placeholder="請輸入失效日期"
                                data-msg-required="請輸入失效日期" data-rule-required="true"
                                data-msg-extraRegex="請輸入正確的日期格式" data-rule-extraRegex="([12]\d{3}\-(0[1-9]|1[0-2])\-(0[1-9]|[12]\d|3[01]))"
                              />
<div class="input-group-append">
                                            <a class="btn btn-outline-danger pop-clear" id="clearTxt2@(itemName)" href="javascript:NewValueClear@(itemName)();"><i class="fas fa-eraser"></i></a>
                                        </div>`;

                break;
            case 'MB019'://庫存管理
                innerHtml += `<select class="form-control" id="txtNewValue@(itemName)" name="txtNewValue@(itemName)" data-rule-required="true" >
                                <option>請選擇</option>
                                <option value="Y">Y</option>
                                <option value="N">N</option>
                              </select>`;
                break;

            case 'MB036'://
            case 'MB037'://
                innerHtml += `<input type="number" class="form-control" id="txtNewValue@(itemName)" name="txtNewValue@(itemName)"
                                placeholder="請輸入新數值" data-rule-required="true" value="0" min="0" step="1"
                              />`;
                break;

            default://
                innerHtml += `<input type="number" class="form-control" id="txtNewValue@(itemName)" name="txtNewValue@(itemName)"
                                placeholder="請輸入新數值" data-rule-required="true" value="0" min="0" step="0.0001"
                              />`;
            break;
        }

        $("#newValueType@(itemName)").html(innerHtml);

        switch ($("#cboAddField@(itemName)").val()) {
            case 'MB005'://倉庫別 品號類別代號 下拉
                $("#txtNewValue@(itemName)").select2({
                    dropdownAutoWidth: true,
                    width: "100%"
                });
                ComboBoxs.WithText("#txtNewValue@(itemName)", "@Url.Action("GetErpData", "BasicInformation")", { "ColumnName": "MtlItemType", "Condition": 1 }, "", "NA", "", "TypeName", "TypeNo");
                break;
            case 'MB006'://倉管別(部門) 品號類別代號 下拉
                $("#txtNewValue@(itemName)").select2({
                    dropdownAutoWidth: true,
                    width: "100%"
                });
                ComboBoxs.WithText("#txtNewValue@(itemName)", "@Url.Action("GetErpData", "BasicInformation")", { "ColumnName": "MtlItemType", "Condition": 2 }, "", "NA", "", "TypeName", "TypeNo");
                break;
            case 'MB007'://業務 品號類別代號 下拉
                $("#txtNewValue@(itemName)").select2({
                    dropdownAutoWidth: true,
                    width: "100%"
                });
                ComboBoxs.WithText("#txtNewValue@(itemName)", "@Url.Action("GetErpData", "BasicInformation")", { "ColumnName": "MtlItemType", "Condition": 3 }, "", "NA", "", "TypeName", "TypeNo");
                break;
            case 'MB008'://生管 品號類別代號 列表
                $("#txtNewValue@(itemName)").select2({
                    dropdownAutoWidth: true,
                    width: "100%"
                });
                ComboBoxs.WithText("#txtNewValue@(itemName)", "@Url.Action("GetErpData", "BasicInformation")", { "ColumnName": "MtlItemType", "Condition": 4 }, "", "NA", "", "TypeName", "TypeNo");
                break
            case 'MB009'://商品描述 文字
                break;
            case 'MB017'://主要庫別 庫別 列表
                $("#txtNewValue@(itemName)").select2({
                    dropdownAutoWidth: true,
                    width: "100%"
                });
                ComboBoxs.Default("#txtNewValue@(itemName)", "@Url.Action("GetInventory", "ScmBasicInformation")", {}, "", "NA", "", "InventoryWithNo", "InventoryNo");//InventoryWithNo
                break;
            case 'MB025'://品號屬性 P-採購件 M-自製件 S-託外加工件 Y-虛設件 F-Feature件 O-Option件 下拉
                $("#txtNewValue@(itemName)").select2({
                    dropdownAutoWidth: true,
                    width: "100%"
                });
                ComboBoxs.Default("#txtNewValue@(itemName)", "@Url.Action("GetType", "BasicInformation")", { "TypeSchema": "MtlItem.ItemAttribute" }, "", "NA", "", "TypeName", "TypeNo");
                break;
            case 'MB028'://備註 文字
                break;
            case 'MB030'://生效日期 日期套件
                let currentDate1 = new Date();
                Suites.DateDropper("#txtNewValue@(itemName)");
                Suites.SetDateDropper("#txtNewValue@(itemName)", currentDate1);
                break;
            case 'MB031'://失效日期 日期套件
                let currentDate2 = new Date();
                Suites.DateDropper("#txtNewValue@(itemName)");
                Suites.SetDateDropper("#txtNewValue@(itemName)", currentDate2);
                break;
            case 'MB043'://檢驗方式 0-免檢 1-抽檢(減量) 2-抽檢(正常) 3-抽檢(加嚴) 4-全檢 下拉
                $("#txtNewValue@(itemName)").select2({
                    dropdownAutoWidth: true,
                    width: "100%"
                });

                ComboBoxs.Default("#txtNewValue@(itemName)", "@Url.Action("GetType", "BasicInformation")", { "TypeSchema": "MtlItem.MeasureType" }, "4", "NA", "", "TypeName", "TypeNo");
                break;
            case 'MB157'://主要領料庫別 庫別 列表
                $("#txtNewValue@(itemName)").select2({
                    dropdownAutoWidth: true,
                    width: "100%"
                });
                ComboBoxs.Default("#txtNewValue@(itemName)", "@Url.Action("GetInventory", "ScmBasicInformation")", {}, "", "NA", "", "InventoryWithNo", "InventoryNo");
                break;
            case 'MB004'://庫存單位 單位 列表
                $("#txtNewValue@(itemName)").select2({
                    dropdownAutoWidth: true,
                    width: "100%"
                });
                ComboBoxs.Default("#txtNewValue@(itemName)", "@Url.Action("GeErpUnit", "Product")", {}, "", "NA", "", "UomWithNo", "UomNo");

                break;
            case 'MB155'://採購單位 單位 列表
                $("#txtNewValue@(itemName)").select2({
                    dropdownAutoWidth: true,
                    width: "100%"
                });
                ComboBoxs.Default("#txtNewValue@(itemName)", "@Url.Action("GeErpUnit", "Product")", {}, "", "NA", "", "UomWithNo", "UomNo");

                break;
            case 'MB156'://銷售單位 單位 列表
                $("#txtNewValue@(itemName)").select2({
                    dropdownAutoWidth: true,
                    width: "100%"
                });
                ComboBoxs.Default("#txtNewValue@(itemName)", "@Url.Action("GeErpUnit", "Product")", {}, "", "NA", "", "UomWithNo", "UomNo");
                break;

            case 'MB068'://生產線別
                $("#txtNewValue@(itemName)").select2({
                    dropdownAutoWidth: true,
                    width: "100%"
                });
                ComboBoxs.WithText("#txtNewValue@(itemName)", "@Url.Action("GetErpData", "BasicInformation")", { "ColumnName": "ProduceLineNo" }, "", "NA", "", "ProduceLineName", "ProduceLineNo");
                break;
            case 'MB019'://庫存管理
                $("#txtNewValue@(itemName)").select2({
                    dropdownAutoWidth: true,
                    width: "100%"
                });
                break;
            case 'MB022'://批量管理 列表

                $("#txtNewValue@(itemName)").select2({
                    dropdownAutoWidth: true,
                    width: "100%"
                });
                ComboBoxs.WithText("#txtNewValue@(itemName)", "@Url.Action("GetType", "BasicInformation")", { "TypeSchema": "MtlItem.LotManagement" }, "N", "NA", "", "TypeName", "TypeNo");
                break;
            case 'MB034'://補貨政策 列表

                $("#txtNewValue@(itemName)").select2({
                    dropdownAutoWidth: true,
                    width: "100%"
                });
                ComboBoxs.WithText("#txtNewValue@(itemName)", "@Url.Action("GetType", "BasicInformation")", { "TypeSchema": "ReplenishmentPolicy" }, "N", "NA", "", "TypeName", "TypeNo");
                break;
            default:

                break;

        }
    }

    function Transfer@(itemName)(mtlItemChangeId) {
        swal.fire({
            titleText: "是否要拋轉ERP?",
            text: "請確認是否要執行!",
            icon: "warning",
            allowOutsideClick: false,
            allowEscapeKey: false,
            showCancelButton: true,
            confirmButtonColor: '#d33',
            reverseButtons: true
        }).then((pass) => {
            if (pass.isConfirmed) {
                let targetUrl = "@Url.Action("UpdateMtlitemChangeToErp", "Product")";
                let postData = {
                    "MtlItemChangeId": mtlItemChangeId,
                };
                let data = DataAccess.EditContinued(targetUrl, postData, false);
                if (data) {
                    //ExpandMtlChangeDetail(mtlItemChangeId);
                    $("#addModalQuery@(itemName)").modal("hide");
                    alert("拋轉成功", "success")
                    Query@(itemName)()
                }
            }
        });
    }

    function Transfer2@(itemName)() {
        swal.fire({
            titleText: "是否要拋轉ERP?",
            text: "請確認是否要執行!",
            icon: "warning",
            allowOutsideClick: false,
            allowEscapeKey: false,
            showCancelButton: true,
            confirmButtonColor: '#d33',
            reverseButtons: true
        }).then((pass) => {
            if (pass.isConfirmed) {
                let targetUrl = "@Url.Action("UpdateMtlitemChangeToErp", "Product")";
                let postData = {
                    "MtlItemChangeId": $("#MtlItemChangeId").val()
                };
                let data = DataAccess.EditContinued(targetUrl, postData, false);
                if (data) {
                    //ExpandMtlChangeDetail(mtlItemChangeId);
                    $("#addModalQuery@(itemName)").modal("hide");
                    alert("拋轉成功", "success")
                    Query@(itemName)();
                }
            }
        });
    }

    function GetMtlItem@(itemName)(mtlItemId) {
        let targetUrl = "@Url.Action("GetMtlItem", "Product")";
                let postData = {
                    "MtlItemId": mtlItemId
                };

                let data = DataAccess.Get(targetUrl, postData, false);

                if (data.status == "success") {
                    $.each(data.result, function (i, item) {
                        switch ($("#cboAddField@(itemName)").val()) {
                            case 'MB005'://會計
                                $("#txtOldTxtValue@(itemName)").val(item.TypeOne)
                                GetMtlItemType@(itemName)("1", item.TypeOne)
                                break;

                            case 'MB006'://倉管
                                $("#txtOldTxtValue@(itemName)").val(item.TypeTwo)
                                GetMtlItemType@(itemName)("2", item.TypeTwo)
                                break;

                            case 'MB007'://業務
                                $("#txtOldTxtValue@(itemName)").val(item.TypeThree)
                                GetMtlItemType@(itemName)("3", item.TypeThree)
                                break;

                            case 'MB008'://生管
                                $("#txtOldTxtValue@(itemName)").val(item.TypeFour)
                                GetMtlItemType@(itemName)("4", item.TypeFour)
                                break;

                            case 'MB017'://主要庫別
                                GetInventory@(itemName)(item.InventoryId)
                                break;

                            case 'MB025'://品號屬性 P-採購件 M-自製件 S-託外加工件 Y-虛設件 F-Feature件 O-Option件
                                GetType@(itemName)("MtlItem.ItemAttribute", item.ItemAttribute);
                                $("#txtOldTxtValue@(itemName)").val(item.ItemAttribute)

                                break;

                            case 'MB043'://檢驗方式 0-免檢 1-抽檢(減量) 2-抽檢(正常) 3-抽檢(加嚴) 4-全檢
                                GetType@(itemName)("MtlItem.MeasureType", item.MeasureType)
                                $("#txtOldTxtValue@(itemName)").val(item.MeasureType)
                                break;

                            case 'MB157'://主要領料庫別
                                GetInventory@(itemName)(item.RequisitionInventoryId)
                                break;


                            case 'MB009'://商品描述 文字
                                $("#txtOldTxtValue@(itemName)").val(item.MtlItemDesc)
                                $("#txtOldValue@(itemName)").val(item.MtlItemDesc)
                                break;

                            case 'MB028'://備註 文字
                                $("#txtOldTxtValue@(itemName)").val(item.MtlItemRemark)
                                $("#txtOldValue@(itemName)").val(item.MtlItemRemark)
                                break;
                            case 'MB030'://生效日期 日期套件 new Date(item.ExpirationDate) dateTostring(date)

                                var date = new Date(item.EffectiveDate);
                                var oeffectiveDate = "";
                                if (item.EffectiveDate != null) {
                                    oeffectiveDate =
                                        date.getFullYear() + "-" +
                                        ("00" + (date.getMonth() + 1)).slice(-2) + "-" +
                                        ("00" + date.getDate()).slice(-2);
                                } else {
                                    oeffectiveDate = "";
                                }

                                $("#txtOldTxtValue@(itemName)").val(oeffectiveDate);
                                $("#txtOldValue@(itemName)").val(oeffectiveDate);
                                break;
                            case 'MB031'://失效日期 日期套件
                                var date = new Date(item.ExpirationDate);
                                var oexpirationDate = "";

                                if (item.ExpirationDate != null) {
                                    oexpirationDate =
                                        date.getFullYear() + "-" +
                                        ("00" + (date.getMonth() + 1)).slice(-2) + "-" +
                                        ("00" + date.getDate()).slice(-2);
                                } else {
                                    oexpirationDate = "";
                                }

                                $("#txtOldTxtValue@(itemName)").val(oexpirationDate);
                                $("#txtOldValue@(itemName)").val(oexpirationDate);
                                break;

                            case 'MB004'://庫存單位
                                GetUom@(itemName)(item.InventoryUomId)
                                break;
                            case 'MB155'://採購單位
                                GetUom@(itemName)(item.PurchaseUomId)
                                break;
                            case 'MB156'://銷售單位
                                GetUom@(itemName)(item.SaleUomId)
                                break;

                            case 'MB068'://生產線別

                                GetProduceLine@(itemName)(item.ProduceLineNo)
                                break;
                            case 'MB039'://最低補量 MinPoQty
                                GetMtlItemSetting@(itemName)(mtlItemId, "MB039");
                                break;
                            case 'MB040'://補貨倍量 MultiplePoQty
                                GetMtlItemSetting@(itemName)(mtlItemId, "MB040");
                                break;
                            case 'MB041'://領用倍量 MultipleReqQty
                                GetMtlItemSetting@(itemName)(mtlItemId, "MB041");
                                break;
                            case 'MB070'://GePriceSix@(itemName)(mtlitemNo)
                                GePriceSix@(itemName)(item.MtlitemNo);
                                break;
                             case 'MB019'://庫存管理
                                $("#txtOldTxtValue@(itemName)").val(item.InventoryManagement)
                                $("#txtOldValue@(itemName)").val(item.InventoryManagement);

                                break;
                            case 'MB036'://固定天數
                                GetPreday@(itemName)(item.MtlitemNo, "MB036")
                                break;
                            case 'MB037'://變動天數
                                GetPreday@(itemName)(item.MtlitemNo, "MB037")
                                break;
                             case 'MB022'://批量管理
                                GetType@(itemName)("MtlItem.LotManagement", item.LotManagement);
                                $("#txtOldTxtValue@(itemName)").val(item.LotManagement)
                                break;
                            case 'MB034'://補貨政策
                                GetType@(itemName)("ReplenishmentPolicy", item.ReplenishmentPolicy);
                                $("#txtOldTxtValue@(itemName)").val(item.ReplenishmentPolicy)
                             default:
                             break;
                        }
                    });


                } else {
                    alert(data.msg, "alert", 0);
                }

    }

    function GetType@(itemName)(typeSchema, no) {
        let targetUrl = "@Url.Action("GetType", "BasicInformation")";
        let postData = {
            "TypeSchema": typeSchema,
            "TypeNo": no
        };
        let data = DataAccess.Get(targetUrl, postData, false);
        if (data.status == "success") {
            $.each(data.result, function (i, item) {
                $("#txtOldValue@(itemName)").val(item.TypeName)
            });
        }


    }

    function GetMtlItemType@(itemName)(condition, typeNo) {
        let targetUrl = "@Url.Action("GetMtlItemType", "Product")";
                let postData = {
                    "Condition": condition,
                    "TypeNo": typeNo
                };

                let data = DataAccess.Get(targetUrl, postData, false);

                if (data.status == "success") {
                    $.each(data.result, function (i, item) {
                        $("#txtOldValue@(itemName)").val(item.TypeName);
                    });
                }
    }

    function GetInventory@(itemName)(inventoryId) {
        let targetUrl = "@Url.Action("GetInventory", "ScmBasicInformation")";
                let postData = {
                    "InventoryId": inventoryId
                };

                let data = DataAccess.Get(targetUrl, postData, false);

                if (data.status == "success") {
                    $.each(data.result, function (i, item) {
                        $("#txtOldTxtValue@(itemName)").val(item.InventoryNo)
                        $("#txtOldValue@(itemName)").val(item.InventoryName);
                    });
                }
    }

    function GetUom@(itemName)(uomId) {
        let targetUrl = "@Url.Action("GetUnitOfMeasure", "PdmBasicInformation")";
                let postData = {
                    "UomId": uomId
                };

                let data = DataAccess.Get(targetUrl, postData, false);

                if (data.status == "success") {
                    $.each(data.result, function (i, item) {
                        $("#txtOldTxtValue@(itemName)").val(item.UomNo)
                        $("#txtOldValue@(itemName)").val("");
                    });
                }
    }

    function GetProduceLine@(itemName)(produceLineNo) {
        let targetUrl = "@Url.Action("GetProduceLine", "Product")";
                let postData = {
                    "ProduceLineNo": produceLineNo
                };

                let data = DataAccess.Get(targetUrl, postData, false);

                if (data.status == "success") {
                    $.each(data.result, function (i, item) {
                        $("#txtOldTxtValue@(itemName)").val(item.ProduceLineNo)
                        $("#txtOldValue@(itemName)").val(item.ProduceLineName);
                    });
                }
    }

    function GetMtlItemSetting@(itemName)(mtlItemId, field) {
        let targetUrl = "@Url.Action("GetMtlItemSetting", "Product")";
        let postData = {
            "MtlItemId": mtlItemId
        };

        let data = DataAccess.Get(targetUrl, postData, false);

        if (data.status == "success") {
            if (data.result.length > 0) {
                $.each(data.result, function (i, item) {
                    switch (field) {

                        case "MB039":
                            $("#txtOldFieldValue@(itemName)").val(item.MinPoQty);
                            break;
                        case "MB040":
                            $("#txtOldFieldValue@(itemName)").val(item.MultiplePoQty);
                            break;
                        case "MB041":
                            $("#txtOldFieldValue@(itemName)").val(item.PurchaseUomId);
                            break;
                        default:
                            break;
                    }
                });
            } else {
                $("#txtOldFieldValue@(itemName)").val("0");
            }


        } else {
            alert("品號設定值資料錯誤!", "alert", 5000);
        }

    }

    function GePriceSix@(itemName)(mtlitemNo) {
        let targetUrl = "@Url.Action("GePriceSix", "Product")";
        let postData = {
            "MtlitemNo": mtlitemNo
        };

        let data = DataAccess.Get(targetUrl, postData, false);

        if (data.status == "success") {
            if (data.result.length > 0) {
                $.each(data.result, function (i, item) {
                     $("#txtOldFieldValue@(itemName)").val(item.MB070);
                });
            } else {
                $("#txtOldFieldValue@(itemName)").val("0");
            }


        } else {
            alert("品號設定值資料錯誤!", "alert", 5000);
        }

    }

    function GetPreday@(itemName)(mtlitemNo, itemno) {
        let targetUrl = "@Url.Action("GetPreday", "Product")";
        let postData = {
            "MtlitemNo": mtlitemNo
        };

        let data = DataAccess.Get(targetUrl, postData, false);

        if (data.status == "success") {
            if (data.result.length > 0) {
                $.each(data.result, function (i, item) {
                    if (itemno = "MB036") {
                    $("#txtOldFieldValue@(itemName)").val(item.MB036);
                    } else {
                    $("#txtOldFieldValue@(itemName)").val(item.MB037);
                    }
                });
            } else {
                $("#txtOldFieldValue@(itemName)").val("0");
            }
        } else {
            alert("品號設定值資料錯誤!", "alert", 5000);
        }

    }

    //品號換算單位變更
    function GetMtlItemUomCalculate@(itemName)(objPage) {
        let innerHtml = '';
        let pageCount = 0;

        let targetUrl = "@Url.Action("GetMtlItemUomCalculate", "Product")";
        let postData = {
            "OrderBy": "",
            "PageIndex": (objPage.pageIndex + 1),
            "PageSize": objPage.pageSize,
            "MtlItemId": $("#txtMtlItemId@(itemName)").val()
        };
        let data = DataAccess.Get(targetUrl, postData, false);

        if (data.status == "success") {
            pageCount = data.result.length > 0 ? parseInt(data.result[0]["TotalCount"]) : 0;

            if (pageCount > 0) {
                objPage = PageCaculate(pageCount, objPage);

                if (data.result.filter(f => f.TransferStatus == `N`).length > 0) { $(`.auth-data-transfer`).show(); }
                else $(`.auth-data-transfer`).hide();

                $.each(data.result, function (i, item) {
                    let _row = (objPage.pageSize * objPage.pageIndex + (i + 1)) + ".";

                    innerHtml += `<tr>
                                        <td>${_row}</td>
                                        <td class="ellipsis" data-toggle="tooltip" title="${item.SwapNumerator}" style="max-width: 170px;">${item.SwapNumerator}</td>
                                        <td class="ellipsis" data-toggle="tooltip" title="${item.ConvertUomNo}" style="max-width: 170px;">${item.ConvertUomNo}</td>
                                        <td class="text-center ellipsis" data-toggle="tooltip" title="等於" style="max-width: 50px;">=</td>
                                        <td class="ellipsis" data-toggle="tooltip" title="${item.SwapDenominator}" style="max-width: 170px;">${item.SwapDenominator}</td>
                                        <td class="ellipsis" data-toggle="tooltip" title="${item.UomNo}" style="max-width: 170px;">${item.UomNo}</td>
                                        <td class="ellipsis ${item.TransferStatus == `N` ? `transferNO` : `transferOK`}" data-toggle="tooltip" title="${item.TransferStatus}" style="max-width: 170px; display: none;">${item.TransferStatus == `Y` ? `已拋轉` : `未拋轉`}</td>
                                        <td class="text-center active-content" style=" display: none;">
                                          ${item.TransferStatus == `N` ? `<a class="active-link auth-calculate" href="javascript:Edit@(itemName)(${item.MtlItemUomCalculateId});"><i class="fas fa-edit"></i></a>` : ``}
                                          ${item.TransferStatus == `N` ? `<a class="active-link auth-calculate" href="javascript:Delete@(itemName)(${item.MtlItemUomCalculateId});"><i class="fas fa-trash-alt"></i></a>` : ``}
                                        </td>
                                      </tr>`;
                });
            } else {
                innerHtml += `<tr>
                                    <td class="text-center" colspan="8" style="background-color: #fff3cd;">
                                      <i class="fal fa-exclamation-circle"></i>&nbsp;目前尚無資料。
                                    </td>
                                  </tr>`;
            }
        } else {
            alert(data.msg, "alert", 0);
        }

        $("#uomCalculatetblData@(itemName) tbody").html(innerHtml);
        TableComponentInit();
        Pager("#uomCalculatepage@(itemName)", pageCount, objPage, GetMtlItemUomCalculate@(itemName));

    }

    //確認反確認
    function Confirm@(itemName)(mtlItemChangeId) {
            swal.fire({
                titleText: "確認品號變更單",
                text: "目前核單者工號為'@Session["UserNo"]'，請確認正確後再進行核單確認!!",
                icon: "warning",
                allowOutsideClick: false,
                allowEscapeKey: false,
                showCancelButton: true,
                confirmButtonColor: '#d33',
                reverseButtons: true
            }).then((result) => {
                if (result.isConfirmed) {
                    let targetUrl = "@Url.Action("UpdateMtiitemChangeConfirm", "Product")";
                    let postData = {
                        "MtlItemChangeId": mtlItemChangeId
                    };

                    let result = DataAccess.Update(targetUrl, postData, false, true);

                    Query@(itemName)();
                    Edit@(itemName)(mrId);
                    ReturnMaterialDetail();
                }
            });
    }

    function ReConfirm@(itemName)(mtlItemChangeId) {
            swal.fire({
                titleText: "反確認品號變更單",
                text: "目前反確認者工號為'@Session["UserNo"]'，請確認正確後再進行反確認!!",
                icon: "warning",
                allowOutsideClick: false,
                allowEscapeKey: false,
                showCancelButton: true,
                confirmButtonColor: '#d33',
                reverseButtons: true
            }).then((result) => {
                if (result.isConfirmed) {
                    let targetUrl = "@Url.Action("UpdateMtiitemChangeReConfirm", "Product")";
                    let postData = {
                        "MtlItemChangeId": mtlItemChangeId
                    };

                    let result = DataAccess.Update(targetUrl, postData, false, true);

                    if (result) {
                        Query@(itemName)();
                        Edit@(itemName)(mrId);
                        ReturnMaterialDetail();
                    }
                }
            });
    }

    function Void@(itemName)(mtlItemChangeId) {
            swal.fire({
                titleText: "品號變更單作廢",
                text: "目前作廢者工號為'@Session["UserNo"]'，請確認正確後再進行作廢!!",
                icon: "warning",
                allowOutsideClick: false,
                allowEscapeKey: false,
                showCancelButton: true,
                confirmButtonColor: '#d33',
                reverseButtons: true
            }).then((result) => {
                if (result.isConfirmed) {
                    let targetUrl = "@Url.Action("UpdateMtiitemChangeVoid", "Product")";
                    let postData = {
                        "MtlItemChangeId": mtlItemChangeId
                    };

                    let result = DataAccess.Update(targetUrl, postData, false, true);

                    if (result) {
                        Query@(itemName)();
                        ReturnMaterialDetail();
                    }
                }
            });
    }


    function InitParameter@(itemName)(selector) {
            let initFnString = "Expand";
            let content = selector.attr("href").split('#tab')[1];

            switch (content) {
                case "Change@(itemName)":
                    initFnString += "Change@(itemName)";
                    break;
                case "MtlItemUomCalculate11@(itemName)":
                    initFnString += "MtlItemUomCalculate11@(itemName)";
                    break;
            }

            let initFn = window[initFnString];
            if (initFn && typeof (initFn) == "function") {
                initFn();
            }
        }

    function Return@(itemName)() {
        Switch("#listData@(itemName)", "#editData@(itemName), .unit-block, .advanced-block");
        ResetForm(objForm@(itemName));
        Query@(itemName)()
        $("#txtNewMtlItemName@(itemName)").attr("readonly", false)
        $("#txtNewMtlItemSpec@(itemName)").attr("readonly", false)
        $("#txtRemark@(itemName)").attr("readonly", false)

    }

    function dateTostring(date) {
        var year = date.getFullYear();
        var month = (date.getMonth() + 1).tostring();
        var day = (date.getDate()).toString();
        if (month.length == 1) {
            month = "O" + month;
        }
        if (day.length = - 1) {
            day = "0" + day;
        }
        var hours = date - getHours().toString();
        if (hours.length == 1) {
            hours = "0" + hours;
        }
        var mintus = date.getMinutes().toString();
        if (mintus.length == 1) {
            mintus = "0" + mintus;
        }
        var second = date.getSeconds().toString();
        if (second.length == 1) {
            second = "0" + second;
        }
        var dateTime = year + "-" + month + "" + day + "" + hours + ":" + mintus + ":" + second;
        return dateTime;
    }
</script>
                                                                                                                    )
