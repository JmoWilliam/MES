@using Business_Manager.Helpers
@{
    string itemName = "ViewDemandPlatformSetting";
    string itemNameText = "需求平台設定";
}

@Html.Resource("css",
    @<style>
    </style>
)

<div class="modal fade" id="modal@(itemName)">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">@(itemNameText)</h5>
                <button class="close" type="button" onclick="Close@(itemName)()">
                    <span aria-hidden="true"><i class="fas fa-times"></i></span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-12">
                        <div class="setting-container">
                            <div class="setting-list">
                                <div class="setting-list-title">信件通知</div>
                                <div class="setting-toggle-switch">
                                    <input type="checkbox" id="cbxMailAdviceStatus@(itemName)" />
                                    <label for="cbxMailAdviceStatus@(itemName)"></label>
                                </div>
                            </div>
                            <div class="setting-list">
                                <div class="setting-list-title">推播通知</div>
                                <div class="setting-toggle-switch">
                                    <input type="checkbox" id="cbxPushAdviceStatus@(itemName)" />
                                    <label for="cbxPushAdviceStatus@(itemName)"></label>
                                </div>
                            </div>
                            <div class="setting-help">請點擊右上角Icon，並點擊訂閱推播</div>
                            <div class="setting-list">
                                <div class="setting-list-title">企業微信通知</div>
                                <div class="setting-toggle-switch">
                                    <input type="checkbox" id="cbxWorkWeixinStatus@(itemName)" />
                                    <label for="cbxWorkWeixinStatus@(itemName)"></label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@Html.Resource("js",
    @<script>
        function Pop@(itemName)() {
            InitData@(itemName)();

            $("#modal@(itemName)").modal({
                backdrop: "static",
                keyboard: false,
                show: true
            });

            $(".setting-toggle-switch input[type='checkbox']").off("change").on("change", function () {
                Setting@(itemName)();
            });
        }

        function InitData@(itemName)() {
            let targetUrl = "@Url.Action("GetNotificationSetting", "SystemSetting")";
            let postData = {};
            let data = DataAccess.Get(targetUrl, postData, false);

            if (data.status == "success") {
                if (data.result.length > 0) {
                    $.each(data.result, function (i, item) {
                        $("#cbxMailAdviceStatus@(itemName)").prop("checked", item.MailAdviceStatus == "Y");
                        $("#cbxPushAdviceStatus@(itemName)").prop("checked", item.PushAdviceStatus == "Y");
                        $("#cbxWorkWeixinStatus@(itemName)").prop("checked", item.WorkWeixinStatus == "Y");
                    });
                } else {
                    $("#cbxMailAdviceStatus@(itemName)").prop("checked", true);
                    $("#cbxPushAdviceStatus@(itemName)").prop("checked", true);
                    $("#cbxWorkWeixinStatus@(itemName)").prop("checked", true);
                }
            } else {
                alert(data.msg, "alert", 0);
            }
        }

        function Setting@(itemName)() {
            let targetUrl = "@Url.Action("UpdateNotificationSetting", "SystemSetting")";
            let postData = {
                "MailAdviceStatus": ($("#cbxMailAdviceStatus@(itemName)").is(":checked") ? "Y" : "N"),
                "PushAdviceStatus": ($("#cbxPushAdviceStatus@(itemName)").is(":checked") ? "Y" : "N"),
                "WorkWeixinStatus": ($("#cbxWorkWeixinStatus@(itemName)").is(":checked") ? "Y" : "N")
            };

            DataAccess.Update(targetUrl, postData, false, false);

            if (result) {
                InitData@(itemName)()
            }
        }

        function Close@(itemName)() {
            $("#modal@(itemName)").modal("hide");
        }
    </script>
)