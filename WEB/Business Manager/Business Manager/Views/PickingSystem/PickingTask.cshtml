@using Business_Manager.Helpers
@{
    string itemName = "PickingTask";
    string itemNameText = "揀貨作業";

    string DoDetailId = Request["DoDetailId"] ?? "";
    string PickingCartonId = Request["PickingCartonId"] ?? "";

    ViewBag.Title = itemNameText;
}

@Html.Resource("css",
    @<style>
        .choose {
            float: right;
            padding: 5px;
            font-weight: bold;
            margin: .35rem 0;
        }

        .left {
            float: left !important;
        }

        .input-selected {
            float: left !important;
            border: 1px solid #0041c4;
            background: #0041c4;
            color: #fff;
            padding: .2rem .5rem;
            margin-bottom: .75rem;
        }

            .input-selected:hover {
                color: #fff;
            }

        .input-un-selected {
            float: left !important;
            border: 1px solid #0041c4;
            color: #0041c4;
            padding: .2rem .5rem;
            margin-bottom: .75rem;
        }

            .input-un-selected:hover {
                background: #0041c4;
                color: #fff;
            }
    </style>
)

<input type="hidden" id="DoId@(itemName)" value="" />
<input type="hidden" id="DoDetailId@(itemName)" value="" />
<input type="hidden" id="PickingCartonId@(itemName)" value="" />
<input type="hidden" id="InputStatus@(itemName)" value="B" />

<header class="header-title">
    <div class="link-area left-link">
        <a href="javascript:history.back();">
            <i class="fas fa-chevron-left"></i>
        </a>
        <a href="@Url.Action("DeliveryList", "PickingSystem")">
            <i class="fas fa-list-alt"></i>
        </a>
    </div>
    <div class="title">@(itemNameText)</div>
    <div class="link-area">
        <a href="@Url.Action("Index", "PickingSystem")">
            <i class="fas fa-home-lg-alt"></i>
        </a>
    </div>
</header>

<div class="wrapper wrap-listpick">
    <div class="section secction-picktask">
        <div class="heading-pickup">
            <div class="list-title">
                <label class="form-label input-barcode un-choose-carton" style="display: none;">
                    物流箱條碼
                    <a class="label-link" href="javascript:void(0);" onclick="UnCarton@(itemName)()">無物流箱</a>
                    <input type="text" class="form-input" id="txtCartonBarcode@(itemName)" name="txtCartonBarcode@(itemName)" placeholder="請輸入物流箱條碼"
                           autocomplete="off" />
                </label>
                <div class="number choose-carton" id="CartonDetail@(itemName)" style="display: none;"></div>
            </div>
        </div>
        <div class="content-picktask">
            <ul class="list-area" id="PickingItem@(itemName)"></ul>
        </div>
        <div class="btn-fixed">
            <div class="btn-block">
                <a class="btn btn-sub btn-large" href="javascript:void(0);" onclick="Cancel@(itemName)()"><i class="far fa-angle-double-left"></i>&nbsp;返回出貨單明細</a>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modalItem@(itemName)">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">選取物件</h5>
                <button class="close" data-dismiss="modal" type="button">
                    <span aria-hidden="true"><i class="fas fa-times"></i></span>
                </button>
            </div>
            <div class="modal-body">
                <div id="DoDetail@(itemName)"></div>
            </div>
        </div>
    </div>
</div>


@Html.Resource("js",
    @<script>
        let Datas@(itemName) = new DataControl@(itemName)();

        $(document).ready(function () {
            $("#DoDetailId@(itemName)").val("@(DoDetailId)");
            $("#PickingCartonId@(itemName)").val("@(PickingCartonId)");

            InitData@(itemName)();
        });

        function InitData@(itemName)() {
            if (!$("#PickingCartonId@(itemName)").val()) {
                Datas@(itemName).GetDoDetail@(itemName)();

                $(".un-choose-carton").show();

                $("#txtCartonBarcode@(itemName)").focus();

                $("#txtCartonBarcode@(itemName)").change(function () {
                    let targetUrl = "@Url.Action("GetCartonDetail", "PickingSystem")";
                    let postData = {
                        "CartonBarcode": $(this).val()
                    };

                    let data = DataAccess.Get(targetUrl, postData, false);

                    if (data.status == "success") {
                        $.each(data.result, function (i, item) {
                            location.href = `@Url.Action("PickingTask", "PickingSystem")?DoDetailId=${$("#DoDetailId@(itemName)").val()}&PickingCartonId=${item.PickingCartonId}`;
                        });
                    } else {
                        alert(data.msg, "alert", 0);
                    }
                });
            } else {
                $(".choose-carton").show();

                Datas@(itemName).GetDoDetail@(itemName)();
                Datas@(itemName).GetCartonDetail@(itemName)();
                Datas@(itemName).GetPickingTask@(itemName)();
            }
        }

        function DataControl@(itemName)() {
            addMethod(this, "GetDoDetail@(itemName)", function () {
                let innerHtml = '';

                let targetUrl = "@Url.Action("GetDoDetail", "PickingSystem")";
                let postData = {
                    "DoDetailId": $("#DoDetailId@(itemName)").val()
                };

                let data = DataAccess.Get(targetUrl, postData, false);

                if (data.status == "success") {
                    if (data.result.length > 0) {
                        $.each(data.result, function (i, item) {
                            innerHtml += `<li class="list-box">
                                            <div class="list-title list-box-object01">
                                              <div class="number">
                                                <span class="number-name">品名</span>
                                                <span class="number-cell">${item.MtlItemName}</span>
                                              </div>
                                              <div class="icon-collapse" onclick="Toggle@(itemName)(${i})">
                                                <i class="fas fa-caret-circle-up active"></i>
                                              </div>
                                            </div>
                                            <div class="list-content" style="display: block;">
                                              <ul class="list-item number-object">
                                                <li>
                                                  <span class="heading">預計出貨數量【正常品】</span>
                                                  <span class="detail">${item.RegularQty}</span>
                                                </li>
                                                <li>
                                                  <span class="heading">預計出貨數量【贈品】</span>
                                                  <span class="detail">${item.FreebieQty}</span>
                                                </li>
                                                <li>
                                                  <span class="heading">預計出貨數量【備品】</span>
                                                  <span class="detail">${item.SpareQty}</span>
                                                </li>
                                                <li>
                                                  <span class="heading">已揀貨數量【正常品】</span>
                                                  <span class="detail detail-warning">${item.PickRegularQty}</span>
                                                </li>
                                                <li>
                                                  <span class="heading">已揀貨數量【贈品】</span>
                                                  <span class="detail detail-warning">${item.PickFreebieQty}</span>
                                                </li>
                                                <li>
                                                  <span class="heading">已揀貨數量【備品】</span>
                                                  <span class="detail detail-warning">${item.PickSpareQty}</span>
                                                </li>
                                              </ul>
                                              <div class="list-item">
                                                ${DetailData@(itemName)(item.ItemDetail)}
                                              </div>
                                            </div>
                                          </li>`;

                            $("#DoId@(itemName)").val(item.DoId != -1 ? item.DoId : "");
                        });
                    } else {
                        innerHtml += `<li class="list-box">
                                        <div class="list-content">
                                          <div class="list-box text-center p-3" style="background-color: #fff3cd;">
                                            <i class="fal fa-exclamation-circle"></i>&nbsp;目前尚無資料。
                                          </div>
                                        </div>
                                      </li>`;
                    }
                } else {
                    alert(data.msg, "alert", 0);
                }

                $("#PickingItem@(itemName)").html(innerHtml);

                function DetailData@(itemName)(source) {
                    let html = '';

                    if (source) {
                        html += `<span class="item-title">物件條碼/刻字碼</span>`;

                        let json = JSON.parse(source);

                        for (var i = 0; i < json.data.length; i++) {
                            switch (json.data[i].ItemStatus) {
                                case 'B':
                                    html += `<div class="item-detail-box">
                                               <div class="item-block-object icon"> 
                                                 <i class="far fa-box-alt"></i>
                                               </div>
                                               <span class="item-detail02">
                                                 <span class="date_num">${json.data[i].ItemBarcode}(${ItemTypeName(json.data[i].ItemType)})</span>
                                                 <span>${json.data[i].LetteringNo}</span>
                                                 <span>批號:${json.data[i].LotNumber}</span>
                                                 <span>Tray盤:${json.data[i].TrayNo}</span>
                                               </span>
                                               <div class="item-block-object">
                                                 <div class="num">${json.data[i].ItemQty}</div>
                                                 PCS
                                               </div>
                                             </div>`;
                                    break;
                                case 'N':
                                    html += `<div class="item-detail-box" onclick="OpenLotList(${json.data[i].PickingItemId})">
                                               <div class="item-block-object icon"> 
                                                 <i class="far fa-box-alt"></i>
                                               </div>
                                               <span class="item-detail02">
                                                 <span>此物件為無條碼(${ItemTypeName(json.data[i].ItemType)})</span>
                                                 <span id="PickingLotTitle@(itemName)${json.data[i].PickingItemId}" style="color:red;">點擊展開批號列表</span>
                                               </span>
                                               <div class="item-block-object">
                                                 <div class="num">${json.data[i].ItemQty}</div>
                                                 PCS
                                               </div>
                                               <input type="hidden" id="LotListStatus@(itemName)${json.data[i].PickingItemId}" value="S" />
                                             </div>
                                             <div id="PickingLot@(itemName)${json.data[i].PickingItemId}" class="PickingLot"></div>
                                             `;
                                    break;
                                case 'S':
                                    html += `<div class="item-detail-box">
                                               <div class="item-block-object icon"> 
                                                 <i class="far fa-box-alt"></i>
                                               </div>
                                               <span class="item-detail02">
                                                 <span>此物件為替代品(${ItemTypeName(json.data[i].ItemType)})</span>
                                                 <span>批號:${json.data[i].LotNumber}</span>
                                               </span>
                                               <div class="item-block-object">
                                                 <div class="num">${json.data[i].ItemQty}</div>
                                                 PCS
                                               </div>
                                             </div>`;
                                    break;
                            }
                        }
                    }
                    return html;
                }
            });

            addMethod(this, "GetCartonDetail@(itemName)", function () {
                let innerHtml = '';

                let targetUrl = "@Url.Action("GetCartonDetail", "PickingSystem")";
                let postData = {
                    "DoDetailId": $("#DoDetailId@(itemName)").val(),
                    "PickingCartonId": $("#PickingCartonId@(itemName)").val()
                };

                let data = DataAccess.Get(targetUrl, postData, false);

                if (data.status == "success") {
                    if (data.result.length > 0) {
                        $.each(data.result, function (i, item) {
                            innerHtml += `<span style="display: block;">
                                            <span class="number-cell">${item.CartonName}</span>
                                            <span class="number-barcode">(${item.CartonBarcode})</span>
                                          </span>
                                          ${item.DoId == -1 ? `<span><span class="number-warning">【注意】此物流箱未綁定出貨單</span></span>` : ``}`;
                        });
                    } else {
                        innerHtml += `<span style="display: block;">
                                        <span class="number-cell">無物流箱</span>
                                        <span class="number-barcode"></span>
                                      </span>`;
                    }
                } else {
                    alert(data.msg, "alert", 0);
                }
                
                $("#CartonDetail@(itemName)").html(innerHtml);
            });

            addMethod(this, "GetPickingTask@(itemName)", function () {
                let innerHtml = '';

                let targetUrl = "@Url.Action("GetPickingTask", "PickingSystem")";
                let postData = {
                    "DoDetailId": $("#DoDetailId@(itemName)").val(),
                    "PickingCartonId": $("#PickingCartonId@(itemName)").val()
                };

                let data = DataAccess.Get(targetUrl, postData, false);

                if (data.status == "success") {
                    innerHtml += `<li class="list-box">
                                    <a class="add-listbox" href="javascript:void(0);" onclick="PopItem@(itemName)()">
                                      <i class="far fa-plus-circle"></i>
                                      <span class="number-cell">選取物件</span>
                                    </a>
                                  </li>`;

                    $.each(data.result, function (i, item) {
                        innerHtml += `<li class="list-box">
                                        <div class="list-title">
                                          <span class="number">
                                            <span class="number-name">品名</span>
                                            <span class="number-cell">${item.MtlItemName}</span>
                                          </span>
                                          <div class="icon-collapse" onclick="Toggle@(itemName)(${i})">
                                            <i class="fas fa-caret-circle-up active"></i>
                                          </div>
                                        </div>
                                        <div class="list-content" style="display: block;">
                                          <ul class="list-item number-object">
                                            <li>
                                              <span class="heading">預計出貨數量【正常品】</span>
                                              <span class="detail">${item.RegularQty}</span>
                                            </li>
                                            <li>
                                              <span class="heading">預計出貨數量【贈品】</span>
                                              <span class="detail">${item.FreebieQty}</span>
                                            </li>
                                            <li>
                                              <span class="heading">預計出貨數量【備品】</span>
                                              <span class="detail">${item.SpareQty}</span>
                                            </li>
                                            <li>
                                              <span class="heading">已揀貨數量【正常品】</span>
                                              <span class="detail detail-warning">${item.PickRegularQty}</span>
                                            </li>
                                            <li>
                                              <span class="heading">已揀貨數量【贈品】</span>
                                              <span class="detail detail-warning">${item.PickFreebieQty}</span>
                                            </li>
                                            <li>
                                              <span class="heading">已揀貨數量【備品】</span>
                                              <span class="detail detail-warning">${item.PickSpareQty}</span>
                                            </li>
                                          </ul>
                                          <div class="list-item">
                                            ${DetailData@(itemName)(item.ItemDetail)}
                                          </div>
                                          ${item.DoDetailId == $("#DoDetailId@(itemName)").val() ? 
                                          `<div class="form-group row">
                                             <label class="col-12 col-form-label popover-label" for="cboItemType@(itemName)">揀貨產品類型 <span class="text-danger">*</span></label>
                                               <div class="col-12">
                                                 <select class="form-control" id="cboItemType@(itemName)" name="cboItemType@(itemName)"></select>
                                               </div>
                                           </div>
                                           <div class="list-item picking-barcode">
                                            <label class="form-label input-barcode">
                                              &nbsp;
                                              <a class="input-selected" style="border-top-left-radius: 3px; border-bottom-left-radius: 3px;" href="javascript:void(0);" onclick="ChangePicking@(itemName)('B')">條碼輸入</a>
                                              <a class="input-un-selected" href="javascript:void(0);" onclick="ChangePicking@(itemName)('N')">無條碼輸入</a>
                                              <a class="input-un-selected" style="border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-left: .5px" href="javascript:void(0);" onclick="ChangePicking@(itemName)('S')">替代品輸入</a>
                                              <input type="text" class="form-input picking-input" id="txtBarcode@(itemName)" name="txtBarcode@(itemName)" placeholder="請輸入物件條碼"
                                                     autocomplete="off" />
                                            </label>
                                          </div>
                                          <div class="list-item picking-no-barcode" style="display: none;">
                                            <label class="form-label">
                                              &nbsp;
                                              <a class="input-un-selected" style="border-top-left-radius: 3px; border-bottom-left-radius: 3px;" href="javascript:void(0);" onclick="ChangePicking@(itemName)('B')">條碼輸入</a>
                                              <a class="input-selected" href="javascript:void(0);" onclick="ChangePicking@(itemName)('N')">無條碼輸入</a>
                                              <a class="input-un-selected" style="border-top-right-radius: 3px; border-bottom-right-radius: 3px;" href="javascript:void(0);" onclick="ChangePicking@(itemName)('S')">替代品輸入</a>
                                              <input type="text" class="form-input picking-input" id="txtNoBarcodeQty@(itemName)" name="txtNoBarcodeQty@(itemName)" placeholder="請輸入物件數量"
                                                     autocomplete="off" />
                                              ${item.LotManagement != "N" ? `<input type="text" class="form-input picking-input" id="txtNoBarcodeLotNumber@(itemName)" name="txtNoBarcodeLotNumber@(itemName)" placeholder="請輸入物件批號"
                                                                                    autocomplete="off" />` : ``}
                                            </label>
                                          </div>
                                          <div class="list-item picking-substitute" style="display: none;">
                                            <label class="form-label">
                                              &nbsp;
                                              <a class="input-un-selected" style="border-top-left-radius: 3px; border-bottom-left-radius: 3px; border-right: .5px" href="javascript:void(0);" onclick="ChangePicking@(itemName)('B')">條碼輸入</a>
                                              <a class="input-un-selected" href="javascript:void(0);" onclick="ChangePicking@(itemName)('N')">無條碼輸入</a>
                                              <a class="left input-selected" style="border-top-right-radius: 3px; border-bottom-right-radius: 3px;" href="javascript:void(0);" onclick="ChangePicking@(itemName)('S')">替代品輸入</a>
                                              <input type="text" class="form-input picking-input" id="txtSubstituteQty@(itemName)" name="txtSubstituteQty@(itemName)" placeholder="請輸入替代品數量"
                                                     autocomplete="off" />
                                              ${item.LotManagement != "N" ? `<input type="text" class="form-input picking-input" id="txtSubstituteLotNumber@(itemName)" name="txtSubstituteLotNumber@(itemName)" placeholder="請輸入替代品批號"
                                                                                    autocomplete="off" />` : ``}
                                            </label>
                                          </div>` : ``}
                                        </div>
                                      </li>`;
                    });
                } else {
                    alert(data.msg, "alert", 0);
                }

                $("#PickingItem@(itemName)").html(innerHtml);

                ComboBoxs.Default("#cboItemType@(itemName)", "@Url.Action("GetType", "BasicInformation")", { "TypeSchema": "PickingItem.ProductType" }, "", "CHOOSE", "", "TypeName", "TypeNo");

                //類型變更時，一併清空input欄位
                $("#cboItemType@(itemName)").change(function () {
                    $("#txtBarcode@(itemName)").val("");
                    $("#txtNoBarcodeQty@(itemName)").val("");
                    $("#txtNoBarcodeLotNumber@(itemName)").val("");
                    $("#txtSubstituteQty@(itemName)").val("");
                    $("#txtSubstituteLotNumber@(itemName)").val("");
                });

                $(".picking-input").change(function () {
                    Datas@(itemName).AddPickingItem@(itemName)();
                });

                function DetailData@(itemName)(source) {
                    let html = '';

                    if (source) {
                        html += `<span class="item-title">物件條碼/刻字碼</span>`;

                        let json = JSON.parse(source);

                        for (var i = 0; i < json.data.length; i++) {
                            switch (json.data[i].ItemStatus) {
                                case 'B':
                                    html += `<div class="item-detail-box">
                                               <div class="item-block-object icon"> 
                                                 <i class="far fa-box-alt"></i>
                                               </div>
                                               <span class="item-detail02">
                                                 <span class="date_num">${json.data[i].ItemBarcode}(${ItemTypeName(json.data[i].ItemType)})</span>
                                                 <span>${json.data[i].LetteringNo}</span>
                                                 <span>批號:${json.data[i].LotNumber}</span>
                                                 <span>Tray:${json.data[i].TrayNo}</span>
                                               </span>
                                               <div class="item-block-object" style="margin-right: 30px;">
                                                 <div class="num">${json.data[i].ItemQty}</div>
                                                 PCS
                                               </div>
                                               <span class="delete-icon">
                                                 <a href="javascript:void(0);" onclick="Datas@(itemName).DeletePickingItem@(itemName)(${json.data[i].PickingItemId})"><i class="fas fa-minus-circle"></i></a>
                                               </span>
                                             </div>`;
                                    break;
                                case 'N':
                                    html += `<div class="item-detail-box" onclick="OpenLotList(${json.data[i].PickingItemId})">
                                               <div class="item-block-object icon">
                                                 <i class="far fa-box-alt"></i>
                                               </div>
                                               <span class="item-detail02">
                                                 <span>此物件為無條碼(${ItemTypeName(json.data[i].ItemType)})</span>
                                                 @*<span>批號:${json.data[i].LotNumber}</span>*@
                                                 <span id="PickingLotTitle@(itemName)${json.data[i].PickingItemId}" style="color:red;">點擊展開批號列表</span>
                                               </span>
                                               <div class="item-block-object" style="margin-right: 30px;">
                                                 <div class="num">${json.data[i].ItemQty}</div>
                                                 PCS
                                               </div>
                                               <span class="delete-icon">
                                                 <a href="javascript:void(0);" onclick="Datas@(itemName).DeletePickingItem@(itemName)(${json.data[i].PickingItemId})"><i class="fas fa-minus-circle"></i></a>
                                               </span>
                                               <input type="hidden" id="LotListStatus@(itemName)${json.data[i].PickingItemId}" value="S" />
                                             </div>
                                             <div id="PickingLot@(itemName)${json.data[i].PickingItemId}"></div>`;
                                    break;
                                case 'S':
                                    html += `<div class="item-detail-box">
                                               <div class="item-block-object icon">
                                                 <i class="far fa-box-alt"></i>
                                               </div>
                                               <span class="item-detail02">
                                                 <span>替代品物件(${ItemTypeName(json.data[i].ItemType)})</span>
                                               </span>
                                               <div class="item-block-object" style="margin-right: 30px;">
                                                 <div class="num">${json.data[i].ItemQty}</div>
                                                 PCS
                                               </div>
                                               <span class="delete-icon">
                                                 <a href="javascript:void(0);" onclick="Datas@(itemName).DeletePickingItem@(itemName)(${json.data[i].PickingItemId})"><i class="fas fa-minus-circle"></i></a>
                                               </span>
                                             </div>`;
                                    break;
                            }
                        }
                    }
                    return html;
                }
            });

            addMethod(this, "AddPickingItem@(itemName)", function () {
                let targetUrl = "@Url.Action("AddPickingItem", "PickingSystem")";
                let postData = {
                    "DoDetailId": $("#DoDetailId@(itemName)").val(),
                    "PickingCartonId": $("#PickingCartonId@(itemName)").val(),
                    "InputStatus": $("#InputStatus@(itemName)").val(),
                    "Barcode": $("#txtBarcode@(itemName)").val(),
                    "NoBarcodeQty": $("#txtNoBarcodeQty@(itemName)").val(),
                    "ItemType": $("#cboItemType@(itemName)").val(),
                    "SubstituteQty": $("#txtSubstituteQty@(itemName)").val(),
                    "NoBarcodeLotNumber": $("#txtNoBarcodeLotNumber@(itemName)").val(),
                    "SubstituteLotNumber": $("#txtSubstituteLotNumber@(itemName)").val(),
                };

                let result = DataAccess.Add(targetUrl, postData, false, false);

                if (result) {
                    InitData@(itemName)();
                    ChangePicking@(itemName)($("#InputStatus@(itemName)").val());

                    $(".picking-input").focus();
                }
            });

            addMethod(this, "DeletePickingItem@(itemName)", function (PickingItemId) {

                if (PickingItemId > 0) {
                    swal.fire({
                        titleText: "確認要刪除嗎?",
                        text: "此動作無法復原，請確認是否要執行!",
                        icon: "warning",
                        allowOutsideClick: false,
                        allowEscapeKey: false,
                        showCancelButton: true,
                        confirmButtonColor: '#0041c4',
                        cancelButtonColor: '#bdbdbd',
                        reverseButtons: true
                    }).then((result) => {
                        if (result.isConfirmed) {
                            let targetUrl = "@Url.Action("DeletePickingItem", "PickingSystem")";
                            let postData = {
                                "PickingItemIds": PickingItemId
                            };

                            let result = DataAccess.Delete(targetUrl, postData, false, false);

                            if (result) {
                                InitData@(itemName)();
                            }
                        }
                    });
                } else {
                    alert("請選取物件!");
                }
            });

            addMethod(this, "DeletePickingLot@(itemName)", function (PickingLotId) {

                if (PickingLotId > 0) {
                    swal.fire({
                        titleText: "確認要刪除嗎?",
                        text: "此動作無法復原，請確認是否要執行!",
                        icon: "warning",
                        allowOutsideClick: false,
                        allowEscapeKey: false,
                        showCancelButton: true,
                        confirmButtonColor: '#0041c4',
                        cancelButtonColor: '#bdbdbd',
                        reverseButtons: true
                    }).then((result) => {
                        if (result.isConfirmed) {
                            let targetUrl = "@Url.Action("DeletePickingLot", "PickingSystem")";
                            let postData = {
                                "PickingLotId": PickingLotId
                            };

                            let result = DataAccess.Delete(targetUrl, postData, false, false);

                            if (result) {
                                InitData@(itemName)();
                            }
                        }
                    });
                } else {
                    alert("請選取物件!");
                }
            });
        }

        function ItemTypeName(itemType) {
            switch (itemType) {
                case "1":
                    return "正常品";
                    break;
                case "2":
                    return "贈品";
                    break;
                case "3":
                    return "備品";
                    break;
            }
        }

        function UnCarton@(itemName)() {
            location.href = `@Url.Action("PickingTask", "PickingSystem")?DoDetailId=${$("#DoDetailId@(itemName)").val()}&PickingCartonId=-999`;
        }

        function ChangePicking@(itemName)(status) {
            $(".picking-barcode").hide();
            $(".picking-no-barcode").hide();
            $(".picking-substitute").hide();

            switch (status) {
                case "B":
                    $(".picking-barcode").show();
                    break;
                case "N":
                    $(".picking-no-barcode").show();
                    break;
                case "S":
                    $(".picking-substitute").show();
                    break;
            }

            $("#InputStatus@(itemName)").val(status);
        }

        function PopItem@(itemName)() {
            let innerHtml = '';

            let targetUrl = "@Url.Action("GetDoDetail", "PickingSystem")";
            let postData = {
                "DoId": $("#DoId@(itemName)").val()
            };

            let data = DataAccess.Get(targetUrl, postData, false);

            if (data.status == "success") {
                if (data.result.length > 0) {
                    $.each(data.result, function (i, item) {
                        innerHtml += `<a class="modal-quote" href="@Url.Action("PickingTask", "PickingSystem")?DoDetailId=${item.DoDetailId}&PickingCartonId=${$("#PickingCartonId@(itemName)").val()}">
                                        <p>
                                          <span class="heading">品名</span>
                                          <span class="detail">${item.MtlItemName}</span>
                                        </p>
                                        <p>
                                          <span class="heading">預計出貨數量【正常品】</span>
                                          <span class="detail">${item.RegularQty}</span>
                                        </p>
                                        <p>
                                          <span class="heading">預計出貨數量【贈品】</span>
                                          <span class="detail">${item.FreebieQty}</span>
                                        </p>
                                        <p>
                                          <span class="heading">預計出貨數量【備品】</span>
                                          <span class="detail">${item.SpareQty}</span>
                                        </p>
                                        <p>
                                          <span class="heading">已揀貨數量【正常品】</span>
                                          <span class="detail detail-warning">${item.PickRegularQty}</span>
                                        </p>
                                        <p>
                                          <span class="heading">已揀貨數量【贈品】</span>
                                          <span class="detail detail-warning">${item.PickFreebieQty}</span>
                                        </p>
                                        <p>
                                          <span class="heading">已揀貨數量【備品】</span>
                                          <span class="detail detail-warning">${item.PickSpareQty}</span>
                                        </p>
                                      </a>`;
                    });
                } else {
                    innerHtml += `<a class="modal-quote" href="javascript:void(0);" style="background-color: #fff3cd;">
                                    <i class="fal fa-exclamation-circle"></i>&nbsp;目前尚無資料。
                                  </a>`;
                }
            } else {
                alert(data.msg, "alert", 0);
            }

            $("#DoDetail@(itemName)").html(innerHtml);

            $("#modalItem@(itemName)").modal({
                backdrop: "static",
                keyboard: false,
                show: true
            });
        }

        function Cancel@(itemName)() {
            location.href = `@Url.Action("DeliveryDetail", "PickingSystem")?DoId=${$("#DoId@(itemName)").val()}`;
        }

        function Toggle@(itemName)(id) {
            $(".list-box").find($(".list-content")[id]).slideToggle(200);
            $(".list-box").find($(".icon-collapse .fa-caret-circle-up")[id]).toggleClass("active");
        }

        function OpenLotList(PickingItemId) {
            let LotListStatus = $(`#LotListStatus@(itemName)${PickingItemId}`).val()
            if (LotListStatus == "A") {
                $(`#LotListStatus@(itemName)${PickingItemId}`).val("S")
                $(`#PickingLotTitle@(itemName)${PickingItemId}`).text("展開批號列表")
                $(`#PickingLot@(itemName)${PickingItemId}`).html("")

            }
            else {
                $(`#LotListStatus@(itemName)${PickingItemId}`).val("A")
                $(`#PickingLotTitle@(itemName)${PickingItemId}`).text("關閉批號列表")

                let innerHtml = '';

                let targetUrl = "@Url.Action("GetPickingLot", "PickingSystem")";
                let postData = {
                    "PickingItemId": PickingItemId
                };

                let data = DataAccess.Get(targetUrl, postData, false);

                if (data.status == "success") {
                    if (data.result.length > 0) {
                        $.each(data.result, function (i, item) {
                            innerHtml += `<div class="item-detail-box" style="background-color: #ff75bd1c;">
                                            <div class="item-block-object icon" style="margin-right: 13px;">
                                            </div>
                                            <span class="item-detail02">
                                                <span>批號:${item.LotNumber}</span>
                                            </span>
                                            <div class="item-block-object">
                                                <div class="num">${item.ItemQty}</div>
                                                PCS
                                            </div>
                                            @*<span class="delete-icon">
                                                <a href="javascript:void(0);" onclick="Datas@(itemName).DeletePickingLot@(itemName)(${item.PickingLotId})"><i class="fas fa-minus-circle"></i></a>
                                            </span>*@
                                            </div>`;
                        });
                    } else {
                        innerHtml += `<a class="modal-quote" href="javascript:void(0);" style="background-color: #fff3cd;">
                                        <i class="fal fa-exclamation-circle"></i>&nbsp;目前尚無資料。
                                      </a>`;
                    }
                } else {
                    alert(data.msg, "alert", 0);
                }

                $(`#PickingLot@(itemName)${PickingItemId}`).html(innerHtml)
            }
        }

        
    </script>
)