@using Business_Manager.Helpers
@{
    string itemName = "ViewUserPassword";
    string itemNameText = "密碼重置";
}

@Html.Resource("css",
    @<style>
    </style>
)

<div class="modal fade" id="modal@(itemName)">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">@(itemNameText)</h5>
            </div>
            <div class="modal-body">
                <form class="container" autocomplete="off" id="editForm@(itemName)">
                    <fieldset>
                        <div class="form-group row">
                            <label class="col-12 col-form-label" for="txtNewPassword@(itemName)">新密碼 <span class="text-danger">*</span></label>
                            <div class="col-12">
                                <input type="password" class="form-control" id="txtNewPassword@(itemName)" name="txtNewPassword@(itemName)" placeholder="請輸入新密碼"
                                       data-msg-required="請輸入新密碼" data-rule-required="true" />
                                <small class="form-text text-muted">8~15位數，至少包含一個大寫字母、一個小寫字母、一個數字</small>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-12 col-form-label" for="txtConfirmPassword@(itemName)">確認密碼</label>
                            <div class="col-12">
                                <input type="password" class="form-control" id="txtConfirmPassword@(itemName)" name="txtConfirmPassword@(itemName)" placeholder="請輸入確認密碼"
                                       data-msg-equalTo="確認密碼不正確" data-rule-equalTo="#txtNewPassword@(itemName)" />
                            </div>
                        </div>
                    </fieldset>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="Close@(itemName)()"><i class="fas fa-times"></i>關閉</button>
                <button type="button" class="btn btn-success" onclick="Save@(itemName)()"><i class="fas fa-save"></i>儲存</button>
            </div>
        </div>
    </div>
</div>

@Html.Resource("js",
    @<script>
        let userId@(itemName);
        let objForm@(itemName) = "#editForm@(itemName)";

        function Pop@(itemName)(userId) {
            userId@(itemName) = userId;

            $("#modal@(itemName)").modal({
                backdrop: "static",
                keyboard: false,
                show: true
            });
        }

        function Save@(itemName)() {
            if ($(objForm@(itemName)).valid()) {
                let targetUrl = "@Url.Action("UpdatePassword", "User")";
                let postData = {
                    "UserId": userId@(itemName),
                    "NewPassword": $("#txtNewPassword@(itemName)").val(),
                    "ConfirmPassword": $("#txtConfirmPassword@(itemName)").val()
                };

                let result = DataAccess.Update(targetUrl, postData, false, true);

                if (result) {
                    ResetForm(objForm@(itemName));
                    $("#modal@(itemName)").modal("hide");
                }
            }
        }

        function Close@(itemName)() {
            ResetForm(objForm@(itemName));
            $("#modal@(itemName)").modal('hide');
        }
    </script>
)