@using Business_Manager.Helpers
@{
    string itemName = "WipOrderManagement";
    string itemNameText = "工單管理(ERP)";
    string authority = ViewBag.authority;
    int UserId = Convert.ToInt32(Session["UserId"]);
    ViewBag.Title = itemNameText;
}

@Html.Resource("css",
    @<style>
          .thead-customized {
              min-width: 75px !important;
              background-color: #ffeeba !important;
              position: relative !important;
              z-index: 1 !important;
              border: none !important;
          }

          .tbody-customized {
              border: none !important;
          }

          .table-sticky thead .col-sticky:nth-last-child(1) {
              right: 0;
          }

          .table-sticky tbody .col-sticky:nth-last-child(1) {
              right: 0;
          }

          .table-sticky thead .col-sticky:nth-child(1) {
              left: 0;
          }

          .table-sticky tbody .col-sticky:nth-child(1) {
              left: 0;
          }

          .table-sticky thead .col-sticky:nth-child(2) {
              left: 50px;
          }

          .table-sticky tbody .col-sticky:nth-child(2) {
              left: 50px;
          }

          .batch{
              display:none
          }
          /*

         .table-sticky thead .col-sticky:nth-child(3) {
             left: 250px;
         }
         .table-sticky tbody .col-sticky:nth-child(3) {
             left: 250px;
         }

         .table-sticky thead .col-sticky:nth-child(4) {
             left: 400px;
         }

         .table-sticky thead .col-sticky:nth-child(5) {
             left: 600px;
         }





         .table-sticky tbody .col-sticky:nth-child(4) {
             left: 400px;
         }

         .table-sticky tbody .col-sticky:nth-child(5) {
             left: 600px;
         }*/



    </style>
        )

<input type="hidden" id="pageAuthority" value="@authority" />
<input type="hidden" id="TransferStatus" value="" />

<div class="row">
    <div class="col-12 title-block">
        <h1 class="pt-2 pb-3">@(itemNameText)</h1>
        <div class="unit-block">
            <div class="button-block mb-1">
                <button type="button" class="btn btn-secondary" onclick="Return@(itemName)()"><i class="fas fa-undo"></i>返回</button>
            </div>
        </div>
    </div>
</div>

<!--搜尋-->
<div class="modal fade" id="modalQuery@(itemName)">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">搜尋</h5>
                <button class="close" data-dismiss="modal" type="button">
                    <span aria-hidden="true"><i class="fas fa-times"></i></span>
                </button>
            </div>
            <div class="modal-body">
                <form class="container" autocomplete="off" id="queryForm@(itemName)">
                    <fieldset>
                        <div class="form-group row">
                            <label class="col-12 col-form-label" for="cboWoErpPrefixQ@(itemName)">工單單別</label>
                            <div class="col-12">
                                <select class="form-control" id="cboWoErpPrefixQ@(itemName)" name="cboWoErpPrefixQ@(itemName)">
                                    <option value="">-- 請選擇工單單別 --</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-12 col-form-label" for="txtWoErpFullNoQ@(itemName)">工單編號</label>
                            <div class="col-12">
                                <input type="text" class="form-control" id="txtWoErpFullNoQ@(itemName)" name="txtWoErpFullNoQ@(itemName)" placeholder="請輸入工單編號" />
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-12 col-form-label" for="txtMtlItemNoQ@(itemName)">產品品號</label>
                            <div class="col-12">
                                <input type="text" class="form-control" id="txtMtlItemNoQ@(itemName)" name="txtMtlItemNoQ@(itemName)" placeholder="請輸入產品品號" />
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-12 col-form-label" for="txtSoErpNoQ@(itemName)">訂單編號</label>
                            <div class="col-12">
                                <input type="text" class="form-control" id="txtSoErpNoQ@(itemName)" name="txtSoErpNoQ@(itemName)" placeholder="請輸入訂單編號(可模糊查詢)" />
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-12 col-form-label">單據日期<input type="checkbox" id="cbxDocDateQ@(itemName)" checked /></label>
                            <div class="col-6">
                                <input type="text" class="form-control" id="txtStartDateQ@(itemName)" name="txtStartDateQ@(itemName)" onkeypress="BandeInput(event)" onkeydown="BandCtrlV(event)"
                                       data-msg-extraRegex="請輸入正確的日期格式" data-rule-extraRegex="([12]\d{3}\-(0[1-9]|1[0-2])\-(0[1-9]|[12]\d|3[01]))"
                                       readonly />
                            </div>
                            <div class="col-6">
                                <input type="text" class="form-control" id="txtEndDateQ@(itemName)" name="txtEndDateQ@(itemName)" onkeypress="BandeInput(event)" onkeydown="BandCtrlV(event)"
                                       data-msg-extraRegex="請輸入正確的日期格式" data-rule-extraRegex="([12]\d{3}\-(0[1-9]|1[0-2])\-(0[1-9]|[12]\d|3[01]))"
                                       readonly />
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-12 col-form-label" for="cbConfirmStatusQ@(itemName)">確認碼</label>
                            <div class="col-12">
                                <select class="form-control" id="cbConfirmStatusQ@(itemName)" name="cbConfirmStatusQ@(itemName)">
                                    <option value="">-- 請選擇確認碼 --</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-12 col-form-label" for="cboWoStatusQ@(itemName)">製令狀態碼</label>
                            <div class="col-12">
                                <select class="form-control" id="cboWoStatusQ@(itemName)" name="cboWoStatusQ@(itemName)">
                                    <option value="">-- 請選擇製令狀態碼 --</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-12 col-form-label" for="cboWoTransferStatusQ@(itemName)">ERP拋轉狀態碼</label>
                            <div class="col-12">
                                <select class="form-control" id="cboWoTransferStatusQ@(itemName)" name="cboWoTransferStatusQ@(itemName)">
                                    <option value="">-- 請選擇ERP拋轉狀態碼 --</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-12 col-form-label" for="cboWoCntStatusQ@(itemName)">MES製令建立狀態</label>
                            <div class="col-12">
                                <div class="col-lg-4 col-md-4 col-6">
                                    <label class="control control-solid control-solid-info control--checkbox">
                                        未建立
                                        <input type="checkbox" id="cboWoCntStatusYQ@(itemName)N" name="cboWoCntStatusYQ@(itemName)" value="1"/>
                                        <span class="control__indicator"></span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </fieldset>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" onclick="Query@(itemName)()" style="margin: auto;"><i class="fal fa-wrench"></i>套用</button>
            </div>
        </div>
    </div>
</div>

<!--列表-->
<div class="row" id="listData@(itemName)">
    <div class="col-12">
        <div class="card card-shadow mb-4">
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-6 col-sm-6 col-md-6">
                        <a class="btn btn-primary" data-backdrop="static" data-keyboard="false" data-toggle="modal" data-target="#modalQuery@(itemName)" href="javascript:void(0);"><i class="fal fa-search"></i>搜尋</a>
                    </div>
                    <div class="col-6 col-sm-6 col-md-6 text-right">
                        <a class="btn btn-success Close" href="javascript:PopCloseView@(itemName)();">指定結案</a>
                        <div class="auth-batch" style="display:inline-block;">
                            <a class="btn btn-info batchShow  " href="javascript:Batch@(itemName)();">批量操作</a>

                        </div>
                        @*<a class="btn btn-success Confirm" href="javascript:Action@(itemName)('Confirm');">確認</a>
                        <a class="btn btn-danger ReConfirm" href="javascript:Action@(itemName)('ReConfirm');">反確認</a>*@
                        <a class="btn btn-warning CancelBatchShow" href="javascript:CancelBatch@(itemName)();">操作取消</a>
                        <a class="btn btn-info auth-add" href="javascript:Edit@(itemName)();"><i class="fas fa-plus"></i>新增</a>
                        <a class="btn btn-info auth-add" href="javascript:SynchronizeERP@(itemName)();"><i class="fas fa-plus"></i>ERP同步</a>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12">
                        <div class="table-custom">
                            <table class="table table-bordered table-striped table-sticky" id="tblData@(itemName)">
                                <thead>
                                    <tr>
                                        <th class="col-sticky" scope="col" style="min-width: 110px;">
                                            #
                                            <span class="CancelBatchShow">
                                                全選 <input type="checkbox" id="cbxWoIdAll@(itemName)" />
                                            </span>
                                        </th>
                                        <th class="col-sticky" scope="col" style="min-width: 200px;">製令編號</th>
                                        <th class="text-center" scope="col" style="min-width: 150px;">操作</th>
                                        <th class="" scope="col" style="min-width: 150px;">單據日期</th>
                                        <th class="" scope="col" style="min-width: 200px;">產品品號</th>
                                        <th class="" scope="col" style="min-width: 250px;">產品品名</th>
                                        <th scope="col" style="min-width: 100px;">預計產量</th>
                                        <th scope="col" style="min-width: 150px;">預計開工</th>
                                        <th scope="col" style="min-width: 150px;">預計完工</th>
                                        <th class="text-center" scope="col" style="min-width: 150px;">製令狀態碼</th>
                                        <th class="text-center" scope="col" style="min-width: 150px;">確認碼</th>
                                        <th class="text-center" scope="col" style="min-width: 150px;">ERP拋轉狀態</th>
                                        <th scope="col" style="min-width: 150px;">開單者</th>
                                        <th scope="col" style="min-width: 150px;">確認者</th>
                                        <th scope="col" style="min-width: 150px;">MES製令</th>
                                        <!--<th scope="col" style="min-width: 150px;">MES領料</th>-->
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                        <div class="pagination" id="page@(itemName)"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!--新增/編輯-->
<div class="row" id="editData@(itemName)" style="display: none;">
    <div class="col-12">
        <div class="card card-shadow mb-4">
            <div class="card-body">
                <form class="container custom-form-container" autocomplete="off" id="editForm@(itemName)">
                    <fieldset>
                        <input type="hidden" id="WoId" name="WoId" value="-1" />
                        <input type="hidden" id="ConfirmStatus" name="ConfirmStatus" value="-1" />
                        <input type="hidden" id="WoStatus" name="WoStatus" value="-1" />
                        <div class="row" id="MtlItemView">
                            <div class="col-lg-12 col-md-12" >
                                <div class="form-group row">
                                    <label class="col-12 col-md-3 col-lg-2 col-form-label" for="txtMtlItemId@(itemName)">產品品號<span class="text-danger">*</span></label>
                                    <div class="col-12 col-md-9 col-lg-10">
                                        <input type="hidden" id="txtMtlItemId@(itemName)" />
                                        <div class="btn-group">
                                            <a  class="btn btn-success read-wipOder" href="javascript:PopMtlItemView();"><i class="fal fa-search"></i></a>
                                            <a class="btn btn-outline-danger pop-clear" href="javascript:void(0);"><i class="fas fa-eraser"></i></a>
                                        </div>
                                        <dl class="help-block">
                                            <dt>品號</dt>
                                            <dd id="desMtlItemNo@(itemName)"></dd>
                                            <dt>品名</dt>
                                            <dd id="desMtlItemName@(itemName)"></dd>
                                            <dt>規格</dt>
                                            <dd id="desMtlItemSpec@(itemName)"></dd>
                                        </dl>
                                    </div>
                                    @*<div class="col-12 col-md-9 col-lg-4">
                       <input type="hidden" id="txtSoDetailId@(itemName)" />
                       <div class="btn-group read-wipOder">
                           <a class="btn btn-success pop-view" href="javascript:void(0);"><i class="fal fa-search"></i></a>
                           <a class="btn btn-outline-danger pop-clear" href="javascript:void(0);"><i class="fas fa-eraser"></i></a>
                       </div>
                       <dl class="help-block">
                           <dt>客戶</dt>
                           <dd id="desCustomer@(itemName)"></dd>
                           <dt>訂單號碼</dt>
                           <dd id="desSoErpFullNo@(itemName)"></dd>
                           <dt>流水號</dt>
                           <dd id="desSoSequence@(itemName)"></dd>
                           <dt>品號</dt>
                           <dd id="desSoDetailMtlItemNo@(itemName)"></dd>
                           <dt>品名</dt>
                           <dd id="desSoDetailMtlItemName@(itemName)"></dd>
                       </dl>
                    </div>*@
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-12 col-md-12">
                                <div class="form-group row">
                                    <label class="col-12 col-md-3 col-lg-2 col-form-label" for="cboWoErpPrefix@(itemName)">製令單別<span class="text-danger">*</span></label>
                                    <div class="col-12 col-md-9 col-lg-4">
                                        <select class="form-control" id="cboWoErpPrefix@(itemName)" name="cboWoErpPrefix@(itemName)" data-rule-required="true" data-msg-required="請選擇製令單別">
                                            <option value="">-- 請選擇製令單別 --</option>
                                        </select>
                                    </div>
                                    <label class="col-12 col-md-3 col-lg-2 col-form-label" for="txtWoErpNo@(itemName)">製令單號</label>
                                    <div class="col-12 col-md-9 col-lg-4">
                                        <input type="text" class="form-control" id="txtWoErpNo@(itemName)" name="txtWoErpNo@(itemName)" placeholder="請輸入製令單號" />
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-12 col-md-12">
                                <div class="form-group row">
                                    <label class="col-12 col-md-3 col-lg-2 col-form-label" for="txtDocDate@(itemName)">單據日期<span class="text-danger">*</span></label>
                                    <div class="col-12 col-md-9 col-lg-4">
                                        <input type="text" class="form-control" id="txtDocDate@(itemName)" name="txtDocDate@(itemName)" onkeypress="BandeInput(event)" onkeydown="BandCtrlV(event)"
                                               data-msg-extraRegex="請輸入正確的日期格式" data-rule-extraRegex="([12]\d{3}\-(0[1-9]|1[0-2])\-(0[1-9]|[12]\d|3[01]))" />
                                    </div>
                                    <label class="col-12 col-md-3 col-lg-2 col-form-label" for="cboSoDetailId@(itemName)">訂單資料</label>
                                    <div class="col-12 col-md-9 col-lg-4">
                                        <select class="form-control" id="cboSoDetailId@(itemName)" name="cboSoDetailId@(itemName)">
                                            <option value="">-- 請選擇訂單資料 --</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-lg-12 col-md-12">
                                <div class="form-group row">
                                    <label class="col-12 col-md-3 col-lg-2 col-form-label" for="txtExpectedStart@(itemName)">預計開工<span class="text-danger">*</span></label>
                                    <div class="col-12 col-md-9 col-lg-4">
                                        <input type="text" class="form-control" id="txtExpectedStart@(itemName)" name="txtExpectedStart@(itemName)" onkeypress="BandeInput(event)" onkeydown="BandCtrlV(event)"
                                               data-msg-extraRegex="請輸入正確的日期格式" data-rule-extraRegex="([12]\d{3}\-(0[1-9]|1[0-2])\-(0[1-9]|[12]\d|3[01]))" data-rule-required="true" />
                                    </div>
                                    <label class="col-12 col-md-3 col-lg-2 col-form-label" for="txtExpectedEnd@(itemName)">預計完工<span class="text-danger">*</span></label>
                                    <div class="col-12 col-md-9 col-lg-4">
                                        <input type="text" class="form-control" id="txtExpectedEnd@(itemName)" name="txtExpectedEnd@(itemName)" onkeypress="BandeInput(event)" onkeydown="BandCtrlV(event)"
                                               data-msg-extraRegex="請輸入正確的日期格式" data-rule-extraRegex="([12]\d{3}\-(0[1-9]|1[0-2])\-(0[1-9]|[12]\d|3[01]))" />
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-12 col-md-12">
                                <div class="form-group row">
                                    <label class="col-12 col-md-3 col-lg-2 col-form-label" for="cboInventoryId@(itemName)">入庫庫別<span class="text-danger">*</span></label>
                                    <div class="col-12 col-md-9 col-lg-4">
                                        <select class="form-control" id="cboInventoryId@(itemName)" name="cboInventoryId@(itemName)" data-rule-required="true" data-msg-required="請選擇庫別">
                                            <option value="">-- 請選擇入庫庫別 --</option>
                                        </select>
                                    </div>
                                    <label class="col-12 col-md-3 col-lg-2 col-form-label" for="txtPlanQty@(itemName)">預計產量<span class="text-danger">*</span></label>
                                    <div class="col-12 col-md-9 col-lg-4">
                                        <input type="number" class="form-control" id="txtPlanQty@(itemName)" name="txtPlanQty@(itemName)"
                                               placeholder="請輸入預計產量" data-rule-required="true" data-msg-required="請編寫預計產量"
                                               data-msg-maxlength="必須少於 100 個字元" maxlength="100" />
                                    </div>
                                </div>
                            </div>
                        </div>
                        <dive class="row">
                            <div class="col-lg-12 col-md-12">
                                <div class="form-group row">
                                    <label class="col-12 col-md-3 col-lg-2 col-form-label" for="cboUomId@(itemName)">單位</label>
                                    <div class="col-12 col-md-9 col-lg-4">
                                        <select class="form-control" id="cboUomId@(itemName)" name="cboUomId@(itemName)">
                                            <option value="">-- 請選擇單位 --</option>
                                        </select>
                                    </div>
                                    <label class="col-12 col-md-3 col-lg-2 col-form-label" for="cboProject@(itemName)">專案名稱</label>
                                    <div class="col-12 col-md-9 col-lg-4">
                                        <select class="form-control" id="cboProject@(itemName)" name="cboProject@(itemName)">
                                            <option value="">-- 請選擇專案 --</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </dive>
                        <div class="row">
                            <div class="col-lg-12 col-md-12">
                                <div class="form-group row">
                                    <label class="col-12 col-md-3 col-lg-2 col-form-label" for="cboCurrencyCode@(itemName)">幣別</label>
                                    <div class="col-12 col-md-9 col-lg-4">
                                        <select class="form-control" id="cboCurrencyCode@(itemName)" name="cboCurrencyCode@(itemName)">
                                            <option value="">-- 請選擇幣別--</option>
                                        </select>
                                    </div>
                                    <label class="col-12 col-md-3 col-lg-2 col-form-label" for="txtExchange@(itemName)">匯率</label>
                                    <div class="col-12 col-md-9 col-lg-4">
                                        <input type="text" class="form-control" id="txtExchange@(itemName)" name="txtExchange@(itemName)" placeholder="請輸入匯率" value="1" />
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-12 col-md-12">
                                <div class="form-group row">
                                    <label class="col-12 col-md-3 col-lg-2 col-form-label" for="chkLossRateStatus@(itemName)">損耗率啟用<span class="text-danger">*</span></label>
                                    <div class="col-12 col-md-9 col-lg-4" style="display: flex;justify-content: space-around;  align-items: center;">
                                        <div class="col-lg-3 col-md-4 col-6">
                                            <label class="control control-solid control-solid-info control--radio col-12">
                                                是
                                                <input type="radio" id="chkLossRateStatus@(itemName)Y" name="chkLossRateStatus@(itemName)" value="Y"
                                                       data-msg-required="請選擇是否啟用損耗率" checked />
                                                <span class="control__indicator"></span>
                                            </label>
                                        </div>
                                        <div class="col-lg-3 col-md-4 col-6">
                                            <label class="control control-solid control-solid-info control--radio col-12">
                                                否
                                                <input type="radio" id="chkLossRateStatus@(itemName)N" name="chkLossRateStatus@(itemName)" value="N"
                                                       data-msg-required="請選擇是否啟用損耗率" />
                                                <span class="control__indicator"></span>
                                            </label>
                                        </div>
                                    </div><label class="col-12 col-md-3 col-lg-2 col-form-label" for="chkProperty@(itemName)">性質<span class="text-danger">*</span></label>
                                    <div class="col-12 col-md-9 col-lg-4" style="display: flex;justify-content: space-around;  align-items: center;">
                                        <div class="col-lg-6 col-md-4 col-6">
                                            <label class="control control-solid control-solid-info control--radio col-12">
                                                廠內
                                                <input type="radio" id="chkProperty@(itemName)IN" name="chkProperty@(itemName)" value="1"
                                                       data-msg-required="廠內"  disabled/>
                                                <span class="control__indicator"></span>
                                            </label>
                                        </div>
                                        <div class="col-lg-6 col-md-4 col-6">
                                            <label class="control control-solid control-solid-info control--radio col-12">
                                                托外
                                                <input type="radio" id="chkProperty@(itemName)OUT" name="chkProperty@(itemName)" value="2"
                                                       data-msg-required="托外" checked disabled/>
                                                <span class="control__indicator"></span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row" id="ProductionLine">
                            <div class="col-lg-12 col-md-12">
                                <div class="form-group row">
                                    <label class="col-12 col-md-3 col-lg-2 col-form-label" for="cboProductionLine@(itemName)">生產線別</label>
                                    <div class="col-12 col-md-9 col-lg-4">
                                        <select class="form-control" id="cboProductionLine@(itemName)" name="cboProductionLine@(itemName)">
                                            <option value="">-- 請選擇生產線別 --</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row Processor" >
                            <div class="col-lg-12 col-md-12">
                                <div class="form-group row">
                                    <label class="col-12 col-md-3 col-lg-2 col-form-label" for="cboProcessor@(itemName)">加工廠商</label>
                                    <div class="col-12 col-md-9 col-lg-4">
                                        <select class="form-control" id="cboProcessor@(itemName)" name="cboProcessor@(itemName)">
                                            <option value="">-- 請選擇加工廠商 --</option>
                                        </select>
                                    </div>
                                    <label class="col-12 col-md-3 col-lg-2 col-form-label" for="cboTaxCode@(itemName)">稅別碼</label>
                                    <div class="col-12 col-md-9 col-lg-4">
                                        <select class="form-control" id="cboTaxCode@(itemName)" name="cboTaxCode@(itemName)" disabled>
                                            <option value="">-- 請選擇稅別碼--</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row Processor">
                            <div class="col-lg-12 col-md-12">
                                <div class="form-group row">
                                    <label class="col-12 col-md-3 col-lg-2 col-form-label" for="cboTaxType@(itemName)" >課稅別</label>
                                    <div class="col-12 col-md-9 col-lg-4">
                                        <select class="form-control" id="cboTaxType@(itemName)" name="cboTaxType@(itemName)" disabled>
                                            <option value="">-- 請選擇課稅別--</option>
                                        </select>
                                    </div>
                                    <label class="col-12 col-md-3 col-lg-2 col-form-label" for="txtTaxRate@(itemName)">營業稅率</label>
                                    <div class="col-12 col-md-9 col-lg-4">
                                        <input type="text" class="form-control" id="txtTaxRate@(itemName)" name="txtTaxRate@(itemName)" placeholder="請輸入營業稅率" disabled/>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row Processor">
                            <div class="col-lg-12 col-md-12">
                                <div class="form-group row">
                                    <label class="col-12 col-md-3 col-lg-2 col-form-label" for="txtPricingTerm@(itemName)">價格條件</label>
                                    <div class="col-12 col-md-9 col-lg-4">
                                        <input type="text" class="form-control" id="txtPricingTerm@(itemName)" name="txtPricingTerm@(itemName)" placeholder="請輸入價格條件" />
                                    </div>
                                    <label class="col-12 col-md-3 col-lg-2 col-form-label" for="cboPaymentTerm@(itemName)">付款條件代號</label>
                                    <div class="col-12 col-md-9 col-lg-4">
                                        <select class="form-control" id="cboPaymentTerm@(itemName)" name="cboPaymentTerm@(itemName)">
                                            <option value="">-- 請選擇付款條件代號 --</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-12 col-md-12">
                                <div class="form-group row">
                                    <label class="col-12 col-md-3 col-lg-2 col-form-label" for="txtWoRemark@(itemName)">備註</label>
                                    <div class="col-12 col-md-9 col-lg-10">
                                        <textarea class="form-control" id="txtWoRemark@(itemName)" name="txtWoRemark@(itemName)"
                                                  data-msg-maxlength="必須少於 255 個字元" maxlength="255" rows="2" placeholder="請輸入備註"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <a class="btn btn-collapse" data-toggle="collapse" href="#basic@(itemName)">
                            <span><i class="fas fa-clipboard"></i> 工單次要資料</span>
                            <i class="fas fa-chevron-down"></i>
                        </a>
                        <div class="collapse mb-3" id="basic@(itemName)">
                            <div class="card card-body">
                                <div class="row">
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12 col-md-3 col-lg-3 col-form-label" for="txtBomDate@(itemName)">BOM日期</label>
                                            <div class="col-12 col-md-9 col-lg-9">
                                                <input type="text" class="form-control" id="txtBomDate@(itemName)" name="txtBomDate@(itemName)"
                                                       data-msg-extraRegex="請輸入正確的日期格式" data-rule-extraRegex="([12]\d{3}\-(0[1-9]|1[0-2])\-(0[1-9]|[12]\d|3[01]))" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12 col-md-3 col-lg-3 col-form-label" for="txtBomVersion@(itemName)">BOM版次</label>
                                            <div class="col-12 col-md-9 col-lg-9">
                                                <input type="text" class="form-control" id="txtBomVersion@(itemName)" name="txtBomVersion@(itemName)" placeholder="請輸入BOM版次" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12 col-md-3 col-lg-3 col-form-label" for="cboConfirmUserId@(itemName)">確認者</label>
                                            <div class="col-12 col-md-9 col-lg-9">
                                                <select class="form-control" id="cboConfirmUserId@(itemName)" name="cboConfirmUserId@(itemName)">
                                                    <option value="">-- 請選擇確認者 --</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12 col-md-3 col-lg-3 col-form-label" for="txtConfirmDate@(itemName)">確認日期</label>
                                            <div class="col-12 col-md-9 col-lg-9">
                                                <input type="text" class="form-control" id="txtConfirmDate@(itemName)" name="txtConfirmDate@(itemName)"
                                                       data-msg-extraRegex="請輸入正確的日期格式" data-rule-extraRegex="([12]\d{3}\-(0[1-9]|1[0-2])\-(0[1-9]|[12]\d|3[01]))" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12 col-md-3 col-lg-3 col-form-label" for="txtVersion@(itemName)">版次</label>
                                            <div class="col-12 col-md-9 col-lg-9">
                                                <input type="text" class="form-control" id="txtVersion@(itemName)" name="txtVersion@(itemName)" placeholder="請輸入版次" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-12">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </fieldset>
                </form>
            </div>
            <div class="card-footer text-center text-lg-right">
                <button type="button" class="btn btn-success read-wipOder" onclick="Save@(itemName)()"><i class="fas fa-save"></i>儲存</button>
            </div>
        </div>
    </div>
</div>

<div class="advanced-block">
    <div class="row">
        <div class="col-12">
            <ul class="nav flag-tabs nav-fill" role="tablist">
                <li class="flag-item">
                    <a class="flag-link active" data-toggle="tab" href="#tabWoDetail">
                        <i class="fas fa-garage-car"></i> ERP製令單身
                    </a>
                </li>
            </ul>
        </div>
    </div>
    <div class="tab-content">
        <div class="tab-pane active" id="tabWoDetail">
            @Html.Partial("WoDetail")
        </div>
    </div>
</div>

<!--指定結案備註-->
<div class="modal fade" id="modalRemark@(itemName)">
    <div class="modal-dialog modal-lg" style="padding-top:7%;">
        <div class="modal-content working-content" style="min-width:350px;">
            <div class="modal-header" style="align-items: center;">
                <h5 class="modal-title">
                    備註
                </h5>
                <button class="close" data-dismiss="modal" type="button">
                    <span aria-hidden="true"><i class="fas fa-times"></i></span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row" id=" ">
                    <div class="col-12">
                        <form autocomplete="off" id="editForm@(itemName)">
                            <div class="row">
                                <div class="col-lg-12 col-md-12 ">
                                    <div class="form-group row">
                                        <label class="col-12 col-form-label">實際完工日期</label>
                                        <div class="col-12">
                                            <input type="text" class="form-control" id="txtFinishDate@(itemName)" name="txtFinishDate@(itemName)"
                                                   data-msg-extraRegex="請輸入正確的日期格式" data-rule-extraRegex="([12]\d{3}\-(0[1-9]|1[0-2])\-(0[1-9]|[12]\d|3[01]))"
                                                   readonly />
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label class="form-label col-12" for="txtRemark@(itemName)">備註<span class="text-danger">*</span></label>
                                        <div class="col-12">
                                            <textarea class="form-control" id="txtRemark@(itemName)" name="txtRemark@(itemName)" rows="2"
                                                      placeholder="請輸入備註"
                                                      data-msg-required="請輸入備註"
                                                      data-msg-maxlength="必須少於 255 個字元" maxlength="255" required></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>

                    </div>
                </div>
            </div>
            <div class="card-footer text-right text-lg-right">
                <button type="button" class="btn btn-success checkbox-mode once" onclick="CloseWipOrder@(itemName)()"><i class="fas fa-paper-plane"></i>確定</button>
                <button type="button" class="btn btn-success checkbox-mode batch" onclick="Action@(itemName)('Close')"><i class="fas fa-paper-plane"></i>確定</button>
            </div>
        </div>
    </div>
</div>

@Html.Partial("ViewMtlItem")
@Html.Partial("ViewSoDetail")

@Html.Resource("js",
    @<script>
        let objPage@(itemName) = {
            "pageIndex": 0,
            "pageSize": 10
        };
        let objForm@(itemName) = "#editForm@(itemName)";

        let userId@(itemName);
        let companyId@(itemName);
        let userNo@(itemName);
        let BatchAction = false
        let WoStatus = ""

        /*定義page */
        let page = {
            TreeStru: "@Url.Action("TreeStru", "Production")"
        };

        $(document).ready(function () {
            GetUserInfo@(itemName)()


            ComboBoxs.WithText("#cboWoErpPrefixQ@(itemName)", "@Url.Action("GetErpData", "BasicInformation")", { "UserNo": userNo@(itemName),"ColumnName": "WipErpPrefix" }, "", "NA", "", "WoErpPrefixName", "WoErpPrefix"); //製令單別
            ComboBoxs.Default("#cbConfirmStatusQ@(itemName)", "@Url.Action("GetStatus", "BasicInformation")", { "StatusSchema": "ConfirmStatus" }, "", "NA", "", "StatusName", "StatusNo"); //製令狀態碼
            ComboBoxs.Default("#cboWoStatusQ@(itemName)", "@Url.Action("GetStatus", "BasicInformation")", { "StatusSchema": "WipOrder.WoStatus" }, "", "NA", "", "StatusName", "StatusNo"); //製令狀態碼
            ComboBoxs.Default("#cboWoTransferStatusQ@(itemName)", "@Url.Action("GetStatus", "BasicInformation")", { "StatusSchema": "Boolean" }, "", "NA", "", "StatusName", "StatusNo"); //製令狀態碼

            let currentDate = new Date();
            //Suites.DateDropper("#txtStartDateQ@(itemName),#txtEndDateQ@(itemName)");
            Suites.DatePicker("txtEndDateQ@(itemName)", currentDate);
            Suites.DatePicker("txtFinishDate@(itemName)", currentDate);
            currentDate.setDate(currentDate.getDate() - 30);
            Suites.DatePicker("txtStartDateQ@(itemName)", currentDate);

            $("input[name='chkLossRateStatus@(itemName)']").on("click", function () {
                if ($("#WoId").val() > 0) {
                    alert("該單據的單身已經成立,不可再異動", "warning")
                    return false
                }
            })


            $("#txtMtlItemId@(itemName)").change(function (e) {
                checkMtlItemId@(itemName)()
                setTimeout(function () {
                    ComboBoxs.Default("#cboSoDetailId@(itemName)", "@Url.Action("GetSaleOrderSimple", "SaleOrder")", { "MtlItemId": $("#txtMtlItemId@(itemName)").val()}, "", "NA", "", "SoErpFullNo", "SoDetailId"); //訂單單位
                }, 500)

            });

            $("#cboWoErpPrefix@(itemName)").change(function () {
                var WoErpPrefix = $("#cboWoErpPrefix@(itemName)").val()
                @*if (WoErpPrefix != "") {
                    $("#MtlItemView").show()
                    if (WoErpPrefix == "5101") {
                        let popConfig1 = {
                            targetSelector: "#txtMtlItemId@(itemName)",
                            popFunction: "PopViewMtlItem",
                            objectMtlItemId: "#txtMtlItemId@(itemName)",
                            objectMtlItemNo: "#desMtlItemNo@(itemName)",
                            objectMtlItemName: "#desMtlItemName@(itemName)",
                            objectMtlItemSpec: "#desMtlItemSpec@(itemName)",
                            objectUomNo: "#desUomNo@(itemName)",
                            objectUomId: "#cboUomId@(itemName)",
                            objectInventoryId: "#cboInventoryId@(itemName)",
                            objectItemAttribute: "F,M,O,S,Y",
                        };
                        InitPopView(popConfig1);
                    }
                }
                else {
                    $("#MtlItemView").hide()
                }*@

                GetProperty(WoErpPrefix)

                ComboBoxs.WithText("#cboProcessor@(itemName)", "@Url.Action("GetErpData", "BasicInformation")", { "ColumnName": "Processor" }, "", "NA", "", "ProcessorName", "ProcessorNo");
                //稅別碼選單
                ComboBoxs.WithText("#cboTaxCode@(itemName)", "@Url.Action("GetErpData", "BasicInformation")", { "ColumnName": "TaxNo" }, "", "NA", "", "TaxName", "TaxNo");
                //課稅別選單
                ComboBoxs.Default("#cboTaxType@(itemName)", "@Url.Action("GetType", "BasicInformation")", { "TypeSchema": "Customer.Taxation" }, "", "NA", "", "TypeName", "TypeNo");
                //幣別選單
                ComboBoxs.WithText("#cboCurrencyCode@(itemName)", "@Url.Action("GetErpData", "BasicInformation")", { "ColumnName": "Currency" }, "", "NA", "", "CurrencyName", "Currency");
                //付款條件選單
                ComboBoxs.Default("#cboPaymentTerm@(itemName)", "@Url.Action("GetErpData", "BasicInformation")", { "ColumnName": "PaymentTerm" }, "", "NA", "", "PaymentTermName", "PaymentTermNo");


                if (companyId@(itemName) == 4) {
                    $("#cboCurrencyCode@(itemName)").val("CNY");
                }
                else if (companyId@(itemName) == 3) {
                    $("#cboCurrencyCode@(itemName)").val("NTD");
                }
                else if (companyId@(itemName) == 5) {
                    $("#cboCurrencyCode@(itemName)").val("CNY");
                }
                else if (companyId@(itemName) == 8) {
                    $("#cboCurrencyCode@(itemName)").val("THB");
                }
            
                else {
                    $("#cboCurrencyCode@(itemName)").val("NT$");
                }
                $("#txtExchange@(itemName)").val(1);

            })

            $("#cboProcessor@(itemName)").change(function () {
                var Processor = $("#cboProcessor@(itemName)").val()
                GetProcessor(Processor)
            })

            $("#cboCurrencyCode@(itemName)").change(function () {
                var CurrencyCode = $("#cboCurrencyCode@(itemName)").val()
                GetCurrencyCode(CurrencyCode)
            })

            $("input[name='chkProperty@(itemName)']").change(function () {
                //縣別選單
                ComboBoxs.WithText("#cboProductionLine@(itemName)", "@Url.Action("GetErpData", "BasicInformation")", { "ColumnName": "ProduceLineNo" }, "", "NA", "", "ProduceLineName", "ProduceLineNo");
                //加工廠商選單
                ComboBoxs.WithText("#cboProcessor@(itemName)", "@Url.Action("GetErpData", "BasicInformation")", { "ColumnName": "Processor" }, "", "NA", "", "ProcessorName", "ProcessorNo");
                //稅別碼選單
                ComboBoxs.WithText("#cboTaxCode@(itemName)", "@Url.Action("GetErpData", "BasicInformation")", { "ColumnName": "TaxNo" }, "", "NA", "", "TaxName", "TaxNo");
                //課稅別選單
                ComboBoxs.Default("#cboTaxType@(itemName)", "@Url.Action("GetType", "BasicInformation")", { "TypeSchema": "Customer.Taxation" }, "", "NA", "", "TypeName", "TypeNo");
                //幣別選單
                ComboBoxs.WithText("#cboCurrencyCode@(itemName)", "@Url.Action("GetErpData", "BasicInformation")", { "ColumnName": "Currency" }, "", "NA", "", "CurrencyName", "Currency");
                //付款條件選單
                ComboBoxs.Default("#cboPaymentTerm@(itemName)", "@Url.Action("GetErpData", "BasicInformation")", { "ColumnName": "PaymentTerm" }, "", "NA", "", "PaymentTermName", "PaymentTermNo");

                $("#cboProductionLine@(itemName)").val("")
                $("#cboPaymentTerm@(itemName)").val("")
                $("#cboProcessor@(itemName)").val("")
                $("#cboTaxCode@(itemName)").val("")
                $("#cboTaxType@(itemName)").val("")
                $("#txtTaxRate@(itemName)").val(0)
                $("#txtPricingTerm@(itemName)").val("")
                $("#cboPaymentTerm@(itemName)").val("")
                if (companyId@(itemName) == 4) {
                    $("#cboCurrencyCode@(itemName)").val("CNY");
                }
                else if (companyId@(itemName) == 3) {
                    $("#cboCurrencyCode@(itemName)").val("NTD");
                }
                else if (companyId@(itemName) == 5) {
                    $("#cboCurrencyCode@(itemName)").val("CNY");
                }
                else if (companyId@(itemName) == 8) {
                    $("#cboCurrencyCode@(itemName)").val("THB");
                }
                else {
                    $("#cboCurrencyCode@(itemName)").val("NT$");
                }
                $("#txtExchange@(itemName)").val(1);

                var selectedValue = $("input[name='chkProperty@(itemName)']:checked").val();
                if (selectedValue == "1") {
                    $("#ProductionLine").show()

                    $(".Processor").hide()

                }
                else if (selectedValue == "2") {
                    $("#ProductionLine").hide()
                    $(".Processor").show()
                }
                else {
                    alert("切換性質資料錯誤!!")
                    return
                }
            })

            



            //製令列表全選
            $("#cbxWoIdAll@(itemName)").off("click").on("click", function () {
                if ($("#cbxWoIdAll@(itemName)").is(":checked")) {
                    $("input[type='checkbox'][name='cbxWoId@(itemName)']").not(":disabled").prop("checked", true);
                } else {
                    $("input[type='checkbox'][name='cbxWoId@(itemName)']").not(":disabled").prop("checked", false);
                }
            })

            if (!isMobile) {
                $("#cboWoErpPrefixQ@(itemName), #cbConfirmStatusQ@(itemName), #cboWoStatusQ@(itemName), #cboWoTransferStatusQ@(itemName) ,#cboSoDetailId@(itemName)").select2({
                    dropdownAutoWidth: true,
                    width: "100%"
                });
            }

            Query@(itemName)();

            $(".batchShow").show()
            $(".CancelBatchShow").hide()
            $(".Close").hide()
        });

        function Query@(itemName)() {
            //objPage@(itemName).pageIndex = 0;
            InitData@(itemName)(objPage@(itemName));
            $(".CancelBatchShow").hide()
            $("#modalQuery@(itemName)").modal("hide");
        }

        function InitData@(itemName)(objPage) {
            let innerHtml = '';
            let pageCount = 0;
            let WoCnt = parseInt($("input[name='cboWoCntStatusYQ@(itemName)']:checked").val());
            let targetUrl = "@Url.Action("GetWipOrder", "Production")";
            let postData = {
                "OrderBy": "",
                "PageIndex": (objPage.pageIndex + 1),
                "PageSize": objPage.pageSize,
                "WoErpPrefix": $("#cboWoErpPrefixQ@(itemName)").val(),
                "WoErpFullNo": $("#txtWoErpFullNoQ@(itemName)").val().trim(),
                "MtlItemNo": $("#txtMtlItemNoQ@(itemName)").val().trim(),
                "StartDate": ($("#cbxDocDateQ@(itemName)").is(":checked") ? $("#txtStartDateQ@(itemName)").val() : ""),
                "EndDate": ($("#cbxDocDateQ@(itemName)").is(":checked") ? $("#txtEndDateQ@(itemName)").val() : ""),
                "ConfirmStatus": $("#cbConfirmStatusQ@(itemName)").val(),
                "WoStatus": BatchAction != true ? $("#cboWoStatusQ@(itemName)").val() : WoStatus,
                "TransferStatus": $("#cboWoTransferStatusQ@(itemName)").val(),
                "SoErpNo": $("#txtSoErpNoQ@(itemName)").val(),
                "WoCnt": WoCnt
            };
            let data = DataAccess.Get(targetUrl, postData, false);

            if (data.status == "success") {
                pageCount = data.result.length > 0 ? parseInt(data.result[0]["TotalCount"]) : 0;

                if (pageCount > 0) {
                    objPage = PageCaculate(pageCount, objPage);

                    $.each(data.result, function (i, item) {
                        let _row = (objPage.pageSize * objPage.pageIndex + (i + 1)) + ".";
                        let woFullNoo = item.WoErpPrefix + "-" + item.WoErpNo;
                        innerHtml += `<tr>
                                        <td class="col-sticky">${_row}
                                            <label class="control control-solid control-solid-info CancelBatchShow">
                                                <input type="checkbox" data-key="${item.WoId}" value="${item.WoId}" name="cbxWoId@(itemName)"/>
                                                <span class="control__indicator"></span>
                                              </label>
                                        </td>
                                        <td class="ellipsis col-sticky" data-toggle="tooltip" title="${item.WoErpPrefix}-${item.WoErpNo}" style="max-width: 200px;">${item.WoErpPrefix}-${item.WoErpNo}</td>
                                        <td class="text-center active-content">
                                          <div class="btn-group mb-4 show" style="margin-bottom: 0 !important; position: static;">
                                            <button type="button" class="btn btn-primary dropdown-toggle" data-so-id="${item.WoId}" style="padding-top: 0; padding-bottom: 0;">動作</button>
                                            <div class="dropdown-menu btn-text-left-block" data-so-id="${item.WoId}" style="overflow-y: auto; z-index: 999; max-height: 150px;">
                                              <a class="dropdown-item btn-text-left auth-read" href="javascript:Read@(itemName)(${item.WoId});" ><i class="fas fa-eye"></i>查看</a>
                                              <a class="dropdown-item btn-text-left auth-woDetail" href="javascript:Detail@(itemName)(${item.WoId});"><i class="fas fa-list"></i><span>單身</span></a>
                                              ${item.ConfirmStatus == `N` ? `<a class="dropdown-item btn-text-left auth-update" href="javascript:Edit@(itemName)(${item.WoId});" ><i class="fas fa-edit"></i>修改</a>` : ``}
                                              ${item.TransferStatus == `N` ? `<a class="dropdown-item btn-text-left auth-delete" href="javascript:Delete@(itemName)(${item.WoId});" ><i class="fas fa-trash-alt"></i>刪除</a>` : ``}
                                              ${item.ConfirmStatus == `N` ? `<a class="dropdown-item btn-text-left auth-confirm" href="javascript:Confirm@(itemName)(${item.WoId});" ><i class="fas fa-check-circle"></i>確認</a>` : ``}
                                              ${item.ConfirmStatus == `Y` && item.TransferStatus == `Y` && item.WoStatus == 1 && item.WoCnt <= 0 ? `<a class="dropdown-item btn-text-left auth-reconfirm" href="javascript:ReConfirm@(itemName)(${item.WoId});" ><i class="fas fa-undo-alt"></i>反確認</a>` : ``}
                                              ${item.ConfirmStatus == `N` && item.TransferStatus == `Y` ? `<a class="dropdown-item btn-text-left auth-void" href="javascript:Void@(itemName)(${item.WoId});" ><i class="fas fa-ban"></i>作廢</a>` : ``}
                                              ${item.ConfirmStatus == `Y` && item.TransferStatus == `Y` ? `<a class="dropdown-item btn-text-left auth-finish" href="javascript:PopModalRemark@(itemName)(${item.WoId}, '${item.ActualEnd}');"><i class="fas fa-oven"></i><span>指定結案</span></a>`:``}
                                              ${item.TransferStatus == `Y` ? `<a class="dropdown-item btn-text-left auth-doc-download" href="javascript:PopSoWord@(itemName)(${item.WoId});" ><i class="fas fa-file-download"></i>單據下載</a>` : ``}
                                              <a class="dropdown-item btn-text-left auth-print" href="javascript:Print@(itemName)(${item.WoId});"><i class="fas fa-print"></i><span>列印</span></a>                                       
                                              <a class="dropdown-item btn-text-left auth-tree" href="javascript:TreeWindows(${item.WoId}, ${woFullNoo});"><i class="fas fa-bezier-curve"></i><span>串查</span></a>
                                            </div>
                                          </div>
                                        </td>
                                        <td class="">${item.DocDate}</td>
                                        <td class="ellipsis " data-toggle="tooltip" title="${item.MtlItemNo}" style="max-width: 200px;">${item.MtlItemNo}</td>
                                        <td class="ellipsis " data-toggle="tooltip" title="${item.MtlItemName}" style="max-width: 250px;">${item.MtlItemName}</td>
                                        <td>${item.PlanQty}</td>
                                        <td>${item.ExpectedStart}</td>
                                        <td>${item.ExpectedEnd}</td>
                                        <td class="text-center">${InputStatusContent(`S`, `WoStatus`, item.WoStatus)}</td>
                                        <td class="text-center">${InputStatusContent(`S`, `ConfirmStatus`, item.ConfirmStatus) }</td>
                                        <td class="text-center">${InputStatusContent(`S`, `TransferStatus`, item.TransferStatus)}</td>
                                        <td>${item.DocUserName}</td>
                                        <td>${item.ConfirmUserName != null ? item.ConfirmUserName : `未確認`}</td>
                                        ${item.WoCnt <= 0 ? `<td class="ellipsis " data-toggle="tooltip" style="max-width: 200px;"><i class="fas fa-times" style="color: #ff0000;"></i></td>` :`<td class="ellipsis " data-toggle="tooltip" style="max-width: 200px;"><i class="fas fa-check" style="color: #25d431;"></i></td>`}
                                        <!--${item.MrCnt <= 0 ? `<td class="ellipsis " data-toggle="tooltip" style="max-width: 200px;"><i class="fas fa-times" style="color: #ff0000;"></i></td>` : `<td class="ellipsis " data-toggle="tooltip" style="max-width: 200px;"><i class="fas fa-check" style="color: #25d431;"></i></td>`}-->
                                        
                                      </tr>
                                      <tr data-wo-id="${item.WoId}" style="display: none;">
                                        <td colspan="16">
                                          <table style="width: 100%; margin: auto; border: 1px solid #d7d7e1;">
                                            <thead>
                                             <tr>
                                                <th class="thead-customized" scope="col">#</th>
                                                <th class="thead-customized" scope="col">材料品號</th>
                                                <th class="thead-customized" scope="col">材料品名</th>
                                                <th class="thead-customized" scope="col">需領用量</th>
                                                <th class="thead-customized" scope="col">已領用量</th>
                                                <th class="thead-customized" scope="col">庫別</th>
                                                <th class="thead-customized" scope="col">替代料</th>
                                              </tr>
                                           </thead>
                                            <tbody>
                                                @*${DetailData@(itemName)(item.WoDetail)}*@
                                            </tbody>
                                          </table>
                                        </td>
                                      </tr>`;
                    });
                }else {
                    innerHtml += `<tr>
                                    <td class="text-center" colspan="14" style="background-color: #fff3cd;">
                                      <i class="fal fa-exclamation-circle"></i>&nbsp;目前尚無資料。
                                    </td>
                                  </tr>`;
                }
            } else {
                alert(data.msg, "alert", 0);
            }

            $("#tblData@(itemName) tbody").html(innerHtml);
            TableComponentInit();
            Pager("#page@(itemName)", pageCount, objPage, InitData@(itemName));

            $(".dropdown-toggle").off("click").on("click", function () {
                let soId = $(this).data("so-id");

                if ($(`.dropdown-menu[data-so-id='${soId}']`).hasClass("show")) {
                    $(".dropdown-menu").removeClass("show");
                } else {
                    $(".dropdown-menu").removeClass("show");

                    $(`.dropdown-menu[data-so-id='${soId}']`).addClass("show");
                    $(`.dropdown-menu[data-so-id='${soId}']`).css({
                        top: `${$(this).position().top + $(this).height() + 5}px`,
                        left: `${$(this).position().left - $(this).width() + 38}px`
                    });
                }
            });

            $("body").off("click").on("click", function (e) {
                if ($(".dropdown-menu").hasClass("show")) {
                    if (!$(e.target).hasClass("dropdown-toggle")
                        && !$(e.target).parents().hasClass("dropdown-toggle")) {
                        $(".dropdown-menu").removeClass("show");
                    }
                }
            });
        }

        function Read@(itemName)(WoId) {
            $("#ProductionLine").hide()
            $(".Processor").show()
            $("#TransferStatus").val("Y");
            $("#WoId").val(WoId ? WoId : 0);
            $("#WoStatus").val(WoStatus ? WoStatus : 1);
            $("#txtDocDate@(itemName)").attr("disabled", true);
            $("#txtBomDate@(itemName)").attr("readonly", true);
            $("#cboWoErpPrefix@(itemName)").attr("disabled", true);
            $("#txtWoErpNo@(itemName)").attr("readonly", true);
            $("#cboInventoryId@(itemName)").attr("disabled", true);
            $("#txtPlanQty@(itemName)").attr("readonly", true);
            $("#cboUomId@(itemName)").attr("disabled", true);
            $("#txtWoRemark@(itemName)").attr("readonly", true);
            $("#cboProject@(itemName)").attr("readonly", true);
            $("#txtExpectedStart@(itemName)").attr("readonly", true);
            $("#txtExpectedEnd@(itemName)").attr("readonly", true);
            $("#cboConfirmUserId@(itemName)").attr("disabled", true);
            $("#txtConfirmDate@(itemName)").attr("readonly", true);
            $("#txtVersion@(itemName)").attr("readonly", true);
            $("#txtBomVersion@(itemName)").attr("readonly", true);
            $("#cboSoDetailId@(itemName)").attr("disabled", true);
            $("#cboProductionLine@(itemName)").attr("disabled", true);
            $("#cboCurrencyCode@(itemName)").attr("disabled", true);
            $("#txtExchange@(itemName)").attr("disabled", true);
            $("#cboProcessor@(itemName)").attr("disabled", true);
            $("#txtPricingTerm@(itemName)").attr("disabled", true);
            $("#cboPaymentTerm@(itemName)").attr("disabled", true);


            $(".read-wipOder").hide();

            Switch("#editData@(itemName), .unit-block", "#listData@(itemName)");

            //下拉選單
            ComboBoxs.WithText("#cboWoErpPrefix@(itemName)", "@Url.Action("GetErpData", "BasicInformation")", { "UserNo": userNo@(itemName),"ColumnName": "WipErpPrefix" }, "", "NA", "", "WoErpPrefixName", "WoErpPrefix"); //製令單別
            ComboBoxs.Default("#cboInventoryId@(itemName)", "@Url.Action("GetInventory", "ScmBasicInformation")", {}, "", "NA", "", "InventoryWithNo", "InventoryId"); //入庫庫別
            ComboBoxs.Default("#cboConfirmUserId@(itemName)", "@Url.Action("GetUser", "BasicInformation")", {"CompanyId": companyId@(itemName)}, "", "NA", "", "UserWithNo", "UserId"); //確認者
            ComboBoxs.Default("#cboUomId@(itemName)", "@Url.Action("GetUnitOfMeasure", "PdmBasicInformation")", {"Status":"A"}, "", "NA", "", "UomNo", "UomId"); //加工單位
            ComboBoxs.WithText("#cboCurrencyCode@(itemName)", "@Url.Action("GetErpData", "BasicInformation")", { "ColumnName": "Currency" }, "", "NA", "", "CurrencyName", "Currency");
            //專案代號選單
            ComboBoxs.Default("#cboProject@(itemName)", "@Url.Action("GetErpData", "BasicInformation")", { "ColumnName": "Project" }, "", "NA", "", "ProjectName", "Project");
            //線別選單
            ComboBoxs.WithText("#cboProductionLine@(itemName)", "@Url.Action("GetErpData", "BasicInformation")", { "ColumnName": "ProduceLineNo" }, "", "NA", "", "ProduceLineName", "ProduceLineNo");
            //加工廠商選單
            ComboBoxs.WithText("#cboProcessor@(itemName)", "@Url.Action("GetErpData", "BasicInformation")", { "ColumnName": "Processor" }, "", "NA", "", "ProcessorName", "ProcessorNo");
            //稅別碼選單
            ComboBoxs.WithText("#cboTaxCode@(itemName)", "@Url.Action("GetErpData", "BasicInformation")", { "ColumnName": "TaxNo" }, "", "NA", "", "TaxName", "TaxNo");
            //課稅別選單
            ComboBoxs.Default("#cboTaxType@(itemName)", "@Url.Action("GetType", "BasicInformation")", { "TypeSchema": "Customer.Taxation" }, "", "NA", "", "TypeName", "TypeNo");
            //幣別選單
            ComboBoxs.WithText("#cboCurrencyCode@(itemName)", "@Url.Action("GetErpData", "BasicInformation")", { "ColumnName": "Currency" }, "", "NA", "", "CurrencyName", "Currency");
            //付款條件選單
            ComboBoxs.Default("#cboPaymentTerm@(itemName)", "@Url.Action("GetErpData", "BasicInformation")", { "ColumnName": "PaymentTerm" }, "", "NA", "", "PaymentTermName", "PaymentTermNo");

            if (WoId > 0) {
                let targetUrl = "@Url.Action("GetWipOrder", "Production")";
                let postData = {
                    "WoId": WoId
                };
                let data = DataAccess.Get(targetUrl, postData, false);

                if (data.status == "success") {
                    $.each(data.result, function (i, item) {
                        $("#txtDocDate@(itemName)").val(item.DocDate);
                        $("#txtBomDate@(itemName)").val(item.BomDate);
                        $("#cboWoErpPrefix@(itemName)").val(item.WoErpPrefix);
                        $("#txtWoErpNo@(itemName)").val(item.WoErpNo);
                        $("#txtMtlItemId@(itemName)").val(item.MtlItemId);
                        if (item.MtlItemId > 0) {
                            $("#txtMtlItemId@(itemName)").siblings(".help-block").show();
                            $("#desMtlItemNo@(itemName)").html(item.MtlItemNo);
                            $("#desMtlItemName@(itemName)").html(item.MtlItemName);
                            $("#desMtlItemSpec@(itemName)").html(item.MtlItemSpec);
                            ComboBoxs.Default("#cboSoDetailId@(itemName)", "@Url.Action("GetSaleOrderSimple", "SaleOrder")", { "MtlItemId": parseInt(item.MtlItemId) }, "", "NA", "", "SoErpFullNo", "SoDetailId"); //訂單單位
                        }
                        if (item.SoDetailId > 0) {
                            $("#cboSoDetailId@(itemName)").val(item.SoDetailId);
                        }
                        $("#cboUomId@(itemName)").val(item.UomId);
                        $("#cboInventoryId@(itemName)").val(item.InventoryId);
                        $("#txtPlanQty@(itemName)").val(item.PlanQty);
                        $("#txtExpectedStart@(itemName)").val(item.ExpectedStart);
                        $("#txtExpectedEnd@(itemName)").val(item.ExpectedEnd);
                        $("#txtWoRemark@(itemName)").val(item.WoRemark);
                        $("#cboConfirmUserId@(itemName)").val(item.ConfirmUserId);
                        $("#txtConfirmDate@(itemName)").val(item.ConfirmDate);
                        $("#cboProject@(itemName)").val(item.Project);
                        $("#txtVersion@(itemName)").val(item.Version);
                        $("#txtBomVersion@(itemName)").val(item.BomVersion);
                        $("#cboProductionLine@(itemName)").val(item.ProductionLine);
                        if (item.LossRateStatus == "Y") {
                            $("#chkLossRateStatus@(itemName)Y").prop("checked", true);
                        }
                        if (item.LossRateStatus == "N") {
                            $("#chkLossRateStatus@(itemName)N").prop("checked", true);
                        }
                        $("#chkLossRateStatus@(itemName)Y").prop("disabled", true);
                        $("#chkLossRateStatus@(itemName)N").prop("disabled", true);
                        $("#cboCurrencyCode@(itemName)").val(item.CurrencyCode)
                        $("#txtExchange@(itemName)").val(item.Exchange)
                        if (item.Property == "1") {
                            $("#chkProperty@(itemName)IN").prop("checked", true);
                            $("#ProductionLine").show()
                            $(".Processor").hide()
                            $("#cboProductionLine@(itemName)").val(item.ProductionLine);
                            $("#cboProcessor@(itemName)").val("");
                            $("#cboTaxCode@(itemName)").val("");
                            $("#cboTaxType@(itemName)").val("");
                            $("#txtTaxRate@(itemName)").val("");
                            $("#txtPricingTerm@(itemName)").val("");
                            $("#cboPaymentTerm@(itemName)").val("");
                        }
                        else if (item.Property == "2") {
                            $("#chkProperty@(itemName)OUT").prop("checked", true);
                            $("#ProductionLine").hide()
                            $(".Processor").show()
                            $("#cboProductionLine@(itemName)").val("");
                            $("#cboProcessor@(itemName)").val(item.Processor);
                            $("#cboTaxCode@(itemName)").val(item.TaxCode);
                            $("#cboTaxType@(itemName)").val(item.TaxType);
                            $("#txtTaxRate@(itemName)").val(item.TaxRate);
                            $("#txtPricingTerm@(itemName)").val(item.PricingTerm);
                            $("#cboPaymentTerm@(itemName)").val(item.PaymentTerm);
                        }
                    });
                       ExpandWoDetail();
                } else {
                    alert(data.msg, "alert", 0);
                }
            }

            if (!isMobile) {
                $("#cboWoErpPrefixQ@(itemName), #cbConfirmStatusQ@(itemName), #cboWoStatusQ@(itemName), #cboWoTransferStatusQ@(itemName) ,#cboSoDetailId@(itemName)").select2({
                    dropdownAutoWidth: true,
                    width: "100%"
                });
            }
        }

        function Edit@(itemName)(WoId) {
            $("#txtMtlItemId@(itemName)").siblings().find(".pop-clear").trigger("click")

            $("#ProductionLine").hide()
            $(".Processor").show()
            $("#WoId").val(WoId ? WoId : 0);
            $("#WoStatus").val(WoStatus ? WoStatus : 1);
            $("#txtDocDate@(itemName)").attr("disabled", false);
            $("#txtBomDate@(itemName)").attr("readonly", true);
            $("#cboWoErpPrefix@(itemName)").attr("disabled", false);
            $("#txtWoErpNo@(itemName)").attr("readonly", true);
            $("#cboInventoryId@(itemName)").attr("disabled", false);
            $("#txtExpectedStart@(itemName)").attr("readonly", false);
            $("#txtExpectedEnd@(itemName)").attr("readonly", false);
            $("#cboConfirmUserId@(itemName)").attr("disabled", true);
            $("#txtConfirmDate@(itemName)").attr("readonly", true);
            $("#txtVersion@(itemName)").attr("readonly", true);
            $("#txtBomVersion@(itemName)").attr("readonly", true);
            $("#txtPlanQty@(itemName)").attr("readonly", false);
            $("#cboUomId@(itemName)").attr("disabled", false);
            $("#txtWoRemark@(itemName)").attr("readonly", false);
            $("#cboProject@(itemName)").attr("readonly", false);
            $("#chkLossRateStatus@(itemName)Y").prop("disabled", false);
            $("#chkLossRateStatus@(itemName)N").prop("disabled", false);
            $("#cboSoDetailId@(itemName)").attr("disabled", false);
            $("#cboProductionLine@(itemName)").attr("disabled", false);
            $("#cboCurrencyCode@(itemName)").attr("disabled", false);
            $("#txtExchange@(itemName)").attr("disabled", false);
            $("#cboProcessor@(itemName)").attr("disabled", false);
            $("#txtPricingTerm@(itemName)").attr("disabled", false);
            $("#cboPaymentTerm@(itemName)").attr("disabled", false);



            $(".read-wipOder").show()

            Switch("#editData@(itemName), .unit-block", "#listData@(itemName)");

            //訂單品號彈跳視窗開啟相關
            @*let popConfig2 = {
                targetSelector: "#txtSoDetailId@(itemName)",
                popFunction: "PopViewSoDetail",
                objectSoDetailId: "#txtSoDetailId@(itemName)",
                objectCustomer: "#desCustomer@(itemName)",
                objectSoErpFullNo: "#desSoErpFullNo@(itemName)",
                objectSoSequence: "#desSoSequence@(itemName)",
                objectMtlItemNo: "#desSoDetailMtlItemNo@(itemName)",
                objectMtlItemName: "#desSoDetailMtlItemName@(itemName)",
                type: "radio",

            };
            InitPopView(popConfig2);*@

            //產品品號彈跳視窗開啟相關
            @*let popConfig1 = {
                targetSelector: "#txtMtlItemId@(itemName)",
                popFunction: "PopViewMtlItem",
                objectMtlItemId: "#txtMtlItemId@(itemName)",
                objectMtlItemNo: "#desMtlItemNo@(itemName)",
                objectMtlItemName: "#desMtlItemName@(itemName)",
                objectMtlItemSpec: "#desMtlItemSpec@(itemName)",
                objectUomNo: "#desUomNo@(itemName)",
                objectUomId: "#cboUomId@(itemName)",
                objectInventoryId: "#cboInventoryId@(itemName)",
                objectItemAttribute: "F,M,O,S,Y",
            };
            InitPopView(popConfig1);*@

            //下拉選單
            ComboBoxs.WithText("#cboWoErpPrefix@(itemName)", "@Url.Action("GetErpData", "BasicInformation")", { "UserNo": userNo@(itemName),"ColumnName": "WipErpPrefix" }, "", "NA", "", "WoErpPrefixName", "WoErpPrefix"); //製令單別
            ComboBoxs.Default("#cboInventoryId@(itemName)", "@Url.Action("GetInventory", "ScmBasicInformation")", {}, "", "NA", "", "InventoryWithNo", "InventoryId"); //入庫庫別
            ComboBoxs.Default("#cboConfirmUserId@(itemName)", "@Url.Action("GetUser", "BasicInformation")", {"CompanyId": companyId@(itemName)}, "", "NA", "", "UserWithNo", "UserId"); //確認者
            ComboBoxs.Default("#cboUomId@(itemName)", "@Url.Action("GetUnitOfMeasure", "PdmBasicInformation")", { "Status": "A"}, "", "NA", "", "UomNo", "UomId"); //加工單位
            ComboBoxs.WithText("#cboCurrencyCode@(itemName)", "@Url.Action("GetErpData", "BasicInformation")", { "ColumnName": "Currency" }, "", "NA", "", "CurrencyName", "Currency");
            //專案代號選單
            ComboBoxs.Default("#cboProject@(itemName)", "@Url.Action("GetErpData", "BasicInformation")", { "ColumnName": "Project" }, "", "NA", "", "ProjectName", "Project");
            //線別選單
            ComboBoxs.WithText("#cboProductionLine@(itemName)", "@Url.Action("GetErpData", "BasicInformation")", { "ColumnName": "ProduceLineNo" }, "", "NA", "", "ProduceLineName", "ProduceLineNo");
            //加工廠商選單
            ComboBoxs.WithText("#cboProcessor@(itemName)", "@Url.Action("GetErpData", "BasicInformation")", { "ColumnName": "Processor" }, "", "NA", "", "ProcessorName", "ProcessorNo");
            //稅別碼選單
            ComboBoxs.WithText("#cboTaxCode@(itemName)", "@Url.Action("GetErpData", "BasicInformation")", { "ColumnName": "TaxNo" }, "", "NA", "", "TaxName", "TaxNo");
            //課稅別選單
            ComboBoxs.Default("#cboTaxType@(itemName)", "@Url.Action("GetType", "BasicInformation")", { "TypeSchema": "Customer.Taxation" }, "", "NA", "", "TypeName", "TypeNo");
            //幣別選單
            ComboBoxs.WithText("#cboCurrencyCode@(itemName)", "@Url.Action("GetErpData", "BasicInformation")", { "ColumnName": "Currency" }, "", "NA", "", "CurrencyName", "Currency");
            //付款條件選單
            ComboBoxs.Default("#cboPaymentTerm@(itemName)", "@Url.Action("GetErpData", "BasicInformation")", { "ColumnName": "PaymentTerm" }, "", "NA", "", "PaymentTermName", "PaymentTermNo");


            //日期欄位 Suites.DateDropper(功能開啟) Suites.SetDateDropper(日期設置)
            //Suites.DateDropper("#txtDocDate@(itemName), #txtExpectedStart@(itemName), #txtExpectedEnd@(itemName)");
            //開單日預設今日
            let currentDate = new Date();
            //Suites.DatePicker("txtDocDate@(itemName), txtExpectedStart@(itemName)", currentDate);
            Suites.DatePicker("txtExpectedStart@(itemName)", currentDate);
            Suites.DatePicker("txtExpectedEnd@(itemName)", "");

            if (WoId > 0) {
                ComboBoxs.Default("@Url.Action("GetUserByAuthority", "BasicInformation")", { "CompanyId": companyId@(itemName), "FunctionCode": "WipOrderManagement", "DetailCode":"add"}, @UserId, "NA", "", "UserWithNo", "UserId"); //生管/採購人員

                $("#cboWoErpPrefix@(itemName)").attr("disabled", true);
                let targetUrl = "@Url.Action("GetWipOrder", "Production")";
                let postData = {
                    "WoId": WoId
                };
                let data = DataAccess.Get(targetUrl, postData, false);

                if (data.status == "success") {
                    $.each(data.result, function (i, item) {
                        //如果有拋轉過就不能更改開單日
                        if (item.TransferStatus == "Y") {
                            $("#txtDocDate@(itemName)").attr("disabled", true);

                            //Suites.DatePicker("txtDocDate@(itemName)").hide();
                            alert("如果有拋轉過就不能更改開單日","warning")
                            $('#txtDocDate@(itemName)').val(item.DocDate);
                            //$("#txtDocDate@(itemName)").hide();
                        }
                        else {
                            if (item.DocDate != null) Suites.DatePicker("txtDocDate@(itemName)", new Date(item.DocDate));
                        }
                        $("#txtBomDate@(itemName)").val(item.BomDate);
                        $("#cboWoErpPrefix@(itemName)").val(item.WoErpPrefix);
                        $("#txtWoErpNo@(itemName)").val(item.WoErpNo);
                        $("#txtMtlItemId@(itemName)").val(item.MtlItemId);
                        if (item.MtlItemId > 0) {
                            $("#txtMtlItemId@(itemName)").siblings(".help-block").show();
                            $("#desMtlItemNo@(itemName)").html(item.MtlItemNo);
                            $("#desMtlItemName@(itemName)").html(item.MtlItemName);
                            $("#desMtlItemSpec@(itemName)").html(item.MtlItemSpec);
                            ComboBoxs.Default("#cboSoDetailId@(itemName)", "@Url.Action("GetSaleOrderSimple", "SaleOrder")", { "MtlItemId": parseInt(item.MtlItemId) }, "", "NA", "", "SoErpFullNo", "SoDetailId"); //訂單單位
                        }

                        if (item.SoDetailId > 0) {
                            $("#cboSoDetailId@(itemName)").val(item.SoDetailId);
                        }
                        $("#cboUomId@(itemName)").val(item.UomId);
                        $("#cboInventoryId@(itemName)").val(item.InventoryId);
                        $("#txtPlanQty@(itemName)").val(item.PlanQty);
                        if (item.ExpectedStart != null) Suites.DatePicker("txtExpectedStart@(itemName)", new Date(item.ExpectedStart));
                        if (item.ExpectedEnd != null) Suites.DatePicker("txtExpectedEnd@(itemName)", new Date(item.ExpectedEnd));
                        $("#txtWoRemark@(itemName)").val(item.WoRemark);
                        $("#cboConfirmUserId@(itemName)").val(item.ConfirmUserId);
                        $("#txtConfirmDate@(itemName)").val(item.ConfirmDate);
                        $("#cboProject@(itemName)").val(item.Project);
                        $("#txtVersion@(itemName)").val(item.Version);
                        $("#txtBomVersion@(itemName)").val(item.BomVersion);
                        $("#cboProductionLine@(itemName)").val(item.ProductionLine);
                        if (item.LossRateStatus == "Y") {
                            $("#chkLossRateStatus@(itemName)Y").prop("checked", true);
                        }
                        if (item.LossRateStatus == "N") {
                            $("#chkLossRateStatus@(itemName)N").prop("checked", true);
                        }
                        $("#cboCurrencyCode@(itemName)").val(item.CurrencyCode)
                        $("#txtExchange@(itemName)").val(item.Exchange)
                        if (item.Property == "1") {
                            $("#chkProperty@(itemName)IN").prop("checked", true);
                            $("#ProductionLine").show()
                            $(".Processor").hide()
                            $("#cboProductionLine@(itemName)").val(item.ProductionLine);
                            $("#cboProcessor@(itemName)").val("");
                            $("#cboTaxCode@(itemName)").val("");
                            $("#cboTaxType@(itemName)").val("");
                            $("#txtTaxRate@(itemName)").val("");
                            $("#txtPaymentTerm@(itemName)").val("");
                            $("#cboPaymentTerm@(itemName)").val("");
                        }
                        else if (item.Property == "2") {
                            $("#chkProperty@(itemName)OUT").prop("checked", true);
                            $("#ProductionLine").hide()
                            $(".Processor").show()
                            $("#cboProductionLine@(itemName)").val("");
                            $("#cboProcessor@(itemName)").val(item.Processor);
                            $("#cboTaxCode@(itemName)").val(item.TaxCode);
                            $("#cboTaxType@(itemName)").val(item.TaxType);
                            $("#txtTaxRate@(itemName)").val(item.TaxRate);
                            $("#txtPricingTerm@(itemName)").val(item.PricingTerm);
                            $("#cboPaymentTerm@(itemName)").val(item.PaymentTerm);
                        }
                        //$("#chkLossRateStatus@(itemName)Y").prop("disabled", true);
                        //$("#chkLossRateStatus@(itemName)N").prop("disabled", true);
                    });
                    ExpandWoDetail();
                } else {
                    alert(data.msg, "alert", 0);
                }
            }
            else {
                Suites.DatePicker("txtDocDate@(itemName)", currentDate);
            }

            //下拉選單樣式
            if (!isMobile) {
                $(`#cboWoErpPrefix@(itemName), #cboInventoryId@(itemName), #cboConfirmUserId@(itemName), #cboUomId@(itemName)
                    , #cboProductionLine@(itemName), #cboPaymentTerm@(itemName), #cboProcessor@(itemName), #cboTaxCode@(itemName)
                    , #cboTaxType@(itemName), #cboPaymentTerm@(itemName), #cboProject@(itemName), #cboCurrencyCode@(itemName)
                    `).select2
                ({
                    dropdownAutoWidth: true,
                    width: "100%"
                });
            }
        }

        //編輯儲存
        function Save@(itemName)() {
            var Property = $("input[name='chkProperty@(itemName)']:checked").val()
            @*if (Property == 2) {
                if ($("#cboProcessor@(itemName)").val().length <= 0) {
                    alert("加工廠商未選!!!")
                    return
                }
            }*@

            if ($(objForm@(itemName)).valid()) {
                let WoId = parseInt($("#WoId").val());
                if (WoId <= 0) {
                    //新增製令
                    let targetUrl = "@Url.Action("AddWipOrder", "Production")";
                    let postData = {
                        "DocDate": $("#txtDocDate@(itemName)").val(),
                        "WoErpPrefix": $("#cboWoErpPrefix@(itemName)").val(),
                        "MtlItemId": $("#txtMtlItemId@(itemName)").val(),
                        "UomId": $("#cboUomId@(itemName)").val(),
                        "SoDetailId": $("#cboSoDetailId@(itemName)").val(),
                        "InventoryId": $("#cboInventoryId@(itemName)").val(),
                        "PlanQty": $("#txtPlanQty@(itemName)").val(),
                        "ExpectedStart": $("#txtExpectedStart@(itemName)").val(),
                        "ExpectedEnd": $("#txtExpectedEnd@(itemName)").val(),
                        "WoRemark": $("#txtWoRemark@(itemName)").val(),
                        "Project": $("#cboProject@(itemName)").val(),
                        "ViewCompanyId": companyId@(itemName),
                        "LossRateStatus": $("input[name='chkLossRateStatus@(itemName)']:checked").val(),
                        "Property": $("input[name='chkProperty@(itemName)']:checked").val(),
                        "ProductionLine": $("#cboProductionLine@(itemName)").val(),
                        "Processor": $("#cboProcessor@(itemName)").val(),
                        "CurrencyCode": $("#cboCurrencyCode@(itemName)").val(),
                        "Exchange": $("#txtExchange@(itemName)").val(),
                        "TaxCode": $("#cboTaxCode@(itemName)").val(),
                        "TaxType": $("#cboTaxType@(itemName)").val(),
                        "TaxRate": $("#txtTaxRate@(itemName)").val(),
                        "PricingTerm": $("#txtPricingTerm@(itemName)").val(),
                        "PaymentTerm": $("#cboPaymentTerm@(itemName)").val()
                    };

                    let data = DataAccess.EditContinued(targetUrl, postData, false);
                    if (data) {
                        $.each(data.result, function (i, item) {
                            $("#WoId").val(item.WoId);
                            $("#txtWoErpNo@(itemName)").val(item.WoErpNo);
                            var date = new Date(item.BomDate);
                            var year = date.getFullYear();
                            var month = String(date.getMonth() + 1).padStart(2, '0');
                            var day = String(date.getDate()).padStart(2, '0');
                            $("#txtBomDate@(itemName)").val(year + '-' + month + '-' + day);
                            $("#txtBomVersion@(itemName)").val(item.BomVersion);
                            $("#txtVersion@(itemName)").val(item.Version);
                        });
                        //ApplyBomWoDetail()
                        ExpandWoDetail();
                    }
                }
                else {
                    //修改製令
                    let targetUrl = "@Url.Action("UpdateWipOrder", "Production")";
                    let postData = {
                        "WoId": WoId,
                        "DocDate": $("#txtDocDate@(itemName)").val(),
                        "MtlItemId": $("#txtMtlItemId@(itemName)").val(),
                        "SoDetailId": $("#cboSoDetailId@(itemName)").val(),
                        "UomId": $("#cboUomId@(itemName)").val(),
                        "InventoryId": $("#cboInventoryId@(itemName)").val(),
                        "PlanQty": $("#txtPlanQty@(itemName)").val(),
                        "ExpectedStart": $("#txtExpectedStart@(itemName)").val(),
                        "ExpectedEnd": $("#txtExpectedEnd@(itemName)").val(),
                        "WoRemark": $("#txtWoRemark@(itemName)").val(),
                        "Project": $("#cboProject@(itemName)").val(),
                        "ViewCompanyId": companyId@(itemName),
                        "Property": $("input[name='chkProperty@(itemName)']:checked").val(),
                        "ProductionLine": $("#cboProductionLine@(itemName)").val(),
                        "CurrencyCode": $("#cboCurrencyCode@(itemName)").val(),
                        "Exchange": $("#txtExchange@(itemName)").val(),
                        "Processor": $("#cboProcessor@(itemName)").val(),
                        "TaxCode": $("#cboTaxCode@(itemName)").val(),
                        "TaxType": $("#cboTaxType@(itemName)").val(),
                        "TaxRate": $("#txtTaxRate@(itemName)").val(),
                        "PricingTerm": $("#txtPricingTerm@(itemName)").val(),
                        "PaymentTerm": $("#cboPaymentTerm@(itemName)").val()
                    };

                    let result = DataAccess.Update(targetUrl, postData, false, true);

                    if (result) {
                        //ApplyBomWoDetail()
                        ExpandWoDetail();
                    }
                }
            }
        }

        //變更單儲存
        @*function ModifySave@(itemName)() {
            if ($(objForm@(itemName)).valid()) {
                let WoId = parseInt($("#WoId").val());
                let targetUrl = "@Url.Action("UpdateErpModify", "Production")";
                let postData = {
                    "WoId": WoId,
                    "ModifyDate": $("#txtModifyDate@(itemName)").val(),
                    "SoDetailId": $("#txtSoDetailId@(itemName)").val(),
                    "UomId": $("#cboUomId@(itemName)").val(),
                    "InventoryId": $("#cboInventoryId@(itemName)").val(),
                    "PlanQty": $("#txtPlanQty@(itemName)").val(),
                    "ExpectedStart": $("#txtExpectedStart@(itemName)").val(),
                    "ExpectedEnd": $("#txtExpectedEnd@(itemName)").val(),
                    "UserId": $("#cboUserId@(itemName)").val(),
                    "ModiReason": $("#txtWoRemark@(itemName)").val(),
                    "WoRemark": $("#txtWoRemark@(itemName)").val(),
                    "Project": $("#txtProject@(itemName)").val(),
                };

                let result = DataAccess.Update(targetUrl, postData, false, true);

                if (result) {
                    ExpandWoDetail();
                }
            }
        }*@

        function Confirm@(itemName)(WoId) {
            var inConfrim = "N";
            if (WoId == "-1") {
                WoId = $("#WoId").val()
                inConfrim = "Y"
            }
            swal.fire({
                titleText: "工單是否要確認嗎?",
                text: "此動作會拋轉ERP，請確認是否要執行!",
                icon: "warning",
                allowOutsideClick: false,
                allowEscapeKey: false,
                showCancelButton: true,
                confirmButtonColor: '#d33',
                reverseButtons: true
            }).then((result) => {
                if (result.isConfirmed) {
                    let targetUrl = "@Url.Action("UpdateWipOrderToERP", "Production")";
                    let postData = {
                        "WoId": WoId
                    };

                    let result = DataAccess.Other(targetUrl, postData, false, true);

                    if (result) {
                        Query@(itemName)();

                        if (inConfrim == "Y") {
                            Return@(itemName)()
                        }
                    }
                }
            });
        }

        function ReConfirm@(itemName)(WoId) {
            swal.fire({
                titleText: "工單是否要反確認嗎?",
                text: "此動作會取消確認，請確認是否要執行!",
                icon: "warning",
                allowOutsideClick: false,
                allowEscapeKey: false,
                showCancelButton: true,
                confirmButtonColor: '#d33',
                reverseButtons: true
            }).then((result) => {
                if (result.isConfirmed) {
                    let targetUrl = "@Url.Action("UpdateWipOrderReconfirm", "Production")";
                    let postData = {
                        "WoId": WoId
                    };

                    let result = DataAccess.Other(targetUrl, postData, false, true);

                    if (result) {
                        Query@(itemName)();
                    }
                }
            });
        }

        function Delete@(itemName)(WoId) {
            swal.fire({
                title: "確認要刪除嗎?",
                text: "此動作無法復原，請確認是否要執行!",
                icon: "warning",
                allowOutsideClick: false,
                allowEscapeKey: false,
                showCancelButton: true,
                confirmButtonColor: '#d33',
                reverseButtons: true
            }).then((result) => {
                if (result.isConfirmed) {
                    let targetUrl = "@Url.Action("DeleteWipOrder", "Production")";
                    let postData = {
                        "WoId": WoId,
                    };

                    let result = DataAccess.Delete(targetUrl, postData, false, true);

                    if (result) {
                        Query@(itemName)();
                    }
                }
            });
        }

        function BandeInput(e) {
            e.preventDefault();
        }
        function BandCtrlV(e) {
            if ((e.ctrlKey || e.metaKey) && e.keyCode == 86) {
                e.preventDefault();
            }
        }

        function Void@(itemName)(WoId) {
            swal.fire({
                titleText: "確認要作廢該單據嗎?",
                text: "此動作無法復原，請確認是否要執行!",
                icon: "warning",
                allowOutsideClick: false,
                allowEscapeKey: false,
                showCancelButton: true,
                confirmButtonColor: '#d33',
                reverseButtons: true
            }).then((result) => {
                if (result.isConfirmed) {
                    let targetUrl = "@Url.Action("UpdateVoidWipOrder", "Production")";
                    let postData = {
                        "WoId": WoId,
                    };

                    let result = DataAccess.Delete(targetUrl, postData, false, true);

                    if (result) {
                        Query@(itemName)();
                    }
                }
            });
        }

        function Change@(itemName)(WoId) {
            alert("變更功能尚未開發~~敬請等候~~~~")
            return
        }

        function Print@(itemName)(WoId) {
            alert("列印功能尚未開發~~敬請等候~~~~")
            return

        }

        function ChangeLog@(itemName)(WoId) {
            alert("變更記錄功能尚未開發~~敬請等候~~~~")
            return
        }

        function DetailData@(itemName)(source){
            let html = '';

            if (source) {
                let json = JSON.parse(source);

                for (let x = 0; x < json.data.length; x++) {
                    html += `<tr>
                                <td class="tbody-customized">${x+1}</td>
                                <td class="tbody-customized">${json.data[x].MtlItemNo}</td>
                                <td class="tbody-customized">${json.data[x].MtlItemName}</td>
                                <td class="tbody-customized">${json.data[x].DemandRequisitionQty}</td>
                                <td class="tbody-customized">${json.data[x].RequisitionQty}</td>
                                <td class="tbody-customized">${json.data[x].InventoryNo + json.data[x].InventoryName}</td>
                                <td class="tbody-customized">${StatusName(`Boolean`, json.data[x].SubstituteStatus)}</td>
                             </tr>`;
                }
            }

            return html;
        }

        function Detail@(itemName)(WoId) {
            if ($(`tr[data-wo-id=${WoId}]`).css("display") == "none") {
                $("tr[data-wo-id]").hide();
                $(`tr[data-wo-id=${WoId}]`).show();
                $(`tr[data-wo-id=${WoId}] tbody`).html(GetWoDetailListData@(itemName)(WoId))
            } else {
                $("tr[data-wo-id]").hide();
            }
        }

        //主頁列表單身彈跳

        function GetWoDetailListData@(itemName)(WoId) {
            let html = '';

            let targetUrl = "@Url.Action("GetWoDetail", "Production")";
            let postData = {
                "WoId": WoId
            };
            let data = DataAccess.Get(targetUrl, postData, false);
            if (data.status == "success") {
                $.each(data.result, function (i, item) {
                    html += `<tr>
                                <td class="tbody-customized">${1+i}</td>
                                <td class="tbody-customized">${item.MtlItemNo}</td>
                                <td class="tbody-customized">${item.MtlItemName}</td>
                                <td class="tbody-customized">${item.DemandRequisitionQty}</td>
                                <td class="tbody-customized">${item.RequisitionQty}</td>
                                <td class="tbody-customized">${item.InventoryNo + item.InventoryName}</td>
                                <td class="tbody-customized">${StatusName(`Boolean`, item.SubstituteStatus)}</td>
                             </tr>`;
                });
                return html

            } else {
                alert(data.msg, "alert", 0);
            }
        }

        //檢查品號是否生效或失效
        function checkMtlItemId@(itemName)(objPage) {
            let targetUrl = "@Url.Action("GetCheckMtlItemDate", "Production")";
            let postData = {
                "MtlItemId": $("#txtMtlItemId@(itemName)").val(),
                "DocDate": $("#txtDocDate@(itemName)").val()
            };
            let data = DataAccess.Get(targetUrl, postData, false);

            if (data.status != "success") {
                setTimeout(() => {
                    $("#txtMtlItemId@(itemName)").siblings().find(".pop-clear").trigger("click")
                },500)
                alert(data.msg, "alert", 0);
            }
        }

        function GetUserInfo@(itemName)() {
            let targetUrl = "@Url.Action("GetLoginByKey", "User")";
            let postData = {
                "UserNo": $.cookie("Login"),
                "KeyText": $.cookie("LoginKey")
            };

            let data = DataAccess.Get(targetUrl, postData, false);

            if (data.status == "success") {
                userId@(itemName) = data.returnData.UserId;
                companyId@(itemName) = data.returnData.CompanyId;
                userNo@(itemName) = data.returnData.UserNo;

            } else {
                alert(data.msg, "alert", 0);
            }
        }

        var WoStatusList = [];
        var ConfirmStatusList = [];
        var BooleanList = [];
        function InputStatusContent(Type, Status, Value) {
            switch (Type) {
                case "S":
                    switch (Status) {
                        case "WoStatus":
                            if (WoStatusList.length <= 0) {
                                let targetUrl = "@Url.Action("GetInputStatusContent", "Production")";
                                let postData = {
                                    "Type": Type,
                                    "StatusSchema": "WipOrder.WoStatus"
                                };
                                let data = DataAccess.Get(targetUrl, postData, false);
                                if (data.status == "success") {
                                    $.each(data.result, function (i, item) {
                                        WoStatusList.push(item.StatusNo+","+item.StatusName)
                                    });
                                } else {
                                    alert(data.msg, "alert", 0);
                                    return
                                }
                            }
                            var StatusName = "";
                            WoStatusList.forEach(function (v) {
                                if (v.split(',')[0] == Value) {
                                    StatusName = v.split(',')[1]
                                }
                            })
                            return StatusName
                            break
                        case "ConfirmStatus":
                            if (ConfirmStatusList.length <= 0) {
                                let targetUrl = "@Url.Action("GetInputStatusContent", "Production")";
                                let postData = {
                                    "Type": Type,
                                    "StatusSchema": "ConfirmStatus"
                                };
                                let data = DataAccess.Get(targetUrl, postData, false);
                                if (data.status == "success") {
                                    $.each(data.result, function (i, item) {
                                        ConfirmStatusList.push(item.StatusNo+","+item.StatusName)
                                    });
                                } else {
                                    alert(data.msg, "alert", 0);
                                    return
                                }
                            }
                            var StatusName = "";
                            ConfirmStatusList.forEach(function (v) {
                                if (v.split(',')[0] == Value) {
                                    StatusName = v.split(',')[1]
                                }
                            })
                            return StatusName
                            break
                        case "TransferStatus":
                            if (ConfirmStatusList.length <= 0) {
                                let targetUrl = "@Url.Action("GetInputStatusContent", "Production")";
                                let postData = {
                                    "Type": Type,
                                    "StatusSchema": "ConfirmStatus"
                                };
                                let data = DataAccess.Get(targetUrl, postData, false);
                                if (data.status == "success") {
                                    $.each(data.result, function (i, item) {
                                        ConfirmStatusList.push(item.StatusNo+","+item.StatusName)
                                    });
                                } else {
                                    alert(data.msg, "alert", 0);
                                    return
                                }
                            }
                            var StatusName = "";
                            ConfirmStatusList.forEach(function (v) {
                                if (v.split(',')[0] == Value) {
                                    StatusName = v.split(',')[1]
                                }
                            })
                            return StatusName
                            break
                    }
                    break
                case "T":
                    break
            }

        }

        function SynchronizeERP@(itemName)() {
            //alert("品號同步功能還沒開放!!請慢心等待")
            //return
            let today = new Date();

            var year = today.getFullYear();

            var month = today.getMonth() + 1;

            var day = today.getDate();

            var Today = year.toString() + month.toString() + day.toString().padStart(2, '0')

            let targetUrl = "@Url.Action("UpdateWipOrderSynchronize", "Production")";
            let postData = {
                "Company": "JMO",
                "SecretKey": "DD7DCF69964529AD7EFE877F8EDB3816BB504CE1970BD4394190EE9A791C25DB",
                "UpdateDate": Today
            };
            let data = DataAccess.Get(targetUrl, postData, false);
            if (data.status == "success") {
                alert("同步成功", "success", 0);
            } else {
                alert(data.msg, "alert", 0);
            }
        }

        let TempWoId@(itemName);
        function PopModalRemark@(itemName)(WoId, ActualEnd) {
            currentDate = new Date();
            Suites.DatePicker("txtFinishDate@(itemName)", currentDate);
            $("#txtRemark@(itemName)").val("");

            TempWoId@(itemName) = WoId;
            if (ActualEnd != "null") {
                $("#txtFinishDate@(itemName)").val(ActualEnd);
            }
            $("#modalRemark@(itemName)").modal("show");
            $(".batch").hide()
            $(".once").show()
        }

        function CloseWipOrder@(itemName)(WoId) {
            swal.fire({
                titleText: "確認要指定結案該單據嗎?",
                text: "此動作無法復原，請確認是否要執行!",
                icon: "warning",
                allowOutsideClick: false,
                allowEscapeKey: false,
                showCancelButton: true,
                confirmButtonColor: '#d33',
                reverseButtons: true
            }).then((result) => {
                if (result.isConfirmed) {
                    let remark = $("#txtRemark@(itemName)").val();
                    if (remark == "") {
                        alert("備註不可為空!!");
                        return;
                    }

                    let targetUrl = "@Url.Action("UpdateCloseManufactureOrder", "Production")";
                    let postData = {
                        "WoId": TempWoId@(itemName),
                        "FinishDate": $("#txtFinishDate@(itemName)").val(),
                        "Remark": remark
                    };

                    let result = DataAccess.Update(targetUrl, postData, false, true);

                    if (result) {
                        Query@(itemName)();
                    }
                }
            });
        }
        /*呼叫樹狀結構頁面 */
        function TreeWindows(woId, woFullNo) {
            WoIdTreeStru = woId;
            MoFullNoTreeStru = woFullNo;

            page.TreeStru += `?WoId=${woId}&MoFullNo=${woFullNo}`;
            let params = `scrollbars=no,resizable=no,status=no,location=no,toolbar=no,menubar=no,width=1100,height=720,left=100,top=100`;
            window.open(page.TreeStru, "tree", params);
            page.TreeStru = "@Url.Action("TreeStru", "Production")";
        }

        function GetProperty(WoErpPrefix) {
            let targetUrl = "@Url.Action("GetProperty", "Production")";
            let postData = {
                "WoErpPrefix": WoErpPrefix
            };
            let data = DataAccess.Get(targetUrl, postData, false);
            if (data.status == "success") {
                $.each(data.result, function (i, item) {
                    if (item.MQ017 == "1") {
                        $("#chkProperty@(itemName)IN").prop("checked", true);
                        $("#chkProperty@(itemName)OUT").prop("checked", false);
                        $("#ProductionLine").show()
                        $(".Processor").hide()

                    }
                    else if (item.MQ017 == "2") {
                        $("#chkProperty@(itemName)IN").prop("checked", false);
                        $("#chkProperty@(itemName)OUT").prop("checked", true);
                        $("#ProductionLine").hide()
                        $(".Processor").show()
                    }
                })
            } else {
                alert(data.msg, "alert", 0);
            }
        }

        function GetProperty(WoErpPrefix) {
            let targetUrl = "@Url.Action("GetProperty", "Production")";
            let postData = {
                "WoErpPrefix": WoErpPrefix
            };
            let data = DataAccess.Get(targetUrl, postData, false);

            if (data.status == "success") {
                $.each(data.result, function (i, item) {

                    if (item.MQ017 == "1") {
                        $("#chkProperty@(itemName)IN").prop("checked", true);
                        $("#chkProperty@(itemName)OUT").prop("checked", false);
                        $("#ProductionLine").show()
                        $(".Processor").hide()

                    }
                    else if (item.MQ017 == "2") {
                        $("#chkProperty@(itemName)IN").prop("checked", false);
                        $("#chkProperty@(itemName)OUT").prop("checked", true);
                        $("#ProductionLine").hide()
                        $(".Processor").show()
                    }
                })
            } else {
                alert(data.msg, "alert", 0);
            }
        }



        function GetProcessor(Processor) {
            let targetUrl = "@Url.Action("GetProcessor", "Production")";
            let postData = {
                "Processor": Processor
            };
            let data = DataAccess.Get(targetUrl, postData, false);
            var Exchange = "";
            //稅別碼選單
            ComboBoxs.WithText("#cboTaxCode@(itemName)", "@Url.Action("GetErpData", "BasicInformation")", { "ColumnName": "TaxNo" }, "", "NA", "", "TaxName", "TaxNo");
            //課稅別選單
            ComboBoxs.Default("#cboTaxType@(itemName)", "@Url.Action("GetType", "BasicInformation")", { "TypeSchema": "Customer.Taxation" }, "", "NA", "", "TypeName", "TypeNo");
            //幣別選單
            ComboBoxs.WithText("#cboCurrencyCode@(itemName)", "@Url.Action("GetErpData", "BasicInformation")", { "ColumnName": "Currency" }, "", "NA", "", "CurrencyName", "Currency");
            //付款條件選單
            ComboBoxs.Default("#cboPaymentTerm@(itemName)", "@Url.Action("GetErpData", "BasicInformation")", { "ColumnName": "PaymentTerm" }, "", "NA", "", "PaymentTermName", "PaymentTermNo");

            if (data.status == "success") {
                $.each(data.result, function (i, item) {

                    $("#cboCurrencyCode@(itemName)").val(item.CurrencyCode);
                    $("#txtExchange@(itemName)").val(item.Exchange);
                    $("#cboTaxCode@(itemName)").val(item.TaxCode);
                    $("#cboTaxType@(itemName)").val(item.TaxType);
                    $("#txtTaxRate@(itemName)").val(item.TaxRate);
                    $("#txtPricingTerm@(itemName)").val(item.PricingTerm);
                    $("#cboPaymentTerm@(itemName)").val(item.PaymentTerm);
                })
            } else {
                alert(data.msg, "alert", 0);
                if (companyId@(itemName) == 4) {
                    $("#cboCurrencyCode@(itemName)").val("CNY");
                }
                else if(companyId@(itemName) == 3) {
                    $("#cboCurrencyCode@(itemName)").val("NTD");
                }
                else if(companyId@(itemName) == 5) {
                    $("#cboCurrencyCode@(itemName)").val("CNY");
                }
                else {
                    $("#cboCurrencyCode@(itemName)").val("NT$");
                }
                $("#txtExchange@(itemName)").val(1);
                $("#cboTaxCode@(itemName)").val("");
                $("#cboTaxType@(itemName)").val("");
                $("#txtTaxRate@(itemName)").val("");
                $("#txtPricingTerm@(itemName)").val("");
                $("#cboPaymentTerm@(itemName)").val("");
            }
        }

        function GetCurrencyCode(CurrencyCode) {
            let targetUrl = "@Url.Action("GetCurrencyCode", "Production")";
            let postData = {
                "CurrencyCode": CurrencyCode
            };
            let data = DataAccess.Get(targetUrl, postData, false);
            var Exchange = "";
            if (data.status == "success") {
                $.each(data.result, function (i, item) {
                    $("#txtExchange@(itemName)").val(item.Exchange);
                })
            } else {
                alert(data.msg, "alert", 0);
                $("#txtExchange@(itemName)").val(1);
            }
        }

        function PopMtlItemView() {
            
            var WoErpPrefix = $("#cboWoErpPrefix@(itemName)").val()
            if (WoErpPrefix == "") {
                alert("請先選擇單別")
                return
            }
            let popConfig = {
                    targetSelector: "#txtMtlItemId@(itemName)",
                    popFunction: "PopViewMtlItem",
                    objectMtlItemId: "#txtMtlItemId@(itemName)",
                    objectMtlItemNo: "#desMtlItemNo@(itemName)",
                    objectMtlItemName: "#desMtlItemName@(itemName)",
                    objectMtlItemSpec: "#desMtlItemSpec@(itemName)",
                    objectUomNo: "#desUomNo@(itemName)",
                    objectUomId: "#cboUomId@(itemName)",
                    objectInventoryId: "#cboInventoryId@(itemName)",
                    objectItemAttribute: "F,M,O,S,Y",
                };
            $("#modalViewMtlItem").modal("show");
            if (WoErpPrefix.substring(0, 2) == "52") {
                popConfig.objectItemAttribute = "F,M,O,S,P,Y"
            }
            
            PopViewMtlItem(popConfig)
            
        }

        function Batch@(itemName)() {
            BatchAction = true
            WoStatus = "1,2,3"
            $("#cbxDocDateQ@(itemName)").prop('checked', false);
            Query@(itemName)(BatchAction)
            $(".batchShow").hide()
            $(".CancelBatchShow").show()
            $(".Close").show()
        }
        function CancelBatch@(itemName)() {
            WoStatus = ""
            BatchAction = false
            
            $("#cbxDocDateQ@(itemName)").prop('checked', true);

            Query@(itemName)()
            $(".batchShow").show()
            $(".CancelBatchShow").hide()
            $(".Close").hide()
        }

        function PopCloseView@(itemName)() {
            currentDate = new Date();
            Suites.DatePicker("txtFinishDate@(itemName)", currentDate);
            $("#txtRemark@(itemName)").val("");

            $("#modalRemark@(itemName)").modal("show");
            $(".batch").show()
            $(".once").hide()
        }

        function Action@(itemName)(Type) {
            let WoIdList = []
            $.each($("input[name='cbxWoId@(itemName)']"), function () {
                if ($(this).is(":checked")) {
                    //只需要改動要傳入的物件相關值即可套用
                    Key = $(this).data("key");
                    if (Key) {
                        WoIdList.push(Key)
                    }
                }
            })
            if (WoIdList.length <= 0) {
                alert("至少需勾選一筆資料才能執行儲存", "alert", 0);
                return
            }

            let titleText = ""
            let text = ""
            let targetUrl = "";
            let postData = {
                "WoIdList": WoIdList.join(",")
            };
            switch (Type) {
                case "Delete":
                    titleText = "是否執行單據批量刪除"
                    text = "該動作無法復原,請確認是否要執行!"
                    targetUrl = "@Url.Action("DeleteOspBatch", "Production")";
                    break;
                case "Confirm":
                    titleText = "是否執行單據批量確認"
                    text = "請確認是否要執行!"
                    targetUrl = "@Url.Action("UpdateOspConfirmBatch", "Production")";
                    break;
                case "ReConfirm":
                    titleText = "是否執行單據批量反確認"
                    text = "請確認是否要執行!"
                    targetUrl = "@Url.Action("UpdateOspReConfirmBatch", "Production")";
                    break;
                case "Close":
                    let remark = $("#txtRemark@(itemName)").val();
                    if (remark == "") {
                        alert("備註不可為空!!");
                        return;
                    }
                    titleText = "是否執行單據批量指定結案"
                    text = "請確認是否要執行!"
                    targetUrl = "@Url.Action("UpdateCloseManufactureOrderBatch", "Production")";
                    postData = {
                        "WoIdList": WoIdList.join(","),
                        "FinishDate": $("#txtFinishDate@(itemName)").val(),
                        "Remark": remark
                    };
                    break;
            }

            swal.fire({
                titleText: `${titleText}`,
                text: `${text}`,
                icon: "warning",
                allowOutsideClick: false,
                allowEscapeKey: false,
                showCancelButton: true,
                confirmButtonColor: '#d33',
                reverseButtons: true
            }).then((result) => {
                if (result.isConfirmed) {
                    let result = DataAccess.Update(targetUrl, postData, false, true);
                    if (result) {
                        CancelBatch@(itemName)()
                        $("#modalRemark@(itemName)").modal("hide");

                    }
                }
            });
        }

        function Return@(itemName)() {
            ResetForm(objForm@(itemName));
            Switch("#listData@(itemName)", "#editData@(itemName), .unit-block, .advanced-block");
            $('#txtDocDate@(itemName)').dateDropper('destroy');
            $('#txtExpectedEnd@(itemName)').dateDropper('destroy');
            $('#txtExpectedStart@(itemName)').dateDropper('destroy');
            $('#txtExpectedRequisitionDateWoDetail').dateDropper('destroy');

            $("#txtMtlItemId@(itemName)").siblings().find(".pop-clear").trigger("click")
            $("#txtMtlItemIdWipOrderManagement").siblings(".help-block").hide()

            $("#TransferStatus").val("")
            BatchAction = false
            WoStatus = ""

            Query@(itemName)();

            $(".batchShow").show()
            $(".CancelBatchShow").hide()
            $(".Close").hide()
        }

</script>
        )