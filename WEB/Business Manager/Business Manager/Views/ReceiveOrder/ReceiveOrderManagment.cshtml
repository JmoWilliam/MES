@using Business_Manager.Helpers
@{
    string itemName = "ReceiveOrderManagment";
    string itemNameText = "銷貨單管理";
    string authority = ViewBag.authority;
    ViewBag.Title = itemNameText;
}

<script src="@Url.Content("~/Scripts/dhtmlx/spreadsheet.commercial/4.3.0/spreadsheet.min.js")"></script>
<link href="@Url.Content("~/Content/dhtmlx/spreadsheet.commercial/4.3.0/spreadsheet.min.css")" rel="stylesheet" />


@Html.Resource("css",
    @<style>
         .trLock {
             color: #f00;
             display: none;
         }

             .trLock input {
             }

         .menyBar::-webkit-scrollbar {
             width: 12px; /* 滚动条宽度 */
         }

         /* 滚动条轨道 */
         .menyBar::-webkit-scrollbar-track {
             background: #f1f1f1; /* 轨道背景颜色 */
         }

         /* 滚动条滑块 */
         .menyBar::-webkit-scrollbar-thumb {
             background: #ff0000; /* 滑块颜色 */
         }

             /* 鼠标悬停时的滑块样式 */
             .menyBar::-webkit-scrollbar-thumb:hover {
                 background: #ff5555; /* 鼠标悬停时的滑块颜色 */
             }

         .menyBar {
             overflow: auto;
         }

         .form-group .select2-selection__rendered {
             line-height: 29px !important;
         }

         .form-group .select2-container .select2-selection--single {
             height: 39px !important;
         }

         .form-group .select2-selection__arrow {
             height: 34px !important;
         }

         .table-deposit {
             margin: 0;
             padding: 0;
             max-height: 30vh;
             margin-bottom: .75rem;
             display: none;
         }

             .table-deposit th {
                 background-color: #d7ecfa !important;
             }

             .table-deposit th, .table-deposit td {
                 padding: 5px 0;
                 text-align: center;
             }

         .active-icon {
             background-color: #d7ecfa;
             color: black;
         }



         /*出貨轉銷貨*/
         .table:not(.table-custom-hover) tbody:hover td[rowspan], .table:not(.table-custom-hover) tbody tr:hover td,
         .table:not(.table-custom-hover) tbody:hover th[rowspan], .table:not(.table-custom-hover) tbody tr:hover th {
             color: #000000 !important;
             background-color: #ffcccc !important;
         }

         .table-sticky thead .col-sticky:nth-child(1) {
             position: sticky;
             left: 0;
         }

         .table-sticky tbody .col-sticky:nth-child(1) {
             position: sticky;
             left: 0;
         }

         .table-sticky thead .col-sticky:nth-child(2) {
             position: sticky;
             left: 75px;
         }

         .table-sticky tbody .col-sticky:nth-child(2) {
             position: sticky;
             left: 75px;
         }

         .table-sticky thead .col-sticky:nth-child(3) {
             position: sticky;
             left: 165px;
         }

         .table-sticky tbody .col-sticky:nth-child(3) {
             position: sticky;
             left: 165px;
         }

         .table-sticky thead .col-sticky:nth-child(4) {
             position: sticky;
             left: 330px;
         }

         .table-sticky tbody .col-sticky:nth-child(4) {
             position: sticky;
             left: 330px;
         }

         .table-sticky thead .col-sticky:nth-child(5) {
             position: sticky;
             left: 495px;
         }

         .table-sticky tbody .col-sticky:nth-child(5) {
             position: sticky;
             left: 495px;
         }
    </style>
                                                                                )

<input type="hidden" id="pageAuthority" value="@authority" />
<input type="hidden" id="TransferStatusMES" value="" />

<div class="row">
    <div class="col-12 title-block">
        <h1 class="pt-2 pb-3">@(itemNameText)</h1>
        <div class="unit-block">
            <div class="button-block mb-1">
                <button type="button" class="btn btn-secondary" onclick="Return@(itemName)()"><i class="fas fa-undo"></i>返回</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modalQuery@(itemName)">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">搜尋</h5>
                <button class="close" data-dismiss="modal" type="button">
                    <span aria-hidden="true"><i class="fas fa-times"></i></span>
                </button>
            </div>
            <div class="modal-body">
                <form class="container custom-form-container" autocomplete="off" id="queryForm@(itemName)">
                    <fieldset>
                        <div class="form-group row">
                            <label class="form-label col-12" for="cboRoErpPrefixQ@(itemName)">銷貨單別</label>
                            <div class="col-12">
                                <select class="form-control" id="cboRoErpPrefixQ@(itemName)" name="cboRoErpPrefixQ@(itemName)"></select>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="form-label col-12" for="txtRoErpFullNoQ@(itemName)">銷貨單</label>
                            <div class="col-12">
                                <input type="text" class="form-control" id="txtRoErpFullNoQ@(itemName)" name="txtRoErpFullNoQ@(itemName)" placeholder="請輸入銷貨單" />
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="form-label col-12" for="cboCustomerIdQ@(itemName)">客戶</label>
                            <div class="col-12">
                                <select class="form-control" id="cboCustomerIdQ@(itemName)" name="cboCustomerIdQ@(itemName)"></select>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="form-label col-12" for="cboSalesmenIdQ@(itemName)">業務人員</label>
                            <div class="col-12">
                                <select class="form-control" id="cboSalesmenIdQ@(itemName)" name="cboSalesmenIdQ@(itemName)"></select>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-12">單據日期<input type="checkbox" id="cbxDocDateQ@(itemName)" checked /></label>
                            <div class="col-6">
                                <input type="text" class="form-control" id="txtStartDocDateQ@(itemName)" name="txtStartDocDateQ@(itemName)" onkeypress="BandeInput(event)" onkeydown="BandCtrlV(event)"
                                       data-msg-extraRegex="請輸入正確的日期格式" data-rule-extraRegex="([12]\d{3}\-(0[1-9]|1[0-2])\-(0[1-9]|[12]\d|3[01]))"
                                       readonly />
                            </div>
                            <div class="col-6">
                                <input type="text" class="form-control" id="txtEndDocDateQ@(itemName)" name="txtEndDocDateQ@(itemName)" onkeypress="BandeInput(event)" onkeydown="BandCtrlV(event)"
                                       data-msg-extraRegex="請輸入正確的日期格式" data-rule-extraRegex="([12]\d{3}\-(0[1-9]|1[0-2])\-(0[1-9]|[12]\d|3[01]))"
                                       readonly />
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-12" for="cboConfirmStatusQ@(itemName)">確認碼</label>
                            <div class="col-12">
                                <select class="form-control" id="cboConfirmStatusQ@(itemName)" name="cboConfirmStatusQ@(itemName)">
                                    <option value="">-- 請選擇確認碼 --</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-12" for="cboTransferStatusMESQ@(itemName)">ERP拋轉狀態碼</label>
                            <div class="col-12">
                                <select class="form-control" id="cboTransferStatusMESQ@(itemName)" name="cboTransferStatusMESQ@(itemName)">
                                    <option value="">-- 請選擇拋轉ERP狀態碼 --</option>
                                </select>
                            </div>
                        </div>
                    </fieldset>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" onclick="Query@(itemName)()" style="margin: auto;"><i class="fal fa-wrench"></i>套用</button>
            </div>
        </div>
    </div>
</div>

<div class="row" id="listData@(itemName)">
    <div class="col-12">
        <div class="card card-shadow mb-4">
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-6 col-sm-6 col-md-6">
                        <a class="btn btn-primary" data-backdrop="static" data-keyboard="false" data-toggle="modal" data-target="#modalQuery@(itemName)" href="javascript:void(0);">
                            <i class="fal fa-search"></i>搜尋
                        </a>
                    </div>
                    <div class="col-6 col-sm-6 col-md-6 text-right">
                        <a class="btn btn-success auth-sync" href="javascript:PopSoSync@(itemName)();"><i class="fas fa-sync"></i>ERP資料同步</a>
                        <a class="btn btn-info auth-add" href="javascript:Edit@(itemName)();"><i class="fas fa-plus"></i>新增</a>
                        @*<a class="btn btn-warning " href="javascript:OpenDelivery@(itemName)();"><i class="fas fa-random"></i>出貨轉銷貨</a>*@
                    </div>
                </div>
                <div class="row">
                    <div class="col-12">
                        <div class="table-custom">
                            <table class="table table-bordered table-striped table-sticky" id="tblData@(itemName)">
                                <thead>
                                    <tr>
                                        <th scope="col" style="min-width: 75px;">#</th>
                                        <th scope="col" style="min-width: 150px;">銷貨單</th>
                                        <th scope="col" style="min-width: 100px;">單據日期</th>
                                        <th scope="col" style="min-width: 200px;">客戶</th>
                                        <th scope="col" style="min-width: 100px;">業務人員</th>
                                        <th scope="col" style="min-width: 120px;">拋轉狀態</th>
                                        <th scope="col" style="min-width: 100px;">確認者</th>
                                        <th class="text-center" scope="col" style="min-width: 75px;">操作</th>
                                        <th style="padding: 0; min-width: 2100px;">
                                            <table class="table table-bordered table-sm mb-0 table-non-rwd table-striped-custom table-row-detail">
                                                <thead>
                                                    <tr>
                                                        <th style="width: 100px;">流水號</th>
                                                        <th style="width: 175px;">品號</th>
                                                        <th style="width: 175px;">品名</th>
                                                        <th style="width: 175px;">庫別</th>
                                                        <th style="width: 120px;">銷貨數量</th>
                                                        <th style="width: 100px;">類型</th>
                                                        <th style="width: 120px;">贈備品數量</th>
                                                        <th style="width: 100px;">計價數量</th>
                                                        <th style="width: 100px;">單價</th>
                                                        <th style="width: 100px;">金額</th>
                                                        <th style="width: 100px;">幣別</th>
                                                        <th style="width: 220px;">訂單</th>
                                                        <th style="width: 220px;">暫出單</th>
                                                        <th style="width: 220px;">批號</th>
                                                    </tr>
                                                </thead>
                                            </table>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                        <div class="pagination" id="page@(itemName)"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row" id="editData@(itemName)" style="display: none;">
    <div class="col-12">
        <div class="card card-shadow mb-4">
            <div class="card-body">
                <form class="container custom-form-container" autocomplete="off" id="editForm@(itemName)">
                    <fieldset>
                        <input type="hidden" id="RoId" name="RoId" value="-1" />
                        <div class="row">
                            <div class="col-lg-6 col-md-12">
                                <div class="form-group row">
                                    <label class="col-12" for="txtDocDate@(itemName)">開單日期<span class="text-danger">*</span></label>
                                    <div class="col-12">
                                        <input type="text" class="form-control" id="txtDocDate@(itemName)" name="txtDocDate@(itemName)"
                                               data-msg-extraRegex="請輸入正確的日期格式" data-rule-extraRegex="([12]\d{3}\-(0[1-9]|1[0-2])\-(0[1-9]|[12]\d|3[01]))" data-rule-required="true" />
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 col-md-12">
                                <div class="form-group row">
                                    <label class="col-12" for="txtReceiveDate@(itemName)">銷貨日期<span class="text-danger">*</span></label>
                                    <div class="col-12">
                                        <input type="text" class="form-control" id="txtReceiveDate@(itemName)" name="txtReceiveDate@(itemName)"
                                               data-msg-extraRegex="請輸入正確的日期格式" data-rule-extraRegex="([12]\d{3}\-(0[1-9]|1[0-2])\-(0[1-9]|[12]\d|3[01]))" data-rule-required="true" />
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-6 col-md-12">
                                <div class="form-group row">
                                    <label class="col-12" for="cboRoErpPrefix@(itemName)">銷貨單別<span class="text-danger">*</span></label>
                                    <div class="col-12">
                                        <select class="form-control" id="cboRoErpPrefix@(itemName)" name="cboRoErpPrefix@(itemName)" data-rule-required="true" data-msg-required="請選擇銷貨單別">
                                            <option value="">-- 請選擇銷貨單別 --</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 col-md-12">
                                <div class="form-group row">
                                    <label class="col-12" for="txtRoErpNo@(itemName)">銷貨單號<span class="text-danger">*</span></label>
                                    <div class="col-12">
                                        <input type="text" class="form-control" id="txtRoErpNo@(itemName)" name="txtRoErpNo@(itemName)" placeholder="請輸入銷貨單號" />
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-6 col-md-12">
                                <div class="form-group row">
                                    <label class="col-12" for="cboCustomerId@(itemName)">客戶<span class="text-danger">*</span></label>
                                    <div class="col-12">
                                        <select class="form-control" id="cboCustomerId@(itemName)" name="cboCustomerId@(itemName)" data-rule-required="true" data-msg-required="請選擇客戶">
                                            <option value="">-- 請選擇客戶 --</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 col-md-12">
                                <div class="form-group row">
                                    <label class="col-12" for="txtSelectOrder@(itemName)">前置單據</label>
                                    <div class="col-12" style="display:flex;">
                                        <input type="hidden" id="txtSourceType@(itemName)" value="" />
                                        <input type="hidden" id="txtPriceSourceType@(itemName)" value="" />
                                        <input type="hidden" id="txtSelectOrderId@(itemName)" value="" />
                                        <input type="text" class="form-control" id="txtSelectOrder@(itemName)" name="txtSelectOrder@(itemName)" placeholder="前置單據" style="width: calc(100% - 135px);" />
                                        <button type="button" class="btn btn-info " onclick="SelectOrder();" style="width:135px;height: 39px;"><i class="fas fa-list-ul"></i>&nbsp;複製前置單據</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-6 col-md-12">
                                <div class="form-group row">
                                    <input type="hidden" id="SourceOrderId@(itemName)" value="-1" />
                                    <label class="col-12" for="cboSourceTypeMain@(itemName)">複製來源</label>
                                    <div class="col-12">
                                        <select class="form-control" id="cboSourceTypeMain@(itemName)" name="cboSourceTypeMain@(itemName)"></select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 col-md-12">
                                <div class="form-group row">
                                    <label class="col-12" for="cboPriceSourceTypeMain@(itemName)">銷貨單價來源</label>
                                    <div class="col-12">
                                        <select class="form-control" id="cboPriceSourceTypeMain@(itemName)" name="cboPriceSourceTypeMain@(itemName)"></select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-6 col-md-12">
                                <div class="form-group row">
                                    <label class="col-12" for="txtProcessCode@(itemName)">流程代號</label>
                                    <div class="col-12">
                                        <input type="text" class="form-control" id="txtProcessCode@(itemName)" name="txtProcessCode@(itemName)" placeholder="請輸入流程代號" />
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 col-md-12">
                                <div class="form-group row">
                                    <label class="col-12 col-md-6 col-lg-12" style="margin-bottom: -3px;">
                                        &nbsp;
                                    </label>
                                    <label class="col-12 col-md-6 col-lg-6" for="cbxRevenueJournalCode@(itemName)">
                                        產生分錄-收入
                                        <input type="checkbox" id="cbxRevenueJournalCode@(itemName)" name="cbxRevenueJournalCode@(itemName)" />
                                    </label>
                                    <label class="col-12 col-md-6 col-lg-6" for="cbxNoCredLimitControl@(itemName)" style="text-align:right;">
                                        不控管信用額度
                                        <input type="checkbox" id="cbxNoCredLimitControl@(itemName)" name="cbxNoCredLimitControl@(itemName)" />
                                    </label>
                                    <label class="col-12 col-md-6 col-lg-6" for="cbxCostJournalCode@(itemName)">
                                        產生分錄-成本
                                        <input type="checkbox" id="cbxCostJournalCode@(itemName)" name="cbxCostJournalCode@(itemName)" />
                                    </label>
                                    <label class="col-12 col-md-6 col-lg-6" for="cbxCashSales@(itemName)" style="text-align:right;">
                                        現銷
                                        <input type="checkbox" id="cbxCashSales@(itemName)" name="cbxCashSales@(itemName)" />
                                    </label>
                                </div>
                            </div>
                        </div>
                        @*<div class="row">
                                <div class="col-lg-6 col-md-12">
                                    <div class="form-group row">
                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-12">
                                    <div class="form-group row">
                                    </div>
                                </div>
                            </div>*@
                        <div class="tab menyBar" style="white-space:unset;">
                            <ul class="nav nav-tabs nav-fill mb-3" role="tablist" style="display: -webkit-inline-box;overflow: scroll;">
                                <li class="nav-item">
                                    <a class="nav-link" data-toggle="tab" href="#tabMoneyData">
                                        <i class="far fa-file-invoice-dollar"></i> 金錢資料
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link active" id="tabActive" data-toggle="tab" href="#tabTrade">
                                        <i class="far fa-file-invoice-dollar"></i> 交易資料
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link " data-toggle="tab" href="#tabDeliver">
                                        <i class="far fa-file-invoice-dollar"></i> 送貨資料
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link " data-toggle="tab" href="#tabBill1">
                                        <i class="far fa-file-invoice-dollar"></i> 發票資料(一)
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link " data-toggle="tab" href="#tabBill2">
                                        <i class="far fa-file-invoice-dollar"></i> 發票資料(二)
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-toggle="tab" href="#tabOther">
                                        <i class="fas fa-folder"></i> 其他資料
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-toggle="tab" href="#tabDispatch">
                                        <i class="fas fa-folder"></i> 訂金/派車資料
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-toggle="tab" href="#tabMilitary">
                                        <i class="fas fa-folder"></i> 軍福品資料
                                    </a>
                                </li>
                            </ul>
                        </div>
                        <div class="tab-content">
                            <div class="tab-pane " id="tabMoneyData">
                                <div class="row">
                                    <div class="col-lg-4 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="txtOriginalAmount@(itemName)">原幣銷貨金額</label>
                                            <div class="col-12">
                                                <input type="text" class="form-control" id="txtOriginalAmount@(itemName)" name="txtOriginalAmount@(itemName)" placeholder="請輸入原幣銷貨金額" value="0" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-4 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="txtOriginalTaxAmount@(itemName)">原幣銷貨稅額</label>
                                            <div class="col-12">
                                                <input type="text" class="form-control" id="txtOriginalTaxAmount@(itemName)" name="txtOriginalTaxAmount@(itemName)" placeholder="請輸入原幣銷貨稅額" value="0" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-4 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="txtOriginalAmountSum@(itemName)">原幣合計</label>
                                            <div class="col-12">
                                                <input type="text" class="form-control" id="txtOriginalAmountSum@(itemName)" name="txtOriginalAmountSum@(itemName)" placeholder="請輸入原幣合計" value="0" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-4 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="txtPretaxAmount@(itemName)">本幣銷貨金額</label>
                                            <div class="col-12">
                                                <input type="text" class="form-control" id="txtPretaxAmount@(itemName)" name="txtPretaxAmount@(itemName)" placeholder="請輸入本幣銷貨金額" value="0" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-4 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="txtTaxAmount@(itemName)">本幣銷貨稅額</label>
                                            <div class="col-12">
                                                <input type="text" class="form-control" id="txtTaxAmount@(itemName)" name="txtTaxAmount@(itemName)" placeholder="請輸入本幣銷貨稅額" value="0" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-4 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="txtPretaxAmountSum@(itemName)">本幣合計</label>
                                            <div class="col-12">
                                                <input type="text" class="form-control" id="txtPretaxAmountSum@(itemName)" name="txtPretaxAmountSum@(itemName)" placeholder="請輸入本幣合計" value="0" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-4 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="txtTotalQuantity@(itemName)">總數量</label>
                                            <div class="col-12">
                                                <input type="text" class="form-control" id="txtTotalQuantity@(itemName)" name="txtTotalQuantity@(itemName)" placeholder="請輸入總數量" value="0" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-4 col-md-12">
                                        <div class="form-group row">

                                        </div>
                                    </div>
                                    <div class="col-lg-4 col-md-12">
                                        <div class="form-group row">

                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane active" id="tabTrade">
                                <div class="row">
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="cboSalesmenId@(itemName)">業務人員</label>
                                            <div class="col-12">
                                                <select class="form-control" id="cboSalesmenId@(itemName)" name="cboSalesmenId@(itemName)"></select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="cboDepartmentId@(itemName)">部門</label>
                                            <div class="col-12">
                                                <select class="form-control" id="cboDepartmentId@(itemName)" name="cboDepartmentId@(itemName)">
                                                    <option value="">-- 請選擇部門 --</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12 " for="cboFactory@(itemName)">出貨廠別<span class="text-danger">*</span></label>
                                            <div class="col-12">
                                                <select class="form-control" id="cboFactory@(itemName)" name="cboFactory@(itemName)" data-rule-required="true" data-msg-required="請選擇出貨廠別"></select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="cboPaymentTerm@(itemName)">付款條件</label>
                                            <div class="col-12">
                                                <select class="form-control" id="cboPaymentTerm@(itemName)" name="cboPaymentTerm@(itemName)"></select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12 " for="cboTradingTerms@(itemName)">交易條件<span class="text-danger">*</span></label>
                                            <div class="col-12">
                                                <select class="form-control" id="cboTradingTerms@(itemName)" name="cboTradingTerms@(itemName)" data-rule-required="true" data-msg-required="請選擇交易條件"></select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="cboCurrency@(itemName)">幣別匯率<span class="text-danger">*</span></label>
                                            <div class="col-12" style="display: flex;">
                                                <select class="form-control" id="cboCurrency@(itemName)" name="cboCurrency@(itemName)" style="width:105px;"></select>
                                                <input type="number" class="form-control" id="txtExchangeRate@(itemName)" name="txtExchangeRate@(itemName)" placeholder="請輸入匯率" style="height: unset;width: calc(100% - 105px);" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="cboBondCode@(itemName)">保稅碼<span class="text-danger">*</span></label>
                                            <div class="col-12">
                                                <select class="form-control" id="cboBondCode@(itemName)" name="cboBondCode@(itemName)" data-rule-required="true"></select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-12 ">
                                        <div class="form-group row">
                                            <label class="col-12" for="txtRowCnt@(itemName)">件數</label>
                                            <div class="col-12">
                                                <input type="text" class="form-control" id="txtRowCnt@(itemName)" name="txtRowCnt@(itemName)" placeholder="請輸入件數" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="cboConfirmStatus@(itemName)">確認碼</label>
                                            <div class="col-12">
                                                <select class="form-control" id="cboConfirmStatus@(itemName)" name="cboConfirmStatus@(itemName)"></select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="cboConfirmUserId@(itemName)">確認者</label>
                                            <div class="col-12">
                                                <select class="form-control" id="cboConfirmUserId@(itemName)" name="cboConfirmUserId@(itemName)"></select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-12 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="txtRemark@(itemName)">備註</label>
                                            <div class="col-12 col-md-12 col-lg-12">
                                                <textarea class="form-control" id="txtRemark@(itemName)" name="txtRemark@(itemName)"
                                                          data-msg-maxlength="必須少於 255 個字元" maxlength="255" rows="2" placeholder="請輸入備註"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane " id="tabDeliver">
                                <div class="row">
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="txtCustomerFullName@(itemName)">送貨客戶全名</label>
                                            <div class="col-12">
                                                <input type="text" class="form-control" id="txtCustomerFullName@(itemName)" name="txtCustomerFullName@(itemName)" placeholder="請輸入送貨客戶全名" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="txtContactPerson@(itemName)">聯絡人</label>
                                            <div class="col-12">
                                                <input type="text" class="form-control" id="txtContactPerson@(itemName)" name="txtContactPerson@(itemName)" placeholder="請輸入聯絡人" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="txtCustomerAddressFirst@(itemName)">地址(一)</label>
                                            <div class="col-12">
                                                <input type="text" class="form-control" id="txtCustomerAddressFirst@(itemName)" name="txtCustomerAddressFirst@(itemName)" placeholder="請輸入地址(一)" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="txtTelephoneNumber@(itemName)">TEL_NO</label>
                                            <div class="col-12">
                                                <input type="text" class="form-control" id="txtTelephoneNumber@(itemName)" name="txtTelephoneNumber@(itemName)" placeholder="請輸入TEL_NO<" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="txtCustomerAddressSecond@(itemName)">地址(二)</label>
                                            <div class="col-12">
                                                <input type="text" class="form-control" id="txtCustomerAddressSecond@(itemName)" name="txtCustomerAddressSecond@(itemName)" placeholder="請輸入地址(二)" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12 " for="txtFaxNumber@(itemName)">FAX_NO</label>
                                            <div class="col-12">
                                                <input type="text" class="form-control" id="txtFaxNumber@(itemName)" name="txtFaxNumber@(itemName)" placeholder="請輸入FAX_NO" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane " id="tabBill1">
                                <div class="row">
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="cboTaxCode@(itemName)">稅別碼<span class="text-danger">*</span></label>
                                            <div class="col-12">
                                                <select class="form-control" id="cboTaxCode@(itemName)" name="cboTaxCode@(itemName)" data-rule-required="true"></select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="cboInvoiceType@(itemName)">發票聯數</label>
                                            <div class="col-12">
                                                <select class="form-control" id="cboInvoiceType@(itemName)" name="cboInvoiceType@(itemName)" data-rule-required="true"></select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="cboTaxType@(itemName)">課稅別<span class="text-danger">*</span></label>
                                            <div class="col-12">
                                                <select class="form-control" id="cboTaxType@(itemName)" name="cboTaxType@(itemName)" data-rule-required="true"></select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="txtTaxRate@(itemName)">營業稅率</label>
                                            <div class="col-12">
                                                <input type="number" class="form-control" id="txtTaxRate@(itemName)" name="txtTaxRate@(itemName)" placeholder="請輸入營業稅率" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="cboInvNumGenMethod@(itemName)">發票產生方式<span class="text-danger">*</span></label>
                                            <div class="col-12">
                                                <select class="form-control" id="cboInvNumGenMethod@(itemName)" name="cboInvNumGenMethod@(itemName)" data-rule-required="true"></select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="txtUiNo@(itemName)">統一編號</label>
                                            <div class="col-12">
                                                <input type="text" class="form-control" id="txtUiNo@(itemName)" name="txtUiNo@(itemName)" placeholder="請輸入統一編號" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="txtInvoiceDate@(itemName)">發票日期</label>
                                            <div class="col-12">
                                                <input type="text" class="form-control" id="txtInvoiceDate@(itemName)" name="txtInvoiceDate@(itemName)" placeholder="請輸入發票日期" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="txtInvoiceTime@(itemName)">發票開立時間</label>
                                            <div class="col-12">
                                                <input type="text" class="form-control" id="txtInvoiceTime@(itemName)" name="txtInvoiceTime@(itemName)" placeholder="請輸入發票開立時間" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="txtInvNumStart@(itemName)">發票號碼(起)</label>
                                            <div class="col-12">
                                                <input type="text" class="form-control" id="txtInvNumStart@(itemName)" name="txtInvNumStart@(itemName)" placeholder="請輸入發票號碼(起)" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="txtInvNumEnd@(itemName)">發票號碼(訖)</label>
                                            <div class="col-12">
                                                <input type="text" class="form-control" id="txtInvNumEnd@(itemName)" name="txtInvNumEnd@(itemName)" placeholder="請輸入發票號碼(訖)" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="txtApplyYYMM@(itemName)">申報年月<span class="text-danger">*</span></label>
                                            <div class="col-12">
                                                <input type="text" class="form-control" id="txtApplyYYMM@(itemName)" name="txtApplyYYMM@(itemName)" placeholder="請輸入申報年月" data-rule-required="true" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="cboCustomsClearance@(itemName)">通關方式<span class="text-danger">*</span></label>
                                            <div class="col-12">
                                                <select class="form-control" id="cboCustomsClearance@(itemName)" name="cboCustomsClearance@(itemName)" data-rule-required="true"></select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="txtCustomerFullNameOre@(itemName)">客戶全名</label>
                                            <div class="col-12">
                                                <input type="text" class="form-control" id="txtCustomerFullNameOre@(itemName)" name="txtCustomerFullNameOre@(itemName)" placeholder="請輸入客戶全名" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="txtInvoiceAddressFirst@(itemName)">發票地址(一)</label>
                                            <div class="col-12">
                                                <input type="text" class="form-control" id="txtInvoiceAddressFirst@(itemName)" name="txtInvoiceAddressFirst@(itemName)" placeholder="請輸入發票地址(一)" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="txtCustomerEgFullName@(itemName)">客戶英文全名</label>
                                            <div class="col-12">
                                                <input type="text" class="form-control" id="txtCustomerEgFullName@(itemName)" name="txtCustomerEgFullName@(itemName)" placeholder="請輸入客戶英文全名" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="txtInvoiceAddressSecond@(itemName)">發票地址(二)</label>
                                            <div class="col-12">
                                                <input type="text" class="form-control" id="txtInvoiceAddressSecond@(itemName)" name="txtInvoiceAddressSecond@(itemName)" placeholder="請輸入發票地址(二)" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12 col-md-6 col-lg-6" for="cbxMultipleInvoices@(itemName)">
                                                多發票
                                                <input type="checkbox" id="cbxMultipleInvoices@(itemName)" name="cbxMultipleInvoices@(itemName)" />
                                            </label>
                                            <label class="col-12 col-md-6 col-lg-6" for="cbxMultiTaxRate@(itemName)" style="text-align:right;">
                                                單身多稅率
                                                <input type="checkbox" id="cbxMultiTaxRate@(itemName)" name="cbxMultiTaxRate@(itemName)" />
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12 col-md-6 col-lg-6" for="cbxAttachInvWithShip@(itemName)">
                                                隨貨附發票
                                                <input type="checkbox" id="cbxAttachInvWithShip@(itemName)" name="cbxAttachInvWithShip@(itemName)" />
                                            </label>
                                            <label class="col-12 col-md-6 col-lg-6" for="cbxInvoicesVoid@(itemName)" style="text-align:right;">
                                                發票作廢
                                                <input type="checkbox" id="cbxInvoicesVoid@(itemName)" name="cbxInvoicesVoid@(itemName)" />
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane " id="tabBill2">
                                <div class="row">
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="txtVehicleTypeNumber@(itemName)">載具類別</label>
                                            <div class="col-12">
                                                <input type="text" class="form-control" id="txtVehicleTypeNumber@(itemName)" name="txtVehicleTypeNumber@(itemName)" placeholder="請輸入載具類別" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="txtInvDonationRecipient@(itemName)">發票捐贈對象</label>
                                            <div class="col-12">
                                                <input type="text" class="form-control" id="txtInvDonationRecipient@(itemName)" name="txtInvDonationRecipient@(itemName)" placeholder="請輸入發票捐贈對象" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="txtVehicleIDshow@(itemName)">載具顯碼ID</label>
                                            <div class="col-12">
                                                <input type="text" class="form-control" id="txtVehicleIDshow@(itemName)" name="txtVehicleIDshow@(itemName)" placeholder="請輸入載具顯碼ID" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="txtVehicleIDhide@(itemName)">載具隱碼ID</label>
                                            <div class="col-12">
                                                <input type="text" class="form-control" id="txtVehicleIDhide@(itemName)" name="txtVehicleIDhide@(itemName)" placeholder="請輸入載具隱碼ID" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="txtCreditCard4No@(itemName)">信用卡末四碼</label>
                                            <div class="col-12">
                                                <input type="text" class="form-control" id="txtCreditCard4No@(itemName)" name="txtCreditCard4No@(itemName)" placeholder="請輸入信用卡末四碼" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="txtInvRandomCode@(itemName)">發票防偽隨機碼</label>
                                            <div class="col-12">
                                                <input type="text" class="form-control" id="txtInvRandomCode@(itemName)" name="txtInvRandomCode@(itemName)" placeholder="請輸入發票防偽隨機碼" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="txtContactEmail@(itemName)">聯絡人E-Mail</label>
                                            <div class="col-12">
                                                <input type="text" class="form-control" id="txtContactEmail@(itemName)" name="txtContactEmail@(itemName)" placeholder="請輸入聯絡人E-Mail" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane " id="tabOther">
                                <div class="row">
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="cboStaffId@(itemName)">員工</label>
                                            <div class="col-12">
                                                <select class="form-control" id="cboStaffId@(itemName)" name="cboStaffId@(itemName)"></select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="cboCollectionSalesmenId@(itemName)">收款業務</label>
                                            <div class="col-12">
                                                <select class="form-control" id="cboCollectionSalesmenId@(itemName)" name="cboCollectionSalesmenId@(itemName)"></select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-12 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="txtRemark1@(itemName)">備註(一)</label>
                                            <div class="col-12 col-md-12 col-lg-12">
                                                <textarea class="form-control" id="txtRemark1@(itemName)" name="txtRemark1@(itemName)"
                                                          data-msg-maxlength="必須少於 255 個字元" maxlength="255" rows="2" placeholder="請輸入備註"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-12 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="txtRemark2@(itemName)">備註(二)</label>
                                            <div class="col-12 col-md-12 col-lg-12">
                                                <textarea class="form-control" id="txtRemark2@(itemName)" name="txtRemark2@(itemName)"
                                                          data-msg-maxlength="必須少於 255 個字元" maxlength="255" rows="2" placeholder="請輸入備註"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-12 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="txtRemark3@(itemName)">備註(三)</label>
                                            <div class="col-12 col-md-12 col-lg-12">
                                                <textarea class="form-control" id="txtRemark3@(itemName)" name="txtRemark3@(itemName)"
                                                          data-msg-maxlength="必須少於 255 個字元" maxlength="255" rows="2" placeholder="請輸入備註"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="txtLCNO@(itemName)">L/C NO</label>
                                            <div class="col-12">
                                                <input type="text" class="form-control" id="txtLCNO@(itemName)" name="txtLCNO@(itemName)" placeholder="請輸入L/C NO" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="txtInvoiceNO@(itemName)">INVOICE NO</label>
                                            <div class="col-12">
                                                <input type="text" class="form-control" id="txtInvoiceNO@(itemName)" name="txtInvoiceNO@(itemName)" placeholder="請輸入INVOICE NO" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="txtDeclarationNumber@(itemName)">報單號碼</label>
                                            <div class="col-12">
                                                <input type="text" class="form-control" id="txtDeclarationNumber@(itemName)" name="txtDeclarationNumber@(itemName)" placeholder="請輸入報單號碼" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="txtNewRoFull@(itemName)">新銷貨單</label>
                                            <div class="col-12">
                                                <input type="text" class="form-control" id="txtNewRoFull@(itemName)" name="txtNewRoFull@(itemName)" placeholder="請輸入新銷貨單" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="txtShipNoticeFull@(itemName)">出貨通知單</label>
                                            <div class="col-12">
                                                <input type="text" class="form-control" id="txtShipNoticeFull@(itemName)" name="txtShipNoticeFull@(itemName)" placeholder="請輸入出貨通知單" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12">&nbsp</label>
                                            <label class="col-12 col-md-6 col-lg-6" for="cbxChangeInvCode@(itemName)">
                                                更換發票
                                                <input type="checkbox" id="cbxChangeInvCode@(itemName)" name="cbxChangeInvCode@(itemName)" />
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane " id="tabDispatch">
                                <div class="row">
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="txtSoFull@(itemName)">訂單單號</label>
                                            <div class="col-12">
                                                <input type="text" class="form-control" id="txtSoFull@(itemName)" name="txtSoFull@(itemName)" placeholder="請輸入訂單單號" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="txtAdvOrderFull@(itemName)">預收待抵單</label>
                                            <div class="col-12">
                                                <input type="text" class="form-control" id="txtAdvOrderFull@(itemName)" name="txtAdvOrderFull@(itemName)" placeholder="請輸入預收待抵單" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="txtOffsetAmount@(itemName)">沖抵金額</label>
                                            <div class="col-12">
                                                <input type="number" class="form-control" id="txtOffsetAmount@(itemName)" name="txtOffsetAmount@(itemName)" placeholder="請輸入沖銷金額" value="0" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="txtOffsetTaxAmount@(itemName)">沖抵稅額</label>
                                            <div class="col-12">
                                                <input type="number" class="form-control" id="txtOffsetTaxAmount@(itemName)" name="txtOffsetTaxAmount@(itemName)" placeholder="請輸入衝低稅額" value="0" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="cboTransportMethod@(itemName)">運輸方式</label>
                                            <div class="col-12">
                                                <select class="form-control" id="cboTransportMethod@(itemName)" name="cboTransportMethod@(itemName)"></select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="txtDispatchOrderFull@(itemName)">派車單</label>
                                            <div class="col-12">
                                                <input type="text" class="form-control" id="txtDispatchOrderFull@(itemName)" name="txtDispatchOrderFull@(itemName)" placeholder="請輸入派車單" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="txtCarNumber@(itemName)">車號車次</label>
                                            <div class="col-12" style="display:flex;">
                                                <input type="text" class="form-control" id="txtCarNumber@(itemName)" name="txtCarNumber@(itemName)" placeholder="請輸入車號" style="width:50%;" />
                                                <input type="text" class="form-control" id="txtTrainNumber@(itemName)" name="txtTrainNumber@(itemName)" placeholder="請輸入車次" style="width:50%;" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="txtDeliveryUserName@(itemName)">送貨者</label>
                                            <div class="col-12">
                                                <input type="text" class="form-control" id="txtDeliveryUserName@(itemName)" name="txtDeliveryUserName@(itemName)" placeholder="請輸入送貨客戶全名" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12">&nbsp</label>
                                            <label class="col-12 col-md-6 col-lg-6" for="cbxDepositBatches@(itemName)">
                                                訂金分批
                                                <input type="checkbox" id="cbxDepositBatches@(itemName)" name="cbxDepositBatches@(itemName)" />
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane " id="tabMilitary">
                                <div class="row">
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="cboCourier@(itemName)">代送商</label>
                                            <div class="col-12">
                                                <select class="form-control" id="cboCourier@(itemName)" name="cboCourier@(itemName)"></select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="txtSiteCommCalcMethod@(itemName)">營站傭金計算方式</label>
                                            <div class="col-12">
                                                <input type="text" class="form-control" id="txtSiteCommCalcMethod@(itemName)" name="txtSiteCommCalcMethod@(itemName)" placeholder="請輸入營站傭金計算方式" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="txtSiteCommRate@(itemName)">營站佣金比率</label>
                                            <div class="col-12">
                                                <input type="text" class="form-control" id="txtSiteCommRate@(itemName)" name="txtSiteCommRate@(itemName)" placeholder="請輸入營站佣金比率" value="0" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12" for="txtTotalCommAmount@(itemName)">佣金總金額</label>
                                            <div class="col-12">
                                                <input type="text" class="form-control" id="txtTotalCommAmount@(itemName)" name="txtTotalCommAmount@(itemName)" placeholder="請輸入佣金總金額" value="0" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12">&nbsp</label>
                                            <label class="col-12 col-md-6 col-lg-6" for="cbxCommCalcInclTax@(itemName)">
                                                傭金計算含稅
                                                <input type="checkbox" id="cbxCommCalcInclTax@(itemName)" name="cbxCommCalcInclTax@(itemName)" />
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </fieldset>
                </form>
            </div>
            <div class="card-footer text-center text-lg-right">
                <button type="button" id="SaveButton" class="btn btn-success" onclick="Save@(itemName)()"><i class="fas fa-save"></i>儲存</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modalSync@(itemName)">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">@(itemNameText)同步</h5>
                <button class="close" type="button" onclick="CloseSync@(itemName)()">
                    <span aria-hidden="true"><i class="fas fa-times"></i></span>
                </button>
            </div>
            <div class="modal-body">
                <form class="container custom-form-container" autocomplete="off" id="syncForm@(itemName)">
                    <fieldset>
                        <div class="form-group row">
                            <label class="col-12 col-md-3 col-lg-3 col-form-label" for="txtRoErpFullNo@(itemName)">銷貨單單號</label>
                            <div class="col-12 col-md-9 col-lg-9">
                                <input type="text" class="form-control" id="txtRoErpFullNo@(itemName)" name="txtRoErpFullNo@(itemName)" placeholder="請輸入銷貨單單號單號" />
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-12 col-md-3 col-lg-3 col-form-label" for="txtSyncStartDate@(itemName)">開始日期 <input type="checkbox" id="cbxSyncDate@(itemName)" checked /></label>
                            <div class="col-12 col-md-9 col-lg-9">
                                <input type="text" class="form-control" id="txtSyncStartDate@(itemName)" name="txtSyncStartDate@(itemName)" placeholder="請輸入開始日期" />
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-12 col-md-3 col-lg-3 col-form-label" for="txtSyncEndDate@(itemName)">結束日期</label>
                            <div class="col-12 col-md-9 col-lg-9">
                                <input type="text" class="form-control" id="txtSyncEndDate@(itemName)" name="txtSyncEndDate@(itemName)" placeholder="請輸入結束日期" />
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-12 col-md-3 col-lg-3 col-form-label">同步模式</label>
                            <div class="col-12 col-md-9 col-lg-9">
                                <div class="row">
                                    <div class="col">
                                        <label class="control control-solid control-solid-info control--checkbox">
                                            正常同步
                                            <input type="checkbox" id="cbxNormalSync@(itemName)" name="cbxNormalSync@(itemName)" checked />
                                            <span class="control__indicator"></span>
                                        </label>
                                    </div>
                                    <div class="col">
                                        <label class="control control-solid control-solid-info control--checkbox">
                                            異動同步
                                            <input type="checkbox" id="cbxTranSync@(itemName)" name="cbxTranSync@(itemName)" />
                                            <span class="control__indicator"></span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </fieldset>
                </form>
            </div>
            <div class="modal-footer text-center">
                <button type="button" class="btn btn-success" onclick="Sync@(itemName)()"><i class="fas fa-sync"></i>同步</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="PopViewOrder@(itemName)">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    前置單據選擇
                    <span class="sub-title">目前客戶 <span class="sub-text" id="desCustomerName@(itemName)"></span></span>
                </h5>
            </div>
            <div class="modal-body">
                <div class="row" id="listData@(itemName)">
                    <div class="col-lg-12">
                        <form autocomplete="off" id="listDataPopOrder@(itemName)">
                            <fieldset>
                                <div class="form-row align-items-center mb-2">
                                    <div class="col-auto">
                                        <label>請選擇複製來源 <span class="text-danger">*</span></label>
                                        <select class="form-control" id="cboSourceType@(itemName)" name="cboSourceType@(itemName)"></select>
                                    </div>
                                    <div class="col-auto">
                                        <label>來源單據</label>
                                        <input type="text" class="form-control" id="txtSourceOrderFull@(itemName)" name="txtOrderFull@(itemName)" placeholder="請輸入來源單據" />
                                    </div>
                                    <div class="col-auto">
                                        <label>請選擇銷貨單價來源 <span class="text-danger">*</span></label>
                                        <select class="form-control" id="cboPriceSourceType@(itemName)" name="cboSourceType@(itemName)"></select>
                                    </div>
                                </div>
                            </fieldset>
                        </form>
                        <div class="table-custom">
                            <table class="table table-bordered table-striped table-sticky" id="tblPopOrder@(itemName)">
                                <thead>
                                    <tr>
                                        <th scope="col" style="min-width: 75px;">#</th>
                                        <th scope="col" style="min-width: 150px;">單據單號</th>
                                        <th scope="col" style="min-width: 100px;">單據日期</th>
                                        <th scope="col" style="min-width: 200px;">客戶</th>
                                        <th class="text-center col-sticky" scope="col" style="min-width: 75px;">請選擇</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                        <div class="pagination" id="pagePopOrder@(itemName)"></div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary list-mode" onclick="ClosePopView()"><i class="fas fa-times"></i>關閉</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="selectLotManagement@(itemName)">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    批號選單
                    <span class="sub-title">目前品號 <span class="sub-text" id="desMtlItemNo@(itemName)"></span></span>
                </h5>
            </div>
            <div class="modal-body">
                <div class="row" id="listData@(itemName)">
                    <div class="col-lg-12">
                        <div class="table-custom">
                            <table class="table table-bordered table-striped table-sticky" id="tblLotManagementData@(itemName)">
                                <thead>
                                    <tr>
                                        <th scope="col" style="min-width: 75px;">#</th>
                                        <th scope="col" style="min-width: 200px;">批號</th>
                                        <th scope="col" style="min-width: 125px;">庫別</th>
                                        <th scope="col" style="min-width: 100px;">數量</th>
                                        <th scope="col" style="min-width: 100px;">入庫日</th>
                                        <th scope="col" style="min-width: 100px;">失效日</th>
                                        <th scope="col" class="col-sticky" style="min-width: 200px;text-align:center;">操作</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                        <div class="pagination" id="pageSelectLotManagement@(itemName)"></div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary list-mode" onclick="CloseSelectLotManagement()"><i class="fas fa-times"></i>關閉</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modalDelivery@(itemName)">
    <div class="modal-dialog modal-xl">
        <div class="modal-content" style="width:95vw;left: 50%; transform: translate(-50%, 0%);">
            <div class="modal-header">
                <h5 class="modal-title">出貨轉銷貨</h5>
                <button class="close" type="button" onclick="CloseDelivery@(itemName)()">
                    <span aria-hidden="true"><i class="fas fa-times"></i></span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row" id="listDelivery@(itemName)">
                    <div class="col-12">
                        <form autocomplete="off" id="queryFormDelivery@(itemName)">
                            <fieldset>
                                <div class="form-row align-items-center mb-2">
                                    <div class="col-lg-2 col-3">
                                        <label class="form-label" for="cboDeliveryCustomerQ@(itemName)">客戶</label>
                                        <select class="form-control" id="cboDeliveryCustomerQ@(itemName)" name="cboDeliveryCustomerQ@(itemName)"></select>
                                    </div>
                                    <div class="col-lg-2 col-2">
                                        <label class="form-label" for="txtSearchKeyQ@(itemName)">關鍵字</label>
                                        <input type="text" class="form-control" id="txtSearchKeyQ@(itemName)" name="txtSearchKeyQ@(itemName)" placeholder="請輸入品號/品名/訂單單號" />
                                    </div>
                                    <div class="col-lg-2 col-2">
                                        <label class="form-label" for="txtDeliveryStartDateQ@(itemName)">起始日期</label>
                                        <input type="text" class="form-control" id="txtDeliveryStartDateQ@(itemName)" name="txtDeliveryStartDateQ@(itemName)" placeholder="請輸入起始日期"
                                               data-msg-extraRegex="請輸入正確的日期格式" data-rule-extraRegex="([12]\d{3}\-(0[1-9]|1[0-2])\-(0[1-9]|[12]\d|3[01]))"
                                               readonly />
                                    </div>
                                    <div class="col-lg-2 col-2">
                                        <label class="form-label" for="txtDeliveryEndDateQ@(itemName)">結束日期</label>
                                        <input type="text" class="form-control" id="txtDeliveryEndDateQ@(itemName)" name="txtDeliveryEndDateQ@(itemName)" placeholder="請輸入結束日期"
                                               data-msg-extraRegex="請輸入正確的日期格式" data-rule-extraRegex="([12]\d{3}\-(0[1-9]|1[0-2])\-(0[1-9]|[12]\d|3[01]))"
                                               readonly />
                                    </div>
                                    <div class="col-lg-2 col-2 mt-4">
                                        <button type="button" class="btn btn-primary" onclick="GetDelivery@(itemName)()"><i class="fal fa-search"></i>搜尋</button>
                                    </div>
                                    <div class="col-lg-2 col-2 mt-4 text-right">
                                        <a class="btn btn-info" href="javascript:OpenRoErpPrefix@(itemName)();"><i class="fas fa-plus"></i>開立單據</a>
                                    </div>
                                </div>
                            </fieldset>
                        </form>
                        <div class="table-custom">
                            <table class="table table-bordered table-striped table-sticky tiny-table" id="tblDelivery@(itemName)">
                                <thead>
                                    <tr>
                                        <th class="col-sticky text-center checkbox-mode" scope="col" style="min-width: 75px;">
                                            <label class="control control-solid control-solid-info control--checkbox" style="margin-bottom: 0px;">
                                                全選 <input type="checkbox" id="cbxSelectAll@(itemName)" />
                                                <span class="control__indicator"></span>
                                            </label>
                                        </th>
                                        <th class="col-sticky" scope="col" style="min-width: 100px;">出貨日期</th>
                                        <th class="col-sticky" scope="col" style="min-width: 165px;">訂單單號</th>
                                        <th class="col-sticky" scope="col" style="min-width: 165px;">品號</th>
                                        <th class="col-sticky" scope="col" style="min-width: 165px;">品名</th>
                                        <th scope="col" style="min-width: 150px;">出貨客戶</th>
                                        <th scope="col" style="min-width: 165px;">庫別</th>
                                        <th class="text-right" scope="col" style="min-width: 110px; background-color:#FFECC9;">欲銷貨<br>【正常品】數量</th>
                                        <th class="text-right" scope="col" style="min-width: 110px; background-color:#FFECC9;">欲銷貨<br>【贈品】數量</th>
                                        <th class="text-right" scope="col" style="min-width: 110px; background-color:#FFECC9;">欲銷貨<br>【備品】數量</th>
                                        <th class="text-right" scope="col" style="min-width: 110px; background-color:#85C1E9;">訂單<br>【正常品】數量</th>
                                        <th class="text-right" scope="col" style="min-width: 110px; background-color:#85C1E9;">訂單<br>【贈品】數量</th>
                                        <th class="text-right" scope="col" style="min-width: 110px; background-color:#85C1E9;">訂單<br>【備品】數量</th>
                                        <th class="text-right" scope="col" style="min-width: 110px; background-color:#73C6B6;">已銷貨<br>【正常品】數量</th>
                                        <th class="text-right" scope="col" style="min-width: 110px; background-color:#73C6B6;">已銷貨<br>【贈品】數量</th>
                                        <th class="text-right" scope="col" style="min-width: 110px; background-color:#73C6B6;">已銷貨<br>【備品】數量</th>
                                        <th scope="col" style="min-width: 150px;">訂單業務</th>
                                        <th scope="col" style="min-width: 150px;">備註</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                        <div class="pagination" id="pageDelivery@(itemName)"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!--單別POP-->
<div class="modal fade" id="modalRoErpPrefix@(itemName)">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button class="close" type="button" onclick="CloseRoErpPrefix@(itemName)()">
                    <span aria-hidden="true"><i class="fas fa-times"></i></span>
                </button>
            </div>
            <div class="modal-body">
                <form class="container custom-form-container" autocomplete="off" id="RoErpPrefixForm@(itemName)">
                    <fieldset>
                        <div class="form-group row">
                            <label class="col-12 col-md-3 col-lg-3 col-form-label" for="txtPopDocDate@(itemName)">開單日期</label>
                            <div class="col-12 col-md-9 col-lg-9">
                                <input type="text" class="form-control" id="txtPopDocDate@(itemName)" name="txtPopDocDate@(itemName)"
                                       data-msg-extraRegex="請輸入正確的日期格式" data-rule-extraRegex="([12]\d{3}\-(0[1-9]|1[0-2])\-(0[1-9]|[12]\d|3[01]))" data-rule-required="true" />
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-12 col-md-3 col-lg-3 col-form-label" for="cboPopRoErpPrefix@(itemName)">單別</label>
                            <div class="col-12 col-md-9 col-lg-9">
                                <select class="form-control" id="cboPopRoErpPrefix@(itemName)" name="cboPopRoErpPrefix@(itemName)"
                                        data-msg-required="請選擇暫出單單別" data-rule-required="true"></select>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-12 col-md-3 col-lg-3 col-form-label" for="cboPopCustomerId@(itemName)">客戶</label>
                            <div class="col-12 col-md-9 col-lg-9">
                                <select class="form-control" id="cboPopCustomerId@(itemName)" name="cboPopCustomerId@(itemName)" data-rule-required="true" data-msg-required="請選擇客戶" disabled></select>
                            </div>
                        </div>
                        @*<div class="form-group row">
                            <label class="col-12 col-md-3 col-lg-3 col-form-label" for="cboPopSalesmenId@(itemName)">業務人員</label>
                            <div class="col-12 col-md-9 col-lg-9">
                                <select class="form-control" id="cboPopSalesmenId@(itemName)" name="cboPopSalesmenId@(itemName)"
                                        data-msg-required="請選擇負責業務人員" data-rule-required="true"></select>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-12 col-md-3 col-lg-3 col-form-label" for="cboPopCollectionSalesmenId@(itemName)">收款業務人員</label>
                            <div class="col-12 col-md-9 col-lg-9">
                                <select class="form-control" id="cboPopCollectionSalesmenId@(itemName)" name="cboPopCollectionSalesmenId@(itemName)"
                                        data-msg-required="請選擇收款業務人員" data-rule-required="true"></select>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-12 col-md-3 col-lg-3 col-form-label" for="cboPopDeptId@(itemName)">所屬部門</label>
                            <div class="col-12 col-md-9 col-lg-9">
                                <select class="form-control" id="cboPopDeptId@(itemName)" name="cboPopDeptId@(itemName)"
                                        data-msg-required="請選擇所屬部門" data-rule-required="true"></select>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-12 col-md-3 col-lg-3 col-form-label" for="txtPopRemark@(itemName)">單頭備註</label>
                            <div class="col-12 col-md-9 col-lg-9">
                                <input type="text" class="form-control" id="txtPopRemark@(itemName)" name="txtPopRemark@(itemName)" placeholder="請輸入單頭備註" />
                            </div>
                        </div>*@
                    </fieldset>
                </form>
            </div>
            <div class="modal-footer text-center">
                <button type="button" class="btn btn-success" onclick="PopRoSave@(itemName)()"><i class="fas fa-save"></i>儲存</button>
            </div>
        </div>
    </div>
</div>

<div class="advanced-block">
    <div class="row">
        <div class="col-12">
            <ul class="nav flag-tabs nav-fill" role="tablist">
                <li class="flag-item">
                    <a class="flag-link" data-toggle="tab" href="#tabRoDetail">
                        <i class="fas fa-code-branch"></i> 銷貨單單身
                    </a>
                </li>
            </ul>
        </div>
    </div>
    <div class="tab-content">
        <div class="row tab-pane active" id="tabRoDetail">
            <div class="col-12">
                <div class="card card-shadow mb-4">
                    <div class="card-body">
                        <div class="row mb-3">
                            <div class="col-6 col-sm-6 col-md-6">
                            </div>
                            <div class="col-6 col-sm-6 col-md-6 text-right ">
                                <span id="Import">
                                    <a class="btn btn-secondary auth-import" href="javascript:Import@(itemName)('-1');"><i class="far fa-arrow-alt-square-up"></i>拋轉單據</a>
                                </span>
                                <span id="Revise">
                                    <a class="btn btn-secondary auth-import" href="javascript:Revise@(itemName)('-1');"><i class="fas fa-reply-all"></i>單據重新編輯</a>
                                </span>
                                <span id="Confirm">
                                    <a class="btn btn-success auth-confirm" href="javascript:Confirm@(itemName)('-1');"><i class="fas fa-check"></i>核准單據</a>
                                </span>
                                <span id="ReConfirm">
                                    <a class="btn btn-danger auth-reconfirm" href="javascript:ReConfirm@(itemName)('-1');"><i class="fas fa-undo-alt"></i>反確認</a>
                                </span>
                                <span id="Void">
                                    <a class="btn btn-danger auth-reconfirm" href="javascript:Void@(itemName)('-1');"><i class="fas fa-undo-alt"></i>作廢</a>
                                </span>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div style="height: 50%; width: 100%;" id="RoDetailTemporary"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@Html.Resource("js",
@<script>
    let objPage@(itemName) = {
        "pageIndex": 0,
        "pageSize": 10
    };

    let popViewOrderPage = {
        "pageIndex": 0,
        "pageSize": 10
    };
    let objForm@(itemName) = "#editForm@(itemName)";

    let spreadsheet@(itemName);
    let spreadsheetData@(itemName);

    let spreadsheetJson@(itemName) =
    {
        spreadsheetInfoQiMaterial: []
    }

    let GetrFromStatus = false;


    //公共參數
    let userId@(itemName);
    let companyId@(itemName);
    let userNo@(itemName);

    let NewRoId;
    let RoErpPrefix;
    let Currency;
    let ExchangeRate;
    let TaxType;
    let InventoryArr = [];

    let decimalOrPrice; //原幣單價取位
    let decimalOrAmoute; //原幣金額取位
    let decimalLoPrice; //本幣單價取位
    let decimalLoAmoute; //本幣金額取位

    const DetailStatusArr = ["👁️查看", "✎編輯", "🗑️刪除"]
    const FreeSpareTypeArr = ["1.贈品量", "2.備品量"]
    const GetColumn = {
        B: "MtlItemNo",
        E: "InventoryNo",
        G: "Location",
        I: "Quantity",
        J: "Type",
        K: "FreeSpareQty",
        L: "UomNo",
        M: "AvailableQty",
        N: "AvailableUomNo",
        O: "UnitPrice",
        P: "TaxRate",
        Q: "DiscountRate",
        R: "Amount",
        S: "OrigPreTaxAmt",
        T: "OrigTaxAmt",
        U: "PreTaxAmt",
        V: "TaxAmt",
        W: "SoFull",
        X: "LotNumber",
        Y: "CustomerMtlItemNo",
        Z: "ProjectCode",
        AB: "Remarks",
        AC: "TsnFull",
        AD: "BondedCode",
        AE: "CustomerPurchaseOrder",
        AF: "ForecastFull",
        AG: "LotManagement"
    }

    const RoDetailTemplateDefault = `
                    {"sheets":[{"name":"sheet1","data":[
                     {"cell":"A1","css":"dhx_generated_class_u1690959030041","format":"text","value":"操作"}
                    ,{"cell":"B1","css":"dhx_generated_class_u1690959030043","format":"text","value":"品號"}
                    ,{"cell":"C1","css":"dhx_generated_class_u1690959030049","format":"text","value":"品名"}
                    ,{"cell":"D1","css":"dhx_generated_class_u1690959030049","format":"text","value":"規格"}
                    ,{"cell":"E1","css":"dhx_generated_class_u1690959030043","format":"text","value":"庫別"}
                    ,{"cell":"F1","css":"dhx_generated_class_u1690959030049","format":"text","value":"庫別名稱"}
                    ,{"cell":"G1","css":"dhx_generated_class_u1690959030044","format":"text","value":"儲位"}
                    ,{"cell":"H1","css":"dhx_generated_class_u1690959030049","format":"text","value":"儲位位置"}
                    ,{"cell":"I1","css":"dhx_generated_class_u1690959030044","format":"text","value":"數量"}
                    ,{"cell":"J1","css":"dhx_generated_class_u1690959030043","format":"text","value":"類型"}
                    ,{"cell":"K1","css":"dhx_generated_class_u1690959030043","format":"text","value":"贈/備品量"}
                    ,{"cell":"L1","css":"dhx_generated_class_u1690959030043","format":"text","value":"單位"}
                    ,{"cell":"M1","css":"dhx_generated_class_u1690959030044","format":"text","value":"計價數量"}
                    ,{"cell":"N1","css":"dhx_generated_class_u1690959030044","format":"text","value":"計價單位"}
                    ,{"cell":"O1","css":"dhx_generated_class_u1690959030044","format":"text","value":"單價"}
                    ,{"cell":"P1","css":"dhx_generated_class_u1690959030049","format":"text","value":"營業稅率"}
                    ,{"cell":"Q1","css":"dhx_generated_class_u1690959030044","format":"text","value":"折扣率"}
                    ,{"cell":"R1","css":"dhx_generated_class_u1690959030044","format":"text","value":"金額"}
                    ,{"cell":"S1","css":"dhx_generated_class_u1690959030049","format":"text","value":"原幣未稅金額"}
                    ,{"cell":"T1","css":"dhx_generated_class_u1690959030044","format":"text","value":"原幣稅額"}
                    ,{"cell":"U1","css":"dhx_generated_class_u1690959030044","format":"text","value":"本幣未稅金額"}
                    ,{"cell":"V1","css":"dhx_generated_class_u1690959030044","format":"text","value":"本幣稅額"}
                    ,{"cell":"W1","css":"dhx_generated_class_u1690959030044","format":"text","value":"訂單單據"}
                    ,{"cell":"X1","css":"dhx_generated_class_u1690959030044","format":"text","value":"批號"}
                    ,{"cell":"Y1","css":"dhx_generated_class_u1690959030044","format":"text","value":"客戶品號"}
                    ,{"cell":"Z1","css":"dhx_generated_class_u1690959030044","format":"text","value":"專案代號"}
                    ,{"cell":"AA1","css":"dhx_generated_class_u1690959030049","format":"text","value":"專案名稱"}
                    ,{"cell":"AB1","css":"dhx_generated_class_u1690959030044","format":"text","value":"備註"}
                    ,{"cell":"AC1","css":"dhx_generated_class_u1690959030044","format":"text","value":"暫出單"}
                    ,{"cell":"AD1","css":"dhx_generated_class_u1690959030044","format":"text","value":"保稅碼"}
                    ,{"cell":"AE1","css":"dhx_generated_class_u1690959030044","format":"text","value":"預測單"}
                    ,{"cell":"AF1","css":"dhx_generated_class_u1690959030049","format":"text","value":"ID"}
                    ,{"cell":"AG1","css":"dhx_generated_class_u1690959030049","format":"text","value":"批號管理"}
                    ]
                    ,"cols":[{"width":100},{"width":170},{"width":170},{"width":170},{"width":220},{"width":150},{"width":120},{"width":80},{"width":80},{"width":120},{"width":110},{"width":80},{"width":120},{"width":120}
                    ,{"width":120},{"width":100},{"width":100},{"width":120},{"width":120},{"width":120},{"width":120},{"width":120},{"width":180}
                    ,{"width":120},{"width":120},{"width":120},{"width":150},{"width":120},{"width":170},{"width":120},{"width":120}
                    ]
                    ,"rows":[{"height":32}]}]
                    ,"styles":{
                     "dhx_generated_class_u1690959030041":{"background":"#FFACAF","text-align":"center","justify-content":"center"}
                    ,"dhx_generated_class_u1690959030042":{"background":"#FFD6A6","text-align":"center","justify-content":"center"}
                    ,"dhx_generated_class_u1690959030043":{"background":"#FDFFB4","text-align":"center","justify-content":"center"}
                    ,"dhx_generated_class_u1690959030044":{"background":"#CCFFBE","text-align":"center","justify-content":"center"}
                    ,"dhx_generated_class_u1690959030045":{"background":"#9BF7FF","text-align":"center","justify-content":"center"}
                    ,"dhx_generated_class_u1690959030046":{"background":"#9FC5FF","text-align":"center","justify-content":"center"}
                    ,"dhx_generated_class_u1690959030047":{"background":"#BFB2FF","text-align":"center","justify-content":"center"}
                    ,"dhx_generated_class_u1690959030048":{"background":"#FFC8FF","text-align":"center","justify-content":"center"}
                    ,"dhx_generated_class_u1690959030049":{"background":"#D8E3DF","text-align":"center","justify-content":"center"}
                    ,"dhx_generated_class_u1690959030050":{"background":"#F48083","text-align":"center","justify-content":"center"}
                    ,"dhx_generated_class_u1690959030051":{"background":"#FCE186","text-align":"center","justify-content":"center"}
                    ,"dhx_generated_class_u1690959030052":{"background":"#E8FFCE","text-align":"center","justify-content":"center"}
                    ,"dhx_generated_class_u1690959030053":{"background":"#9CDDDA","text-align":"center","justify-content":"center"}
                    ,"dhx_generated_class_u1690959030054":{"background":"#0696CA","text-align":"center","justify-content":"center"}}
                    ,"formats":[{"name":"Common","id":"common","mask":"","example":"1500.31"},{"name":"Number","id":"number","mask":"#,##0.00","example":"1500.31"}
                    ,{"name":"Percent","id":"percent","mask":"#,##0.00%","example":"15.0031"},{"name":"Currency","id":"currency","mask":"$#,##0.00","example":"1500.31"}
                    ,{"name":"Date","id":"date","mask":"yy-mm-dd","example":"2023-11-20","dateFormat":"%y/%m/%d"}
                    ,{"name":"Time","id":"time","mask":"h:mm:ss am/pm","example":"0.5625","timeFormat":12}
                    ,{"name":"Text","id":"text","mask":"@@","example":"some text"}]}`;

    $(document).ready(function () {
        GetUserInfo@(itemName)()

        let currentDate = new Date();
        Suites.DatePicker("txtEndDocDateQ@(itemName)", currentDate);
        currentDate.setDate(currentDate.getDate() - 7);
        Suites.DatePicker("txtStartDocDateQ@(itemName)", currentDate);
        Suites.DatePicker("txtDeliveryStartDateQ@(itemName)", $("#txtStartDocDateQ@(itemName)").val());
        Suites.DatePicker("txtDeliveryEndDateQ@(itemName)", $("#txtEndDocDateQ@(itemName)").val());    
        ComboBoxs.WithText("#cboRoErpPrefixQ@(itemName)", "@Url.Action("GetErpData", "BasicInformation")", { "UserNo": userNo@(itemName), "ColumnName": "RoErpPrefix" }, "", "NA", "", "RoErpPrefixName", "RoErpPrefix"); //入庫單單別
        ComboBoxs.Default("#cboCustomerIdQ@(itemName)", "@Url.Action("GetCustomer", "ScmBasicInformation")", { "Status": "A", "TransferStatus": "A" }, "", "ALL", "", "CustomerWithNo", "CustomerId");
        ComboBoxs.Default("#cboConfirmStatusQ@(itemName)", "@Url.Action("GetStatus", "BasicInformation")", { "StatusSchema": "ConfirmStatus" }, "", "NA", "", "StatusName", "StatusNo");
        ComboBoxs.Default("#cboTransferStatusMESQ@(itemName)", "@Url.Action("GetStatus", "BasicInformation")", { "StatusSchema": "ConfirmStatus" }, "", "NA", "", "StatusName", "StatusNo");
        ComboBoxs.Default("#cboSalesmenIdQ@(itemName)", "@Url.Action("GetUser", "BasicInformation")", { "CompanyId": companyId@(itemName), "Status": "A" }, "", "NA", "", "UserWithNo", "UserId"); //確認者
        ComboBoxs.Default("#cboDeliveryCustomerQ@(itemName)", "@Url.Action("GetCustomer", "ScmBasicInformation")", { "Status": "A", "TransferStatus": "A" }, "", "ALL", "", "CustomerWithNo", "CustomerId");

        if (!isMobile) {
            $("#cboRoErpPrefixQ@(itemName), #cboCustomerIdQ@(itemName), #cboSalesmenIdQ@(itemName), #cboConfirmStatusQ@(itemName), #cboTransferStatusMESQ@(itemName)").select2({
                dropdownAutoWidth: true,
                width: "100%"
            });
        }
        //日期更換
        $("#txtDocDate@(itemName)").on("change", function () {
            $("#txtReceiveDate@(itemName)").val($("#txtDocDate@(itemName)").val())
        })
        //幣別更換
        $("#cboCurrency@(itemName)").on("change", function () {
            Currency = $("#cboCurrency@(itemName)").val()
            GetExchangeRate($("#cboCurrency@(itemName)").val())
            AmountCalc(true, true, false, '')
        })
        //匯率更換
        $("#txtExchangeRate@(itemName)").on("change", function () {
            ExchangeRate = $("#txtExchangeRate@(itemName)").val()
            AmountCalc(true, true, false, '')
        })

        //銷貨單單別改變觸發
        $("#cboRoErpPrefix@(itemName)").on("change", function () {
            RoErpPrefix = $(this).val()

            let InvNumGenMethod;
            let targetUrl = "@Url.Action("GetRoErpPrefixSetting", "ReceiveOrder")";
            let postData = {
                "RoErpPrefix": RoErpPrefix
            };

            let data = DataAccess.Get(targetUrl, postData, false);

            if (data.status == "success") {
                $.each(data.result, function (i, item) {
                    InvNumGenMethod = item.InvNumGenMethod;
                });
                ComboBoxs.WithText("#cboInvNumGenMethod@(itemName)", "@Url.Action("GetStatus", "BasicInformation")", { "StatusSchema": "ReceiveOrder.InvNumGenMethod" }, InvNumGenMethod, "NA", "", "StatusName", "StatusNo");
                $("#cboInvNumGenMethod@(itemName)").val(InvNumGenMethod)
            }
            else {
                alert(data.msg, "alert", 0);
            }
        });

        //稅別碼改變觸發
        $("#cboTaxCode@(itemName)").on("change", function () {
            ComboBoxs.Default("#cboInvoiceType@(itemName)", "@Url.Action("GetErpData", "BasicInformation")", { "ColumnName": "InvoiceCount", "Condition": $("#cboTaxCode@(itemName)").val() }, "", "CHOOSE", "", "InvoiceCountName", "InvoiceCountNo");

            let taxation;
            let targetUrl = "@Url.Action("GetErpData", "BasicInformation")";
            let postData = {
                "ColumnName": "TaxNo",
                "Condition": $("#cboTaxCode@(itemName)").val()
            };

            let data = DataAccess.Get(targetUrl, postData, false);

            if (data.status == "success") {
                $.each(data.result, function (i, item) {
                    taxation = item.Taxation;
                    $("#txtTaxRate@(itemName)").val(parseFloat(item.BusinessTaxRate));
                });
                ComboBoxs.Default("#cboTaxType@(itemName)", "@Url.Action("GetType", "BasicInformation")", { "TypeSchema": "Customer.Taxation" }, taxation, "NA", "", "TypeName", "TypeNo");
                TaxType = $("#cboTaxType@(itemName)").val()
                AmountCalc(true, true, true, '')
            }
            else {
                alert(data.msg, "alert", 0);
            }
        });

        //客戶變化
        $("#cboCustomerId@(itemName)").change(function () {
            let dataset = JSON.parse(RoDetailTemplateDefault);
            spreadsheet@(itemName).parse(dataset);
            spreadsheetData@(itemName) = dataset;

            popViewOrderPage = {
                "pageIndex": 0,
                "pageSize": 10
            };
            let targetUrl = "@Url.Action("GetCustomer", "ScmBasicInformation")";
            let postData = {
                "CustomerId": $(this).val()
            };
            let data = DataAccess.Get(targetUrl, postData, false);

            if (data.status == "success") {
                if (data.result.length > 0) {
                    $.each(data.result, function (i, item) {
                        //稅別碼
                        ComboBoxs.WithText("#cboTaxCode@(itemName)", "@Url.Action("GetErpData", "BasicInformation")", { "ColumnName": "TaxNo" }, "", "NA", "", "TaxName", "TaxNo");
                        $("#cboTaxCode@(itemName)").val(item.TaxNo);

                        ComboBoxs.Default("#cboInvoiceType@(itemName)", "@Url.Action("GetErpData", "BasicInformation")", { "ColumnName": "InvoiceCount", "Condition": $("#cboTaxCode@(itemName)").val() }, "", "CHOOSE", "", "InvoiceCountName", "InvoiceCountNo");
                        let taxation;
                        let targetUrl = "@Url.Action("GetErpData", "BasicInformation")";
                        let postData = {
                            "ColumnName": "TaxNo",
                            "Condition": $("#cboTaxCode@(itemName)").val()
                        };
                        let data = DataAccess.Get(targetUrl, postData, false);
                        if (data.status == "success") {
                            $.each(data.result, function (i, item) {
                                taxation = item.Taxation;
                                $("#txtTaxRate@(itemName)").val(parseFloat(item.BusinessTaxRate));
                            });
                        }
                        ComboBoxs.Default("#cboTaxType@(itemName)", "@Url.Action("GetType", "BasicInformation")", { "TypeSchema": "Customer.Taxation" }, taxation, "NA", "", "TypeName", "TypeNo");

                        $("#txtUiNo@(itemName)").val(item.GuiNumber);

                        //交易幣別
                        ComboBoxs.WithText("#cboCurrency@(itemName)", "@Url.Action("GetErpData", "BasicInformation")", { "ColumnName": "Currency" }, "", "NA", "", "CurrencyName", "Currency");
                        $("#cboCurrency@(itemName)").val(item.Currency);

                        //付款條件
                        ComboBoxs.Default("#cboPaymentTerm@(itemName)", "@Url.Action("GetErpData", "BasicInformation")", { "ColumnName": "PaymentTerm" }, "", "NA", "", "PaymentTermName", "PaymentTermNo");
                        $("#cboPaymentTerm@(itemName)").val(item.PaymentTerm);

                        GetExchangeRate(item.Currency)
                        TaxType = $("#cboTaxType@(itemName)").val()
                        AmountCalc(true, true, true, '')
                    });
                }
            }
            else {
                alert(data.msg, "alert", 0);
            }
        });

        //部門改變觸發
        $("#cboDepartmentId@(itemName)").change(function () {
            ComboBoxs.Default("#cboSalesmenId@(itemName)", "@Url.Action("GetUser", "BasicInformation")", {"DepartmentId": $(this).val()}, "", "NA", "", "UserWithNo", "UserId");
        });

        //業務改變觸發
        $("#cboSalesmenId@(itemName)").change(function () {
            let targetUrl = "@Url.Action("GetUser", "BasicInformation")";
            let postData = {
                "UserId": $(this).val()
            };
            let data = DataAccess.Get(targetUrl, postData, false);

            if (data.status == "success") {
                if (data.result.length > 0) {
                    $.each(data.result, function (i, item) {
                        ComboBoxs.Default("#cboDepartmentId@(itemName)", "@Url.Action("GetDepartment", "BasicInformation")", { "CompanyId": companyId@(itemName), "Status": "A" }, item.DepartmentId, "NA", "", "DepartmentWithNo", "DepartmentId");
                    });
                }
            }
            else {
                alert(data.msg, "alert", 0);
            }

        });


        $("#cboSourceType@(itemName)").on("change", function () {
            GetSourceOrder(popViewOrderPage)
        })
        $("#cbxCashSales@(itemName), #cbxAttachInvWithShip@(itemName)").click(function () {
            alert("功能尚未開發");
            $(this).prop('checked', false); // 取消选中状态
            return
        });
        $("#cboDeliveryCustomerQ@(itemName)").select2({
                dropdownAutoWidth: true,
                width: "100%"
        });
        $("#cboPopSalesmenId@(itemName)").on("change", function () {
            let PopSalesmenId = $("#cboPopSalesmenId@(itemName)").val()
            let targetUrl = "@Url.Action("GetUser", "BasicInformation")";
            let postData = {
                "UserId": $(this).val()
            };
            let data = DataAccess.Get(targetUrl, postData, false);

            if (data.status == "success") {
                if (data.result.length > 0) {
                    $.each(data.result, function (i, item) {
                        $("#cboPopDeptId@(itemName)").val(item.DepartmentId).trigger("change.select2");
                    });

                    $("#cboPopCollectionSalesmenId@(itemName)").val(PopSalesmenId).trigger("change.select2");
                }
            }
            else {
                alert(data.msg, "alert", 0);
            }
            //GetDelivery@(itemName)()
        })
        $("#txtSearchKeyQ@(itemName)").on("change", function () {
            GetDelivery@(itemName)()
        })

        $("#txtSourceOrderFull@(itemName)").on("keydown", function (event) {
            if (event.key === "Enter") {
                event.preventDefault();
                return false;
            }
        });

        $("#txtSourceOrderFull@(itemName)").on("change", function () {
            popViewOrderPage.pageIndex = 0;
            GetSourceOrder(popViewOrderPage)
        })

        Query@(itemName)()
    });

    function Query@(itemName)() {
        objPage@(itemName).pageIndex = 0;
        InitData@(itemName)(objPage@(itemName));

        $("#modalQuery@(itemName)").modal("hide");
    }

    function InitData@(itemName)(objPage) {
        let innerHtml = '';
        let pageCount = 0;

        let targetUrl = "@Url.Action("GetReceiveOrder", "ReceiveOrder")";
        let postData = {
            "OrderBy": "",
            "PageIndex": (objPage.pageIndex + 1),
            "PageSize": objPage.pageSize,
            "RoErpPrefix": $("#cboRoErpPrefixQ@(itemName)").val(),
            "RoErpFullNo": $("#txtRoErpFullNoQ@(itemName)").val().trim(),
            "CustomerId": $("#cboCustomerIdQ@(itemName)").val(),
            "SalesmenId": $("#cboSalesmenIdQ@(itemName)").val(),
            "StartDocDate": ($("#cbxDocDateQ@(itemName)").is(":checked") ? $("#txtStartDocDateQ@(itemName)").val() : ""),
            "EndDocDate": ($("#cbxDocDateQ@(itemName)").is(":checked") ? $("#txtEndDocDateQ@(itemName)").val() : ""),
            "ConfirmStatus": $("#cboConfirmStatusQ@(itemName)").val(),
            "TransferStatusMES": $("#cboTransferStatusMESQ@(itemName)").val()
        };

        let data = DataAccess.Get(targetUrl, postData, false);

        if (data.status == "success") {
            pageCount = data.result.length > 0 ? parseInt(data.result[0]["TotalCount"]) : 0;

            if (pageCount > 0) {
                objPage = PageCaculate(pageCount, objPage);

                $.each(data.result, function (i, item) {
                    let _row = (objPage.pageSize * objPage.pageIndex + (i + 1)) + ".";
                    let TransferStatusMES;
                    switch (item.TransferStatusMES) {
                        case "N":
                            TransferStatusMES = "未拋轉"
                            break
                        case "R":
                            TransferStatusMES = "重新編輯中"
                            break
                        case "Y":
                            TransferStatusMES = "已拋轉"
                            break
                        case "V":
                            TransferStatusMES = "作廢"
                            break
                    }
                    innerHtml += `<tr>
                                        <td>${_row}</td>
                                        <td class="ellipsis" data-toggle="tooltip" title="${item.RoErpFullNo}" style="max-width: 200px;">${item.RoErpFullNo} ${item.ConfirmStatus == `Y` ? `${ErpDocStatus(item.ConfirmStatus)}` : item.ConfirmStatus == `V` ?`(廢)`:``}</td>
                                        <td class="ellipsis" data-toggle="tooltip" title="${item.DocDate}" style="max-width: 200px;">${item.DocDate}</td>
                                        <td class="ellipsis" data-toggle="tooltip" title="${item.CustomerName}" style="max-width: 200px;">${item.CustomerName}</td>
                                        <td class="ellipsis" data-toggle="tooltip" title="${item.SalesmenName}" style="max-width: 200px;">${item.SalesmenName != null ? item.SalesmenName :`尚未維護` }</td>
                                        <td class="ellipsis" data-toggle="tooltip" title="${item.TransferStatusMES}" style="max-width: 200px;">${TransferStatusMES}</td>
                                        <td class="ellipsis" data-toggle="tooltip" title="${item.ConfirmUserName}" style="max-width: 200px;">${item.ConfirmUserName != null ? item.ConfirmUserName : `尚未確認` }</td>
                                        <td class="text-center active-content">
                                          <div class="btn-group mb-4 show" style="margin-bottom: 0 !important; position: static;">
                                            <button type="button" class="btn btn-primary dropdown-toggle" data-ro-id="${item.RoId}" style="padding-top: 0; padding-bottom: 0;">動作</button>
                                            <div class="dropdown-menu btn-text-left-block" data-ro-id="${item.RoId}" style="overflow-y: auto; z-index: 999; max-height: 150px;">
                                              ${item.TransferStatusMES == `Y` ? `<a class="dropdown-item btn-text-left auth-update" href="javascript:Edit@(itemName)(${item.RoId});" ><i class="fas fa-eye"></i>查看</a>` : ``}
                                              ${item.TransferStatusMES != `Y` ? `<a class="dropdown-item btn-text-left auth-update" href="javascript:Edit@(itemName)(${item.RoId});" ><i class="fas fa-edit"></i>修改</a>` : ``}
                                              ${item.TransferStatusMES == `N` && item.ConfirmStatus == `N` ? `<a class="dropdown-item btn-text-left auth-delete" href="javascript:Delete@(itemName)(${item.RoId});" ><i class="fas fa-trash-alt"></i>刪除</a>` : ``}
                                              ${(item.TransferStatusMES == `N` || item.TransferStatusMES == `R`) && item.ConfirmStatus == `N` ? `<a class="dropdown-item btn-text-left auth-import" href="javascript:Import@(itemName)(${item.RoId});" ><i class="fas fa-upload"></i><span>拋轉</span></a>` : item.TransferStatusMES == `Y` && item.ConfirmStatus == `N` ? `<a class="dropdown-item btn-text-left auth-import" href="javascript:Revise@(itemName)(${item.RoId});" ><i class="fas fa-reply-all"></i><span>回歸</span></a>` : ``}
                                              ${item.TransferStatusMES == `Y` && item.ConfirmStatus == `N` ? `<a class="dropdown-item btn-text-left auth-confirm" href="javascript:Confirm@(itemName)(${item.RoId});" ><i class="fas fa-check-circle"></i>確認</a>` : ``}
                                              ${item.ConfirmStatus == `Y` ? `<a class="dropdown-item btn-text-left auth-reconfirm" href="javascript:ReConfirm@(itemName)(${item.RoId});" ><i class="fas fa-undo-alt"></i>反確認</a>` : ``}
                                              ${item.TransferStatusMES == `Y` && item.ConfirmStatus == `N` ? `<a class="dropdown-item btn-text-left auth-void" href="javascript:Void@(itemName)(${item.RoId});" ><i class="fas fa-ban"></i>作廢</a>` : ``}
                                              ${item.TransferStatus == `Y` ? `<a class="dropdown-item btn-text-left auth-doc-download" href="javascript:PopSoWord@(itemName)(${item.RoId});" ><i class="fas fa-file-download"></i>單據下載</a>` : ``}
                                            </div>
                                          </div>
                                        </td>
                                        <td style="padding: 0;">
                                          <table class="table table-bordered table-sm mb-0 table-non-rwd table-striped-custom table-row-detail">
                                            <tbody>
                                              ${DetailData@(itemName)(item.Currency, item.RoDetail)}
                                            </tbody>
                                          </table>
                                        </td>
                                      </tr>`;
                });
            } else {
                innerHtml += `<tr>
                                    <td class="text-center" colspan="8" style="background-color: #fff3cd;">
                                      <i class="fal fa-exclamation-circle"></i>&nbsp;目前尚無資料。
                                    </td>
                                  </tr>`;
            }
        } else {
            alert(data.msg, "alert", 0);
        }

        $("#tblData@(itemName) tbody").html(innerHtml);
        TableComponentInit();
        Pager("#page@(itemName)", pageCount, objPage, InitData@(itemName));

        $(".dropdown-toggle").off("click").on("click", function () {
            let roId = $(this).data("ro-id");

            if ($(`.dropdown-menu[data-ro-id='${roId}']`).hasClass("show")) {
                $(".dropdown-menu").removeClass("show");
            } else {
                $(".dropdown-menu").removeClass("show");

                $(`.dropdown-menu[data-ro-id='${roId}']`).addClass("show");
                $(`.dropdown-menu[data-ro-id='${roId}']`).css({
                    top: `${$(this).position().top + $(this).height() + 5}px`,
                    left: `${$(this).position().left - $(this).width() + 38}px`
                });
            }
        });

        $("body").off("click").on("click", function (e) {
            if ($(".dropdown-menu").hasClass("show")) {
                if (!$(e.target).hasClass("dropdown-toggle")
                    && !$(e.target).parents().hasClass("dropdown-toggle")) {
                    $(".dropdown-menu").removeClass("show");
                }
            }
        });
    }

    function DetailData@(itemName)(currency, source){
        let html = '';

        if (source) {
            let json = JSON.parse(source);

            for (let x = 0; x < json.data.length; x++) {
                let TypeName;
                switch (json.data[x].Type) {
                    case "1":
                        TypeName = "贈品量"
                        break
                    case "2":
                        TypeName = "備品量"
                        break
                }
                html += `<tr>
                            <td style="width: 100px; max-width: 100px;">${json.data[x].RoSequence}</td>
                            <td style="width: 175px; max-width: 175px;" class="ellipsis" data-toggle="tooltip" title="${json.data[x].MtlItemNo}">${json.data[x].MtlItemNo}</td>
                            <td style="width: 175px; max-width: 175px;" class="ellipsis" data-toggle="tooltip" title="${json.data[x].MtlItemName}">${json.data[x].MtlItemName}</td>
                            <td style="width: 175px; max-width: 175px;" class="ellipsis" data-toggle="tooltip" title="${json.data[x].InventoryNo}">${json.data[x].InventoryNo}</td>
                            <td style="width: 120px; max-width: 120px;">${json.data[x].Quantity.toLocaleString(`en`)}</td>
                            <td style="width: 175px; max-width: 100px;" class="ellipsis" data-toggle="tooltip" title="${TypeName}">${TypeName}</td>
                            <td style="width: 120px; max-width: 120px;">${json.data[x].FreeSpareQty.toLocaleString(`en`)}</td>
                            <td style="width: 100px; max-width: 100px;">${json.data[x].AvailableQty.toLocaleString(`en`)}</td>
                            <td style="width: 100px; max-width: 100px;">${json.data[x].UnitPrice.toLocaleString(`en`)}</td>
                            <td style="width: 100px; max-width: 100px;">${json.data[x].Amount.toLocaleString(`en`)}</td>
                            <td style="width: 100px; max-width: 100px;">${currency}</td>
                            <td style="width: 220px; max-width: 220px;" class="ellipsis" data-toggle="tooltip" title="${json.data[x].SoFullNo}">${json.data[x].SoFullNo}</td>
                            <td style="width: 220px; max-width: 220px;" class="ellipsis" data-toggle="tooltip" title="${json.data[x].TsnFullNo}">${json.data[x].TsnFullNo}</td>
                            <td style="width: 220px; max-width: 220px;" class="ellipsis" data-toggle="tooltip" title="${json.data[x].LotNumber}">${json.data[x].LotNumber}</td>
                            </tr>`;
            }
        }

        return html;
    }

    function Edit@(itemName)(RoId) {
        $("#RoId").val(RoId ? RoId : 0);
        Switch("#editData@(itemName), .unit-block", "#listData@(itemName)");
        $(".advanced-block").slideDown("slow");
        ResetSpreadsheet@(itemName)();

        spreadsheet@(itemName).clear();
        GetRoDetailExcel@(itemName)()

        // 單元格-值改變觸發
        spreadsheet@(itemName).events.on("afterValueChange", function (cell) {
            var row = cell.substr(1);
            //品號清空就刪除改row
            if (cell.split('')[0] == "B" && row > 1) {
                var MtlItemNo = spreadsheet@(itemName).getValue("B" + row)
                if (!!!MtlItemNo) {
                    spreadsheet@(itemName).deleteRow("B" + row);
                }
            }
        });

        //單元格-選擇後設定
        spreadsheet@(itemName).events.on("afterSelectionSet", function (cell) {
            let row = cell.substr(1);
            if (cell.split('')[0] == "X" && row > 1) {
                // 開啟批號視窗
                let MtlItemNo = spreadsheet@(itemName).getValue("B" + row)
                let LotManagement = spreadsheet@(itemName).getValue("AG" + row)

                if (!!MtlItemNo && LotManagement != "N") {
                    let InventoryNo = spreadsheet@(itemName).getValue("E" + row).split(":")[0]
                    $("#selectLotManagement@(itemName)").modal("show");
                    $("#desMtlItemNo@(itemName)").text(MtlItemNo)
                    GetLotManagement(MtlItemNo, InventoryNo, row)
                }
            }
        });

        //單元格-焦點設定前
        let OreUomNo
        spreadsheet@(itemName).events.on("afterEditStart", function (cell) {
            let row = cell.substr(1);
            if (cell.split('')[0] == "N" && row > 1) {
                let AvailableUomNo = spreadsheet@(itemName).getValue("N" + row)
                OreUomNo = AvailableUomNo
            }
        });
        //單元格-編輯結束後
        spreadsheet@(itemName).events.on("afterEditEnd", function (cell) {
            let row = cell.substr(1);
            let column = cell.split('')[0];
            let ChangeStatus = false;
            let Inventory
            let LocationArr
            let OrigTaxAmt
            let Qty
            let Amount
            let PreTaxAmt
            let OrigPreTaxAmt
            let TaxAmt
            if (row > 1) {
                let MtlItemNo = spreadsheet@(itemName).getValue("B" + row)
                if (!!!MtlItemNo) {
                    alert("該列尚無品號,不能異動")
                    spreadsheet@(itemName).setValue(cell,"")
                    return
                }
                switch (column) {
                    case "E":
                        //庫別改變
                        Inventory = spreadsheet@(itemName).getValue("E" + row)
                        LocationArr = GetInventory("CMSNL", Inventory.split(':')[0])
                        spreadsheet@(itemName).setValidation(`G` + row, LocationArr)
                        spreadsheet@(itemName).setValue(`G` + row, "")//儲位
                        break;
                    case "I":
                        //數量改變
                        Qty = spreadsheet@(itemName).getValue("I" + row)
                        CalcQty(MtlItemNo, row, false)
                        AmountCalc(true, true, false, row)
                        break;
                    case "K":
                        //贈/備品量
                        AmountCalc(false, true, true, row)
                        break;
                    case "M":
                        //計價數量改變
                        AmountCalc(true, true, false, row)
                        break;
                    case "L":
                    case "N":
                        //計價單位改變
                        CalcQty(MtlItemNo, row,true)
                        AmountCalc(true, true, false, row)
                        break;
                    case "O":
                        //單價改變
                        let UnitPrice = spreadsheet@(itemName).getValue("O" + row)
                        let OrpExponent = Math.log(decimalOrPrice) / Math.log(10);
                        UnitPrice = (Math.round(UnitPrice * decimalOrPrice) / decimalOrPrice).toFixed(OrpExponent)
                        spreadsheet@(itemName).setValue(`O` + row, UnitPrice)
                        AmountCalc(true, true, false, row)
                        break;
                    case "Q":
                        //折扣率改變
                        AmountCalc(true, true, false, row)
                        break;
                    case "R":
                        //金額改變
                        AmountCalc(true, true, true, row)
                        break;
                    case "T":
                        //原幣稅額
                        Amount = spreadsheet@(itemName).getValue("R" + row)
                        OriginalTaxAmount = spreadsheet@(itemName).getValue("T" + row)

                        switch (TaxType) {
                            case "1": //內含
                                OriginalAmount = Amount - OriginalTaxAmount
                                spreadsheet@(itemName).unlock("S" + row);
                                spreadsheet@(itemName).setValue(`S` + row, OriginalAmount)//原幣未稅金額
                                spreadsheet@(itemName).lock("S" + row);
                                break;
                            case "2": //外加
                            default:
                                break;
                        }

                        AmountCalc(false, true, true, row)
                        break;
                    case "U":
                        //本幣未稅金額
                        AmountCalc(false, true, true, row)
                        break;
                    case "V":
                        //本幣稅額
                        Amount = spreadsheet@(itemName).getValue("R" + row)
                        TaxAmount = spreadsheet@(itemName).getValue("V" + row)
                        switch (TaxType) {
                            case "1": //內含
                                PretaxAmount = Amount * ExchangeRate - TaxAmount
                                spreadsheet@(itemName).setValue(`U` + row, PretaxAmount)//本幣未稅金額

                                AmountCalc(false, true, true, row)
                                break;
                            case "2": //外加
                            default:
                                AmountCalc(false, true, true, row)
                                break;
                        }
                        break;
                }
            }
        });

        //點擊觸發
        spreadsheet@(itemName).toolbar.events.on("click", function (id) {
            if (id == "Delete") {
                DeleteExcelData@(itemName)();
            }
        });

        //開單日預設今日
        let currentDate = new Date();
        Suites.DatePicker("txtDocDate@(itemName)", currentDate);
        Suites.DatePicker("txtReceiveDate@(itemName)", currentDate);
        let Today = new Date();
        $("#txtApplyYYMM@(itemName)").val(Today.getFullYear().toString() + "-" + ((Today.getMonth() + 1)).toString().padStart(2, '0'));

        $("#SaveButton").show()//儲存按鈕顯示
        $("#Import").hide()
        $("#Revise").hide()
        $("#Confirm").hide()
        $("#ReConfirm").hide()
        $("#Void").hide()

        $("#txtReceiveDate@(itemName)").attr("disabled", true);
        $("#cboRoErpPrefix@(itemName)").attr("disabled", false);
        $("#txtRoErpNo@(itemName)").attr("disabled", true);
        $("#cboCustomerId@(itemName)").attr("disabled", false);
        $("#txtSelectOrder@(itemName)").attr("disabled", true);
        $("#cboSourceTypeMain@(itemName)").attr("disabled", true);
        $("#cboPriceSourceTypeMain@(itemName)").attr("disabled", true);
        $("#txtProcessCode@(itemName)").attr("disabled", true);
        $("#cboConfirmStatus@(itemName)").attr("disabled", true);
        $("#cboConfirmUserId@(itemName)").attr("disabled", true);

        $("#txtOriginalAmount@(itemName)").attr("disabled", true);
        $("#txtOriginalTaxAmount@(itemName)").attr("disabled", true);
        $("#txtOriginalAmountSum@(itemName)").attr("disabled", true);
        $("#txtPretaxAmount@(itemName)").attr("disabled", true);
        $("#txtTaxAmount@(itemName)").attr("disabled", true);
        $("#txtPretaxAmountSum@(itemName)").attr("disabled", true);
        $("#txtTotalQuantity@(itemName)").attr("disabled", true);

        $("#cboInvoiceType@(itemName)").attr("disabled", true);
        $("#cboTaxType@(itemName)").attr("disabled", true);
        $("#txtTaxRate@(itemName)").attr("disabled", true);
        $("#cboTatxtTaxRatexType@(itemName)").attr("disabled", true);
        $("#cboInvNumGenMethod@(itemName)").attr("disabled", true);
        $("#txtInvNumEnd@(itemName)").attr("disabled", true);
        $("#cboCurrency@(itemName)").attr("disabled", false);

        $("#txtNewRoFull@(itemName)").attr("disabled", true);
        $("#txtShipNoticeFull@(itemName)").attr("disabled", true);

        $("#txtAdvOrderFull@(itemName)").attr("disabled", true);
        $("#txtDispatchOrderFull@(itemName)").attr("disabled", true);
        $("#txtCarNumber@(itemName)").attr("disabled", true);
        $("#txtTrainNumber@(itemName)").attr("disabled", true);
        $("#txtDeliveryUserName@(itemName)").attr("disabled", true);

        $("#cboCourier@(itemName)").attr("disabled", true);
        $("#txtSiteCommCalcMethod@(itemName)").attr("disabled", true);
        $("#txtSiteCommRate@(itemName)").attr("disabled", true);
        $("#txtTotalCommAmount@(itemName)").attr("disabled", true);

        $("#cbxRevenueJournalCode@(itemName)").attr("disabled", true);
        $("#cbxNoCredLimitControl@(itemName)").attr("disabled", true);
        $("#cbxCostJournalCode@(itemName)").attr("disabled", true);
        $("#cbxCashSales@(itemName)").attr("disabled", false); //現銷
        $("#cbxMultipleInvoices@(itemName)").attr("disabled", true);
        $("#cbxMultiTaxRate@(itemName)").attr("disabled", true);
        $("#cbxAttachInvWithShip@(itemName)").attr("disabled", false); //隨貨附發票
        $("#cbxInvoicesVoid@(itemName)").attr("disabled", true);
        $("#cbxChangeInvCode@(itemName)").attr("disabled", true);
        $("#cbxDepositBatches@(itemName)").attr("disabled", true);
        $("#cbxCommCalcInclTax@(itemName)").attr("disabled", true);

        //單別選單
        ComboBoxs.WithText("#cboRoErpPrefix@(itemName)", "@Url.Action("GetErpData", "BasicInformation")", { "UserNo": userNo@(itemName), "ColumnName": "RoErpPrefix" }, "", "NA", "", "RoErpPrefixName", "RoErpPrefix");
        //客戶選單
        ComboBoxs.Default("#cboCustomerId@(itemName)", "@Url.Action("GetCustomer", "ScmBasicInformation")", { "Status": "A", "TransferStatus": "A" }, "", "NA", "", "CustomerWithNo", "CustomerId");
        //複製來源
        ComboBoxs.Default("#cboSourceTypeMain@(itemName)", "@Url.Action("GetType", "BasicInformation")", { "TypeSchema": "ReceiveOrder.SourceType" }, "", "NA", "", "TypeName", "TypeNo");
        //銷貨單價來源
        ComboBoxs.Default("#cboPriceSourceTypeMain@(itemName)", "@Url.Action("GetType", "BasicInformation")", { "TypeSchema": "ReceiveOrder.SourceType" }, "", "NA", "", "TypeName", "TypeNo");
        //部門選單
        ComboBoxs.Default("#cboDepartmentId@(itemName)", "@Url.Action("GetDepartment", "BasicInformation")", { "CompanyId": companyId@(itemName), "Status": "A" }, "", "NA", "", "DepartmentWithNo", "DepartmentId");
        //出貨廠別選單
        ComboBoxs.WithText("#cboFactory@(itemName)", "@Url.Action("GetErpData", "BasicInformation")", { "ColumnName": "Factory" }, "", "CHOOSE", "", "FactoryName", "Factory");
        //付款條件選單
        ComboBoxs.WithText("#cboPaymentTerm@(itemName)", "@Url.Action("GetErpData", "BasicInformation")", { "ColumnName": "PaymentTerm" }, "", "NA", "", "PaymentTermName", "PaymentTermNo");
        //交易條件選單
        ComboBoxs.WithText("#cboTradingTerms@(itemName)", "@Url.Action("GetErpData", "BasicInformation")", { "ColumnName": "TradeTerm" }, "", "NA", "", "TradeTermName", "TradeTermNo");
        //幣別選單
        ComboBoxs.WithText("#cboCurrency@(itemName)", "@Url.Action("GetErpData", "BasicInformation")", { "ColumnName": "Currency" }, "", "NA", "", "CurrencyName", "Currency");
        //保稅選單
        ComboBoxs.WithText("#cboBondCode@(itemName)", "@Url.Action("GetStatus", "BasicInformation")", { "StatusSchema": "ReceiveOrder.BondCode" }, "", "CHOOSE", "", "StatusName", "StatusNo");
        //確認碼
        ComboBoxs.Default("#cboConfirmStatus@(itemName)", "@Url.Action("GetStatus", "BasicInformation")", { "StatusSchema": "ConfirmStatus" }, "", "NA", "", "StatusName", "StatusNo");
        //稅別碼選單
        ComboBoxs.WithText("#cboTaxCode@(itemName)", "@Url.Action("GetErpData", "BasicInformation")", { "ColumnName": "TaxNo" }, "", "NA", "", "TaxName", "TaxNo");
        //發票聯數選單
        ComboBoxs.WithText("#cboInvoiceType@(itemName)", "@Url.Action("GetErpData", "BasicInformation")", { "ColumnName": "InvoiceType" }, "", "NA", "", "InvoiceCountName", "InvoiceCountNo");
        //課稅別選單
        ComboBoxs.WithText("#cboTaxType@(itemName)", "@Url.Action("GetType", "BasicInformation")", { "TypeSchema": "Customer.Taxation" }, "", "NA", "", "TypeName", "TypeNo");
        //發票產生方式
        ComboBoxs.WithText("#cboInvNumGenMethod@(itemName)", "@Url.Action("GetStatus", "BasicInformation")", { "StatusSchema": "ReceiveOrder.InvNumGenMethod" }, "", "NA", "", "StatusName", "StatusNo");
        //通關方式
        ComboBoxs.WithText("#cboCustomsClearance@(itemName)", "@Url.Action("GetStatus", "BasicInformation")", { "StatusSchema": "ReceiveOrder.CustomsClearance" }, "", "NA", "", "StatusName", "StatusNo");
        //運輸方式
        ComboBoxs.WithText("#cboTransportMethod@(itemName)", "@Url.Action("GetErpData", "BasicInformation")", { "ColumnName": "ShipMethod" }, "", "NA", "", "ShipMethodName", "ShipMethodNo");
        //業務選單,收款業務選單

        //業務選單,收款業務選單
        if (RoId > 0) {
            ComboBoxs.Default("#cboSalesmenId@(itemName), #cboConfirmUserId@(itemName), #cboStaffId@(itemName), #cboCollectionSalesmenId@(itemName)", "@Url.Action("GetUser", "BasicInformation")", { "CompanyId": companyId@(itemName)}, "", "NA", "", "UserWithNo", "UserId");
        }
        else {
            ComboBoxs.Default("#cboSalesmenId@(itemName), #cboConfirmUserId@(itemName), #cboStaffId@(itemName), #cboCollectionSalesmenId@(itemName)", "@Url.Action("GetUser", "BasicInformation")", {"CompanyId": companyId@(itemName), "Status": "A"}, "", "NA", "", "UserWithNo", "UserId");
        }
        //員工選單
        //ComboBoxs.Default("#cboStaffId@(itemName)", "@Url.Action("GetUser", "BasicInformation")", {}, "", "NA", "", "UserWithNo", "UserId"); //業務
        //代送商選單

        if (!isMobile) {
            $(`#cboRoErpPrefix@(itemName), #cboCustomerId@(itemName), #cboDepartmentId@(itemName), #cboFactory@(itemName), #cboPaymentTerm@(itemName), #cboTradingTerms@(itemName)
             , #cboCurrency@(itemName), #cboBondCode@(itemName), #cboConfirmStatus@(itemName), #cboTaxCode@(itemName), #cboInvoiceType@(itemName), #cboInvNumGenMethod@(itemName)
             , #cboCustomsClearance@(itemName), #cboTaxType@(itemName), #cboSalesmenId@(itemName), #cboConfirmUserId@(itemName), #cboStaffId@(itemName), #cboCollectionSalesmenId@(itemName), #cboTransportMethod@(itemName)`
             ).select2({
                dropdownAutoWidth: true,
                width: "100%"
            });
        }


        if (RoId > 0) {
            $("#cboRoErpPrefix@(itemName)").attr("disabled", true);
            
            let targetUrl = "@Url.Action("GetReceiveOrder", "ReceiveOrder")";
            let postData = {
                "RoId": RoId
            };

            let data = DataAccess.Get(targetUrl, postData, false);

            if (data.status == "success") {
                $.each(data.result, function (i, item) {
                    $("#TransferStatusMES").val(item.TransferStatusMES)
                    if (item.TransferStatusMES != "N") {
                        $("#cboCustomerId@(itemName)").attr("disabled", true);
                    }
                    else {
                        $("#cboCustomerId@(itemName)").attr("disabled", false);
                    }
                    switch (item.TransferStatusMES) {
                        case "N":
                        case "R":
                            $("#SaveButton").show()
                            $("#Import").show()
                            $("#Revise").hide()
                            $("#Confirm").hide()
                            $("#ReConfirm").hide()
                            if (item.TransferStatusMES == "R") {
                                $("#Void").show()
                            }
                            else {
                                $("#Void").hide()
                            }
                            break;
                        case "Y":
                            $("#SaveButton").hide()
                            $("#Import").hide()
                            $("#Revise").show()
                            $("#Void").show()
                            if (item.ConfirmStatus == "Y") {
                                $("#Revise").hide()
                                $("#Confirm").hide()
                                $("#ReConfirm").show()
                                $("#Void").hide()
                            }
                            else if (item.ConfirmStatus == "V") {
                                $("#SaveButton").hide()
                                $("#Import").hide()
                                $("#Revise").hide()
                                $("#Confirm").hide()
                                $("#ReConfirm").hide()
                                $("#Void").hide()
                            }
                            else {
                                $("#Confirm").show()
                                $("#ReConfirm").hide()
                                $("#Void").show()
                            }
                            break;
                        case "V":
                            $("#SaveButton").hide()
                            $("#Import").hide()
                            $("#Revise").hide()
                            $("#Confirm").hide()
                            $("#ReConfirm").hide()
                            $("#Void").hide()
                            break;

                    }

                    //單頭主資料
                    RoErpPrefix = item.RoErpPrefix;
                    $("#txtDocDate@(itemName)").val(item.DocDate);
                    $("#txtReceiveDate@(itemName)").val(item.ReceiveDate);
                    $("#cboRoErpPrefix@(itemName)").val(item.RoErpPrefix).trigger("change.select2");
                    $("#txtRoErpNo@(itemName)").val(item.RoErpNo);
                    $("#cboCustomerId@(itemName)").val(item.CustomerId).trigger("change.select2");
                    $("#txtProcessCode@(itemName)").val(item.ProcessCode);
                    item.RevenueJournalCode == "Y" ? $("#cbxRevenueJournalCode@(itemName)").attr("checked", true) : $("#cbxRevenueJournalCode@(itemName)").attr("checked", false)
                    item.CostJournalCode == "Y" ? $("#cbxCostJournalCode@(itemName)").attr("checked", true) : $("#cbxCostJournalCode@(itemName)").attr("checked", false)
                    item.NoCredLimitControl == "Y" ? $("#cbxNoCredLimitControl@(itemName)").attr("checked", true) : $("#cbxNoCredLimitControl@(itemName)").attr("checked", false)
                    item.CashSales == "Y" ? $("#cbxCashSales@(itemName)").attr("checked", true) : $("#cbxCashSales@(itemName)").attr("checked", false)
                    $("#cboSourceTypeMain@(itemName)").val(item.SourceType).trigger("change.select2");
                    $("#cboPriceSourceTypeMain@(itemName)").val(item.PriceSourceTypeMain).trigger("change.select2");
                    $("#txtSelectOrder@(itemName)").val(item.SourceFull);
                    $("#SourceOrderId@(itemName)").val(item.SourceOrderId);

                    //金錢資料
                    //$("#txtOriginalAmount@(itemName)").val(item.OriginalAmount);
                    //$("#txtOriginalTaxAmount@(itemName)").val(item.OriginalTaxAmount);
                    //$("#txtOriginalAmountSum@(itemName)").val(item.SourceOrderId);
                    //$("#txtPretaxAmount@(itemName)").val(item.PretaxAmount);
                    //$("#txtTaxAmount@(itemName)").val(item.TaxAmount);
                    //$("#txtPretaxAmountSum@(itemName)").val(item.SourceOrderId);

                    //交易資料
                    $("#cboDepartmentId@(itemName)").val(item.DepartmentId).trigger("change.select2");
                    $("#cboSalesmenId@(itemName)").val(item.SalesmenId).trigger("change.select2");
                    $("#cboFactory@(itemName)").val(item.Factory).trigger("change.select2");
                    $("#cboPaymentTerm@(itemName)").val(item.PaymentTerm).trigger("change.select2");
                    $("#cboTradingTerms@(itemName)").val(item.TradingTerms).trigger("change.select2");
                    $("#cboCurrency@(itemName)").val(item.Currency).trigger("change.select2");
                    $("#txtExchangeRate@(itemName)").val(item.ExchangeRate);
                    $("#txtTotalQuantity@(itemName)").val(item.ExchangeRate);

                    $("#cboBondCode@(itemName)").val(item.BondCode).trigger("change.select2");
                    $("#txtRowCnt@(itemName)").val(item.RowCnt);
                    $("#cboConfirmStatus@(itemName)").val(item.ConfirmStatus).trigger("change.select2");
                    $("#cboConfirmUserId@(itemName)").val(item.ConfirmUserId).trigger("change.select2");
                    $("#txtRemark@(itemName)").val(item.Remark);

                    //送貨資料
                    $("#txtCustomerFullName@(itemName)").val(item.CustomerFullName);
                    $("#txtContactPerson@(itemName)").val(item.ContactPerson);
                    $("#txtCustomerAddressFirst@(itemName)").val(item.CustomerAddressFirst);
                    $("#txtTelephoneNumber@(itemName)").val(item.TelephoneNumber);
                    $("#txtCustomerAddressSecond@(itemName)").val(item.CustomerAddressSecond);
                    $("#txtFaxNumber@(itemName)").val(item.FaxNumber);

                    //發票資料(一)
                    $("#cboTaxCode@(itemName)").val(item.TaxCode).trigger("change.select2");

                    $("#cboInvoiceType@(itemName)").val(item.InvoiceType).trigger("change.select2");
                    $("#cboTaxType@(itemName)").val(item.TaxType).trigger("change.select2");
                    $("#txtTaxRate@(itemName)").val(item.TaxRate);
                    $("#cboInvNumGenMethod@(itemName)").val(item.InvNumGenMethod).trigger("change.select2");
                    $("#txtUiNo@(itemName)").val(item.UiNo);
                    $("#txtInvoiceDate@(itemName)").val(item.InvoiceDate);
                    $("#txtInvoiceTime@(itemName)").val(item.InvoiceTime);
                    $("#txtInvNumStart@(itemName)").val(item.InvNumStart);
                    $("#txtInvNumEnd@(itemName)").val(item.InvNumEnd);
                    $("#txtApplyYYMM@(itemName)").val(item.ApplyYYMM);
                    $("#cboCustomsClearance@(itemName)").val(item.CustomsClearance).trigger("change.select2");
                    $("#txtCustomerFullNameOre@(itemName)").val(item.CustomerFullName);
                    $("#txtInvoiceAddressFirst@(itemName)").val(item.InvoiceAddressFirst);
                    $("#txtCustomerEgFullName@(itemName)").val(item.CustomerEgFullName);
                    $("#txtInvoiceAddressSecond@(itemName)").val(item.InvoiceAddressSecond);
                    item.MultipleInvoices == "Y" ? $("#cbxMultipleInvoices@(itemName)").attr("checked", true) : $("#cbxMultipleInvoices@(itemName)").attr("checked", false)
                    item.MultiTaxRate == "Y" ? $("#cbxMultiTaxRate@(itemName)").attr("checked", true) : $("#cbxMultiTaxRate@(itemName)").attr("checked", false)
                    item.AttachInvWithShip == "Y" ? $("#cbxAttachInvWithShip@(itemName)").attr("checked", true) : $("#cbxAttachInvWithShip@(itemName)").attr("checked", false)
                    item.InvoicesVoid == "Y" ? $("#cbxInvoicesVoid@(itemName)").attr("checked", true) : $("#cbxInvoicesVoid@(itemName)").attr("checked", false)

                    //發票資料(二)
                    $("#txtVehicleTypeNumber@(itemName)").val(item.VehicleTypeNumber);
                    $("#txtInvDonationRecipient@(itemName)").val(item.InvDonationRecipient);
                    $("#txtVehicleIDshow@(itemName)").val(item.VehicleIDshow);
                    $("#txtVehicleIDhide@(itemName)").val(item.VehicleIDhide);
                    $("#txtCreditCard4No@(itemName)").val(item.CreditCard4No);
                    $("#txtInvRandomCode@(itemName)").val(item.InvRandomCode);
                    $("#txtContactEmail@(itemName)").val(item.ContactEmail);

                    //其他資料
                    $("#cboStaffId@(itemName)").val(item.StaffId).trigger("change.select2");
                    $("#cboCollectionSalesmenId@(itemName)").val(item.CollectionSalesmenId).trigger("change.select2");
                    $("#txtRemark1@(itemName)").val(item.Remark1);
                    $("#txtRemark2@(itemName)").val(item.Remark2);
                    $("#txtRemark3@(itemName)").val(item.Remark3);
                    $("#txtLCNO@(itemName)").val(item.txtLCNO);
                    $("#txtInvoiceNO@(itemName)").val(item.InvoiceNO);
                    $("#txtDeclarationNumber@(itemName)").val(item.DeclarationNumber);
                    $("#txtNewRoFull@(itemName)").val(item.NewRoFull);
                    $("#txtShipNoticeFull@(itemName)").val(item.ShipNoticeFull);
                    item.ChangeInvCode == "Y" ? $("#cbxChangeInvCode@(itemName)").attr("checked", true) : $("#cbxChangeInvCode@(itemName)").attr("checked", false)
                    item.MultiTaxRate == "Y" ? $("#cbxMultiTaxRate@(itemName)").attr("checked", true) : $("#cbxMultiTaxRate@(itemName)").attr("checked", false)

                    //訂金/派車資料
                    $("#txtSoFull@(itemName)").val(item.SoFull);
                    $("#txtAdvOrderFull@(itemName)").val(item.AdvOrderFull);
                    $("#txtOffsetAmount@(itemName)").val(item.OffsetAmount);
                    $("#txtOffsetTaxAmount@(itemName)").val(item.OffsetTaxAmount);
                    $("#cboTransportMethod@(itemName)").val(item.TransportMethod).trigger("change.select2");
                    $("#txtDispatchOrderFull@(itemName)").val(item.DispatchOrderFull);
                    $("#txtCarNumber@(itemName)").val(item.CarNumber);
                    $("#txtTrainNumber@(itemName)").val(item.TrainNumber);
                    $("#txtDeliveryUser@(itemName)").val(item.DeliveryUser);
                    item.DepositBatches == "Y" ? $("#cbxDepositBatches@(itemName)").attr("checked", true) : $("#cbxDepositBatches@(itemName)").attr("checked", false)

                    //軍福品資料
                    $("#cboCourier@(itemName)").val(item.Courier).trigger("change.select2");
                    $("#txtSiteCommCalcMethod@(itemName)").val(item.SiteCommCalcMethod);
                    $("#txtSiteCommRate@(itemName)").val(item.SiteCommRate);
                    $("#txtTotalCommAmount@(itemName)").val(item.TotalCommAmount);
                    item.CommCalcInclTax == "Y" ? $("#cbxCommCalcInclTax@(itemName)").attr("checked", true) : $("#cbxCommCalcInclTax@(itemName)").attr("checked", false)

                    GetExchangeRate(item.Currency)

                });
                GetRoDetailExcel@(itemName)(RoId)
            } else {
                alert(data.msg, "alert", 0);
            }
        }
    }

    //銷貨單單身取得-Excel
    function GetRoDetailExcel@(itemName)(RoId) {
        if (RoId == undefined) {
            let dataset = JSON.parse(RoDetailTemplateDefault);
            spreadsheet@(itemName).parse(dataset);
            spreadsheetData@(itemName) = dataset;
            return
        }

         let targetUrl = "@Url.Action("GetRoDetail", "ReceiveOrder")";
         let postData = {
             "RoId": RoId
         };

         let data = DataAccess.Get(targetUrl, postData, false);

         if (data.status == "success") {
             if (data.result.length > 0) {
                 var row = 1;
                 let dataset = JSON.parse(RoDetailTemplateDefault);
                 spreadsheet@(itemName).parse(dataset);
                 spreadsheetData@(itemName) = dataset;
                 spreadsheet@(itemName).setFormat("B2:B1000", "text")
                 spreadsheet@(itemName).setFormat("C2:C1000", "text")
                 spreadsheet@(itemName).setFormat("D2:D1000", "text")
                 spreadsheet@(itemName).setFormat("E2:E1000", "text")
                 spreadsheet@(itemName).setFormat("F2:F1000", "text")
                 spreadsheet@(itemName).setFormat("G2:G1000", "text")
                 spreadsheet@(itemName).setFormat("H2:H1000", "text")
                 spreadsheet@(itemName).setFormat("L2:L1000", "text")
                 spreadsheet@(itemName).setFormat("N2:N1000", "text")
                 spreadsheet@(itemName).setFormat("W2:W1000", "text")
                 spreadsheet@(itemName).setFormat("X2:X1000", "text")
                 spreadsheet@(itemName).setFormat("Y2:Y1000", "text")
                 spreadsheet@(itemName).setFormat("Z2:Z1000", "text")
                 spreadsheet@(itemName).setFormat("AA2:AA1000", "text")
                 spreadsheet@(itemName).setFormat("AB2:AB1000", "text")
                 spreadsheet@(itemName).setFormat("AD2:AD1000", "text")
                 spreadsheet@(itemName).setFormat("AE2:AE1000", "text")
                 GetInventory("CMSMC", "", "")
                 $.each(data.result, function (i, item) {
                     row = i + 2

                     //單位
                     var MtlItemUomArr = GetMtlItemUom(item.MtlItemNo)
                     var indexUomNo = MtlItemUomArr.findIndex(function (element) {
                         return element.indexOf(item.UomNo) !== -1;
                     });
                     var indexAvailableUomNo = MtlItemUomArr.findIndex(function (element) {
                         return element.indexOf(item.AvailableUomNo) !== -1;
                     });

                     //庫別
                     var indexInventoryNo = InventoryArr.findIndex(function (element) {
                         return element.indexOf(item.InventoryNo) !== -1;
                     });

                     //儲位
                     let LocationArr = GetInventory("CMSNL", item.InventoryNo)
                     var indexLocation = LocationArr.findIndex(function (element) {
                         return element.indexOf(item.Location) !== -1;
                     });
                     if (item.Location == "") {
                         indexLocation = -1
                     }

                     spreadsheet@(itemName).setValidation(`A` + row, DetailStatusArr)
                     spreadsheet@(itemName).setValidation(`J` + row, FreeSpareTypeArr)
                     spreadsheet@(itemName).setValidation(`E` + row, InventoryArr)
                     spreadsheet@(itemName).setValidation(`L` + row, MtlItemUomArr)
                     spreadsheet@(itemName).setValidation(`N` + row, MtlItemUomArr)
                     spreadsheet@(itemName).setValidation(`G` + row, LocationArr)

                     spreadsheet@(itemName).setValue(`A` + row,"👁️查看")
                     spreadsheet@(itemName).setValue(`B` + row, item.MtlItemNo)//品號
                     spreadsheet@(itemName).setValue(`C` + row, item.MtlItemName)//品名
                     spreadsheet@(itemName).setValue(`D` + row, item.MtlItemSpec)//規格
                     spreadsheet@(itemName).setValue(`E` + row, InventoryArr[indexInventoryNo])//庫別
                     spreadsheet@(itemName).setValue(`F` + row, item.InventoryName)//庫別名稱
                     spreadsheet@(itemName).setValue(`G` + row, indexLocation != -1 ? LocationArr[indexLocation] : "")//儲位
                     spreadsheet@(itemName).setValue(`H` + row, item.SaveLocation)//儲存位置
                     spreadsheet@(itemName).setValue(`I` + row, item.Quantity)//數量
                     spreadsheet@(itemName).setValue(`J` + row, FreeSpareTypeArr[parseInt(item.Type) -1])//類型
                     spreadsheet@(itemName).setValue(`K` + row, item.FreeSpareQty)//贈/備品量
                     spreadsheet@(itemName).setValue(`L` + row, indexUomNo != -1 ? MtlItemUomArr[indexUomNo] : "")//單位
                     spreadsheet@(itemName).setValue(`M` + row, item.AvailableQty)//計價數量
                     spreadsheet@(itemName).setValue(`N` + row, indexAvailableUomNo != -1 ? MtlItemUomArr[indexAvailableUomNo] : "")//計價單位
                     spreadsheet@(itemName).setValue(`O` + row, item.UnitPrice)//單價
                     spreadsheet@(itemName).setValue(`P` + row, item.TaxRate)//營業稅率
                     spreadsheet@(itemName).setValue(`Q` + row, item.DiscountRate)//折扣率
                     spreadsheet@(itemName).setValue(`R` + row, item.Amount)//金額
                     spreadsheet@(itemName).setValue(`S` + row, item.OrigPreTaxAmt)//原幣未稅金額
                     spreadsheet@(itemName).setValue(`T` + row, item.OrigTaxAmt)//原幣稅額
                     spreadsheet@(itemName).setValue(`U` + row, item.PreTaxAmt)//本幣未稅金額
                     spreadsheet@(itemName).setValue(`V` + row, item.TaxAmt)//本幣稅額
                     spreadsheet@(itemName).setValue(`W` + row, item.SoFullNo)//訂單單別
                     spreadsheet@(itemName).setValue(`X` + row, item.LotNumber)//批號
                     spreadsheet@(itemName).setValue(`Y` + row, ``)//客戶品號
                     spreadsheet@(itemName).setValue(`Z` + row, ``)//專案代號
                     spreadsheet@(itemName).setValue(`AA` + row, ``)//專案名稱
                     spreadsheet@(itemName).setValue(`AB` + row, item.Remarks)//備註
                     spreadsheet@(itemName).setValue(`AC` + row, item.ToFullNo)//暫出單
                     spreadsheet@(itemName).setValue(`AD` + row, `N`)//保稅碼
                     spreadsheet@(itemName).setValue(`AE` + row,  ``)//預測單
                     spreadsheet@(itemName).setValue(`AF` + row, item.RoDetailId)//單身ID
                     spreadsheet@(itemName).setValue(`AG` + row, item.LotManagement)//批號管理
                 });

                 spreadsheet@(itemName).lock("C2:C" + (parseInt(data.result.length) +1));
                 spreadsheet@(itemName).lock("D2:D" + (parseInt(data.result.length) +1));
                 spreadsheet@(itemName).lock("F2:F" + (parseInt(data.result.length) +1));
                 spreadsheet@(itemName).lock("H2:H" + (parseInt(data.result.length) +1));
                 spreadsheet@(itemName).lock("P2:P" + (parseInt(data.result.length) +1));
                 spreadsheet@(itemName).lock("W2:Y" + (parseInt(data.result.length) +1));
                 spreadsheet@(itemName).lock("X2:Y" + (parseInt(data.result.length) +1));
                 spreadsheet@(itemName).lock("Y2:Y" + (parseInt(data.result.length) +1));
                 spreadsheet@(itemName).lock("AA2:AA" + (parseInt(data.result.length) +1));
                 spreadsheet@(itemName).lock("AC2:AC" + (parseInt(data.result.length) +1));
                 spreadsheet@(itemName).lock("AF2:AF" + (parseInt(data.result.length) +1));
                 spreadsheet@(itemName).lock("AG2:AG" + (parseInt(data.result.length) + 1));
                 AmountCalc(false, true, true, '')

             }
             else {
                 let dataset = JSON.parse(RoDetailTemplateDefault);
                 spreadsheet@(itemName).parse(dataset);
                 spreadsheetData@(itemName) = dataset;
             }
         } else {
             alert(data.msg, "alert", 0);
         }
    }

    function Save@(itemName)() {
        if ($(objForm@(itemName)).valid()) {
            let RoId = parseInt($("#RoId").val());

            //銷或單身資料撈取
            spreadsheetJson@(itemName).spreadsheetInfo = [];
            spreadsheetData@(itemName) = spreadsheet@(itemName).serialize();

            let errMsg = ""
            let MtlItemNo = ""
            let LotNumber = ""
            let RoDetailData = [];
            let RoDetailObj = {};

            let OrigPreTaxAmt = 0
            let OrigTaxAmt = 0
            let PreTaxAmt = 0
            let TaxAmt = 0

            $.each(spreadsheetData@(itemName).sheets[0].data, function (i, item) {
                let cell = item.cell;
                let row = parseInt(cell.substring(1))
                if (cell.charAt(0) == "B" && row > 1) {
                    for (let key in GetColumn) {
                        let value = spreadsheet@(itemName).getValue(key + row);
                        let ColumName = GetColumn[key]

                        let nowRow = key + row
                        switch (key) {
                            case "B":
                                MtlItemNo = value
                                if (!!!value)
                                    errMsg += `【${nowRow}-品號】不可為空<br>`
                                break;
                            case "E":
                                if (!!!value) {
                                    errMsg += `【${nowRow}-庫別】不可為空<br>`
                                }
                                else {
                                    if (!InventoryArr.includes(value)) {
                                        errMsg += `【${nowRow}-轉出庫別】資料異常<br>`
                                    }
                                    else {
                                        InventoryNo = value.split(':')[0]
                                    }
                                }
                                break;
                            case "G":
                                if (!!value) {
                                    var LocationArr = GetInventory("CMSNL", Location, row, "")
                                    if (!LocationArr.includes(value)) {
                                        errMsg += `【${nowRow}-儲位】資料異常<br>`
                                    }
                                }
                                else if (!!!value) {
                                    value = ""
                                }
                                break;
                            case "I":
                                if (!!!value)
                                    value = 0
                                break;
                            case "J":
                                if (!!!value) {
                                    errMsg += `【${nowRow}-類型】不可為空<br>`
                                }
                                else if (!FreeSpareTypeArr.includes(value)) {
                                    errMsg += `【${nowRow}-類型】資料異常<br>`
                                }
                                break;
                            case "K":
                                if (!!!value)
                                    value = 0
                                break;
                            case "L":
                                if (!!value) {
                                    var MtlItemUomArr = GetMtlItemUom(MtlItemNo)
                                    if (!MtlItemUomArr.includes(value)) {
                                        errMsg += `【${nowRow}-單位】資料異常<br>`
                                    }
                                }
                                else if (!!!value) {
                                    value = ""
                                }
                                break;
                            case "M":
                                if (!!!value)
                                    value = 0
                                break;
                            case "N":
                                if (!!value) {
                                    var MtlItemUomArr = GetMtlItemUom(MtlItemNo)
                                    if (!MtlItemUomArr.includes(value)) {
                                        errMsg += `【${nowRow}-計價單位】資料異常<br>`
                                    }
                                }
                                else if (!!!value) {
                                    value = ""
                                }
                                break;
                            case "O":
                                if (!!!value)
                                    value = 0
                                break;
                            case "P":
                                if (!!!value)
                                    value = 0
                                break;
                            case "Q":
                                if (!!!value)
                                    value = 1
                                break;
                            case "R":
                                if (!!!value)
                                    value = 0
                                break;
                            case "S":
                                if (!!!value) {
                                    value = 0
                                }
                                else {
                                    OrigPreTaxAmt = value
                                }
                                break;
                            case "T":
                                if (!!!value) {
                                    value = 0
                                }
                                else {
                                    OrigTaxAmt = value
                                }
                                break;
                            case "U":
                                if (!!!value) {
                                    value = 0
                                }
                                else {
                                    PreTaxAmt = value
                                    if (ExchangeRate == 1 && PreTaxAmt != OrigPreTaxAmt) {
                                        errMsg += `【${nowRow}】匯率為1情況下原幣稅額,本幣稅額須相同】不可為空<br>`
                                    }
                                }
                                break;
                            case "V":
                                if (!!!value) {
                                    value = 0
                                }
                                else {
                                    TaxAmt = value
                                    if (ExchangeRate == 1 && OrigPreTaxAmt != PreTaxAmt) {
                                        errMsg += `【${nowRow}】匯率為1情況下原幣未稅金額,本幣未稅金額須相同不可為空<br>`
                                    }
                                }
                                break;
                            case "W":
                                if (!!!value)
                                    errMsg += `【${nowRow}-來源訂單單據】不可為空<br>`
                                break;
                            case "X":
                                if (!!!value) {
                                    value = ""
                                }
                                LotNumber = value
                                break;
                            case "Y":
                                if (!!!value)
                                    value = ""
                                break;
                            case "V":
                                if (!!!value)
                                    value = ""
                                break;
                            case "W":
                                if (!!!value)
                                    value = ""
                                break;
                            case "X":
                                if (!!!value)
                                    value = ""
                                break;
                            case "Y":
                                if (!!!value)
                                    value = ""
                                break;
                            case "Z":
                                if (!!!value)
                                    value = ""
                                break;
                            case "AB":
                                if (!!!value)
                                    value = ""
                                break;
                            case "AC":
                                if (!!!value)
                                    value = ""
                                break;
                            case "AD":
                                if (!!!value)
                                    value = ""
                                break;
                            case "AB":
                                if (!!!value)
                                    value = "N"
                                break;
                            case "AE":
                                if (!!!value)
                                    value = ""
                                break;
                            case "AF":
                                if (!!!value)
                                    value = ""
                                break;
                            case "AG":
                                if (value != "N" && !!!LotNumber) {
                                    errMsg += `【${nowRow}-批號】不可為空<br>`
                                }
                                else if (value == "N" && !!LotNumber) {
                                    errMsg += `【${nowRow}-批號】不需維護<br>`
                                }
                                break;
                        }

                        RoDetailObj[ColumName] = value;
                    }
                    RoDetailData.push(RoDetailObj)
                    RoDetailObj = {}
                }
            });

            if (!!errMsg) {
                alert(errMsg, "alert", 0);
                return
            }
            AmountCalc(false, true, true, "")

            if (RoId <= 0) {

                let targetUrl = "@Url.Action("AddReceiveOrder", "ReceiveOrder")";
                let postData = {
                    "ViewCompanyId": companyId@(itemName),
                    "DocDate": $("#txtDocDate@(itemName)").val(),
                    //單頭主資料
                    "ReceiveDate": $("#txtReceiveDate@(itemName)").val(),
                    "RoErpPrefix": $("#cboRoErpPrefix@(itemName)").val(),
                    "RoErpNo": $("#txtRoErpNo@(itemName)").val(),
                    "CustomerId": $("#cboCustomerId@(itemName)").val(),
                    "ProcessCode": $("#txtProcessCode@(itemName)").val(),
                    "RevenueJournalCode": $("#cbxRevenueJournalCode@(itemName)").is(":checked") ? "Y" : "N",
                    "CostJournalCode": $("#cbxCostJournalCode@(itemName)").is(":checked") ? "Y" : "N",
                    "NoCredLimitControl": $("#cbxNoCredLimitControl@(itemName)").is(":checked") ? "Y" : "N",
                    "CashSales": $("#cbxCashSales@(itemName)").is(":checked") ? "Y" : "N",
                    "SourceType": $("#cboSourceTypeMain@(itemName)").val(),
                    "PriceSourceTypeMain": $("#cboPriceSourceTypeMain@(itemName)").val(),
                    "SourceOrderId": $("#SourceOrderId@(itemName)").val(),
                    "SourceFull": $("#txtSelectOrder@(itemName)").val(),
                    //金錢資料
                    "OriginalAmount": $("#txtOriginalAmount@(itemName)").val(),
                    "OriginalTaxAmount": $("#txtOriginalTaxAmount@(itemName)").val(),
                    "PretaxAmount": $("#txtPretaxAmount@(itemName)").val(),
                    "TaxAmount": $("#txtTaxAmount@(itemName)").val(),
                    "TotalQuantity": $("#txtTotalQuantity@(itemName)").val(),
                    //交易資料
                    "DepartmentId": $("#cboDepartmentId@(itemName)").val(),
                    "SalesmenId": $("#cboSalesmenId@(itemName)").val(),
                    "Factory": $("#cboFactory@(itemName)").val(),
                    "PaymentTerm": $("#cboPaymentTerm@(itemName)").val(),
                    "TradingTerms": $("#cboTradingTerms@(itemName)").val(),
                    "Currency": $("#cboCurrency@(itemName)").val(),
                    "ExchangeRate": $("#txtExchangeRate@(itemName)").val(),
                    "BondCode": $("#cboBondCode@(itemName)").val(),
                    "RowCnt": $("#txtRowCnt@(itemName)").val(),
                    //"ConfirmStatus": $("#cboConfirmStatus@(itemName)").val(),
                    "Remark": $("#txtRemark@(itemName)").val(),
                    //送貨資料
                    "CustomerFullName": $("#txtCustomerFullName@(itemName)").val(),
                    "ContactPerson": $("#txtContactPerson@(itemName)").val(),
                    "CustomerAddressFirst": $("#txtCustomerAddressFirst@(itemName)").val(),
                    "TelephoneNumber": $("#txtTelephoneNumber@(itemName)").val(),
                    "CustomerAddressSecond": $("#txtCustomerAddressSecond@(itemName)").val(),
                    "FaxNumber": $("#txtFaxNumber@(itemName)").val(),
                    //發票資料(一)
                    "TaxCode": $("#cboTaxCode@(itemName)").val(),
                    "InvoiceType": $("#cboInvoiceType@(itemName)").val(),
                    "TaxType": $("#cboTaxType@(itemName)").val(),
                    "TaxRate": $("#txtTaxRate@(itemName)").val(),
                    "InvNumGenMethod": $("#cboInvNumGenMethod@(itemName)").val(),
                    "UiNo": $("#txtUiNo@(itemName)").val(),
                    "InvoiceDate": $("#txtInvoiceDate@(itemName)").val(),
                    "InvoiceTime": $("#txtInvoiceTime@(itemName)").val(),
                    "InvNumStart": $("#txtInvNumStart@(itemName)").val(),
                    "InvNumEnd": $("#txtInvNumEnd@(itemName)").val(),
                    "ApplyYYMM": $("#txtApplyYYMM@(itemName)").val(),
                    "CustomsClearance": $("#cboCustomsClearance@(itemName)").val(),
                    "CustomerFullNameOre": $("#txtCustomerFullNameOre@(itemName)").val(),
                    "InvoiceAddressFirst": $("#txtInvoiceAddressFirst@(itemName)").val(),
                    "CustomerEgFullName": $("#txtCustomerEgFullName@(itemName)").val(),
                    "InvoiceAddressSecond": $("#txtInvoiceAddressSecond@(itemName)").val(),
                    "MultipleInvoices": $("#cbxMultipleInvoices@(itemName)").is(":checked") ? "Y" : "N",
                    "MultiTaxRate": $("#cbxMultiTaxRate@(itemName)").is(":checked") ? "Y" : "N",
                    "AttachInvWithShip": $("#cbxAttachInvWithShip@(itemName)").is(":checked") ? "Y" : "N",
                    "InvoicesVoid": $("#cbxInvoicesVoid@(itemName)").is(":checked") ? "Y" : "N",

                    //發票資料(二)
                    "VehicleTypeNumber": $("#txtVehicleTypeNumber@(itemName)").val(),
                    "InvDonationRecipient": $("#txtInvDonationRecipient@(itemName)").val(),
                    "VehicleIDshow": $("#txtVehicleIDshow@(itemName)").val(),
                    "VehicleIDhide": $("#txtVehicleIDhide@(itemName)").val(),
                    "CreditCard4No": $("#txtCreditCard4No@(itemName)").val(),
                    "InvRandomCode": $("#txtInvRandomCode@(itemName)").val(),
                    "ContactEmail": $("#txtContactEmail@(itemName)").val(),
                    //其他資料
                    "StaffId": $("#cboStaffId@(itemName)").val(),
                    "CollectionSalesmenId": $("#cboCollectionSalesmenId@(itemName)").val(),
                    "Remark1": $("#txtRemark1@(itemName)").val(),
                    "Remark2": $("#txtRemark2@(itemName)").val(),
                    "Remark3": $("#txtRemark3@(itemName)").val(),
                    "LCNO": $("#txtLCNO@(itemName)").val(),
                    "INVOICENO": $("#txtInvoiceNO@(itemName)").val(),
                    "DeclarationNumber": $("#txtDeclarationNumber@(itemName)").val(),
                    "NewRoFull": $("#txtNewRoFull@(itemName)").val(),
                    "ShipNoticeFull": $("#txtShipNoticeFull@(itemName)").val(),
                    "ChangeInvCode": $("#cbxChangeInvCode@(itemName)").is(":checked") ? "Y" : "N",
                    //訂金/派車資料
                    "DepositBatches": $("#cbxDepositBatches@(itemName)").is(":checked") ? "Y" : "N",
                    "SoFull": $("#txtSoFull@(itemName)").val(),
                    "AdvOrderFull": $("#txtAdvOrderFull@(itemName)").val(),
                    "OffsetAmount": $("#txtOffsetAmount@(itemName)").val(),
                    "OffsetTaxAmount": $("#txtOffsetTaxAmount@(itemName)").val(),
                    "TransportMethod": $("#cboTransportMethod@(itemName)").val(),
                    "DispatchOrderFull": $("#txtDispatchOrderFull@(itemName)").val(),
                    "CarNumber": $("#txtCarNumber@(itemName)").val(),
                    "TrainNumber": $("#txtTrainNumber@(itemName)").val(),
                    "DeliveryUser": $("#txtDeliveryUser@(itemName)").val(),
                    //軍福品資料
                    "Courier": $("#cboCourier@(itemName)").val(),
                    "SiteCommCalcMethod": $("#txtSiteCommCalcMethod@(itemName)").val(),
                    "SiteCommRate": $("#txtSiteCommRate@(itemName)").val(),
                    "TotalCommAmount": $("#txtTotalCommAmount@(itemName)").val(),
                    "RoDetailData": JSON.stringify(RoDetailData)
                };

                let data = DataAccess.EditContinued(targetUrl, postData, false);

                if (data) {
                    $.each(data.result, function (i, item) {
                        NewRoId = item
                    });
                    Return@(itemName)();
                }
            } else {
                let targetUrl = "@Url.Action("UpdateReceiveOrder", "ReceiveOrder")";
                let postData = {
                    "RoId": RoId,
                    "ViewCompanyId": companyId@(itemName),
                    //單頭主資料
                    "DocDate": $("#txtDocDate@(itemName)").val(),
                    "ReceiveDate": $("#txtReceiveDate@(itemName)").val(),
                    "RoErpPrefix": $("#cboRoErpPrefix@(itemName)").val(),
                    "RoErpNo": $("#txtRoErpNo@(itemName)").val(),
                    "CustomerId": $("#cboCustomerId@(itemName)").val(),
                    "ProcessCode": $("#txtProcessCode@(itemName)").val(),
                    "RevenueJournalCode": $("#cbxRevenueJournalCode@(itemName)").is(":checked") ? "Y" : "N",
                    "CostJournalCode": $("#cbxCostJournalCode@(itemName)").is(":checked") ? "Y" : "N",
                    "NoCredLimitControl": $("#cbxNoCredLimitControl@(itemName)").is(":checked") ? "Y" : "N",
                    "CashSales": $("#cbxCashSales@(itemName)").is(":checked") ? "Y" : "N",
                    "SourceType": $("#cboSourceTypeMain@(itemName)").val(),
                    "PriceSourceTypeMain": $("#cboPriceSourceTypeMain@(itemName)").val(),
                    "SourceOrderId": $("#SourceOrderId@(itemName)").val(),
                    "SourceFull": $("#txtSelectOrder@(itemName)").val(),
                    //金錢資料
                    "OriginalAmount": $("#txtOriginalAmount@(itemName)").val(),
                    "OriginalTaxAmount": $("#txtOriginalTaxAmount@(itemName)").val(),
                    "PretaxAmount": $("#txtPretaxAmount@(itemName)").val(),
                    "TaxAmount": $("#txtTaxAmount@(itemName)").val(),
                    "TotalQuantity": $("#txtTotalQuantity@(itemName)").val(),
                    //交易資料
                    "DepartmentId": $("#cboDepartmentId@(itemName)").val(),
                    "SalesmenId": $("#cboSalesmenId@(itemName)").val(),
                    "Factory": $("#cboFactory@(itemName)").val(),
                    "PaymentTerm": $("#cboPaymentTerm@(itemName)").val(),
                    "TradingTerms": $("#cboTradingTerms@(itemName)").val(),
                    "Currency": $("#cboCurrency@(itemName)").val(),
                    "ExchangeRate": $("#txtExchangeRate@(itemName)").val(),
                    "BondCode": $("#cboBondCode@(itemName)").val(),
                    "RowCnt": $("#txtRowCnt@(itemName)").val(),
                    "ConfirmStatus": $("#cboConfirmStatus@(itemName)").val(),
                    "Remark": $("#txtRemark@(itemName)").val(),
                    //送貨資料
                    "CustomerFullName": $("#txtCustomerFullName@(itemName)").val(),
                    "ContactPerson": $("#txtContactPerson@(itemName)").val(),
                    "CustomerAddressFirst": $("#txtCustomerAddressFirst@(itemName)").val(),
                    "TelephoneNumber": $("#txtTelephoneNumber@(itemName)").val(),
                    "CustomerAddressSecond": $("#txtCustomerAddressSecond@(itemName)").val(),
                    "FaxNumber": $("#txtFaxNumber@(itemName)").val(),
                    //發票資料(一)
                    "TaxCode": $("#cboTaxCode@(itemName)").val(),
                    "InvoiceType": $("#cboInvoiceType@(itemName)").val(),
                    "TaxType": $("#cboTaxType@(itemName)").val(),
                    "TaxRate": $("#txtTaxRate@(itemName)").val(),
                    "InvNumGenMethod": $("#cboInvNumGenMethod@(itemName)").val(),
                    "UiNo": $("#txtUiNo@(itemName)").val(),
                    "InvoiceDate": $("#txtInvoiceDate@(itemName)").val(),
                    "InvoiceTime": $("#txtInvoiceTime@(itemName)").val(),
                    "InvNumStart": $("#txtInvNumStart@(itemName)").val(),
                    "InvNumEnd": $("#txtInvNumEnd@(itemName)").val(),
                    "ApplyYYMM": $("#txtApplyYYMM@(itemName)").val(),
                    "CustomsClearance": $("#cboCustomsClearance@(itemName)").val(),
                    "CustomerFullNameOre": $("#txtCustomerFullNameOre@(itemName)").val(),
                    "InvoiceAddressFirst": $("#txtInvoiceAddressFirst@(itemName)").val(),
                    "CustomerEgFullName": $("#txtCustomerEgFullName@(itemName)").val(),
                    "InvoiceAddressSecond": $("#txtInvoiceAddressSecond@(itemName)").val(),
                    "MultipleInvoices": $("#cbxMultipleInvoices@(itemName)").is(":checked") ? "Y" : "N",
                    "MultiTaxRate": $("#cbxMultiTaxRate@(itemName)").is(":checked") ? "Y" : "N",
                    "AttachInvWithShip": $("#cbxAttachInvWithShip@(itemName)").is(":checked") ? "Y" : "N",
                    "InvoicesVoid": $("#cbxInvoicesVoid@(itemName)").is(":checked") ? "Y" : "N",
                    //發票資料(二)
                    "VehicleTypeNumber": $("#txtVehicleTypeNumber@(itemName)").val(),
                    "InvDonationRecipient": $("#txtInvDonationRecipient@(itemName)").val(),
                    "VehicleIDshow": $("#txtVehicleIDshow@(itemName)").val(),
                    "VehicleIDhide": $("#txtVehicleIDhide@(itemName)").val(),
                    "CreditCard4No": $("#txtCreditCard4No@(itemName)").val(),
                    "InvRandomCode": $("#txtInvRandomCode@(itemName)").val(),
                    "ContactEmail": $("#txtContactEmail@(itemName)").val(),
                    //其他資料
                    "StaffId": $("#cboStaffId@(itemName)").val(),
                    "CollectionSalesmenId": $("#cboCollectionSalesmenId@(itemName)").val(),
                    "LCNO": $("#txtLCNO@(itemName)").val(),
                    "InvoiceNO": $("#txtInvoiceNO@(itemName)").val(),
                    "DeclarationNumber": $("#txtDeclarationNumber@(itemName)").val(),
                    "NewSOFull": $("#txtNewRoFull@(itemName)").val(),
                    "ShipNoticeFull": $("#txtShipNoticeFull@(itemName)").val(),
                    "ChangeInvCode": $("#cbxChangeInvCode@(itemName)").is(":checked") ? "Y" : "N",
                    //訂金/派車資料
                    "DepositBatches": $("#cbxDepositBatches@(itemName)").is(":checked") ? "Y" : "N",
                    "SoFull": $("#txtSoFull@(itemName)").val(),
                    "AdvOrderFull": $("#txtAdvOrderFull@(itemName)").val(),
                    "OffsetAmount": $("#txtOffsetAmount@(itemName)").val(),
                    "OffsetTaxAmount": $("#txtOffsetTaxAmount@(itemName)").val(),
                    "TransportMethod": $("#cboTransportMethod@(itemName)").val(),
                    "DispatchOrderFull": $("#txtDispatchOrderFull@(itemName)").val(),
                    "CarNumber": $("#txtCarNumber@(itemName)").val(),
                    "TrainNumber": $("#txtTrainNumber@(itemName)").val(),
                    "DeliveryUser": $("#txtDeliveryUser@(itemName)").val(),
                    //軍福品資料
                    "Courier": $("#cboCourier@(itemName)").val(),
                    "SiteCommCalcMethod": $("#txtSiteCommCalcMethod@(itemName)").val(),
                    "SiteCommRate": $("#txtSiteCommRate@(itemName)").val(),
                    "TotalCommAmount": $("#txtTotalCommAmount@(itemName)").val(),
                    "RoDetailData": JSON.stringify(RoDetailData)
                };

                let result = DataAccess.Update(targetUrl, postData, false, true);

                if (result) {
                    Return@(itemName)();
                }
            }
        }
    }

    //銷貨單刪除
    function Delete@(itemName)(RoId) {
        swal.fire({
            titleText: "確認要刪除嗎?",
            text: "此動作無法復原，請確認是否要執行!",
            icon: "warning",
            allowOutsideClick: false,
            allowEscapeKey: false,
            showCancelButton: true,
            confirmButtonColor: '#d33',
            reverseButtons: true
        }).then((result) => {
            if (result.isConfirmed) {
                let targetUrl = "@Url.Action("DeleteReceiveOrder", "ReceiveOrder")";
                let postData = {
                    "RoId": RoId,
                };

                let result = DataAccess.Delete(targetUrl, postData, false, true);

                if (result) {
                    Query@(itemName)();
                }
            }
        });
    }

    //前置單據視窗開啟
    function SelectOrder() {
        if ($("#cboRoErpPrefix@(itemName)").val() == "") {
            alert("銷貨單別尚未選取!!!")
            return
        }
        if ($("#TransferStatusMES").val() != "N" && $("#TransferStatusMES").val() != "") {
            alert("該銷貨單已經拋轉ERP,不可在更改!!!")
            return
        }
        $("#PopViewOrder@(itemName)").modal("show");
        //複製來源,銷貨單價來源
        ComboBoxs.Default("#cboSourceType@(itemName)", "@Url.Action("GetType", "BasicInformation")", { "TypeSchema": "ReceiveOrder.SourceType" }, "To", "NA", "", "TypeName", "TypeNo");
        ComboBoxs.Default("#cboPriceSourceType@(itemName)", "@Url.Action("GetType", "BasicInformation")", { "TypeSchema": "ReceiveOrder.SourceType" }, "To", "NA", "", "TypeName", "TypeNo");

        $("#cboSourceType@(itemName)").change(function () {
            ComboBoxs.Default("#cboPriceSourceType@(itemName)", "@Url.Action("GetType", "BasicInformation")", { "TypeSchema": "ReceiveOrder.SourceType" }, $(this).val(), "NA", "", "TypeName", "TypeNo");
        })

        if (!isMobile) {
            $(`#cboSourceType@(itemName), #cboPriceSourceType@(itemName)`).select2({
                dropdownAutoWidth: true,
                width: "100%"
            });
        }

        GetSourceOrder(popViewOrderPage)
    }

    //前置單據視窗-取得暫出單資料
    function GetSourceOrder(objPage) {
        let innerHtml = "";
        let pageCount = 0;
        let targetUrl = "";
        var SourceType = $("#cboSourceType@(itemName)").val();
        if ($("#cboCustomerId@(itemName)").val() > 0) {
            CustomerName = $("#select2-cboCustomerIdReceiveOrderManagment-container").text()
            $("#desCustomerName@(itemName)").text(CustomerName)
        }
        else {
            $("#desCustomerName@(itemName)").text("尚未選擇客戶")
        }
        if (SourceType == "To") {
            targetUrl = "@Url.Action("GetTempShippingNote", "ScmInventory")";
        }
        else if (SourceType == "So") {
            targetUrl = "@Url.Action("GetSaleOrder", "SaleOrder")";
        }


        let postData = {
            "OrderBy": "",
            "PageIndex": (objPage.pageIndex + 1),
            "PageSize": objPage.pageSize,
            "CustomerId": $("#cboCustomerId@(itemName)").val(),
            "SoErpFullNo": $("#txtSourceOrderFull@(itemName)").val(),
            "TsnErpPrefix": $("#txtSourceOrderFull@(itemName)").val().split('-')[0],
            "TsnErpNo": $("#txtSourceOrderFull@(itemName)").val().split('-')[1],
            "ObjectCustomer": $("#cboCustomerId@(itemName)").val()
        };
        let data = DataAccess.Get(targetUrl, postData, false);

        if (data.status == "success") {
            pageCount = data.result.length > 0 ? parseInt(data.result[0]["TotalCount"]) : 0;

            if (pageCount > 0) {
                objPage = PageCaculate(pageCount, objPage);

                $.each(data.result, function (i, item) {
                    let SourceId =""
                    let SourceErpPrefix =""
                    let SourceErpNo =""
                    let SourceFullNo =""
                    let SourceObjectName =""
                    let ObjectName =""
                    let TransferStatus =""
                    let DocDate =""
                    let ConfirmStatus =""
                    if (SourceType == "To") {
                        SourceId = item.TsnId
                        SourceErpPrefix = item.TsnErpPrefix
                        SourceErpNo = item.TsnErpNo
                        SourceFullNo = item.TsnErpFullNo
                        SourceObjectName = item.ToObjectName
                        ObjectName = item.ObjectName
                        TransferStatus = item.TransferStatus
                        DocDate = item.DocDate
                        ConfirmStatus = item.DocStatus
                    }
                    else if (SourceType == "So") {
                        SourceId = item.SoId
                        SourceErpPrefix = item.SoErpPrefix
                        SourceErpNo = item.SoErpNo
                        SourceFullNo = item.SoErpFullNo
                        SourceObjectName = ""
                        ObjectName = item.CustomerName
                        TransferStatus = item.TransferStatus
                        DocDate = item.DocDate
                        ConfirmStatus = item.ConfirmStatus
                        CheckOutCode = item.ClosureStatus
                    }

                    let _row = (objPage.pageSize * objPage.pageIndex + (i + 1)) + ".";
                    innerHtml += `<tr>
                                    <td>${_row}</td>
                                    <td class="ellipsis" data-toggle="tooltip" title="${SourceFullNo}" style="max-width: 165px;">
                                      ${SourceFullNo}
                                      ${TransferStatus == `Y` ? `${ErpDocStatus(ConfirmStatus)}` : ``}
                                    </td>
                                    <td>${(new Date(DocDate)).Format(`yyyy-MM-dd`)}</td>
                                    <td class="ellipsis" data-toggle="tooltip" title="${SourceObjectName}【${ObjectName}】" style="max-width: 150px;">${SourceObjectName}【${ObjectName}】</td>
                                    <td class="text-center active-content">
                                        <label class="control control-solid control-solid-info control--radio">
                                            <input type="radio" name="chkTsnId@(itemName)" data-source-id="${SourceId}" value="${SourceId}"/>
                                            <span class="control__indicator ${ ConfirmStatus != `Y` ? `trLock` : `` }"></span>
                                        </label>
                                        <input type="hidden" name="txtSourceErpPrefix@(itemName)" data-source-prefix="${SourceId}" value="${SourceErpPrefix}" />
                                        <input type="hidden" name="txtSourceErpNo@(itemName)" data-source-no="${SourceId}" value="${SourceErpNo}" />
                                        <input type="hidden" name="txtSourceErpFullNo@(itemName)" data-source-fullno="${SourceId}" value="${SourceFullNo}" />
                                    </td>
                                  </tr>`;
                });
            } else {
                innerHtml += `<tr>
                                <td class="text-center" colspan="7" style="background-color: #fff3cd;">
                                  <i class="fal fa-exclamation-circle"></i>&nbsp;目前尚無資料。
                                </td>
                              </tr>`;
            }
        } else {
            alert(data.msg, "alert", 0);
        }

        $("#tblPopOrder@(itemName) tbody").html(innerHtml);
        TableComponentInit();
        Pager("#pagePopOrder@(itemName)", pageCount, objPage, GetSourceOrder);

        //選中暫出單單據觸發
        $("input[type='radio']").click(function () {
            if ("[data-mtl-item-id]:checked") {
                let sourceId = $(this).data("source-id");
                if (sourceId) {
                    let SourceType = $("#cboSourceType@(itemName)").val()
                    let PriceSourceType = $("#cboPriceSourceType@(itemName)").val()
                    if (SourceType == "" || PriceSourceType == "") {
                        SourceType != "" ? PriceSourceType != "" ? `` : alert("銷貨單價來源尚未選擇") : alert("複製來源尚未選擇") ;
                        $(this).prop('checked', false); // 取消选中状态
                        return
                    }
                    //if (SourceType == "So") {
                    //    alert("導入訂單功能尚未開發!!")
                    //    $(this).prop('checked', false); // 取消选中状态
                    //    return
                    //}
                    let SourceErpPrefix = $(`input[name="txtSourceErpPrefix@(itemName)"][data-source-prefix="${sourceId}"]`).val();
                    let SourceErpNo = $(`input[name="txtSourceErpNo@(itemName)"][data-source-no="${sourceId}"]`).val();
                    let SourceErpFullNo = $(`input[name="txtSourceErpFullNo@(itemName)"][data-source-fullno="${sourceId}"]`).val();

                    $("#cboSourceTypeMain@(itemName)").val(SourceType).trigger("change.select2")
                    $("#cboPriceSourceTypeMain@(itemName)").val(PriceSourceType).trigger("change.select2")
                    $("#txtSelectOrder@(itemName)").val(SourceErpFullNo)
                    $("#SourceOrderId@(itemName)").val(sourceId)
                    GetSourceOrderData(SourceType, SourceErpPrefix, SourceErpNo)

                }
            }
            $("#PopViewOrder@(itemName)").modal("hide");
        });
     }
    //前置單據撈取並顯示前端
    function GetSourceOrderData(SourceType, SourceErpPrefix, SourceErpNo, DoDetailList) {

        $("#cboCurrency@(itemName)").attr("disabled", true);
        let targetUrl = "@Url.Action("GetSourceOrderData", "ReceiveOrder")";
        let postData = {
            "SourceType": SourceType,
            "SourcePrefix": SourceErpPrefix,
            "SourceNo": SourceErpNo,
            "DoDetailList":DoDetailList
        };
        let data = DataAccess.Get(targetUrl, postData, false);

        if (data.status == "success") {
            if (data.result.length > 0) {
                switch (SourceType) {
                    case "So":
                        $("#cboCurrency@(itemName)").attr("disabled", true);

                        $.each(data.result, function (i, item) {

                            //Salesmen
                            if (item.Salesmen != "") {
                                var SalesmenOptions = $("#cboSalesmenId@(itemName) option").filter(function () {
                                    return $(this).text().indexOf(item.Salesmen) !== -1;
                                });
                                if (SalesmenOptions.length > 0) {
                                    SalesmenOptions.each(function () {
                                        $("#cboSalesmenId@(itemName)").val($(this).val()).trigger("change.select2");
                                        $("#cboCollectionSalesmenId@(itemName)").val($(this).val()).trigger("change.select2");
                                    });
                                }
                                $("#cboSalesmenId@(itemName)").val(item.SalesmenId).trigger("change.select2");
                                $("#cboCollectionSalesmenId@(itemName)").val(item.SalesmenId).trigger("change.select2");
                            }

                            @*//Salesmen
                            var SalesmenOptions = $("#cboSalesmenId@(itemName) option").filter(function () {
                                return $(this).text().indexOf(item.Salesmen) !== -1;
                            });
                            if (SalesmenOptions.length > 0) {
                                SalesmenOptions.each(function () {
                                    $("#cboSalesmenId@(itemName)").val($(this).val()).trigger("change.select2");
                                    $("#cboCollectionSalesmenId@(itemName)").val($(this).val()).trigger("change.select2");
                                });
                            }*@

                            

                            //Customer
                            if (item.Customer != "") {
                                var CustomerOptions = $("#cboCustomerId@(itemName) option").filter(function () {
                                    return $(this).text().indexOf(item.Customer) !== -1;
                                });
                                // 檢查是否有符合的選項
                                if (CustomerOptions.length > 0) {
                                    // 在這裡處理找到的選項
                                    CustomerOptions.each(function () {
                                        $("#cboCustomerId@(itemName)").val($(this).val()).trigger("change.select2");
                                    });
                                }
                                $("#txtCustomerFullName@(itemName)").val(item.CustomerName);
                            }
                            
                            //Department
                            if (item.Department != "") {
                                var DepartmentOptions = $("#cboDepartmentId@(itemName) option").filter(function () {
                                    return $(this).text().indexOf(item.Department) !== -1;
                                });
                                if (DepartmentOptions.length > 0) {
                                    DepartmentOptions.each(function () {
                                        $("#cboDepartmentId@(itemName)").val($(this).val()).trigger("change.select2");
                                    });
                                }
                            }
                            
                            
                            $("#cboFactory@(itemName)").val(item.Factory).trigger("change.select2");
                            $("#cboTaxType@(itemName)").val(item.TaxType).trigger("change.select2");
                            if ($("#cboTaxType@(itemName)").val() == "3") {
                                $("#cboCustomsClearance@(itemName)").val("2").trigger("change.select2")
                            }
                            else {
                                $("#cboCustomsClearance@(itemName)").val("1").trigger("change.select2")
                            }
                            $("#cboPaymentTerm@(itemName)").val(item.PaymentTerm).trigger("change.select2");
                            $("#cboTradingTerms@(itemName)").val(item.TradingTerms).trigger("change.select2");
                            $("#cboCurrency@(itemName)").val(item.Currency).trigger("change.select2");
                            $("#txtRowCnt@(itemName)").val(item.RowCnt);
                            $("#txtRemark@(itemName)").val(item.Remark);
                            $("#txtCustomerFullName@(itemName)").val(item.CustomerFullName);
                            $("#txtCustomerAddressFirst@(itemName)").val(item.CustomerAddressFirst);
                            $("#txtCustomerAddressSecond@(itemName)").val(item.CustomerAddressSecond);
                            $("#txtContactPerson@(itemName)").val(item.ContactPerson);
                            $("#txtTelephoneNumber@(itemName)").val(item.TelephoneNumber);
                            $("#txtFaxNumber@(itemName)").val(item.FaxNumber);
                            $("#txtCustomerFullNameOre@(itemName)").val(item.CustomerFullName);
                            $("#txtCustomerEgFullName@(itemName)").val(item.CustomerEgFullName);
                            $("#txtInvoiceAddressFirst@(itemName)").val(item.InvoiceAddressFirst);
                            $("#txtTaxRate@(itemName)").val(item.TaxRate);
                            $("#cboTransportMethod@(itemName)").val(item.TransportMethod).trigger("change.select2");;
                            $("#cboTaxCode@(itemName)").val(item.TaxCode).trigger("change.select2");
                            ComboBoxs.Default("#cboInvoiceType@(itemName)", "@Url.Action("GetErpData", "BasicInformation")", { "ColumnName": "InvoiceCount", "Condition": $("#cboTaxCode@(itemName)").val() }, "", "CHOOSE", "", "InvoiceCountName", "InvoiceCountNo");
                            item.MultiTaxRate == "Y" ? $("#cbxMultiTaxRate@(itemName)").attr("checked", true) : $("#cbxMultiTaxRate@(itemName)").attr("checked", false)
                            item.NoCredLimitControl == "Y" ? $("#cbxNoCredLimitControl@(itemName)").attr("checked", true) : $("#cbxNoCredLimitControl@(itemName)").attr("checked", false)
                            $("#txtLCNO@(itemName)").val(item.LCNO);
                            $("#txtInvoiceNO@(itemName)").val(item.InvoiceNO);

                            TaxType = item.TaxType
                            GetExchangeRate(item.Currency)
                        })

                        if (!GetrFromStatus) {
                            //GetrFromStatus = true;
                            GetSourceOrderData("SoDetail", SourceErpPrefix, SourceErpNo, DoDetailList)
                        }
                        break;
                    case "To":
                        $("#cboCurrency@(itemName)").attr("disabled", true);

                        $.each(data.result, function (i, item) {

                            //Customer
                            if (item.Customer != "") {
                                var CustomerOptions = $("#cboCustomerId@(itemName) option").filter(function () {
                                    return $(this).text().indexOf(item.Customer) !== -1;
                                });
                                // 檢查是否有符合的選項
                                if (CustomerOptions.length > 0) {
                                    // 在這裡處理找到的選項
                                    CustomerOptions.each(function () {
                                        $("#cboCustomerId@(itemName)").val($(this).val()).trigger("change.select2");
                                    });
                                }
                                $("#txtCustomerFullName@(itemName)").val(item.CustomerName);
                            }
                            
                            //Department
                            if (item.Department != "") {
                                var DepartmentOptions = $("#cboDepartmentId@(itemName) option").filter(function () {
                                    return $(this).text().indexOf(item.Department) !== -1;
                                });
                                if (DepartmentOptions.length > 0) {
                                    DepartmentOptions.each(function () {
                                        $("#cboDepartmentId@(itemName)").val($(this).val()).trigger("change.select2");
                                    });
                                }
                            }
                            
                            //Salesmen
                            if (item.Salesmen != "") {
                                var SalesmenOptions = $("#cboSalesmenId@(itemName) option").filter(function () {
                                    return $(this).text().indexOf(item.Salesmen) !== -1;
                                });
                                if (SalesmenOptions.length > 0) {
                                    SalesmenOptions.each(function () {
                                        $("#cboSalesmenId@(itemName)").val($(this).val()).trigger("change.select2");
                                        $("#cboCollectionSalesmenId@(itemName)").val($(this).val()).trigger("change.select2");
                                    });
                                }
                            }
                            

                            $("#cboFactory@(itemName)").val(item.Factory).trigger("change.select2");
                            $("#cboTaxType@(itemName)").val(item.TaxType).trigger("change.select2");
                            if ($("#cboTaxType@(itemName)").val() == "3") {
                                $("#cboCustomsClearance@(itemName)").val("2").trigger("change.select2")
                            }
                            else {
                                $("#cboCustomsClearance@(itemName)").val("1").trigger("change.select2")
                            }
                            $("#cboPaymentTerm@(itemName)").val(item.PaymentTerm).trigger("change.select2");
                            $("#cboTradingTerms@(itemName)").val(item.TradingTerms).trigger("change.select2");
                            $("#cboCurrency@(itemName)").val(item.Currency).trigger("change.select2");
                            $("#txtRowCnt@(itemName)").val(item.RowCnt);
                            $("#txtRemark@(itemName)").val(item.Remark);
                            $("#txtCustomerFullName@(itemName)").val(item.CustomerFullName);
                            $("#txtCustomerAddressFirst@(itemName)").val(item.CustomerAddressFirst);
                            $("#txtCustomerAddressSecond@(itemName)").val(item.CustomerAddressSecond);
                            $("#txtContactPerson@(itemName)").val(item.ContactPerson);
                            $("#txtCustomerFullNameOre@(itemName)").val(item.CustomerFullName);
                            $("#txtCustomerEgFullName@(itemName)").val(item.CustomerEgFullName);
                            $("#txtInvoiceAddressFirst@(itemName)").val(item.InvoiceAddressFirst);
                            $("#txtTelephoneNumber@(itemName)").val(item.TelephoneNumber);
                            $("#txtFaxNumber@(itemName)").val(item.FaxNumber);
                            $("#txtTaxRate@(itemName)").val(item.TaxRate);
                            $("#cboTransportMethod@(itemName)").val(item.TransportMethod).trigger("change.select2");;
                            $("#cboTaxCode@(itemName)").val(item.TaxCode).trigger("change.select2");
                            ComboBoxs.Default("#cboInvoiceType@(itemName)", "@Url.Action("GetErpData", "BasicInformation")", { "ColumnName": "InvoiceCount", "Condition": $("#cboTaxCode@(itemName)").val() }, "", "CHOOSE", "", "InvoiceCountName", "InvoiceCountNo");
                            item.MultiTaxRate == "Y" ? $("#cbxMultiTaxRate@(itemName)").attr("checked", true) : $("#cbxMultiTaxRate@(itemName)").attr("checked", false)
                            item.NoCredLimitControl == "Y" ? $("#cbxNoCredLimitControl@(itemName)").attr("checked", true) : $("#cbxNoCredLimitControl@(itemName)").attr("checked", false)
                            $("#txtLCNO@(itemName)").val(item.txtLCNO);
                            $("#txtInvoiceNO@(itemName)").val(item.InvoiceNO);

                            TaxType = item.TaxType
                            GetExchangeRate(item.Currency)

                        })

                        if (!GetrFromStatus) {
                            //GetrFromStatus = true;
                            GetSourceOrderData("ToDetail", SourceErpPrefix, SourceErpNo)
                        }
                        break;
                    case "SoDetail":
                        var row = 1;
                        var dataset = JSON.parse(RoDetailTemplateDefault);
                        spreadsheet@(itemName).parse(dataset);
                        spreadsheetData@(itemName) = dataset;
                        spreadsheet@(itemName).setFormat("B2:B1000", "text")
                        spreadsheet@(itemName).setFormat("C2:C1000", "text")
                        spreadsheet@(itemName).setFormat("D2:D1000", "text")
                        spreadsheet@(itemName).setFormat("E2:E1000", "text")
                        spreadsheet@(itemName).setFormat("F2:F1000", "text")
                        spreadsheet@(itemName).setFormat("G2:G1000", "text")
                        spreadsheet@(itemName).setFormat("H2:H1000", "text")
                        spreadsheet@(itemName).setFormat("L2:L1000", "text")
                        spreadsheet@(itemName).setFormat("N2:N1000", "text")
                        spreadsheet@(itemName).setFormat("W2:W1000", "text")
                        spreadsheet@(itemName).setFormat("X2:X1000", "text")
                        spreadsheet@(itemName).setFormat("Y2:Y1000", "text")
                        spreadsheet@(itemName).setFormat("Z2:Z1000", "text")
                        spreadsheet@(itemName).setFormat("AA2:AA1000", "text")
                        spreadsheet@(itemName).setFormat("AB2:AB1000", "text")
                        spreadsheet@(itemName).setFormat("AD2:AD1000", "text")
                        spreadsheet@(itemName).setFormat("AE2:AE1000", "text")
                        spreadsheet@(itemName).setFormat("AF2:AF1000", "text")
                        spreadsheet@(itemName).setFormat("AG2:AG1000", "text")
                        GetInventory("CMSMC", "", "")
                        $.each(data.result, function (i, item) {
                            row = i + 2
                            //庫別
                            var indexInventoryNo = InventoryArr.findIndex(function (element) {
                                return element.indexOf(item.InventoryNo) !== -1;
                            });
                            //儲位
                            var LocationArr = GetInventory("CMSNL", item.InventoryNo)
                            var indexLocation = LocationArr.findIndex(function (element) {
                                return element.indexOf(item.Location) !== -1;
                            });
                            if (item.Location == "") {
                                indexLocation = -1
                            }
                            //單位
                            var MtlItemUomArr = GetMtlItemUom(item.MtlItemNo, item.UomNo, row, false)

                            var indexUomNo = MtlItemUomArr.findIndex(function (element) {
                                return element.indexOf(item.UomNo) !== -1;
                            });
                            var indexAvailableUomNo = MtlItemUomArr.findIndex(function (element) {
                                return element.indexOf(item.AvailableUomNo) !== -1;
                            });

                            var CanUseFreeSpareQty = 0
                            if (item.Type == "1") {
                                CanUseFreeSpareQty = item.CanUseFreebieQty
                            }
                            else if (item.Type == "2") {
                                CanUseFreeSpareQty = item.CanUseSpareQty
                            }


                            spreadsheet@(itemName).setValidation(`A` + row, ["📌待新增"])
                            spreadsheet@(itemName).setValidation(`E` + row, InventoryArr)
                            spreadsheet@(itemName).setValidation(`G` + row, LocationArr)
                            spreadsheet@(itemName).setValidation(`J` + row, FreeSpareTypeArr)
                            spreadsheet@(itemName).setValidation(`L` + row, MtlItemUomArr)
                            spreadsheet@(itemName).setValidation(`N` + row, MtlItemUomArr)

                            spreadsheet@(itemName).setValue(`A` + row, "📌待新增")
                            spreadsheet@(itemName).setValue(`B` + row, item.MtlItemNo)//品號
                            spreadsheet@(itemName).setValue(`C` + row, item.MtlItemName)//品名
                            spreadsheet@(itemName).setValue(`D` + row, item.MtlItemSpec)//規格
                            spreadsheet@(itemName).setValue(`E` + row, InventoryArr[indexInventoryNo])//庫別
                            spreadsheet@(itemName).setValue(`F` + row, item.InventoryName)//庫別名稱
                            spreadsheet@(itemName).setValue(`G` + row, indexLocation != -1 ? LocationArr[indexLocation] : "")//儲位
                            spreadsheet@(itemName).setValue(`H` + row, "")//儲存位置
                            spreadsheet@(itemName).setValue(`I` + row, parseFloat(item.CanUseQty))//數量
                            spreadsheet@(itemName).setValue(`J` + row, FreeSpareTypeArr[parseInt(item.Type) - 1])//類型
                            spreadsheet@(itemName).setValue(`K` + row, parseFloat(CanUseFreeSpareQty))//贈/備品量
                            spreadsheet@(itemName).setValue(`L` + row, indexUomNo != -1 ? MtlItemUomArr[indexUomNo] : "")//單位
                            spreadsheet@(itemName).setValue(`N` + row, indexAvailableUomNo != -1 ? MtlItemUomArr[indexAvailableUomNo] : "")//計價單位
                            spreadsheet@(itemName).setValue(`M` + row, parseFloat(item.CanUseAvailableQty))//計價數量
                            spreadsheet@(itemName).setValue(`O` + row, item.UnitPrice)//單價
                            spreadsheet@(itemName).setValue(`P` + row, item.TaxRate)//營業稅率
                            spreadsheet@(itemName).setValue(`Q` + row, (parseFloat(item.DiscountRate) != 0 ? parseFloat(item.DiscountRate) : 1))//折扣率
                            spreadsheet@(itemName).setValue(`W` + row, item.SoErpPrefix + '-' + item.SoErpNo + '-' + item.SoSequence)//訂單單別
                            spreadsheet@(itemName).setValue(`X` + row, item.LotManagement != "N" ? item.LotNumber : "")//批號
                            spreadsheet@(itemName).setValue(`Y` + row, item.CustomerMtlItemNo)//客戶品號
                            spreadsheet@(itemName).setValue(`Z` + row, item.ProjectNo)//專案代號
                            spreadsheet@(itemName).setValue(`AA` + row, ``)//專案名稱
                            spreadsheet@(itemName).setValue(`AB` + row, item.Remarks)//備註
                            spreadsheet@(itemName).setValue(`AC` + row, ``)//暫出單
                            spreadsheet@(itemName).setValue(`AD` + row, `N`)//保稅碼
                            spreadsheet@(itemName).setValue(`AE` + row, ``)//預測單
                            spreadsheet@(itemName).setValue(`AG` + row, item.LotManagement)//批號管理
                            AmountCalc(true, true, false, row)
                        })
                        spreadsheet@(itemName).lock("C2:C" + (parseInt(data.result.length) + 1));
                        spreadsheet@(itemName).lock("D2:D" + (parseInt(data.result.length) + 1));
                        spreadsheet@(itemName).lock("F2:F" + (parseInt(data.result.length) + 1));
                        spreadsheet@(itemName).lock("H2:H" + (parseInt(data.result.length) + 1));
                        spreadsheet@(itemName).lock("P2:P" + (parseInt(data.result.length) + 1));
                        spreadsheet@(itemName).lock("S2:S" + (parseInt(data.result.length) + 1));
                        spreadsheet@(itemName).lock("W2:W" + (parseInt(data.result.length) + 1));
                        spreadsheet@(itemName).lock("X2:X" + (parseInt(data.result.length) + 1));
                        spreadsheet@(itemName).lock("Y2:Y" + (parseInt(data.result.length) + 1));
                        spreadsheet@(itemName).lock("AA2:AA" + (parseInt(data.result.length) + 1));
                        spreadsheet@(itemName).lock("AC2:AC" + (parseInt(data.result.length) + 1));
                        spreadsheet@(itemName).lock("AF2:AF" + (parseInt(data.result.length) + 1));
                        spreadsheet@(itemName).lock("AG2:AG" + (parseInt(data.result.length) + 1));
                        break
                    case "ToDetail":
                        var row = 1;
                        var dataset = JSON.parse(RoDetailTemplateDefault);
                        spreadsheet@(itemName).parse(dataset);
                        spreadsheetData@(itemName) = dataset;
                        spreadsheet@(itemName).setFormat("B2:B1000", "text")
                        spreadsheet@(itemName).setFormat("C2:C1000", "text")
                        spreadsheet@(itemName).setFormat("D2:D1000", "text")
                        spreadsheet@(itemName).setFormat("E2:E1000", "text")
                        spreadsheet@(itemName).setFormat("F2:F1000", "text")
                        spreadsheet@(itemName).setFormat("G2:G1000", "text")
                        spreadsheet@(itemName).setFormat("H2:H1000", "text")
                        spreadsheet@(itemName).setFormat("L2:L1000", "text")
                        spreadsheet@(itemName).setFormat("N2:N1000", "text")
                        spreadsheet@(itemName).setFormat("W2:W1000", "text")
                        spreadsheet@(itemName).setFormat("X2:X1000", "text")
                        spreadsheet@(itemName).setFormat("Y2:Y1000", "text")
                        spreadsheet@(itemName).setFormat("Z2:Z1000", "text")
                        spreadsheet@(itemName).setFormat("AA2:AA1000", "text")
                        spreadsheet@(itemName).setFormat("AB2:AB1000", "text")
                        spreadsheet@(itemName).setFormat("AD2:AD1000", "text")
                        spreadsheet@(itemName).setFormat("AE2:AE1000", "text")
                        spreadsheet@(itemName).setFormat("AF2:AF1000", "text")
                        spreadsheet@(itemName).setFormat("AG2:AG1000", "text")
                        GetInventory("CMSMC", "", "")
                        $.each(data.result, function (i, item) {
                            row = i + 2

                            //庫別
                            var indexInventoryNo = InventoryArr.findIndex(function (element) {
                                return element.indexOf(item.InventoryNo) !== -1;
                            });
                            //儲位
                            GetInventory("CMSNL", item.InventoryNo)
                            var indexLocation = LocationArr.findIndex(function (element) {
                                return element.indexOf(item.Location) !== -1;
                            });
                            if (item.Location == "") {
                                indexLocation = -1
                            }
                            //單位
                            var MtlItemUomArr = GetMtlItemUom(item.MtlItemNo, item.AvailableUomNo, row, false)
                            var indexUomNo = MtlItemUomArr.findIndex(function (element) {
                                return element.indexOf(item.UomNo) !== -1;
                            });
                            var indexAvailableUomNo = MtlItemUomArr.findIndex(function (element) {
                                return element.indexOf(item.AvailableUomNo) !== -1;
                            });

                            spreadsheet@(itemName).setValidation(`A` + row, ["📌待新增"])
                            spreadsheet@(itemName).setValidation(`E` + row, InventoryArr)
                            spreadsheet@(itemName).setValidation(`G` + row, LocationArr)
                            spreadsheet@(itemName).setValidation(`L` + row, MtlItemUomArr)
                            spreadsheet@(itemName).setValidation(`N` + row, MtlItemUomArr)
                            spreadsheet@(itemName).setValidation(`J` + row, FreeSpareTypeArr)

                            spreadsheet@(itemName).setValue(`A` + row, "📌待新增")
                            spreadsheet@(itemName).setValue(`B` + row, item.MtlItemNo)//品號
                            spreadsheet@(itemName).setValue(`C` + row, item.MtlItemName)//品名
                            spreadsheet@(itemName).setValue(`D` + row, item.MtlItemSpec)//規格
                            spreadsheet@(itemName).setValue(`E` + row, InventoryArr[indexInventoryNo])//庫別
                            spreadsheet@(itemName).setValue(`F` + row, item.InventoryName)//庫別名稱
                            spreadsheet@(itemName).setValue(`G` + row, indexLocation != -1 ? LocationArr[indexLocation] : "")//儲位
                            spreadsheet@(itemName).setValue(`H` + row, item.SaveLocation)//儲存位置
                            spreadsheet@(itemName).setValue(`I` + row, parseFloat(item.CanUseQty))//數量
                            spreadsheet@(itemName).setValue(`J` + row, FreeSpareTypeArr[parseInt(item.Type) - 1])//類型
                            spreadsheet@(itemName).setValue(`K` + row, parseFloat(item.CanUseFreeSpareQty))//贈/備品量
                            spreadsheet@(itemName).setValue(`L` + row, indexUomNo != -1 ? MtlItemUomArr[indexUomNo] : "")//單位
                            spreadsheet@(itemName).setValue(`M` + row, parseFloat(item.CanUseAvailableQty))//計價數量
                            spreadsheet@(itemName).setValue(`N` + row, indexAvailableUomNo != -1 ? MtlItemUomArr[indexAvailableUomNo] : "")//計價單位
                            spreadsheet@(itemName).setValue(`O` + row, $("#cboPriceSourceType@(itemName)").val() != "So" ? item.UnitPrice : item.SoUnitPrice)//單價
                            spreadsheet@(itemName).setValue(`P` + row, item.TaxRate)//營業稅率
                            spreadsheet@(itemName).setValue(`Q` + row, (parseFloat(item.DiscountRate) != 0 ? parseFloat(item.DiscountRate) : 1))//折扣率
                            spreadsheet@(itemName).setValue(`W` + row, item.FromOrderPrefix + '-' + item.FromOrderNo + '-' + item.FromOrderSequence)//訂單單別
                            spreadsheet@(itemName).setValue(`X` + row, item.LotNumber)//批號
                            spreadsheet@(itemName).setValue(`Y` + row, ``)//客戶品號
                            spreadsheet@(itemName).setValue(`Z` + row, ``)//專案代號
                            spreadsheet@(itemName).setValue(`AA` + row, ``)//專案名稱
                            spreadsheet@(itemName).setValue(`AB` + row, item.Remarks)//備註
                            spreadsheet@(itemName).setValue(`AC` + row, item.TsnErpPrefix + '-' + item.TsnErpNo + '-' + item.TsnSequence)//暫出單
                            spreadsheet@(itemName).setValue(`AD` + row, `N`)//保稅碼
                            spreadsheet@(itemName).setValue(`AE` + row, ``)//預測單
                            spreadsheet@(itemName).setValue(`AG` + row, item.LotManagement)//批號管理
                            AmountCalc(true, true, false, row)
                        })
                        spreadsheet@(itemName).lock("C2:C" + (parseInt(data.result.length) + 1));
                        spreadsheet@(itemName).lock("D2:D" + (parseInt(data.result.length) + 1));
                        spreadsheet@(itemName).lock("F2:F" + (parseInt(data.result.length) + 1));
                        spreadsheet@(itemName).lock("H2:H" + (parseInt(data.result.length) + 1));
                        spreadsheet@(itemName).lock("P2:P" + (parseInt(data.result.length) + 1));
                        spreadsheet@(itemName).lock("S2:S" + (parseInt(data.result.length) + 1));
                        spreadsheet@(itemName).lock("W2:W" + (parseInt(data.result.length) + 1));
                        spreadsheet@(itemName).lock("X2:X" + (parseInt(data.result.length) + 1));
                        spreadsheet@(itemName).lock("Y2:Y" + (parseInt(data.result.length) + 1));
                        spreadsheet@(itemName).lock("AA2:AA" + (parseInt(data.result.length) + 1));
                        spreadsheet@(itemName).lock("AC2:AC" + (parseInt(data.result.length) + 1));
                        spreadsheet@(itemName).lock("AF2:AF" + (parseInt(data.result.length) + 1));
                        spreadsheet@(itemName).lock("AG2:AG" + (parseInt(data.result.length) + 1));
                        break
                }
            }
            else {
                alert("該單據已經結案或是其他異常找不到單據資料!!", "alert", 0);
                let dataset = JSON.parse(RoDetailTemplateDefault);
                spreadsheet@(itemName).parse(dataset);
                spreadsheetData@(itemName) = dataset;
                return
            }
        }
        else {
            alert(data.msg, "alert", 0);
        }
     }
    //前置單據視窗關閉
    function ClosePopView() {
        $("#PopViewOrder@(itemName)").modal("hide");
    }



    //Excel模板啟用
    function ResetSpreadsheet@(itemName)() {
        $("#RoDetailTemporary").empty();
        $("#RoDetailTemporary").css("height", "550px");

        spreadsheet@(itemName) = new dhx.Spreadsheet("RoDetailTemporary", {
            colsCount: 32,
            topSplit: 1,
            menu: false,
            dateFormat: "%Y-%m-%d",
            toolbarBlocks: [
                "format"
            ]
        });
        //右鍵鎖定功能不顯示
        spreadsheet@(itemName).contextMenu.data.remove("lock");

        spreadsheet@(itemName).toolbar.data.add({
            type: "button",
            icon: "fas fa-trash-alt",
            tooltip: "刪除選取數據",
            id: "Delete"
        });

    }

    //取得庫別資料
    function GetInventory(Table, InventoryNo) {
        targetUrl = "@Url.Action("GetInventory", "ReceiveOrder")";
        postData = {
            "ViewCompanyId": companyId@(itemName),
            "Table": Table,
            "InventoryNo": InventoryNo
        };
        data = DataAccess.Get(targetUrl, postData, false);
        if (data.status == "success") {
            switch (Table) {
                case "CMSMC":
                    $.each(data.result, function (i, item) {
                        InventoryArr.push(item.InventoryNo + ":" + item.InventoryName)
                    });
                    break
                case "CMSNL":
                    LocationArr = []
                    $.each(data.result, function (i, item) {
                        LocationArr.push(item.Location + ":" + item.LocationName)
                    });
                    return LocationArr
                    break
            }
        }
        else {
            alert(data.msg, "alert", 0);
        }
    }

    //取得品號單位算換資料
    function GetMtlItemUom(MtlItemNo) {
        let targetUrl = "@Url.Action("GetMtlItemUom", "ReceiveOrder")";
        let postData = {
            "MtlItemNo": MtlItemNo
        };
        let data = DataAccess.Get(targetUrl, postData, false);
        if (data.status == "success") {
            let MtlItemUomArr = []
            $.each(data.result, function (i, item) {
                MtlItemUomArr.push(item.ChaUomNo)
            });

            return MtlItemUomArr
        }
        else {
            alert(data.msg, "alert", 0);
        }
    }

    //銷貨單身-單位換算資料設定+換算後的計價數量
    function CalcQty(MtlItemNo, Rows, ChangeStatus) {
        let targetUrl = "@Url.Action("GetMtlItemUom", "ReceiveOrder")";
        let postData = {
            "MtlItemNo": MtlItemNo
        };
        let data = DataAccess.Get(targetUrl, postData, false);
        if (data.status == "success") {
            let MtlItemUomArrDetail = []
            let AvailableQty = 0//計價數量
            let Quantity = spreadsheet@(itemName).getValue("I" + Rows)
            let UomNo = spreadsheet@(itemName).getValue("L" + Rows)
            let AvailableUomNo = spreadsheet@(itemName).getValue("N" + Rows)
            $.each(data.result, function (i, item) {
                var newItem = {
                    "OreUomNo": item.OreUomNo,
                    "SwapDenominator": item.SwapDenominator,
                    "ChaUomNo": item.ChaUomNo,
                    "SwapNumerator": item.SwapNumerator
                };
                MtlItemUomArrDetail.push(newItem)
            });

            $.each(MtlItemUomArrDetail, function (index, item) {
                if (item.ChaUomNo === UomNo) {
                    AvailableQty = parseFloat(Quantity) / parseFloat(item.SwapNumerator) * parseFloat(item.SwapDenominator)
                }
            });
            $.each(MtlItemUomArrDetail, function (index, item) {
                if (item.ChaUomNo === AvailableUomNo) {
                    AvailableQty = AvailableQty / parseFloat(item.SwapDenominator) * parseFloat(item.SwapNumerator)
                }
            });
            spreadsheet@(itemName).setValue(`M` + Rows, AvailableQty)//計價數量

            if (ChangeStatus) {
                spreadsheet@(itemName).setValue(`O` + Rows, 0)//單價
                spreadsheet@(itemName).setValue(`R` + Rows, 0)//金額
                spreadsheet@(itemName).setValue(`S` + Rows, 0)//原幣未稅金額
                spreadsheet@(itemName).setValue(`T` + Rows, 0)//原幣稅額
                spreadsheet@(itemName).setValue(`U` + Rows, 0)//本幣未稅金額
                spreadsheet@(itemName).setValue(`V` + Rows, 0)//本幣稅額
            }
        }
        else {
            alert(data.msg, "alert", 0);
        }
    }

    //ERP匯率資料撈取
    function GetExchangeRate(Currency) {
        let targetUrl = "@Url.Action("GetExchangeRate", "ReceiveOrder")";
        let postData = {
            "Condition": Currency,
            "ErpPrefix": RoErpPrefix
        };
        let data = DataAccess.Get(targetUrl, postData, false);
        if (data.status == "success") {
            $.each(data.result, function (i, item) {
                $("#txtExchangeRate@(itemName)").val(item.ExchangeRateInBank)
                ExchangeRate = item.ExchangeRate
                Currency = item.Currency

                // 原幣單價取位
                decimalOrPrice = CalculateDecimalPlaces(item.decimalOrPrice);
                // 原幣金額取位
                decimalOrAmoute = CalculateDecimalPlaces(item.decimalOrAmoute);
                // 本幣單價取位
                decimalLoPrice = CalculateDecimalPlaces(item.decimalLoPrice);
                // 本幣金額取位
                decimalLoAmoute = CalculateDecimalPlaces(item.decimalLoAmoute);
            });
        }
        else {
            alert(data.msg, "alert", 0);
        }
    }
    function CalculateDecimalPlaces(decimalData) {
        return Math.pow(10, decimalData);
    }
    //金錢計算
    function AmountCalc(bodayAction, headAction, useAmount,row) {
        let rowData
        let AvailableQty
        let UnitPrice
        let TaxRate
        let DiscountRate
        let Amount
        if (bodayAction) {
            if (!!row) {
                //單筆異動
                rowData = spreadsheet@(itemName).getValue(`M${row},O${row},P${row},Q${row},R${row}`);
                AvailableQty = parseFloat(rowData[0])
                UnitPrice = parseFloat(rowData[1])
                TaxRate = parseFloat(rowData[2])
                DiscountRate = parseFloat(rowData[3])
                Amount = parseFloat(rowData[4])
                BodyMoneyCalc(useAmount, AvailableQty, UnitPrice, TaxRate, DiscountRate, Amount, row)
            }
            else {
                //全域異動
                spreadsheetData@(itemName) = spreadsheet@(itemName).serialize();
                $.each(spreadsheetData@(itemName).sheets[0].data, function (i, item) {
                    let cell = item.cell;
                    let row = parseInt(cell.substring(1))
                    let MtlItemNo = item.value
                    if (cell.charAt(0) == "B" && row > 1) {
                        if (!!MtlItemNo) {
                            rowData = spreadsheet@(itemName).getValue(`M${row},O${row},P${row},Q${row},R${row}`);
                            AvailableQty = parseFloat(rowData[0])
                            UnitPrice = parseFloat(rowData[1])
                            TaxRate = parseFloat(rowData[2])
                            DiscountRate = parseFloat(rowData[3])
                            Amount = parseFloat(rowData[4])
                            BodyMoneyCalc(useAmount, AvailableQty, UnitPrice, TaxRate, DiscountRate, Amount, row)
                        }
                    }
                })
            }
        }
        if (headAction) {
            HeadMoneyCalc()
        }
    }

    //單身金錢資料重計
    function BodyMoneyCalc(useAmount, AvailableQty, UnitPrice, TaxRate, DiscountRate, Amount, row) {
        let OriginalAmount = 0
        let OriginalTaxAmount = 0
        let PretaxAmount = 0
        let TaxAmount = 0
        if (!useAmount) {
            //金額欄位重新計算 = 計價數量*單價*折扣率
            Amount = AvailableQty * UnitPrice * DiscountRate
        }
        let OraExponent = Math.log(decimalOrAmoute) / Math.log(10);
        let LoaExponent = decimalLoAmoute != 1 ? Math.log(decimalLoAmoute) / Math.log(10) : 0;

        switch (TaxType) {
            case "1": //內含
                //原幣未稅金額
                OriginalAmount = (Math.round(Amount / (1 + TaxRate) * decimalOrAmoute) / decimalOrAmoute).toFixed(OraExponent)
                //原幣稅額
                OriginalTaxAmount = (Amount - OriginalAmount).toFixed(OraExponent)
                //本幣未稅金額
                PretaxAmount = (Math.round(OriginalAmount * ExchangeRate * decimalLoAmoute) / decimalLoAmoute).toFixed(LoaExponent)
                //本幣稅額
                TaxAmount = (OriginalTaxAmount * ExchangeRate).toFixed(LoaExponent)
                break;
            case "2": //外加
                //原幣未稅金額
                OriginalAmount = Amount.toFixed(LoaExponent)
                //原幣稅額
                OriginalTaxAmount = (Math.round(Amount * TaxRate * decimalOrAmoute) / decimalOrAmoute).toFixed(LoaExponent)
                //本幣未稅金額
                PretaxAmount = (Math.round(OriginalAmount * ExchangeRate * decimalLoAmoute) / decimalLoAmoute).toFixed(LoaExponent)
                //本幣稅額
                TaxAmount = (Math.round(OriginalTaxAmount * ExchangeRate * decimalLoAmoute) / decimalLoAmoute).toFixed(LoaExponent)
                break;
            default:
                //原幣未稅金額
                OriginalAmount = Amount.toFixed(LoaExponent)
                OriginalTaxAmount = 0
                PretaxAmount = (OriginalAmount * ExchangeRate).toFixed(LoaExponent)
                TaxAmount = 0
                break;
        }
        Amount = (Math.round(Amount * decimalOrAmoute) / decimalOrAmoute).toFixed(OraExponent)

        spreadsheet@(itemName).unlock("S" + row);
        spreadsheet@(itemName).setValue(`R` + row, Amount)//金額
        spreadsheet@(itemName).setValue(`S` + row, OriginalAmount)//原幣未稅金額
        spreadsheet@(itemName).setValue(`T` + row, OriginalTaxAmount)//原幣稅額
        spreadsheet@(itemName).setValue(`U` + row, PretaxAmount)//本幣未稅金額
        spreadsheet@(itemName).setValue(`V` + row, TaxAmount)//本幣稅額
        spreadsheet@(itemName).lock("S" + row);
    }

    //單頭金錢資料重計
    function HeadMoneyCalc() {
        let TotalOriginalAmount = 0;
        let TotalOriginalTaxAmount = 0;
        let TotalOriginalAmountSum = 0;
        let TotalPretaxAmount = 0;
        let TotalTaxAmount = 0;
        let TotalPretaxAmountSum = 0;
        let TotalQty = 0;

        for (var i = 2; i <= 1000; i++) {
            let rowData = spreadsheet@(itemName).getValue(`B${i},I${i},K${i},S${i},T${i},U${i},V${i}`);
            if (!!rowData[0]) {
                //取值
                let Quantity = parseFloat(rowData[1])
                let FreeSpareQty = parseFloat(rowData[2])
                let OriginalAmount = parseFloat(rowData[3])
                let OriginalTaxAmount = parseFloat(rowData[4])
                let PretaxAmount =parseFloat(rowData[5])
                let TaxAmount = parseFloat(rowData[6])
                //累加
                TotalQty += Quantity + FreeSpareQty
                TotalOriginalAmount += OriginalAmount
                TotalOriginalTaxAmount += OriginalTaxAmount
                TotalOriginalAmountSum += OriginalAmount + OriginalTaxAmount
                TotalPretaxAmount += PretaxAmount
                TotalTaxAmount += TaxAmount
                TotalPretaxAmountSum += PretaxAmount + TaxAmount
            }
        }
        //賦值
        $("#txtOriginalAmount@(itemName)").val(TotalOriginalAmount);
        $("#txtOriginalTaxAmount@(itemName)").val(TotalOriginalTaxAmount);
        $("#txtOriginalAmountSum@(itemName)").val(TotalOriginalAmountSum);
        $("#txtPretaxAmount@(itemName)").val(TotalPretaxAmount);
        $("#txtTaxAmount@(itemName)").val(TotalTaxAmount);
        $("#txtPretaxAmountSum@(itemName)").val(TotalPretaxAmountSum);
        $("#txtTotalQuantity@(itemName)").val(TotalQty);
    }


    //批號管理頁面
    let objPageLotManagement = {
        "pageIndex": 0,
        "pageSize": 10
    };
    function GetLotManagement(MtlItemNo, InventoryNo, row) {
        let innerHtml = '';
        let pageCount = 0;
        let targetUrl = "@Url.Action("GetLotNumberInventory", "Inventory")";
        let postData = {
            "OrderBy": "",
            "PageIndex": (objPageLotManagement.pageIndex + 1),
            "PageSize": objPageLotManagement.pageSize,
            "MtlItemNo": MtlItemNo,
            "InventoryId": -1,
            "Receipt": "Mr"
        }
        let data = DataAccess.Get(targetUrl, postData, false);

        if (data.status == "success") {
            if (data.result.length > 0) {
                objPageLotManagement = PageCaculate(pageCount, objPageLotManagement);

                $.each(data.result, function (i, item) {
                    let _row = (objPageLotManagement.pageSize * objPageLotManagement.pageIndex + (i + 1)) + ".";

                    innerHtml += `<tr>
                                    <td>${_row}</td>
                                    <td>${item.ME002}</td>
                                    <td>${item.MF007}</td>
                                    <td>${item.num}</td>
                                    <td>${item.ME003}</td>
                                    <td>${item.ME009}</td>
                                    <td class="text-center col-sticky">
                                      <label class="control control-solid control-solid-info control--radio">
                                        <input type="radio" name="chkLotNumber@(itemName)" data-lot-number="${item.ME002}" data-inventory-no="${item.MF007}" data-expiration-date="${item.ME009}" value="${item.ME002}"/>
                                        <span class="control__indicator  ${ item.MF007 != InventoryNo ? `trLock` : ``}"></span>
                                      </label>
                                    </td>
                                  </tr>`;
                });
            } else {
                innerHtml += `<tr>
                                <td class="text-center" colspan="7" style="background-color: #fff3cd;">
                                  <i class="fal fa-exclamation-circle"></i>&nbsp;目前尚無資料。
                                </td>
                              </tr>`;
            }
        } else {
            alert(data.msg, "warning", 0);
            setTimeout(function () { Close@(itemName)();}, 100)
            return
        }

        $("#tblLotManagementData@(itemName) tbody").html(innerHtml);
        TableComponentInit();
        Pager("#pageSelectLotManagement@(itemName)", pageCount, objPageLotManagement, GetLotManagement);

        $("input[type='radio']").click(function () {
            if ("[data-lot-number]:checked") {

                let LotNumber = $(this).data("lot-number");
                let ExpirationDate = $(this).data("expiration-date");
                var docDate = $("#txtReceiveDate@(itemName)").val();
                docDate = docDate.replace(/-/g, "")

                if (ExpirationDate != "") {
                    if (ExpirationDate >= docDate) {
                        spreadsheet@(itemName).setValue(`X` + row, LotNumber)//庫別
                        CloseSelectLotManagement()
                    }
                    else {
                        alert("該批號已經失效了")
                    }
                }
                else {
                    spreadsheet@(itemName).setValue(`X` + row, LotNumber)//庫別
                    CloseSelectLotManagement()
                }
            }
        });
    }

    //出貨轉銷貨
    let objPageDelivery@(itemName) = {
        "pageIndex": 0,
        "pageSize": 50
    };
    function OpenDelivery@(itemName)() {
        @*if (companyId@(itemName) != 3) {
            alert("非紘立公司不能使用出貨轉銷貨功能")
            return
        }*@

        alert("不開放使用囉~~")
        return


        $("#modalDelivery@(itemName)").modal("show");
        objPageDelivery@(itemName).pageIndex = 0;
        $("#txtDeliveryStartDateQ@(itemName)").val($("#txtStartDocDateQ@(itemName)").val());
        $("#txtDeliveryEndDateQ@(itemName)").val($("#txtEndDocDateQ@(itemName)").val());


        $("#cbxSelectAll@(itemName)").prop("checked", false);
        GetDelivery@(itemName)(objPageDelivery@(itemName))

    }
    function CloseDelivery@(itemName)(){
        $("#modalDelivery@(itemName)").modal("hide");
    }
    function GetDelivery@(itemName)(objPage) {
        if (typeof objPage == "undefined") {
            objPageDelivery@(itemName).pageIndex = 0;
            objPage = objPageDelivery@(itemName)
        }
        let innerHtml = '';
        let pageCount = 0;

        let targetUrl = "@Url.Action("GetDeliveryToTsn", "ScmInventory")";
        let postData = {
            "OrderBy": "",
            "PageIndex": (objPage.pageIndex + 1),
            "PageSize": objPage.pageSize,
            "CustomerId": $("#cboDeliveryCustomerQ@(itemName)").val(),
            "SearchKey": $("#txtSearchKeyQ@(itemName)").val(),
            "StartDate": $("#txtDeliveryStartDateQ@(itemName)").val(),
            "EndDate": $("#txtDeliveryEndDateQ@(itemName)").val()
        };
        let data = DataAccess.Get(targetUrl, postData, false);

        if (data.status == "success") {
            pageCount = data.result.length > 0 ? parseInt(data.result[0]["TotalCount"]) : 0;

            if (pageCount > 0) {
                objPage = PageCaculate(pageCount, objPage);

                let SameInfo = ""
                let ColorUse = ""

                $.each(data.result, function (i, item) {
                    let _row = (objPage.pageSize * objPage.pageIndex + (i + 1)) + ".";
                    let SameInfoNow = item.DoDate + "-" + item.SoErpFullNo
                    let ColorUserNow = ""
                    let Color1 = "#ffcbcb94"
                    let Color2 = "#aef6fd47"
                    if (SameInfo == "") {
                        SameInfo = SameInfoNow
                        ColorUse = Color1
                    }
                    else {
                        if (SameInfo != SameInfoNow) {
                            if (ColorUse == Color1) {
                                ColorUse = Color2
                            }
                            else {
                                ColorUse = Color1
                            }
                        }
                    }
                    innerHtml += `<tr>
                                    <td style="background:${ColorUse}!important" class="text-center col-sticky">
                                        <label class="control control-solid control-solid-info control--checkbox">
                                        <input type="checkbox" data-do-detail-id="${item.DoDetailId}" data-customer-id="${item.CustomerId}" data-sofull-no="${item.SoErpFullNo}" data-dodate="${item.DoDate}"  value="${item.DoDetailId}" />
                                        <span class="control__indicator"></span>
                                        </label>
                                    </td>
                                    <td style="background:${ColorUse}!important" class="col-sticky">${item.DoDate}</td>
                                    <td style="background:${ColorUse}!important" class="col-sticky">${item.SoErpFullNo}<code>(${item.SoSequence})</code></td>
                                    <td style="background:${ColorUse}!important" class="col-sticky" data-toggle="tooltip" title="${item.MtlItemNo}" style="max-width: 150px;">${item.MtlItemNo}</td>
                                    <td style="background:${ColorUse}!important" class="col-sticky" data-toggle="tooltip" title="${item.MtlItemName}" style="max-width: 175px;">${item.MtlItemName}</td>
                                    <td style="background:${ColorUse}!important"><code>${item.CustomerNo}</code> ${item.CustomerShortName}</td>
                                    <td style="background:${ColorUse}!important" class="p-0">
                                        <select class="form-control" name="cboPopInventory@(itemName)" data-do-detail-id="${item.DoDetailId}" data-pop-inventory="${item.InventoryNo}"></select>
                                    </td>
                                    <td class="text-right" style=" background-color:#FFECC9;">${item.PickRegularQty.toLocaleString(`en`)}</td>
                                    <td class="text-right" style=" background-color:#FFECC9;">${item.PickFreebieQty.toLocaleString(`en`)}</td>
                                    <td class="text-right" style=" background-color:#FFECC9;">${item.PickSpareQty.toLocaleString(`en`)}</td>

                                    <td class="text-right" style=" background-color:#85C1E9;">${item.SoRegularQty.toLocaleString(`en`)}</td>
                                    <td class="text-right" style=" background-color:#85C1E9;">${item.SoFreebieQty.toLocaleString(`en`)}</td>
                                    <td class="text-right" style=" background-color:#85C1E9;">${item.SoSpareQty.toLocaleString(`en`)}</td>

                                    <td class="text-right" style=" background-color:#73C6B6;">${item.TsnQty.toLocaleString(`en`)}</td>
                                    <td class="text-right" style=" background-color:#73C6B6;">${item.TsnFreebieQty.toLocaleString(`en`)}</td>
                                    <td class="text-right" style=" background-color:#73C6B6;">${item.TsnSpareQty.toLocaleString(`en`)}</td>

                                    <td><code>${item.CustomerNo}</code> ${item.CustomerShortName}</td>
                                    <td>${item.DcShortName}</td>
                                    <td>
                                        ${item.SalesmenGender == `M` ? `<span class="gender-male"><i class="fas fa-male"></i></span>` : item.SalesmenGender == `F` ? `<span class="gender-female"><i class="fas fa-female"></i></span>` : ``}${item.SalesmenNo} ${item.SalesmenName}
                                    </td>
                                    <td>${item.PcDoDetailRemark}</td>
                                    </tr>`;
                });
            } else {
                innerHtml += `<tr>
                                <td class="text-center" colspan="20" style="background-color: #fff3cd;">
                                    <i class="fal fa-exclamation-circle"></i>&nbsp;目前尚無資料。
                                </td>
                                </tr>`;
            }
        } else {
            alert(data.msg, "alert", 0);
        }

        $("#tblDelivery@(itemName) tbody").html(innerHtml);
        TableComponentInit();
        Pager("#pageDelivery@(itemName)", pageCount, objPage, GetDelivery@(itemName));

        ComboBoxs.Default("select[name='cboTsnOutInventory@(itemName)'][data-do-detail-id], select[name='cboTsnInInventory@(itemName)'][data-do-detail-id]", "@Url.Action("GetInventory", "ScmBasicInformation")", { "Status": "A" }, "", "NA", "", "InventoryWithNo", "InventoryId");

        $("#cbxSelectAll@(itemName)").off("click").on("click", function () {
            if ($("#cbxSelectAll@(itemName)").is(":checked")) {
                $("input[type='checkbox'][data-do-detail-id]").not(":disabled").prop("checked", true);
            } else {
                $("input[type='checkbox'][data-do-detail-id]").not(":disabled").prop("checked", false);
            }
        });
        ComboBoxs.Default("select[name='cboPopInventory@(itemName)'][data-do-detail-id], select[name='cboPopInventory@(itemName)'][data-do-detail-id]", "@Url.Action("GetInventory", "ScmBasicInformation")", { "Status": "A" }, "", "NA", "", "InventoryWithNo", "InventoryNo");

        $("select[name='cboPopInventory@(itemName)'][data-do-detail-id]").each(function () {
            $(this).val($(this).data("pop-inventory"));
        });

        $("select[name='cboPopInventory@(itemName)'][data-do-detail-id], select[name='cboPopInventory@(itemName)'][data-do-detail-id]").select2({
            dropdownAutoWidth: true,
            width: "100%"
        });
    }

    let PopSoFullNo = ""
    function OpenRoErpPrefix@(itemName)() {
        let doDetail = [];
        let SameCustomer = true
        let CustomerId = -1
        let SameSoFullNo = true
        let SoFullNo = ""
        let DodateStatus = true
        let DoDate = ""

        $.each($("input[type='checkbox'][data-do-detail-id]:checked"), function (i) {
            let doDetailId = $(this).data("do-detail-id");
            SoFullNo = $(this).data("sofull-no");
            if (CustomerId == -1) {
                CustomerId = $(this).data("customer-id");
            }
            else {
                if (CustomerId != $(this).data("customer-id")) {
                    doDetail = []
                    SameCustomer = false
                    return false
                }
            }
            if (SoFullNo == "") {
                SoFullNo = $(this).data("sofull-no");
            }
            else {
                if (SoFullNo != $(this).data("sofull-no")) {
                    doDetail = []
                    SameSoFullNo = false
                    return false
                }
            }
            if (DoDate == "") {
                DoDate = $(this).data("dodate");
            }
            else {
                if (DoDate != $(this).data("dodate")) {
                    doDetail = []
                    DodateStatus = false
                    return false
                }
            }
            doDetail.push(doDetailId);
        });
        if (!SameCustomer) {
            alert("選取資料客戶不一致,請重新確認!");
            return
        }
        if (!SameSoFullNo) {
            alert("選取資料訂單不一致,請重新確認!");
            return
        }
        if (!DodateStatus) {
            alert("選取資料出貨日不一致,請重新確認!");
            return
        }
        if (doDetail.length > 0) {
            $("#modalRoErpPrefix@(itemName)").modal("show");
            let currentDate = new Date();
            Suites.DatePicker("txtPopDocDate@(itemName)", DoDate);

            //單別選單
            ComboBoxs.WithText("#cboPopRoErpPrefix@(itemName)", "@Url.Action("GetErpData", "BasicInformation")", { "UserNo": userNo@(itemName), "ColumnName": "RoErpPrefix" }, "", "NA", "", "RoErpPrefixName", "RoErpPrefix");
            //客戶選單
            ComboBoxs.Default("#cboPopCustomerId@(itemName)", "@Url.Action("GetCustomer", "ScmBasicInformation")", { "Status": "A", "TransferStatus": "A" }, CustomerId, "NA", "", "CustomerWithNo", "CustomerId");
            //業務選單,收款業務選單
            //ComboBoxs.Default("#cboPopSalesmenId@(itemName)", "@Url.Action("GetUser", "BasicInformation")", {"CompanyId": companyId@(itemName), "Status": "A"}, "", "NA", "", "UserWithNo", "UserId");
            ComboBoxs.Default("#cboPopSalesmenId@(itemName), #cboPopCollectionSalesmenId@(itemName)", "@Url.Action("GetUserByAuthority", "BasicInformation")", { "CompanyId": companyId@(itemName), "FunctionCode": "SaleOrderManagement", "DetailCode": "add", "Status": "A"}, "", "CHOOSE", "請選擇業務", "UserWithNo", "UserId");
            //部門選單
            ComboBoxs.Default("#cboPopDeptId@(itemName)", "@Url.Action("GetDepartment", "BasicInformation")", { "CompanyId": companyId@(itemName), "Status": "A" }, "", "NA", "", "DepartmentWithNo", "DepartmentId");

            $("#cboPopRoErpPrefix@(itemName), #cboPopCustomerId@(itemName), #cboPopSalesmenId@(itemName), #cboPopDeptId@(itemName), #cboPopCollectionSalesmenId@(itemName)").select2({
                dropdownAutoWidth: true,
                width: "100%"
            });
            PopSoFullNo = SoFullNo
        } else {
            alert("請至少選擇一筆資料!");
        }
        
    }
    function CloseRoErpPrefix@(itemName)() {
        $("#modalRoErpPrefix@(itemName)").modal("hide");
        PopSoFullNo = ""
        
    }

    function PopRoSave@(itemName)() {

        let SameCustomer = true
        let doDetail = [];
        let CustomerId = -1
        let doJson = JSON.parse('{ "data" : []}');
        let PopDocDate = $("#txtPopDocDate@(itemName)").val()
        let PopRoErpPrefix = $("#cboPopRoErpPrefix@(itemName)").val()
        
        $.each($("input[type='checkbox'][data-do-detail-id]:checked"), function (i) {
            let doDetailId = $(this).data("do-detail-id");
            doDetail.push(doDetailId);
            let json = {
                doDetailId: doDetailId,
                Inventory: $(`select[name='cboPopInventory@(itemName)'][data-do-detail-id='${doDetailId}']`).val() ? $(`select[name='cboPopInventory@(itemName)'][data-do-detail-id='${doDetailId}']`).val() : -1,
            };

            doJson.data.push(json);

        });
        if (PopRoErpPrefix == "" || PopDocDate == "") {
            alert("單別或單據日不可為空,請重新確認!");
            return
        }
        else {
            //$("#loaderWrpper").show()

            //Edit@(itemName)()
            //$("#txtDocDate@(itemName)").val(PopDocDate)
            //$("#txtReceiveDate@(itemName)").val(PopDocDate)
            //$("#cboRoErpPrefix@(itemName)").val(PopRoErpPrefix).trigger("change.select2");
            //GetSourceOrderData("So", PopSoFullNo.split('-')[0], PopSoFullNo.split('-')[1], doDetail.join(','))
            //CloseRoErpPrefix@(itemName)()
            //CloseDelivery@(itemName)()
            //Save@(itemName)()
            //Import@(itemName)(NewRoId,true)
            //setTimeout(function () {
            //    $("#loaderWrpper").hide()
            //    Return@(itemName)();
            //    NewRoId = -1
            //}, 2000); // 1000 毫秒等於 1 秒
            //return
        }

        
        console.log(doJson)
        if (!SameCustomer) {
            alert("選取資料客戶不一致,請重新確認!");
            return
        }

        if (doJson.data.length > 0) {
            let targetUrl = "@Url.Action("AddReceiveOrderToErp", "ReceiveOrder")";
            let postData = {
                "ViewCompanyId": companyId@(itemName),
                "DocDate": $("#txtPopDocDate@(itemName)").val(),
                "RoErpPrefix": $("#cboPopRoErpPrefix@(itemName)").val(),
                "CustomerId": $("#cboPopCustomerId@(itemName)").val(),
                "SalesmenId": $("#cboPopSalesmenId@(itemName)").val(),
                "CollectionSalesmenId": $("#cboPopCollectionSalesmenId@(itemName)").val(),
                "DepartmentId": $("#cboPopDeptId@(itemName)").val(),
                "Remark": $("#txtPopRemark@(itemName)").val(),
                "DoDetails": JSON.stringify(doJson)
            }

            let result = DataAccess.Update(targetUrl, postData, false, true);

            if (result) {
                CloseRoErpPrefix@(itemName)()
                CloseDelivery@(itemName)()
                Sync@(itemName)(true)
                Return@(itemName)();
            }
        } else {
            alert("請至少選擇一筆資料!");
        }
    }



    //單身資料刪除
    function DeleteExcelData@(itemName)() {
        spreadsheetJson@(itemName).spreadsheetInfo = [];
        spreadsheetData@(itemName) = spreadsheet@(itemName).serialize();

        var RoDetailList = [];
        $.each(spreadsheetData@(itemName).sheets[0].data, function (i, item) {
            let cell = item.cell;

            if (cell.charAt(0) == "A" && parseInt(cell.substring(1))) {
                row = parseInt(cell.substring(1))
                if (row > 1 && item.value == "🗑️刪除") {
                    var RoDetailId = spreadsheet@(itemName).getValue("AF" + row)
                    RoDetailList.push(RoDetailId)
                }
            }
        });
        if (RoDetailList.length > 0) {
            swal.fire({
                titleText: "確認要刪除選取數據嗎?",
                text: "此動作無法復原，請確認是否要執行!",
                icon: "warning",
                allowOutsideClick: false,
                allowEscapeKey: false,
                showCancelButton: true,
                confirmButtonColor: '#d33',
                reverseButtons: true
            }).then((result) => {
                if (result.isConfirmed) {
                    let targetUrl = "@Url.Action("DeleteRoDetail", "ReceiveOrder")";
                    let postData = {
                        "RoDetailList": RoDetailList.join(",")
                    };

                    let result = DataAccess.Delete(targetUrl, postData, false, true);

                    if (result) {
                        Return@(itemName)();
                    }
                }
            });
        }
        else {
            alert("請選擇要刪除的資料")
        }
    }

    //拋轉ERP
    function Import@(itemName)(RoId, Auto) {
        var inConfrim = "N";
        if (RoId == "-1") {
            RoId = $("#RoId").val()
            inConfrim = "Y"
        }
        if (!Auto) {
            swal.fire({
                titleText: "銷貨單是否要拋轉ERP嗎?",
                text: "此動作會將單據拋轉ERP，請確認是否要執行!",
                icon: "warning",
                allowOutsideClick: false,
                allowEscapeKey: false,
                showCancelButton: true,
                confirmButtonColor: '#d33',
                reverseButtons: true
            }).then((result) => {
                if (result.isConfirmed) {
                    let targetUrl = "@Url.Action("UpdateReceiveOrderToERP", "ReceiveOrder")";
                    let postData = {
                        "RoId": RoId
                    };

                    let result = DataAccess.Other(targetUrl, postData, false, true);

                    if (result) {
                        Query@(itemName)();

                        if (inConfrim == "Y") {
                            Return@(itemName)()
                        }
                    }
                }
            });
        }
        else {
            let targetUrl = "@Url.Action("UpdateReceiveOrderToERP", "ReceiveOrder")";
            let postData = {
                "RoId": RoId
            };

            let result = DataAccess.Other(targetUrl, postData, false, true);
        }
        
    }
    //重新編輯
    function Revise@(itemName)(RoId) {
        var inConfrim = "N";
        if (RoId == "-1") {
            RoId = $("#RoId").val()
            inConfrim = "Y"
        }
        swal.fire({
            titleText: "銷貨單是否要重新編輯嗎?",
            text: "此動作可以讓單據回歸MES做編輯，請確認是否要執行!",
            icon: "warning",
            allowOutsideClick: false,
            allowEscapeKey: false,
            showCancelButton: true,
            confirmButtonColor: '#d33',
            reverseButtons: true
        }).then((result) => {
            if (result.isConfirmed) {
                let targetUrl = "@Url.Action("UpdateReceiveOrderReviseMES", "ReceiveOrder")";
                let postData = {
                    "RoId": RoId
                };

                let result = DataAccess.Other(targetUrl, postData, false, true);

                if (result) {
                    Query@(itemName)();

                    if (inConfrim == "Y") {
                        Return@(itemName)()
                    }
                }
            }
        });
    }

    //單據核單
    function Confirm@(itemName)(RoId) {
        var inConfrim = "N";
        if (RoId == "-1") {
            RoId = $("#RoId").val()
            inConfrim = "Y"
        }
        swal.fire({
            titleText: "銷貨單是否要核單嗎?",
            text: "請確認是否要執行!",
            icon: "warning",
            allowOutsideClick: false,
            allowEscapeKey: false,
            showCancelButton: true,
            confirmButtonColor: '#d33',
            reverseButtons: true
        }).then((result) => {
            if (result.isConfirmed) {
                let targetUrl = "@Url.Action("UpdateRoConfirm", "ReceiveOrder")";
                let postData = {
                    "RoId": RoId
                };

                let result = DataAccess.Other(targetUrl, postData, false, true);

                if (result) {
                    Query@(itemName)();

                    if (inConfrim == "Y") {
                        Return@(itemName)()
                    }
                }
            }
        });
    }

    //單據反確認
    function ReConfirm@(itemName)(RoId) {
        var inConfrim = "N";
        if (RoId == "-1") {
            RoId = $("#RoId").val()
            inConfrim = "Y"
        }
        swal.fire({
            titleText: "銷貨單是否要反確認嗎?",
            text: "請確認是否要執行!",
            icon: "warning",
            allowOutsideClick: false,
            allowEscapeKey: false,
            showCancelButton: true,
            confirmButtonColor: '#d33',
            reverseButtons: true
        }).then((result) => {
            if (result.isConfirmed) {
                let targetUrl = "@Url.Action("UpdateRoReconfirm", "ReceiveOrder")";
                let postData = {
                    "RoId": RoId
                };

                let result = DataAccess.Other(targetUrl, postData, false, true);

                if (result) {
                    Query@(itemName)();

                    if (inConfrim == "Y") {
                        Return@(itemName)()
                    }
                }
            }
        });
    }

    //單據作廢
    function Void@(itemName)(RoId) {
        var inConfrim = "N";
        if (RoId == "-1") {
            RoId = $("#RoId").val()
            inConfrim = "Y"
        }
        swal.fire({
            titleText: "銷貨單是否要作廢嗎?",
            text: "請確認是否要執行!",
            icon: "warning",
            allowOutsideClick: false,
            allowEscapeKey: false,
            showCancelButton: true,
            confirmButtonColor: '#d33',
            reverseButtons: true
        }).then((result) => {
            if (result.isConfirmed) {
                let targetUrl = "@Url.Action("UpdateReceiveOrderVoid", "ReceiveOrder")";
                let postData = {
                    "RoId": RoId
                };

                let result = DataAccess.Other(targetUrl, postData, false, true);

                if (result) {
                    Query@(itemName)();

                    if (inConfrim == "Y") {
                        Return@(itemName)()
                    }
                }
            }
        });
    }

    //同步功能
    function PopSoSync@(itemName)(List) {
        $("#modalSync@(itemName)").modal({
            backdrop: "static",
            keyboard: false,
            show: true
        });
        //$("#modalSync@(itemName)").show()
        let currentDate = new Date();
        Suites.DatePicker("txtSyncEndDate@(itemName)", currentDate);
        if (!List) {
            currentDate.setDate(currentDate.getDate() - 7);
        }
        Suites.DatePicker("txtSyncStartDate@(itemName)", currentDate);
    }

    function CloseSync@(itemName)() {
        ResetForm("#syncForm@(itemName)");

        $("#modalSync@(itemName)").modal("hide");

        Query@(itemName)();
    }

    function Sync@(itemName)(Auto) {
        if (Auto) {
            let currentDate = new Date();
            let year = currentDate.getFullYear();
            let month = String(currentDate.getMonth() + 1).padStart(2, '0'); // getMonth() 返回的月份是 0-11，所以需要 +1
            let day = String(currentDate.getDate()).padStart(2, '0');

            currentDate = `${year}-${month}-${day}`;
            let targetUrl = "@Url.Action("UpdateReceiveOrderSynchronize", "ReceiveOrder")";
            let postData = {
                "RoErpFullNo": $("#txtRoErpFullNo@(itemName)").val(),
                "SyncStartDate":currentDate,
                "SyncEndDate": currentDate,
                "NormalSync":  "Y",
                "TranSync":  "N"
            };

            let data = DataAccess.EditContinued(targetUrl, postData, false);

            if (data) {
                alert(data.result, "success", 5000);
            }
        }
        else {
            swal.fire({
                titleText: "確認執行ERP資料同步嗎?",
                text: "此動作無法復原，請確認是否要執行!",
                icon: "warning",
                allowOutsideClick: false,
                allowEscapeKey: false,
                showCancelButton: true,
                confirmButtonColor: '#d33',
                reverseButtons: true
            }).then((result) => {
                if (result.isConfirmed) {
                    let targetUrl = "@Url.Action("UpdateReceiveOrderSynchronize", "ReceiveOrder")";
                    let postData = {
                        "RoErpFullNo": $("#txtRoErpFullNo@(itemName)").val(),
                        "SyncStartDate": ($("#cbxSyncDate@(itemName)").is(":checked") ? $("#txtSyncStartDate@(itemName)").val() : ""),
                        "SyncEndDate": ($("#cbxSyncDate@(itemName)").is(":checked") ? $("#txtSyncEndDate@(itemName)").val() : ""),
                        "NormalSync": $("#cbxNormalSync@(itemName)").is(":checked") ? "Y" : "N",
                        "TranSync": $("#cbxTranSync@(itemName)").is(":checked") ? "Y" : "N"
                    };

                    let data = DataAccess.EditContinued(targetUrl, postData, false);

                    if (data) {
                        alert(data.result, "success", 5000);
                    }

                    CloseSync@(itemName)();
                }
            });
        }
    }

    function GetUserInfo@(itemName)() {
        let targetUrl = "@Url.Action("GetLoginByKey", "User")";
        let postData = {
            "UserNo": $.cookie("Login"),
            "KeyText": $.cookie("LoginKey")
        };

        let data = DataAccess.Get(targetUrl, postData, false);

        if (data.status == "success") {
            userId@(itemName) = data.returnData.UserId;
            companyId@(itemName) = data.returnData.CompanyId;
            userNo@(itemName) = data.returnData.UserNo;

        } else {
            alert(data.msg, "alert", 0);
        }
    }

    function CloseSelectLotManagement(){
        $("#selectLotManagement@(itemName)").modal("hide");
    }

    function Return@(itemName)() {
        ResetForm(objForm@(itemName));
        $("#TransferStatusMES").val("")
        Switch("#listData@(itemName)", "#editData@(itemName), .unit-block, .advanced-block");
        Query@(itemName)();
    }

</script>
                        )
