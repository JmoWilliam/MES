@using Business_Manager.Helpers
@{
    string itemName = "JmoCheckToolSet";
    string itemNameText = "JMO檔檢查處理";
    string authority = ViewBag.authority;

    ViewBag.Title = itemNameText;
}

@Html.Resource("css",
    @<style>
        /* Tab 標籤樣式 */
        /*.flag-tabs {
            border-bottom: 1px solid #dee2e6;
            margin-bottom: 0.5rem;
        }

        .flag-item {
            margin-bottom: -1px;
        }*/

        /*.flag-link {
            border: 1px solid transparent;
            border-top-left-radius: 0.25rem;
            border-top-right-radius: 0.25rem;
            color: #495057;
            font-size: 1.1rem;
            padding: 0.5rem 1.25rem;
            display: block;
        }

        .flag-link:hover,
        .flag-link:focus {
            border-color: #e9ecef #e9ecef #dee2e6;
            text-decoration: none;
        }

        .flag-link.active {
            color: #007bff;
            background-color: #fff;
            border-color: #dee2e6 #dee2e6 #fff;
            font-weight: bold;
        }*/

        /* Tab 內容區域樣式 */
        /*.tab-content > .tab-pane {
            display: none;
        }

        .tab-content > .active {
            display: block;
        }*/

        /* 標籤圖示樣式 */
        /*.flag-link i {
            margin-right: 0.5rem;
        }*/
    </style>
)

<input type="hidden" id="pageAuthority" value="@authority" />

<div class="row">
    <div class="col-12 title-block">
        <h1 class="pt-2 pb-3">@(itemNameText)</h1>
        <div class="unit-block">
            <div class="button-block mb-1">
                <button type="button" class="btn btn-secondary" onclick="Return@(itemName)()"><i class="fas fa-undo"></i>返回</button>
            </div>
        </div>
    </div>
</div>


<!-- 主頁面內容 -->
<div class="row">
    <div class="col-12">
        <!-- Tab 選單 -->
        <ul class="nav flag-tabs nav-fill" id="tabZone" role="tablist">
            <li class="flag-item" role="presentation">
                <a class="flag-link active" id="core-jmo-tab" data-toggle="tab" href="#tabCoreJmoCheck" role="tab" aria-controls="tabCoreJmoCheck" aria-selected="true">
                    <i class="fas fa-file-alt"></i> 模仁JMO檔檢查
                </a>
            </li>
            <!-- 可以在這裡添加更多的 Tab -->
            <li class="flag-item" role="presentation">
                <a class="flag-link" id="insert-jmo-tab" data-toggle="tab" href="#tabInsertToJmo" role="tab" aria-controls="tabInsertToJmo" aria-selected="false">
                    <i class="fas fa-tools"></i> 入子JMO
                </a>
            </li>
        </ul>

        <!-- Tab 內容 -->
        <div class="tab-content" id="tabZoneContent">
            <!-- Core JMO Check Tab -->
            <div class="tab-pane fade show active" id="tabCoreJmoCheck" role="tabpanel" aria-labelledby="core-jmo-tab">
                @Html.Partial("CoreJmoCheck")
            </div>

            <!-- 入子 JMO Tab -->
            <div class="tab-pane fade" id="tabInsertToJmo" role="tabpanel" aria-labelledby="insert-jmo-tab">
                @Html.Partial("InsertToJmo")
            </div>
        </div>
    </div>
</div>

@Html.Resource("js",
    @<script>
        $(document).ready(function () {
            // 當頁面載入完成後初始化第一個頁籤
            initializeActiveTab();

            // Tab 切換事件處理
            $('#tabZone a').on('click', function (e) {
                e.preventDefault();
                $(this).tab('show');

                // 獲取目標tab的ID
                var targetTabId = $(this).attr('href');
                
                // 在選項卡顯示後初始化相應的uploader
                $(targetTabId).on('shown.bs.tab', function (e) {
                    initializeTabContent(targetTabId);
                });
                
                // 立即初始化當前選擇的tab
                initializeTabContent(targetTabId);
            });

            // 初始化指定tab的內容
            function initializeTabContent(tabId) {
                if (tabId === '#tabCoreJmoCheck') {
                    // 初始化模仁JMO檔檢查頁籤
                    if (typeof window['fileUploaderCoreJmoCheck'] !== 'undefined' && 
                        typeof window['fileUploaderCoreJmoCheck'].init === 'function') {
                        window['fileUploaderCoreJmoCheck'].init();
                    }
                } else if (tabId === '#tabInsertToJmo') {
                    // 初始化入子JMO頁籤
                    if (typeof window['fileUploaderInsertToJmo'] !== 'undefined' && 
                        typeof window['fileUploaderInsertToJmo'].init === 'function') {
                        window['fileUploaderInsertToJmo'].init();
                    }
                }
            }

            // 初始化當前活動的頁籤
            function initializeActiveTab() {
                var activeTabId = $('.flag-link.active').attr('href');
                initializeTabContent(activeTabId);
            }

            // 返回按鈕功能
            window.Return@(itemName) = function() {
                window.history.back();
            };
        });
    </script>
        )