@using Business_Manager.Helpers
@{
    string itemName = "ViewAddBarcodePrint";
    string itemNameText = "新增批量條碼";
}

@Html.Resource("css",
    @<style>
    </style>
)

<div class="modal fade" id="modal@(itemName)">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    @(itemNameText)
                    <span class="sub-title">製令: <span class="sub-text" id="desWoErpFullNo@(itemName)"></span></span>
                </h5>
                <a class="close list-mode" href="javascript:void(0);" onclick="Close@(itemName)()"><i class="fas fa-times"></i></a>
            </div>
            <div class="modal-body">
                <form class="container" autocomplete="off" id="editForm@(itemName)">
                    <fieldset>
                        <div class="form-group row">
                            <label class="col-12 col-form-label">條碼數量(每盤條碼數量)</label>
                            <div class="col-12">
                                <input type="number" class="form-control" id="txtBarcodeQty@(itemName)" name="txtBarcodeQty@(itemName)" placeholder="請輸入數量" value="" required>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-12 col-form-label">產生次數(預計要產生的條碼次數)</label>
                            <div class="col-12">
                                <input type="number" class="form-control" id="txtBarcodeCount@(itemName)" name="txtBarcodeCount@(itemName)" placeholder="請輸入數量" value="" required>
                            </div>
                        </div>
                    </fieldset>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-success" onclick="Save@(itemName)()">
                    <i class="fas fa-check"> 確認</i>
                </button>
            </div>
        </div>
    </div>
</div>

@Html.Resource("js",
    @<script>
        let woErpFullNo@(itemName);
        function Pop@(itemName)() {
            woErpFullNo@(itemName) = $("#txtMoNoLotBarcoderPrintLabel").val();
            $("#desWoErpFullNo@(itemName)").html(woErpFullNo@(itemName));

            $("#txtBarcodeQty@(itemName)").val("0");
            $("#txtBarcodeCount@(itemName)").val("1");

            $("#modal@(itemName)").modal({
                backdrop: "static",
                keyboard: false,
                show: true
            });

            $(window).keydown(function (event) {
                if (event.keyCode == 13) {
                    event.preventDefault();
                    return false;
                }
            });
        }

        function Save@(itemName)() {
            let targetUrl = "@Url.Action("AddBarcodePrint", "PrintLabel")";
            let postData = {
                "WoErpFullNo": woErpFullNo@(itemName),
                "BarcodeQty": $("#txtBarcodeQty@(itemName)").val(),
                "BarcodeCount": $("#txtBarcodeCount@(itemName)").val()
            };

            let result = DataAccess.Add(targetUrl, postData, false, true);

            if (result) {
                GetLotBarcodeLotBarcoderPrintLabel();
                Close@(itemName)();
            }
        }

        function Close@(itemName)() {
            $("#modal@(itemName)").modal('hide');
        }
    </script>
                        )