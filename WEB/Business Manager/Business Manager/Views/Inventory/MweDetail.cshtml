@using Business_Manager.Helpers
@{
    string itemName = "MweDetail";
    string itemNameText = "入庫單單身列表";
}

@Html.Resource("css",
    @<style>
         .card-header {
             position: sticky;
             top: 0;
             left: 0;
             z-index: 99;
         }
         /*.table-sticky thead .col-sticky:nth-last-child(1) {
             position: sticky;
             z-index: 2;
             right: 0;
         }

         .table-sticky tbody .col-sticky:nth-last-child(1) {
             position: sticky;
             z-index: 2;
             right: 0;
         }*/
         .table-sticky thead .col-sticky-MweD:nth-child(1) {
             position: sticky;
             z-index: 2;
             left: 0;
         }

         .table-sticky tbody .col-sticky-MweD:nth-child(1) {
             position: sticky;
             z-index: 2;
             left: 0;
         }

         .table-sticky thead .col-sticky-MweD:nth-child(2) {
             position: sticky;
             z-index: 2;
             left: 75px;
         }

         .table-sticky tbody .col-sticky-MweD:nth-child(2) {
             position: sticky;
             z-index: 2;
             left: 75px;
         }

         .table-sticky thead .col-sticky-MweD:nth-child(3) {
             position: sticky;
             z-index: 2;
             left: 250px;
         }

         .table-sticky tbody .col-sticky-MweD:nth-child(3) {
             position: sticky;
             z-index: 2;
             left: 250px;
         }
        .erp-status{
            top:3px;
        }
        .color-pass {
            border: 1px solid #008000;
        }
            .color-pass span {
                color: #008000;
            }
        .color-ng {
            border: 1px solid #ffbf00;
        }
            .color-ng span {
                color: #ffbf00;
            }
    </style>
                                                                       )

<input type="hidden" id="MoIdType" value="" />
<input type="hidden" id="MeasureType" value="" />
<input type="hidden" id="ScrapRegister" value="" />
<input type="hidden" id="ConfirmStatus" value="" />
<input type="hidden" id="BarcodeListStatus" value="" />
<input type="hidden" id="MweDetailIdPass" value="" />
<input type="hidden" id="MweDetailIdScrap" value="" />
<input type="hidden" id="InventoryPass" value="" />
<input type="hidden" id="MweStatus" value="S" />  @*T拋轉 TP二次拋轉 C確認 S未拋轉*@
<input type="hidden" id="LotManagement" value="" />
<input type="hidden" id="QcRecordId" value="" />


<!--搜尋-->
<div class="modal fade" id="modalQuery@(itemName)">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">搜尋</h5>
                <button class="close" data-dismiss="modal" type="button">
                    <span aria-hidden="true"><i class="fas fa-times"></i></span>
                </button>
            </div>
            <div class="modal-body">
                <form class="container" autocomplete="off" id="queryForm@(itemName)">
                    <fieldset>
                        <div class="form-group row">
                            <label class="col-12 col-form-label" for="txtMoIdQ@(itemName)">製令</label>
                            <div class="col-12">
                                <input type="text" class="form-control" id="txtMoIdQ@(itemName)" name="txtMoIdQ@(itemName)" placeholder="請輸入製令" />
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-12 col-form-label" for="txtMtlItemIdQ@(itemName)">產品品號</label>
                            <div class="col-12">
                                <input type="text" class="form-control" id="txtMtlItemIdQ@(itemName)" name="txtMtlItemIdQ@(itemName)" placeholder="請輸入材料品號" />
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-12 col-form-label" for="cboInventoryIdQ@(itemName)">進貨庫別</label>
                            <div class="col-12">
                                <select class="form-control" id="cboInventoryIdQ@(itemName)" name="cboInventoryIdQ@(itemName)">
                                    <option value="">-- 請選擇進貨庫別 --</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-12 col-form-label">驗收日期 <input type="checkbox" id="cbxAcceptanceDateQ@(itemName)" /></label>
                            <div class="col-6">
                                <input type="text" class="form-control" id="txtStartAcceptanceDateQ@(itemName)" name="txtStartAcceptanceDateQ@(itemName)"
                                       data-msg-extraRegex="請輸入正確的日期格式" data-rule-extraRegex="([12]\d{3}\-(0[1-9]|1[0-2])\-(0[1-9]|[12]\d|3[01]))"
                                       readonly />
                            </div>
                            <div class="col-6">
                                <input type="text" class="form-control" id="txtEndAcceptanceDateQ@(itemName)" name="txtEndAcceptanceDateQ@(itemName)"
                                       data-msg-extraRegex="請輸入正確的日期格式" data-rule-extraRegex="([12]\d{3}\-(0[1-9]|1[0-2])\-(0[1-9]|[12]\d|3[01]))"
                                       readonly />
                            </div>
                        </div>
                    </fieldset>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" onclick="Query@(itemName)()" style="margin: auto;"><i class="fal fa-wrench"></i>套用</button>
            </div>
        </div>
    </div>
</div>

<!--條碼搜尋-->
@*<div class="modal fade" id="modalMoIdBarcode@(itemName)">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">條碼搜尋</h5>
                    <button class="close" data-dismiss="modal" type="button">
                        <span aria-hidden="true"><i class="fas fa-times"></i></span>
                    </button>
                </div>
                <div class="modal-body">
                    <form class="container" autocomplete="off" id="queryForm@(itemName)">
                        <fieldset>
                            <div class="col-lg-12 col-md-12">
                                <div class="form-group">
                                    <label class="col-form-label">產品條碼</label>
                                    <input type="text" class="form-control query-Barcodesearch@(itemName)" id="txtBarcodeNoQ@(itemName)" name="txtBarcodeNoQ@(itemName)" placeholder="請輸入產品條碼" />
                                </div>
                            </div>
                            <div class="col-lg-12 col-md-12">
                                <div class="form-group">
                                    <label class="col-form-label">條碼狀態</label>
                                    <select class="form-control query-Barcodesearch@(itemName)" id="cboCurrentProdStatusQ@(itemName)" name="cboCurrentProdStatusQ@(itemName)">
                                        <option value="">-- 請選擇條碼狀態 --</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-lg-12 col-md-12">
                                <div class="form-group">
                                    <label class="col-form-label">流程狀態</label>
                                    <select class="form-control query-Barcodesearch@(itemName)" id="cboBarcodeStatusQ@(itemName)" name="cboBarcodeStatusQ@(itemName)">
                                        <option value="">-- 請選擇流程狀態 --</option>
                                    </select>
                                </div>
                            </div>
                        </fieldset>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="GetMoIdBarcode@(itemName)()" style="margin: auto;"><i class="fal fa-wrench"></i>套用</button>
                </div>
            </div>
        </div>
    </div>*@


<div class="row" id="listData@(itemName)">
    <div class="col-12">
        <div class="card card-shadow mb-4">
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-6 col-sm-6 col-md-6">
                        <a class="btn btn-primary" data-backdrop="static" data-keyboard="false" data-toggle="modal" data-target="#modalQuery@(itemName)" href="javascript:void(0);">
                            <i class="fal fa-search"></i>搜尋
                        </a>
                    </div>
                    <div class="col-6 col-sm-6 col-md-6 text-right ">
                        <span id="TransferErp">
                            <a class="btn btn-secondary auth-detail" href="javascript:TransferErpMoWarehouseEnryManagment('-1');"><i class="far fa-arrow-alt-square-up"></i>拋轉單據</a>
                        </span>
                        <span id="ReorganizeData">
                            <a class="btn btn-secondary auth-update" href="javascript:UpdateReConfirmStatusMoWarehouseEnryManagment('-1');"><i class="fas fa-reply-all"></i>單據重新編輯</a>
                        </span>
                        <span id="ConfirmErp">
                            @*<a class="btn btn-success auth-confirm2" href="javascript:ConfirmMoWarehouseEnryManagment('-1','1');"><i class="fas fa-check"></i>核准單據</a>*@
                            <a class="btn btn-success auth-confirm" href="javascript:ConfirmMoWarehouseEnryManagment('-1','2');"><i class="fas fa-check"></i>核准單據</a>
                        </span>
                        <span id="ReConfirmErp">
                            @*<a class="btn btn-danger auth-reconfirm2" href="javascript:ReConfirmMoWarehouseEnryManagment('-1','1');"><i class="fas fa-undo-alt"></i>反確認</a>*@
                            <a class="btn btn-danger auth-reconfirm" href="javascript:ReConfirmMoWarehouseEnryManagment('-1','2');"><i class="fas fa-undo-alt"></i>反確認</a>
                        </span>
                        <div class="read-status" style="display:inline-block;">
                            <a class="btn btn-info auth-add " href="javascript:Edit@(itemName)();"><i class="fas fa-plus"></i>入庫單單身新增</a>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12">
                        <div class="table-custom">
                            <table class="table table-bordered table-striped table-sticky" id="tblData@(itemName)">
                                <thead>
                                    <tr>
                                        <th class="" scope="col" style="min-width: 75px;">#</th>
                                        <th class="" scope="col" style="min-width: 150px;">製令</th>
                                        <th class="" scope="col" style="min-width: 230px;">產品品號</th>
                                        <th scope="col" style="min-width: 300px;">產品品名</th>
                                        <th scope="col" style="min-width: 150px;">進貨庫別</th>
                                        <th scope="col" style="min-width: 120px;">進貨數量</th>
                                        <th scope="col" style="min-width: 120px;">驗收數量</th>
                                        <th scope="col" style="min-width: 120px;">報廢數量</th>
                                        <th scope="col" style="min-width: 120px;">計價數量</th>
                                        <th scope="col" style="min-width: 120px;">加工單價</th>
                                        <th scope="col" style="min-width: 120px;">加工金額</th>
                                        <th scope="col" style="min-width: 120px;">原幣未稅金額</th>
                                        <th scope="col" style="min-width: 120px;">原幣稅金額</th>
                                        <th scope="col" style="min-width: 120px;">本幣未稅額</th>
                                        <th scope="col" style="min-width: 120px;">本幣稅額</th>
                                        <th class="text-center col-sticky" scope="col" style="min-width: 300px;">操作</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                        <div class="pagination" id="page@(itemName)"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row" id="editData@(itemName)" style="display: none;">
    <div class="col-12">
        <div class="card card-shadow mb-4">
            <div class="card-body">
                <form class="container custom-form-container" style="max-width:1140px!important;" autocomplete="off" id="editForm@(itemName)">
                    <fieldset>
                        <input type="hidden" id="MweDetailId" name="MweDetailId" value="-1" />
                        <div class="row">
                            <div class="col-lg-12 col-md-12">
                                <div class="form-group row">
                                    <label class="col-12 col-form-label" style="text-align: left;" for="txtMoId@(itemName)">綁定MES製令<span class="text-danger">*</span></label>
                                    <div class="col-12">
                                        <input type="hidden" id="txtMoId@(itemName)" value="" />
                                        <input type="hidden" id="txtMtlItemId@(itemName)" value="" />
                                        <input type="hidden" id="IsAmortizeType@(itemName)" name="IsAmortizeTypee" value="-1" />

                                        <div class="btn-group btn-group@(itemName) choose-MoId">
                                            <a class="btn btn-success pop-view" href="javascript:void(0);"><i class="fal fa-search"></i></a>
                                            <a class="btn btn-outline-danger pop-clear" href="javascript:void(0);"><i class="fas fa-eraser"></i></a>
                                        </div>
                                        <dl class="help-block">
                                            <dt>製令</dt>
                                            <dd id="desWoErpFullNo@(itemName)"></dd>
                                            <dt>品號</dt>
                                            <dd id="desMtlItemNo@(itemName)"></dd>
                                            <dt>品名</dt>
                                            <dd id="desMtlItemName@(itemName)"></dd>
                                            <dt>規格</dt>
                                            <dd id="desMtlItemSpec@(itemName)"></dd>
                                            <dt>預計產量</dt>
                                            <dd id="desPlanQty@(itemName)"></dd>
                                            <dt>可進貨數量</dt>
                                            <dd id="desMakeQty@(itemName)"></dd>
                                            <dt>尚未生產數量</dt>
                                            <dd id="desNoMakeQty@(itemName)"></dd>
                                            <dt>已經入庫數量</dt>
                                            <dd id="desEnterQty@(itemName)"></dd>
                                            <dt class="MFGQC">可以驗收數量</dt>
                                            <dd class="MFGQC" id="desNoEnterQty@(itemName)"></dd>
                                            <dt class="MFGQC">可以報廢數量</dt>
                                            <dd class="MFGQC" id="desNoNgQty@(itemName)"></dd>
                                        </dl>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <a class="btn btn-collapse BarcodeVersion" data-toggle="collapse" href="#BarcodeVersion@(itemName)">
                            <span><i class="fas fa-clipboard"></i> 入庫單綁定條碼資料</span>
                            <i class="fas fa-chevron-down"></i>
                        </a>
                        <div class="collapse mb-3 BarcodeVersion" id="BarcodeVersion@(itemName)" style="max-height: 70vh!important;">
                            @*<div class="card card-header">
                                    <div class="row mb-1">
                                        <div class="col-6 col-sm-6 col-md-6">
                                            <a class="btn btn-primary" data-backdrop="static" data-keyboard="false" data-toggle="modal" data-target="#modalMoIdBarcode@(itemName)" href="javascript:void(0);">
                                                <i class="fal fa-search"></i>條碼搜尋
                                            </a>
                                        </div>
                                    </div>
                                </div>*@
                            <div class="card card-body">
                                <div class="row ">
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <div class="col-12">
                                                <label class="col-form-label">刷取產品條碼類型</label>
                                                <select id="cboBarcodeType@(itemName)" name="cboBarcodeType@(itemName)" style="width:35% !important;">
                                                    <option value="">-- 請選擇條碼類型 --</option>
                                                </select>
                                                @*<label class="col-form-label" for="cbxIsAmortize@(itemName)">
                                                    是否攤提<span class="text-danger">*</span>
                                                    <input class="auth-isAmortize" type="checkbox" id="cbxIsAmortize@(itemName)" name="cbxIsAmortize@(itemName)" value="Y" />
                                                    <span class="control__indicator"></span>
                                                </label>*@
                                                <div class="col-form-label" style="display: inline-block;">
                                                    <label class="control control-solid control-solid-info" for="cbxIsAmortize@(itemName)">
                                                        是否攤提
                                                        <input class="auth-isAmortize" type="checkbox" id="cbxIsAmortize@(itemName)" name="cbxIsAmortize@(itemName)" value="Y" />
                                                        <span class="control__indicator" style="left:unset;right: -30px!important;"></span>
                                                    </label>
                                                </div>
                                                
                                                <input type="text" class="form-control query-search@(itemName)" id="txtBarcodeNo@(itemName)" name="txtBarcodeNo@(itemName)" placeholder="請輸入欲入庫的產品條碼,確認其正確列表就會勾選" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-12" style="display:flex;align-items:flex-end">
                                        <div class="form-group row">
                                            <div class="col-12">
                                                <button type="button" class="btn btn-primary" onclick="checkBarcode();"><i class="far fa-paper-plane"></i>&nbsp;送出</button>
                                                <button type="button" class="btn btn-primary scrapRegisterNo" id="QueryButtomAll"><i class="fas fa-save"></i>&nbsp;全部</button>
                                                <button type="button" class="btn btn-success scrapRegister" onclick="GetMoIdBarcodePass@(itemName)();"><i class="fas fa-laugh-squint"></i>&nbsp;良品</button>
                                                <button type="button" class="btn btn-danger scrapRegister" onclick="GetMoIdBarcodeScrap@(itemName)();"><i class="fas fa-sad-cry"></i>&nbsp;報廢品</button>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                                <div class="row auth-isAmortize">
                                    @*<div class="col-lg-6 col-md-12 auth-isAmortize">
                                        <div class="form-group row">
                                            <div class="col-12 row">
                                                <label class="col-form-label" for="cbxIsAmortize@(itemName)">是否攤提<span class="text-danger">*</span></label>
                                                <div class="col-lg-3 col-md-4 col-6">
                                                    <label class="control control-solid control-solid-info control--checkbox">
                                                        是
                                                        <input class="auth-isAmortize" type="checkbox" id="cbxIsAmortize@(itemName)" name="cbxIsAmortize@(itemName)" value="Y" />
                                                        <span class="control__indicator"></span>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>*@
                                </div>
                                <div class="row">
                                    <div class="col-12">
                                        <div class="table-custom">
                                            <table class="table table-bordered table-striped table-sticky" id="tblMoIdBarcodeData@(itemName)">
                                                <thead>
                                                    <tr>
                                                        <th class="text-center" scope="col" style="min-width: 110px;">
                                                            <label class="col-12 col-form-label">
                                                                全選 <input type="checkbox" id="cbxSelectAll@(itemName)" />
                                                            </label>
                                                        </th>
                                                        <th class="text-center" scope="col" style="min-width: 110px;">
                                                            <label class="col-12 col-form-label">
                                                                攤提
                                                            </label>
                                                        </th>
                                                        <th scope="col" style="min-width: 50px;">#</th>
                                                        <th scope="col" style="min-width: 200px;">條碼</th>
                                                        <th scope="col" style="min-width: 200px;">屬性</th>
                                                        <th scope="col" style="min-width: 90px;">條碼數量</th>
                                                        <th scope="col" style="min-width: 150px;">流程狀態</th>
                                                        <th scope="col" style="min-width: 150px;">當前站別</th>
                                                    </tr>
                                                </thead>
                                                <tbody></tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card card-footer">
                                <div class="col-12 col-sm-12 col-md-12 text-right read-status">
                                    <button type="button" class="btn btn-success read-status" onclick="Save@(itemName)()"><i class="fas fa-save"></i>條碼列表儲存</button>
                                    <button type="button" class="btn btn-danger read-status" onclick="DeleteBarcodeAll@(itemName)()"><i class="fas fa-trash-alt"></i>條碼列表清空</button>
                                </div>
                            </div>
                        </div>
                        <a class="btn btn-collapse BarcodeVersion" data-toggle="collapse" href="#BarcodeTransfer@(itemName)">
                            <span><i class="fas fa-clipboard"></i> 條碼移轉製令留存資料</span>
                            <i class="fas fa-chevron-down"></i>
                        </a>
                        <div class="collapse mb-3 BarcodeVersion" id="BarcodeTransfer@(itemName)">
                            <div class="card card-body">
                                <div class="row">
                                    <div class="col-12">
                                        <div class="table-custom">
                                            <table class="table table-bordered table-striped table-sticky" id="tblMoIdBarcodeTransferData@(itemName)">
                                                <thead>
                                                    <tr>
                                                        <th scope="col" style="min-width: 75px;">#</th>
                                                        <th scope="col" style="min-width: 200px;">條碼</th>
                                                        <th scope="col" style="min-width: 100px;">條碼數量</th>
                                                        <th scope="col" style="min-width: 200px;">條碼屬性欄位</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td class="text-center" colspan="4" style="background-color: #fff3cd;">
                                                            <i class="fal fa-exclamation-circle"></i>&nbsp;目前尚無資料
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-6 col-md-12">
                                <div class="form-group row">
                                    <label class="col-12 col-md-3 col-lg-3 col-form-label" for="cboInventoryId@(itemName)">進貨庫別<span class="text-danger">*</span></label>
                                    <div class="col-12 col-md-9 col-lg-9">
                                        <select class="form-control" id="cboInventoryId@(itemName)" name="cboInventoryId@(itemName)">
                                            <option value="">-- 請選擇進貨庫別 --</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 col-md-12">
                                <div class="form-group row">
                                    <label class="col-12 col-md-3 col-lg-3 col-form-label" for="txtAcceptanceDate@(itemName)">驗收日期</label>
                                    <div class="col-12 col-md-9 col-lg-9">
                                        <input type="text" class="form-control" id="txtAcceptanceDate@(itemName)" name="txtAcceptanceDate@(itemName)"
                                               data-msg-extraRegex="請輸入正確的日期格式" data-rule-extraRegex="([12]\d{3}\-(0[1-9]|1[0-2])\-(0[1-9]|[12]\d|3[01]))" />
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-6 col-md-12">
                                <div class="form-group row">
                                    <label class="col-12 col-md-3 col-lg-3 col-form-label" for="cboUomId@(itemName)">單位<span class="text-danger">*</span></label>
                                    <div class="col-12 col-md-9 col-lg-9">
                                        <select class="form-control" id="cboUomId@(itemName)" name="cboUomId@(itemName)">
                                            <option value="">-- 請選擇單位 --</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 col-md-12">
                                <div class="form-group row">
                                    <label class="col-12 col-md-3 col-lg-3 col-form-label" for="txtReceiptQty@(itemName)">進貨數量<span class="text-danger">*</span></label>
                                    <div class="col-12 col-md-9 col-lg-9">
                                        <input type="number" class="form-control" id="txtReceiptQty@(itemName)" name="txtReceiptQty@(itemName)" placeholder="請輸入進貨數量" />
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-6 col-md-12">
                                <div class="form-group row">
                                    <label class="col-12 col-md-3 col-lg-3 col-form-label" for="txtAcceptQty@(itemName)">驗收數量<span class="text-danger">*</span></label>
                                    <div class="col-12 col-md-9 col-lg-9">
                                        <input type="number" class="form-control qty-check" id="txtAcceptQty@(itemName)" name="txtAcceptQty@(itemName)" value="0" placeholder="請輸入需驗收數量" />
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 col-md-12">
                                <div class="form-group row">
                                    <label class="col-12 col-md-3 col-lg-3 col-form-label" for="txtScriptQty@(itemName)">報廢數量<span class="text-danger">*</span></label>
                                    <div class="col-12 col-md-9 col-lg-9">
                                        <input type="number" class="form-control qty-check" id="txtScriptQty@(itemName)" name="txtScriptQty@(itemName)" value="0" placeholder="請輸入報廢數量" />
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-6 col-md-12">
                                <div class="form-group row">
                                    <label class="col-12 col-md-3 col-lg-3 col-form-label" for="txtReturnQty@(itemName)">驗退數量<span class="text-danger">*</span></label>
                                    <div class="col-12 col-md-9 col-lg-9">
                                        <input type="number" class="form-control qty-check" id="txtReturnQty@(itemName)" name="txtReturnQty@(itemName)" value="0" placeholder="請輸入驗退數量" />
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 col-md-12">
                                <div class="form-group row">
                                    <label class="col-12 col-md-3 col-lg-3 col-form-label" for="txtAvailableQty@(itemName)">計價數量<span class="text-danger">*</span></label>
                                    <div class="col-12 col-md-9 col-lg-9">
                                        <input type="number" class="form-control qty-check" id="txtAvailableQty@(itemName)" name="txtAvailableQty@(itemName)" value="0" placeholder="請輸入計價數量" />
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-6 col-md-12">
                                <div class="form-group row">
                                    <label class="col-12 col-md-3 col-lg-3 col-form-label" for="cboQcStatus@(itemName)">檢驗狀態<span class="text-danger">*</span></label>
                                    <div class="col-12 col-md-9 col-lg-9">
                                        <select class="form-control" id="cboQcStatus@(itemName)" name="cboQcStatus@(itemName)">
                                            <option value="">-- 請選擇檢驗狀態 --</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 col-md-12">
                                <div class="form-group row">
                                    <label class="col-12 col-md-3 col-lg-3 col-form-label" for="txtRemark@(itemName)">備註</label>
                                    <div class="col-12 col-md-9 col-lg-9">
                                        <textarea class="form-control" id="txtRemark@(itemName)" name="txtRemark@(itemName)"
                                                  data-msg-maxlength="必須少於 255 個字元" maxlength="255" rows="2" placeholder="請輸入備註"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <a class="btn btn-collapse" data-toggle="collapse" href="#moneyData@(itemName)">
                            <span><i class="fas fa-clipboard"></i> 金錢資料</span>
                            <i class="fas fa-chevron-down"></i>
                        </a>
                        <div class="collapse mb-3" id="moneyData@(itemName)">
                            <div class="card card-body">
                                <div class="row">
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12 col-md-3 col-lg-3 col-form-label" for="cboProcessNo@(itemName)">製程代號</label>
                                            <div class="col-12 col-md-9 col-lg-9">
                                                <select class="form-control" id="cboProcessNo@(itemName)" name="cboProcessNo@(itemName)">
                                                    <option value="">-- 請選擇製程代號 --</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-group row">
                                            <label class="col-12 col-md-3 col-lg-3 col-form-label" for="txtOrigUnitPrice@(itemName)">加工單價</label>
                                            <div class="col-12 col-md-9 col-lg-9">
                                                <input type="number" step="any" min="0" max="99999" class="form-control" id="txtOrigUnitPrice@(itemName)" name="txtOrigUnitPrice@(itemName)"
                                                       value="0"
                                                       placeholder="請輸入加工單價"
                                                       data-msg-required="請輸入加工單價" />
                                            </div>
                                        </div>
                                        <div class="form-group row">
                                            <label class="col-12 col-md-3 col-lg-3 col-form-label" for="txtOrigAmount@(itemName)">加工金額</label>
                                            <div class="col-12 col-md-9 col-lg-9">
                                                <input type="number" step="any" min="0" max="99999" class="form-control" id="txtOrigAmount@(itemName)" name="txtOrigAmount@(itemName)"
                                                       value="0"
                                                       placeholder="請輸入加工金額"
                                                       data-msg-required="請輸入加工金額" readonly />
                                            </div>
                                        </div>
                                        <div class="form-group row">
                                            <label class="col-12 col-md-3 col-lg-3 col-form-label" for="txtOrigDiscountAmt@(itemName)">扣款金額</label>
                                            <div class="col-12 col-md-9 col-lg-9 osp-date">
                                                <input type="number" class="form-control" id="txtOrigDiscountAmt@(itemName)" name="txtOrigDiscountAmt@(itemName)"
                                                       value="0"
                                                       placeholder="請輸入扣款金額"
                                                       data-msg-required="請輸入扣款金額" disabled />
                                            </div>
                                        </div>
                                        <div class="form-group row">
                                            <label class="col-12 col-md-3 col-lg-3 col-form-label" for="txtReceiptExpense@(itemName)">進貨費用</label>
                                            <div class="col-12 col-md-9 col-lg-9 osp-date">
                                                <input type="number" class="form-control" id="txtReceiptExpense@(itemName)" name="txtReceiptExpense@(itemName)"
                                                       value="0"
                                                       placeholder="請輸入進貨費用"
                                                       data-msg-required="請輸入進貨費用" disabled />
                                            </div>
                                        </div>

                                    </div>
                                    <div class="col-lg-6 col-md-12 ">
                                        <div class="form-group row">
                                            <label class="col-12 col-md-3 col-lg-3 col-form-label" for="txtOrigPreTaxAmt@(itemName)">原幣未稅金額</label>
                                            <div class="col-12 col-md-9 col-lg-9 osp-date">
                                                <input type="number" class="form-control" id="txtOrigPreTaxAmt@(itemName)" name="txtOrigPreTaxAmt@(itemName)"
                                                       value="0"
                                                       placeholder="請輸入原幣未稅金額"
                                                       data-msg-required="請輸入進貨費用" readonly />
                                            </div>
                                        </div>
                                        <div class="form-group row">
                                            <label class="col-12 col-md-3 col-lg-3 col-form-label" for="txtOrigTaxAmt@(itemName)">原幣稅額</label>
                                            <div class="col-12 col-md-9 col-lg-9 osp-date">
                                                <input type="number" class="form-control" id="txtOrigTaxAmt@(itemName)" name="txtOrigTaxAmt@(itemName)"
                                                       value="0"
                                                       placeholder="請輸入原幣稅額"
                                                       data-msg-required="請輸入原幣稅額" readonly />
                                            </div>
                                        </div>
                                        <div class="form-group row">
                                            <label class="col-12 col-md-3 col-lg-3 col-form-label" for="txtPreTaxAmt@(itemName)">本幣未稅金額</label>
                                            <div class="col-12 col-md-9 col-lg-9 osp-date">
                                                <input type="number" class="form-control" id="txtPreTaxAmt@(itemName)" name="txtPreTaxAmt@(itemName)"
                                                       value="0"
                                                       placeholder="請輸入本幣未稅金額"
                                                       data-msg-required="請輸入本幣未稅金額" readonly />
                                            </div>
                                        </div>
                                        <div class="form-group row">
                                            <label class="col-12 col-md-3 col-lg-3 col-form-label" for="txtTaxAmt@(itemName)">本幣稅額</label>
                                            <div class="col-12 col-md-9 col-lg-9 osp-date">
                                                <input type="number" class="form-control" id="txtTaxAmt@(itemName)" name="txtTaxAmt@(itemName)"
                                                       value="0"
                                                       placeholder="請輸入本幣未稅金額"
                                                       data-msg-required="請輸入本幣未稅金額" readonly />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <a class="btn btn-collapse" id="SecondaryData" data-toggle="collapse" href="#basic@(itemName)">
                            <span><i class="fas fa-clipboard"></i> 次要資料</span>
                            <i class="fas fa-chevron-down"></i>
                        </a>
                        <div class="collapse mb-3" id="basic@(itemName)">
                            <div class="card card-body">
                                <div class="row">
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12 col-md-3 col-lg-3 col-form-label" for="txtDiscountDescription@(itemName)">扣款說明</label>
                                            <div class="col-12 col-md-9 col-lg-9">
                                                <textarea class="form-control" id="txtDiscountDescription@(itemName)" name="txtDiscountDescription@(itemName)"
                                                          data-msg-maxlength="必須少於 40 個字元" maxlength="40" rows="2" placeholder="請輸入扣款說明"></textarea>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12 col-md-3 col-lg-3 col-form-label" for="txtProject@(itemName)">專案名稱</label>
                                            <div class="col-12 col-md-9 col-lg-9">
                                                <input type="text" class="form-control" id="txtProject@(itemName)" name="txtProject@(itemName)" placeholder="請輸入專案名稱" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12 col-md-3 col-lg-3 col-form-label" for="txtAvailableDate@(itemName)">有效日期</label>
                                            <div class="col-12 col-md-9 col-lg-9">
                                                <input type="text" class="form-control" id="txtAvailableDate@(itemName)" name="txtAvailableDate@(itemName)" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12 col-md-3 col-lg-3 col-form-label" for="txtReCheckDate@(itemName)">複檢日期</label>
                                            <div class="col-12 col-md-9 col-lg-9">
                                                <input type="text" class="form-control" id="txtReCheckDate@(itemName)" name="txtReCheckDate@(itemName)" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12 col-md-3 col-lg-3 col-form-label" for="txtLotNumber@(itemName)">批號</label>
                                            <div class="col-12 col-md-9 col-lg-9" style="display: flex;">
                                                <input type="text" class="form-control" id="txtLotNumber@(itemName)" name="txtLotNumber@(itemName)" placeholder="請輸入批號" style="width: calc(100% - 105px);" />
                                                <button type="button" class="btn btn-info " onclick="PopView();" style="width:110px;height: 39px;"><i class="fas fa-list-ul"></i>&nbsp;批號選擇</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12 col-md-3 col-lg-3 col-form-label" for="cboConfirmUserId@(itemName)">確認者</label>
                                            <div class="col-12 col-md-9 col-lg-9">
                                                <select class="form-control" id="cboConfirmUserId@(itemName)" name="cboConfirmUserId@(itemName)">
                                                    <option value="">-- 請選擇確認者 --</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-4 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12 col-md-3 col-lg-4 col-form-label" for="txtVoucherPayablePrefix@(itemName)">應付憑單別</label>
                                            <div class="col-12 col-md-9 col-lg-8">
                                                <textarea class="form-control" id="txtVoucherPayablePrefix@(itemName)" name="txtVoucherPayablePrefix@(itemName)"
                                                          data-msg-maxlength="必須少於 4 個字元" maxlength="4" rows="2" placeholder="請輸入應付憑單別" readonly></textarea>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-4 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12 col-md-3 col-lg-4 col-form-label" for="txtVoucherPayableNo@(itemName)">應付憑單號</label>
                                            <div class="col-12 col-md-9 col-lg-8">
                                                <textarea class="form-control" id="txtVoucherPayableNo@(itemName)" name="txtVoucherPayableNo@(itemName)"
                                                          data-msg-maxlength="必須少於 11 個字元" maxlength="11" rows="2" placeholder="請輸入應付憑單號" readonly></textarea>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-4 col-md-12">
                                        <div class="form-group row">
                                            <label class="col-12 col-md-3 col-lg-4 col-form-label" for="txtVoucherPayableSeq@(itemName)">應付憑單序號</label>
                                            <div class="col-12 col-md-9 col-lg-8">
                                                <textarea class="form-control" id="txtVoucherPayableSeq@(itemName)" name="txtVoucherPayableSeq@(itemName)"
                                                          data-msg-maxlength="必須少於 4 個字元" maxlength="4" rows="2" placeholder="請輸入應付憑單序號" readonly></textarea>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-3 col-form-label">
                                        <label class="control control-solid control-solid-info control--checkbox" for="cbxPaymentHold@(itemName)">
                                            暫不付款
                                            <input type="checkbox" id="cbxPaymentHold@(itemName)" name="cbxPaymentHold@(itemName)" />
                                            <span class="control__indicator"></span>
                                        </label>
                                    </div>
                                    <div class="col-3 col-form-label">
                                        <label class="control control-solid control-solid-info control--checkbox" for="cbxOverdue@(itemName)">
                                            逾期碼
                                            <input type="checkbox" id="cbxOverdue@(itemName)" name="cbxOverdue@(itemName)" />
                                            <span class="control__indicator"></span>
                                        </label>
                                    </div>
                                    <div class="col-3 col-form-label">
                                        <label class="control control-solid control-solid-info control--checkbox" for="cbxReserveTaxCode@(itemName)">
                                            保稅碼
                                            <input type="checkbox" id="cbxReserveTaxCode@(itemName)" name="cbxReserveTaxCode@(itemName)" />
                                            <span class="control__indicator"></span>
                                        </label>
                                    </div>
                                    <div class="col-3 col-form-label">
                                        <label class="control control-solid control-solid-info control--checkbox" for="cbxReturnCode@(itemName)">
                                            檢退碼
                                            <input type="checkbox" id="cbxReturnCode@(itemName)" name="cbxReturnCode@(itemName)" disabled />
                                            <span class="control__indicator"></span>
                                        </label>
                                    </div>

                                </div>
                                <div class="row">
                                    <div class="col-3 col-form-label">
                                        <label class="control control-solid control-solid-info control--checkbox" for="cbxCostEntry@(itemName)">
                                            產生分錄-成本
                                            <input type="checkbox" id="cbxCostEntry@(itemName)" name="cbxCostEntry@(itemName)" disabled />
                                            <span class="control__indicator"></span>
                                        </label>
                                    </div>
                                    <div class="col-3 col-form-label">
                                        <label class="control control-solid control-solid-info control--checkbox" for="cbxExpenseEntry@(itemName)">
                                            產生分錄-費用
                                            <input type="checkbox" id="cbxExpenseEntry@(itemName)" name="cbxExpenseEntry@(itemName)" disabled />
                                            <span class="control__indicator"></span>
                                        </label>
                                    </div>
                                    <div class="col-3 col-form-label">
                                        <label class="control control-solid control-solid-info control--checkbox" for="cbxUrgentMtl@(itemName)">
                                            急料
                                            <input type="checkbox" id="cbxUrgentMtl@(itemName)" name="cbxUrgentMtl@(itemName)" disabled />
                                            <span class="control__indicator"></span>
                                        </label>
                                    </div>
                                    <div class="col-3 col-form-label">
                                        <label class="control control-solid control-solid-info control--checkbox" for="cbxCloseStatus@(itemName)">
                                            結帳碼
                                            <input type="checkbox" id="cbxCloseStatus@(itemName)" name="cbxCloseStatus@(itemName)" disabled />
                                            <span class="control__indicator"></span>
                                        </label>
                                    </div>
                                </div>
                                @*<div class="row">
                                    <div class="col-3 col-form-label">
                                        <label class="control control-solid control-solid-info control--checkbox" for="cbxCheckMode@(itemName)">
                                            高標準入庫模式
                                            <input type="checkbox" id="cbxCheckMode@(itemName)" name="cbxCheckMode@(itemName)"  disabled />
                                            <span class="control__indicator"></span>
                                        </label>
                                    </div>
                                    <div class="col-3 col-form-label">
                                        
                                    </div>
                                    <div class="col-3 col-form-label">
                                        
                                    </div>
                                    <div class="col-3 col-form-label">
                                        
                                    </div>
                                </div>*@
                            </div>
                        </div>
                    </fieldset>
                </form>
            </div>
            <div class="card-footer text-center text-lg-right">
                <button type="button" class="btn btn-secondary" onclick="Return@(itemName)()"><i class="fas fa-undo"></i>返回</button>
                <button type="button" class="btn btn-success read-status notBarcode" onclick="Save@(itemName)()"><i class="fas fa-save"></i>儲存</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modalPotNumberBarcodeList@(itemName)">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    鍋次條碼列表
                </h5>
            </div>
            <div class="modal-body">
                <div class="row" id="listData@(itemName)">
                    <div class="col-lg-12">
                        <div class="table-custom">
                            <table class="table table-bordered table-striped table-sticky" id="tblPotNumberBarcodeList@(itemName)">
                                <thead>
                                    <tr>
                                        <th scope="col" style="min-width: 75px;">#</th>
                                        <th scope="col" style="min-width: 200px;">條碼</th>
                                        <th scope="col" style="min-width: 100px;">條碼數量</th>
                                        <th scope="col" style="min-width: 200px;">條碼屬性欄位</th>
                                        <th scope="col" style="min-width: 200px;">流程狀態</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                        <div class="pagination" id="pagePotNumberBarcodeList@(itemName)"></div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-success" id="SavePotNumberBarcodeList"><i class="fas fa-paper-plane"></i>送出</button>
                <button type="button" class="btn btn-secondary" onclick="ClosePotNumberBarcodeList@(itemName)()"><i class="fas fa-times"></i>關閉</button>
            </div>
        </div>
    </div>
</div>

@Html.Partial("ViewManufactureOrder")
@Html.Partial("ViewMwePrint")
@Html.Partial("ViewPackageList")
@Html.Partial("ViewLotNumberInventory")



@Html.Resource("js",
    @<script>
        let objPage@(itemName) = {
            "pageIndex": 0,
            "pageSize": 999
        };
        let objForm@(itemName) = "#editForm@(itemName)";
        let userId@(itemName);
        let companyId@(itemName);

        let attributeObj = {}
        let BarcodeAttributesObj = {}
        let OverMsg

        $(document).ready(function () {

            @*$("#IsAmortizeType@(itemName)").val(($("#cbxIsAmortize@(itemName)").is(":checked") ? "Y" : "N"));*@
            $("#cbxIsAmortize@(itemName)").attr("checked", false);

            GetUserInfo@(itemName)()
            //搜尋日期區間條件
            let currentDate = new Date();
            //單據日期
            Suites.DateDropper("#txtStartAcceptanceDateQ@(itemName),#txtEndAcceptanceDateQ@(itemName)");
            Suites.SetDateDropper("#txtEndAcceptanceDateQ@(itemName)", currentDate);
            currentDate.setDate(currentDate.getDate() - 7);
            Suites.SetDateDropper("#txtStartAcceptanceDateQ@(itemName)", currentDate);

            //數量輸入公式檢查
            if ($("#cboMweErpPrefixMoWarehouseEnryManagment").val() != "5903") {
            }


            checkNum()


            $("#txtAvailableQty@(itemName)").change(function () {
                AmountCalculation()
            })

            $("#txtOrigUnitPrice@(itemName)").change(function () {
                AmountCalculation()
            })
            $("#txtOrigDiscountAmt@(itemName)").change(function () {
                AmountCalculation()
            })


            $(".BarcodeVersion").hide()

            $(".btn-group").on('click', '.pop-clear', function () {
                $(".BarcodeVersion").hide()
                $("#txtReceiptQty@(itemName)").attr("readonly", false);
                $("#txtAcceptQty@(itemName)").attr("readonly", false);
                $("#MoIdType").val("");
            })



            $("#txtMoId@(itemName)").change(function () {
                $("#tblMoIdBarcodeData@(itemName) tbody").html("");

                $("#txtReceiptQty@(itemName)").val(0);//進貨
                $("#txtAcceptQty@(itemName)").val(0); //驗收
                $("#txtScriptQty@(itemName)").val(0); //報廢
                $("#txtAvailableQty@(itemName)").val(0); //計價

                CheckMoIdType($("#txtMoId@(itemName)").val());
                CheckScrapRegister($("#txtMoId@(itemName)").val())
                GetWipOrderRequisitionSetQty()

                if ($("#MoIdType").val() == "Y") {
                    $(".BarcodeVersion").show()
                    $("#txtReceiptQty@(itemName)").attr("readonly", true);
                    $("#txtAcceptQty@(itemName)").attr("readonly", true);
                    $("#txtScriptQty@(itemName)").attr("readonly", true);

                    ComboBoxs.Default("#cboCurrentProdStatusQ@(itemName)", "@Url.Action("GetType", "BasicInformation")", { "TypeSchema": "Barcode.CurrentProdStatus" }, "", "NA", "", "TypeName", "TypeNo");
                    ComboBoxs.Default("#cboBarcodeStatusQ@(itemName)", "@Url.Action("GetType", "BasicInformation")", { "TypeSchema": "Barcode.BarcodeStatus" }, "Normal", "NA", "", "TypeName", "TypeNo");

                    
                    if ($("#ScrapRegister").val() == "Y") {
                        GetMoIdBarcodePass@(itemName)()
                    }
                    else {
                        GetMoIdBarcode@(itemName)()
                        $("#QueryButtomAll").attr("onclick", `javascript: GetMoIdBarcode@(itemName)()`)
                    }
                }
                else {
                    $(".BarcodeVersion").hide()
                    $("#txtReceiptQty@(itemName)").attr("readonly", false);
                    $("#txtAcceptQty@(itemName)").attr("readonly", false);
                    $("#txtScriptQty@(itemName)").attr("readonly", false);

                    @*$("#txtReceiptQty@(itemName)").val(0) //進貨
                    $("#txtAcceptQty@(itemName)").val(0)  //驗收
                    $("#txtReturnQty@(itemName)").val(0) //驗退
                    $("#txtScriptQty@(itemName)").val(0) //報廢
                    $("#txtAvailableQty@(itemName)").val(0); //計價*@
                }

                AmountCalculation()

            })

            $("#txtBarcodeNo@(itemName)").on("keydown", function (e) {
                if (e.which == 13) {
                    checkBarcode()

                }
            });
            ComboBoxs.Default("#cboInventoryIdQ@(itemName)", "@Url.Action("GetInventory", "ScmBasicInformation")", {}, "", "NA", "", "InventoryWithNo", "InventoryId"); //入庫庫別
            ComboBoxs.Default("#cboBarcodeType@(itemName)", "@Url.Action("GetType", "BasicInformation")", { "TypeSchema": "MweSwipeBarcodeType" }, "Normal", "NA", "", "TypeName", "TypeNo"); //入庫庫別
            if (!isMobile) {
                $(`#cboInventoryIdQ@(itemName), #cboBarcodeList@(itemName),#cboCurrentProdStatusQ@(itemName) ,#cboBarcodeStatusQ@(itemName) `).select2({
                    width: "100%"
                });
                $(`#cboBarcodeType@(itemName)`).select2({
                    width: "35%"
                });
            }

            $("#cbxSelectAll@(itemName)").off("click").on("click", function () {
                // 取得對應的 BarcodeType 下拉選單的值
                let BarcodeType = $("#cboBarcodeType\\@(itemName)").val();
        
                if (BarcodeType == "PotNumber") {
                    event.preventDefault(); // 阻止 checkbox 勾選
                    alert("目前採用的是鍋次條碼模式,不可自行點選!!");
                    return
                }

                if ($("#cbxSelectAll@(itemName)").is(":checked")) {
                    $("input[type='checkbox'][name='cbxBarcode@(itemName)']").not(":disabled").prop("checked", true);
                } else {
                    $("input[type='checkbox'][name='cbxBarcode@(itemName)']").not(":disabled").prop("checked", false);
                }
                let BarcodeListY = [];
                let BarcodeListN = [];
                var barocdeQty = 0;
                var enterQty = 0;
                var passQty = 0;
                var ngQty = 0;

                $.each($("input[name='cbxBarcode@(itemName)']"), function () {
                    if ($(this).is(":checked")) {
                        BarcodeListY.push($(this).val());
                        barocdeQty = $(this).data("barcode-qty")
                        if ($(this).data("barcode-status") == "P") {
                            passQty += barocdeQty
                        }
                        else if ($(this).data("barcode-status") == "S") {
                            ngQty += barocdeQty
                        }
                        else {
                            alert("【入庫管理錯誤】- 入庫條碼當前狀態資料有問題!")
                            return
                        }
                    }
                    else {
                        if (!$(this).is(":disabled")) {
                            BarcodeListN.push($(this).val());
                        }
                    }
                });
                enterQty = passQty + ngQty;
                $("#txtReceiptQty@(itemName)").val(enterQty)
                $("#txtAcceptQty@(itemName)").val(passQty)
                $("#txtScriptQty@(itemName)").val(ngQty);
                $("#txtAvailableQty@(itemName)").val(passQty);
                AmountCalculation()
            });


            $("#cbxIsAmortize@(itemName)").click(function () {
                if ($(this).prop("checked")) {
                    $("input[type='checkbox'][name='cbxBarcodeAmortize@(itemName)']").show();
                    $("#IsAmortizeType@(itemName)").val("Y");
                }
                else {
                    $("input[type='checkbox'][name='cbxBarcodeAmortize@(itemName)']").hide();
                    $("input[type='checkbox'][name='cbxBarcodeAmortize@(itemName)']").prop("checked", false);
                    $("#IsAmortizeType@(itemName)").val("N");

                }
                countcounts()
            });

            $("#cbxCheckMode@(itemName)").off("click").on("click", function () {
                if ($("#cbxCheckMode@(itemName)").is(":checked")) {
                    alert("高標準模式目前只支援數量入庫")
                }
            })

            $(document).on("click.preventClick", "input[type='checkbox'][name='cbxBarcode@(itemName)']", function (event) {
                let BarcodeType = $("#cboBarcodeType@(itemName)").val();
                if (BarcodeType == "PotNumber") {
                    event.preventDefault();
                    alert("目前採用的是鍋次入庫模式,不可自行點選!!");
                    return
                }
            });

            $("#cboBarcodeType@(itemName)").change(function () {
                let MweDetailId = $("#MweDetailId").val()
                if (MweDetailId <= 0) {
                    $("input[type='checkbox'][name='cbxBarcode@(itemName)']").prop("checked", false);
                    checkChecked()
                }
                
            })
            
        })

        function GetUserInfo@(itemName)() {
            let targetUrl = "@Url.Action("GetLoginByKey", "User")";
            let postData = {
                "UserNo": $.cookie("Login"),
                "KeyText": $.cookie("LoginKey")
            };

            let data = DataAccess.Get(targetUrl, postData, false);

            if (data.status == "success") {
                userId@(itemName) = data.returnData.UserId;
                companyId@(itemName) = data.returnData.CompanyId;
            } else {
                alert(data.msg, "alert", 0);
            }
        }

        function Expand@(itemName)(ScrapRegister) {


            if (parseInt($("#MweId").val()) > 0) {
                $(".advanced-block").slideDown("slow");
                if (ScrapRegister != "Y") {
                    Return@(itemName)();
                }
            } else {
                alert("【入庫管理錯誤】- 入庫單資料錯誤", "alert");
            }
        }

        function Query@(itemName)() {
            objPage@(itemName).pageIndex = 0;
            InitData@(itemName)(objPage@(itemName));

            $("#modalQuery@(itemName)").modal("hide");

            if ($("#MweStatus").val() == "S") {
                $("#ConfirmErp").hide()
                $("#TransferErp").show()
                $("#ReorganizeData").hide()
                $("#ReConfirmErp").hide()
            }
            else if ($("#MweStatus").val() == "T") {
                $("#TransferErp").show()
                $("#ReorganizeData").hide()
                $("#ConfirmErp").hide()
                $("#ReConfirmErp").hide()
            }
            else if ($("#MweStatus").val() == "TP") {
                $("#TransferErp").hide()
                $("#ReorganizeData").show()
                $("#ConfirmErp").show()
                $("#ReConfirmErp").hide()
            }
            else if ($("#MweStatus").val() == "C") {
                $("#TransferErp").hide()
                $("#ConfirmErp").hide()
                $("#ReorganizeData").hide()
                $("#ReConfirmErp").show()
            }
        }

        function InitData@(itemName)(objPage) {
            let innerHtml = '';
            let pageCount = 0;
            var TransferStatus = $("#TransferStatus").val()

            if ($("#IsAmortizeTypee").val() == "N") {
                $("input[type='checkbox'][name='cbxBarcodeAmortize@(itemName)']").prop("checked", false);

            } else {
                $("input[type='checkbox'][name='cbxBarcodeAmortize@(itemName)']").prop("checked", true);

            }


            let targetUrl = "@Url.Action("GetMweDetail", "Inventory")";
            let postData = {
                "OrderBy": "",
                "PageIndex": (objPage.pageIndex + 1),
                "PageSize": objPage.pageSize,
                "MweId": $("#MweId").val(),
                "MoId": $("#txtMoIdQ@(itemName)").val(),
                "MtlItemNo": $("#txtMtlItemNoQ@(itemName)").val(),
                "InventoryId": $("#cboInventoryIdQ@(itemName)").val(),
                "StartAcceptanceDate": ($("#cbxAcceptanceDateQ@(itemName)").is(":checked") ? $("#txtStartAcceptanceDateQ@(itemName)").val() : ""),
                "EndAcceptanceDate": ($("#cbxAcceptanceDateQ@(itemName)").is(":checked") ? $("#txtEndAcceptanceDateQ@(itemName)").val() : ""),
            };

            let data = DataAccess.Get(targetUrl, postData, false);

            if (data.status == "success") {
                pageCount = data.result.length > 0 ? parseInt(data.result[0]["TotalCount"]) : 0;

                if (pageCount > 0) {
                    objPage = PageCaculate(pageCount, objPage);

                    $.each(data.result, function (i, item) {
                        let _row = (objPage.pageSize * objPage.pageIndex + (i + 1)) + ".";
                        var MweBarcodeNum = 0
                        if (item.MweBarcodeNum != null) {
                            MweBarcodeNum = item.MweBarcodeNum
                        }

                        innerHtml += `<tr>
                                            <td class="">${_row}</td>
                                            <td class="ellipsis" data-toggle="tooltip" title="${item.MoId}" style="max-width: 200px;">${item.WoErpPrefix}-${item.WoErpNo}(${item.WoSeq})</td>
                                            <td class="ellipsis" data-toggle="tooltip" title="${item.MtlItemNo}" style="max-width: 230px;">${item.MtlItemNo}</td>
                                            <td class="ellipsis" data-toggle="tooltip" title="${item.MtlItemName}" style="max-width: 300px;">${item.MtlItemName}</td>
                                            <td class="ellipsis" data-toggle="tooltip" title="${item.InventoryName}" style="max-width: 150px;">${item.InventoryName}</td>
                                            <td>${item.ReceiptQty}</td>
                                            <td>${item.AcceptQty}</td>
                                            <td>${item.ScriptQty}</td>
                                            <td>${item.AvailableQty}</td>
                                            <td>${item.OrigUnitPrice}</td>
                                            <td>${item.OrigAmount}</td>
                                            <td>${item.OrigPreTaxAmt}</td>
                                            <td>${item.OrigTaxAmt}</td>
                                            <td>${item.PreTaxAmt}</td>
                                            <td>${item.TaxAmt}</td>
                                            <td class="text-center active-content col-sticky">
                                                ${item.ConfirmStatus == `Y` || item.ReConfirmStatus == `N` || MweBarcodeNum > 0 ? `<a class="active-link auth-detail" href="javascript:Read@(itemName)(${item.MweId},${item.MweDetailId},'U');"><i class="fas fa-eye"></i></a>` : `<a class="active-link auth-read active-disable" href="javascript:void(0);"><i class="fas fa-eye"></i></a>`}
                                                ${item.ConfirmStatus == `N` ? `<a class="active-link auth-detail" href="javascript:Edit@(itemName)(${item.MweId},${item.MweDetailId},'${item.IsAmortize}');"><i class="fas fa-edit"></i></a>` : `<a class="active-link auth-update active-disable" href="javascript:void(0);"><i class="fas fa-edit"></i></a>`}
                                                ${item.ConfirmStatus == `N`  ? `<a class="active-link auth-detail" href="javascript:Delete@(itemName)(${item.MweId},${item.MweDetailId});"><i class="fas fa-trash-alt"></i></a>` : `<a class="active-link auth-delete active-disable" href="javascript:void(0);"><i class="fas fa-trash-alt"></i></a>`}
                                                ${item.BarcodeCtrl == `N` && item.OutputBarcodeFlag == `N` ? MweBarcodeNum > 0 ? `<a class="active-link auth-detail btn-danger"  href="javascript:PopViewMwePrint(${item.MweId},${item.MweDetailId});"><i class="fas fa-print"></i><span>入庫標籤</span></a>`  : `<a class="active-link auth-detail" href="javascript:PopViewMwePrint(${item.MweId},${item.MweDetailId});"><i class="fas fa-print"></i><span>入庫標籤</span></a>` : `<a class="active-link auth-detail active-disable" href="javascript:void(0);"><i class="fas fa-print"></i><span>入庫標籤</span></a>`}
                                                </td>
                                          </tr>`;
                    });
                } else {
                    innerHtml += `<tr>
                                        <td class="text-center" colspan="16" style="background-color: #fff3cd;">
                                          <i class="fal fa-exclamation-circle"></i>&nbsp;目前尚無資料
                                        </td>
                                      </tr>`;
                }
            } else {
                alert(data.msg, "alert", 0);
            }

            $("#tblData@(itemName) tbody").html(innerHtml);
            TableComponentInit();
            Pager("#page@(itemName)", pageCount, objPage, InitData@(itemName));

            //${ item.ConfirmStatus == `Y` ? `<a class="active-link auth-mweDetail" href="javascript:PopViewMwePrint(${item.MweId},${item.MweDetailId});"><i class="fas fa-print"></i><span>標籤列印</span></a>` : `<a class="active-link auth-delete active-disable" href="javascript:void(0);"><i class="fas fa-print"></i><span>標籤列印</span></a>` }

        }


        function Read@(itemName)(MweId, MweDetailId) {
            $("#MweDetailId").val(MweDetailId ? MweDetailId : 0);
            $("#txtAvailableDate@(itemName)").attr("readonly", true);
            $("#txtReCheckDate@(itemName)").attr("readonly", true);
            $("#txtAcceptanceDate@(itemName)").attr("readonly", true);
            $("#cboUomId@(itemName)").attr("disabled", true);
            $("#cboInventoryId@(itemName)").attr("disabled", true);
            $("#txtReceiptQty@(itemName)").attr("readonly", true);
            $("#txtAcceptQty@(itemName)").attr("readonly", true);
            $("#txtScriptQty@(itemName)").attr("readonly", true);
            $("#txtReturnQty@(itemName)").attr("readonly", true);
            $("#txtAvailableQty@(itemName)").attr("readonly", true);
            $("#cboConfirmUserId@(itemName)").attr("disabled", true);
            $("#txtRemark@(itemName)").attr("readonly", true);
            $("#txtLotNumber@(itemName)").attr("readonly", true);
            $("#txtProject@(itemName)").attr("readonly", true);

            $("#cboQcStatus@(itemName)").attr("disabled", true);
            $("#cboProcessNo@(itemName)").attr("disabled", true);
            $("#txtOrigUnitPrice@(itemName)").attr("readonly", true);
            $("#txtDiscountDescription@(itemName)").attr("readonly", true);
            $("#cbxPaymentHold@(itemName)").attr("disabled", true);
            $("#cbxOverdue@(itemName)").attr("disabled", true);
            $("#cbxReserveTaxCode@(itemName)").attr("disabled", true);
            $(".choose-MoId").hide()


            Switch("#editData@(itemName)", "#listData@(itemName)");

            ComboBoxs.Default("#cboInventoryId@(itemName)", "@Url.Action("GetInventory", "ScmBasicInformation")", {}, "", "NA", "", "InventoryWithNo", "InventoryId"); //入庫庫別
            ComboBoxs.Default("#cboUomId@(itemName)", "@Url.Action("GetUnitOfMeasure", "PdmBasicInformation")", { "Status": "A"}, "", "NA", "", "UomNo", "UomId"); //加工單位
            ComboBoxs.Default("#cboConfirmUserId@(itemName)", "@Url.Action("GetUser", "BasicInformation")", {}, "", "NA", "", "UserWithNo", "UserId"); //確認者
            ComboBoxs.Default("#cboQcStatus@(itemName)", "@Url.Action("GetType", "BasicInformation")", { "TypeSchema": "MweDetail.CheckStatus" }, "", "NA", "", "TypeName", "TypeNo"); //檢驗類別
            ComboBoxs.Default("#cboProcessNo@(itemName)", "@Url.Action("GetErpData", "BasicInformation")", { "ColumnName": "ProcessNo", "Condition": $("#SupplierNo").val() }, "", "CHOOSE", "****", "ProcessName", "ProcessNo"); //ERP加工商製程


            if (MweDetailId > 0) {
                GetRoutingProcessItem()

                let targetUrl = "@Url.Action("GetMweDetail", "Inventory")";
                let postData = {
                    "MweId": $("#MweId").val(),
                    "MweDetailId": MweDetailId,
                };

                let data = DataAccess.Get(targetUrl, postData, false);

                if (data.status == "success") {
                    $.each(data.result, function (i, item) {

                        $("#MweDetailId").val(item.MweDetailId);

                        $("#cboUomId@(itemName)").val(item.UomId);
                        $("#cboInventoryId@(itemName)").val(item.InventoryId);
                        $("#txtReceiptQty@(itemName)").val(item.ReceiptQty);
                        $("#txtAcceptanceDate@(itemName)").val(item.AcceptanceDate);
                        $("#txtAcceptQty@(itemName)").val(item.AcceptQty);
                        $("#txtAvailableQty@(itemName)").val(item.AvailableQty);
                        $("#txtScriptQty@(itemName)").val(item.ScriptQty);
                        $("#txtReturnQty@(itemName)").val(item.ReturnQty);
                        $("#txtRemark@(itemName)").val(item.Remark);
                        $("#txtLotNumber@(itemName)").val(item.LotNumber);
                        $("#txtProject@(itemName)").val(item.ProjectCode);
                        $("#txtAvailableDate@(itemName)").val(item.AvailableDate);
                        $("#txtReCheckDate@(itemName)").val(item.ReCheckDate);
                        $("#cboConfirmUserId@(itemName)").val(item.ConfirmUserId);

                        $(".help-block").show();
                        $("#txtMoId@(itemName)").val(item.MoId);
                        $("#txtMtlItemId@(itemName)").val(item.MtlItemId);
                        $("#desWoErpFullNo@(itemName)").text(item.WoErpPrefix + "-" + item.WoErpNo);
                        $("#desMtlItemNo@(itemName)").text(item.MtlItemNo);
                        $("#desMtlItemName@(itemName)").text(item.MtlItemName);
                        $("#desMtlItemSpec@(itemName)").text(item.MtlItemSpec);

                        CheckMoIdType(item.MoId, MweDetailId)

                        if ($("#MoIdType").val() == "Y") {
                            $(".BarcodeVersion").show()
                            GetMweBarcodeTransfer@(itemName)(item.MoId,item.MweDetailId)
                            GetMoIdBarcode@(itemName)()
                        }
                        else {
                            $(".BarcodeVersion").hide()
                        }


                        GetWipOrderRequisitionSetQty(MweDetailId)


                        $("#txtReceiptQty@(itemName)").val(item.ReceiptQty);
                        $("#txtAcceptQty@(itemName)").val(item.AcceptQty);
                        $("#txtAvailableQty@(itemName)").val(item.AvailableQty);
                        $("#txtScriptQty@(itemName)").val(item.ScriptQty);
                        $("#txtReturnQty@(itemName)").val(item.ReturnQty);


                        $("#cboQcStatus@(itemName)").val(item.QcStatus);
                        $("#cboProcessNo@(itemName)").val(item.ProcessNo);
                        $("#txtOrigUnitPrice@(itemName)").val(item.OrigUnitPrice);
                        $("#txtOrigAmount@(itemName)").val(item.OrigAmount);
                        $("#txtOrigDiscountAmt@(itemName)").val(item.OrigDiscountAmt);
                        $("#txtReceiptExpense@(itemName)").val(item.ReceiptExpense);
                        $("#txtOrigPreTaxAmt@(itemName)").val(item.OrigPreTaxAmt);
                        $("#txtOrigTaxAmt@(itemName)").val(item.OrigTaxAmt);
                        $("#txtPreTaxAmt@(itemName)").val(item.PreTaxAmt);
                        $("#txtTaxAmt@(itemName)").val(item.TaxAmt);
                        $("#txtDiscountDescription@(itemName)").val(item.DiscountDescription);
                        $("#txtVoucherPayablePrefix@(itemName)").val(item.VoucherPayablePrefix);
                        $("#txtVoucherPayableSeq@(itemName)").val(item.VoucherPayableSeq);

                        if (item.PaymentHold == "Y") {
                            $("#cbxPaymentHold@(itemName)").attr("checked", true);
                        }else {
                            $("#cbxPaymentHold@(itemName)").attr("checked", false);
                        };

                        if (item.Overdue == "Y") {
                            $("#cbxOverdue@(itemName)").attr("checked", true);
                        }else {
                            $("#cbxOverdue@(itemName)").attr("checked", false);
                        };
                        if (item.ReserveTaxCode == "Y") {
                            $("#cbxReserveTaxCode@(itemName)").attr("checked", true);
                        }else {
                            $("#cbxReserveTaxCode@(itemName)").attr("checked", false);
                        };
                        if (item.ReturnCode == "Y") {
                            $("#cbxReturnCode@(itemName)").attr("checked", true);
                        }else {
                            $("#cbxReturnCode@(itemName)").attr("checked", false);
                        };
                        if (item.CostEntry == "Y") {
                            $("#cbxCostEntry@(itemName)").attr("checked", true);
                        }else {
                            $("#cbxCostEntry@(itemName)").attr("checked", false);
                        };
                        if (item.ExpenseEntry == "Y") {
                            $("#cbxExpenseEntry@(itemName)").attr("checked", true);
                        }else {
                            $("#cbxExpenseEntry@(itemName)").attr("checked", false);
                        };
                        if (item.UrgentMtl == "Y") {
                            $("#cbxUrgentMtl@(itemName)").attr("checked", true);
                        }else {
                            $("#cbxUrgentMtl@(itemName)").attr("checked", false);
                        };
                        if (item.CloseStatus == "Y") {
                            $("#cbxCloseStatus@(itemName)").attr("checked", true);
                        }else {
                            $("#cbxCloseStatus@(itemName)").attr("checked", false);
                        };
                    });
                } else {
                    alert(data.msg, "alert", 0);
                }
            }
        }

        function Edit@(itemName)(MweId, MweDetailId, isAmortize) {
            GetRoutingProcessItem()
            $("#MweDetailId").val(MweDetailId ? MweDetailId : -1);
            $("#txtAcceptanceDate@(itemName)").attr("readonly", false);
            $("#txtAvailableDate@(itemName)").attr("readonly", true);
            $("#txtReCheckDate@(itemName)").attr("readonly", true);
            $("#cboUomId@(itemName)").attr("disabled", true);
            $("#cboInventoryId@(itemName)").attr("disabled", false);
            $("#txtReceiptQty@(itemName)").attr("readonly", false);
            $("#txtAcceptQty@(itemName)").attr("readonly", false);
            $("#txtScriptQty@(itemName)").attr("readonly", false);
            $("#txtReturnQty@(itemName)").attr("readonly", true);
            $("#txtAvailableQty@(itemName)").attr("readonly", false);
            $("#cboConfirmUserId@(itemName)").attr("disabled", true);
            $("#txtRemark@(itemName)").attr("readonly", false);
            $("#txtLotNumber@(itemName)").attr("readonly", true);
            $("#txtProject@(itemName)").attr("readonly", false);

            $("#cboQcStatus@(itemName)").attr("disabled", true);
            $("#cboProcessNo@(itemName)").attr("disabled", false);
            $("#txtOrigUnitPrice@(itemName)").attr("readonly", false);
            $("#txtDiscountDescription@(itemName)").attr("readonly", false);
            $("#cbxPaymentHold@(itemName)").attr("disabled", false);
            $("#cbxOverdue@(itemName)").attr("disabled", false);
            $("#cbxReserveTaxCode@(itemName)").attr("disabled", false);

            GetSupplierNo()
            $(".help-block").hide();
            $("#txtMoId@(itemName)").val("");

            $(".read-status").show()

            if ($("#MweStatus").val() == "TP") {
                $(".read-status").hide()
            }
            $(".choose-MoId").show()
            $(".scrapRegisterNo").show()
            if ($("#MoneyDataShow").val() == "Y") {
                $("#moneyData@(itemName)").show()
            }
            else {
                $("#moneyData@(itemName)").hide()
            }

            $("#cbxPaymentHold@(itemName)").attr("checked", false);
            $("#cbxOverdue@(itemName)").attr("checked", false);
            $("#cbxReserveTaxCode@(itemName)").attr("checked", false);


            Switch("#editData@(itemName)", "#listData@(itemName)");

            ComboBoxs.Default("#cboInventoryId@(itemName)", "@Url.Action("GetInventory", "ScmBasicInformation")", {}, "", "NA", "", "InventoryWithNo", "InventoryId"); //入庫庫別
            ComboBoxs.Default("#cboUomId@(itemName)", "@Url.Action("GetUnitOfMeasure", "PdmBasicInformation")", { "Status": "A"}, "", "NA", "", "UomNo", "UomId"); //單位
            ComboBoxs.Default("#cboConfirmUserId@(itemName)", "@Url.Action("GetUser", "BasicInformation")", {}, "", "NA", "", "UserWithNo", "UserId"); //確認者
            ComboBoxs.Default("#cboQcStatus@(itemName)", "@Url.Action("GetType", "BasicInformation")", { "TypeSchema": "MweDetail.CheckStatus" }, "", "NA", "", "TypeName", "TypeNo"); //檢驗類別
            ComboBoxs.Default("#cboProcessNo@(itemName)", "@Url.Action("GetErpData", "BasicInformation")", { "ColumnName": "ProcessNo", "Condition": $("#SupplierNo").val() }, "", "CHOOSE", "****", "ProcessName", "ProcessNo"); //ERP加工商製程


            //日期欄位 Suites.DateDropper(功能開啟) Suites.SetDateDropper(日期設置)
            //Suites.DateDropper("#txtAcceptanceDate@(itemName)")

            //開單日預設今日
            let currentDate = $("#txtDocDateMoWarehouseEnryManagment").val();

            //Suites.SetDateDropper("#txtAcceptanceDate@(itemName)", currentDate);
            Suites.DatePicker("txtAcceptanceDate@(itemName)", currentDate);
            if (MweDetailId > 0) {
                $("#IsAmortizeType@(itemName)").val(isAmortize ? isAmortize : "N");


                if ($("#IsAmortizeType@(itemName)").val() == "Y") {
                    $("input[type='checkbox'][name='cbxBarcodeAmortize@(itemName)']").show();
                } else {
                    $("input[type='checkbox'][name='cbxBarcodeAmortize@(itemName)']").hide();
                }
            

                $("#cbxIsAmortize@(itemName)").prop("disabled", true);

                if (isAmortize == "N") {
                    $("#cbxIsAmortize@(itemName)").prop("checked", false);
                } else {
                    $("#cbxIsAmortize@(itemName)").prop("checked", true);
                }

                let targetUrl = "@Url.Action("GetMweDetail", "Inventory")";
                let postData = {
                    "MweId": $("#MweId").val(),
                    "MweDetailId": MweDetailId,
                };

                //$(".read-status").hide()
                $(".choose-MoId").hide()
                $(".scrapRegister").hide()
                //$(".scrapRegisterNo").hide()


                $("#txtReceiptQty@(itemName)").attr("readonly", true);
                $("#txtAcceptQty@(itemName)").attr("readonly", true);
                $("#txtScriptQty@(itemName)").attr("readonly", true);

                let data = DataAccess.Get(targetUrl, postData, false);

                if (data.status == "success") {
                    $.each(data.result, function (i, item) {
                        $("#ScrapRegister").val(item.ScrapRegister)
                        $("#MeasureType").val(item.MeasureType)

                        $("#MweDetailId").val(item.MweDetailId);
                        if (item.LotManagement == "N") {
                            $("#txtLotNumber@(itemName)").attr("readonly", false);
                        }
                        GetMweBarcodeTransfer@(itemName)(item.MoId, item.MweDetailId)
                        $("#cboUomId@(itemName)").val(item.UomId);
                        $("#cboInventoryId@(itemName)").val(item.InventoryId);
                        switch (companyId@(itemName)) {
                            case 2:
                                if (item.InventoryId != "12") {
                                    $("#InventoryPass").val(item.InventoryId)
                                }
                                break
                            case 3:
                                if (item.InventoryId != "129") {
                                    $("#InventoryPass").val(item.InventoryId)
                                }
                                break
                            case 4:
                                if (item.InventoryId != "46") {
                                    $("#InventoryPass").val(item.InventoryId)
                                }
                                break
                            case 5:
                                if (item.InventoryId != "115") {
                                    $("#InventoryPass").val(item.InventoryId)
                                }
                                break
                            default:
                                alert("資料錯誤")
                                return
                        }


                        $("#txtRemark@(itemName)").val(item.Remark);
                        $("#txtLotNumber@(itemName)").val(item.LotNumber);
                        $("#txtProject@(itemName)").val(item.ProjectCode);
                        $("#txtAvailableDate@(itemName)").val(item.AvailableDate);
                        $("#txtReCheckDate@(itemName)").val(item.ReCheckDate);
                        $("#cboConfirmUserId@(itemName)").val(item.ConfirmUserId);

                        $(".help-block").show();
                        $("#txtMoId@(itemName)").val(item.MoId);
                        $("#txtMtlItemId@(itemName)").val(item.MtlItemId);
                        $("#desWoErpFullNo@(itemName)").text(item.WoErpPrefix + "-" + item.WoErpNo);
                        $("#desMtlItemNo@(itemName)").text(item.MtlItemNo);
                        $("#desMtlItemName@(itemName)").text(item.MtlItemName);
                        $("#desMtlItemSpec@(itemName)").text(item.MtlItemSpec);

                        //if (item.AcceptanceDate != null) Suites.SetDateDropper("#txtAcceptanceDate@(itemName)", new Date(item.AcceptanceDate));
                        if (item.AcceptanceDate != null) Suites.DatePicker("txtAcceptanceDate@(itemName)", new Date(item.AcceptanceDate));

                        CheckMoIdType(item.MoId)

                        if ($("#MoIdType").val() == "Y") {
                            $(".BarcodeVersion").show()
                            if ($("#ScrapRegister").val() == "Y") {
                                if (item.InventoryId == "12" || item.InventoryId == "46" || item.InventoryId == "115") {
                                    $("#MweDetailIdScrap").val(item.MweDetailId);

                                    GetMoIdBarcodeScrap@(itemName)()
                                    $("#QueryButtomAll").attr("onclick", `javascript: GetMoIdBarcodeScrap@(itemName)()`)
                                }
                                else {
                                    $("#MweDetailIdPass").val(item.MweDetailId);
                                    GetMoIdBarcodePass@(itemName)()
                                    $("#QueryButtomAll").attr("onclick", `javascript: GetMoIdBarcodePass@(itemName)()`)
                                }
                            }
                            else {
                                GetMoIdBarcode@(itemName)()
                                $("#QueryButtomAll").attr("onclick", `javascript: GetMoIdBarcode@(itemName)()`)
                            }
                        }
                        else {
                            $("#txtReceiptQty@(itemName)").attr("readonly", false);
                            $("#txtAcceptQty@(itemName)").attr("readonly", false);
                            $("#txtScriptQty@(itemName)").attr("readonly", false);
                            $(".BarcodeVersion").hide()
                        }

                        GetWipOrderRequisitionSetQty(MweDetailId)


                        $("#txtReceiptQty@(itemName)").val(item.ReceiptQty);
                        $("#txtAcceptQty@(itemName)").val(item.AcceptQty);
                        $("#txtAvailableQty@(itemName)").val(item.AvailableQty);
                        $("#txtScriptQty@(itemName)").val(item.ScriptQty);
                        $("#txtReturnQty@(itemName)").val(item.ReturnQty);

                        if (item.ProcessCode = "****") {
                            $("#cboProcessNo@(itemName)").val("");
                        }
                        else {
                            $("#cboProcessNo@(itemName)").val(item.ProcessCode);
                        }
                        $("#txtOrigUnitPrice@(itemName)").val(item.OrigUnitPrice);
                        $("#txtOrigAmount@(itemName)").val(item.OrigAmount);
                        $("#txtOrigDiscountAmt@(itemName)").val(item.OrigDiscountAmt);
                        $("#txtReceiptExpense@(itemName)").val(item.ReceiptExpense);
                        $("#txtOrigPreTaxAmt@(itemName)").val(item.OrigPreTaxAmt);
                        $("#txtOrigTaxAmt@(itemName)").val(item.OrigTaxAmt);
                        $("#txtPreTaxAmt@(itemName)").val(item.PreTaxAmt);
                        $("#txtTaxAmt@(itemName)").val(item.TaxAmt);
                        if (item.AvailableDate != null) Suites.SetDateDropper("#txtAvailableDate@(itemName)", new Date(item.AvailableDate));
                        if (item.ReCheckDate != null) Suites.SetDateDropper("#txtReCheckDate@(itemName)", new Date(item.ReCheckDate));
                        $("#txtDiscountDescription@(itemName)").val(item.DiscountDescription);
                        $("#txtVoucherPayablePrefix@(itemName)").val(item.VoucherPayablePrefix);
                        $("#txtVoucherPayableNo@(itemName)").val(item.VoucherPayableNo);
                        $("#txtVoucherPayableSeq@(itemName)").val(item.VoucherPayableSeq);
                        $("#cboQcStatus@(itemName)").val(item.QcStatus);
                        if (item.PaymentHold == "Y") {
                            $("#cbxPaymentHold@(itemName)").attr("checked", true);
                        } else {
                            $("#cbxPaymentHold@(itemName)").attr("checked", false);
                        };
                        if (item.Overdue == "Y") {
                            $("#cbxOverdue@(itemName)").attr("checked", true);
                        } else {
                            $("#cbxOverdue@(itemName)").attr("checked", false);
                        };

                        if (item.ReserveTaxCode == "Y") {
                            $("#cbxReserveTaxCode@(itemName)").attr("checked", true);
                        } else {
                            $("#cbxReserveTaxCode@(itemName)").attr("checked", false);
                        };
                        if (item.ReturnCode == "Y") {
                            $("#cbxReturnCode@(itemName)").attr("checked", true);
                        } else {
                            $("#cbxReturnCode@(itemName)").attr("checked", false);
                        };
                        if (item.CostEntry == "Y") {
                            $("#cbxCostEntry@(itemName)").attr("checked", true);
                        } else {
                            $("#cbxCostEntry@(itemName)").attr("checked", false);
                        };
                        if (item.ExpenseEntry == "Y") {
                            $("#cbxExpenseEntry@(itemName)").attr("checked", true);
                        } else {
                            $("#cbxExpenseEntry@(itemName)").attr("checked", false);
                        };
                        if (item.UrgentMtl == "Y") {
                            $("#cbxUrgentMtl@(itemName)").attr("checked", true);
                        } else {
                            $("#cbxUrgentMtl@(itemName)").attr("checked", false);
                        };
                        if (item.CloseStatus == "Y") {
                            $("#cbxCloseStatus@(itemName)").attr("checked", true);
                        } else {
                            $("#cbxCloseStatus@(itemName)").attr("checked", false);
                        };

                    });


                    if ($("#IsAmortizeType@(itemName)").val() == "Y") {
                        $("input[type='checkbox'][name='cbxBarcodeAmortize@(itemName)']").show();
                    } else {
                        $("input[type='checkbox'][name='cbxBarcodeAmortize@(itemName)']").hide();
                    }
                
                } else {
                    alert(data.msg, "alert", 0);
                }

            } else {
                $("#IsAmortizeType@(itemName)").val("N");

                $("#cbxIsAmortize@(itemName)").prop("disabled", false);
                $("#cbxIsAmortize@(itemName)").attr("checked", false);

            }

            let popConfig = {
                targetSelector: "#txtMoId@(itemName)",
                popFunction: "PopViewManufactureOrder",
                objectMoId: "#txtMoId@(itemName)",
                objectWoErpFullNo: "#desWoErpFullNo@(itemName)",
                objectMtlItemId: "#txtMtlItemId@(itemName)",
                objectMtlItemNo: "#desMtlItemNo@(itemName)",
                objectMtlItemName: "#desMtlItemName@(itemName)",
                objectMtlItemSpec: "#desMtlItemSpec@(itemName)",
                objectQuantity: "#txtQuantity@(itemName)",
                objectInventoryId: "#cboInventoryId@(itemName) , #InventoryPass",
                objectUomId: "#cboUomId@(itemName)"
            };
            InitPopView(popConfig);
            if (!isMobile) {
                $(`#cboInventoryId@(itemName), #cboUomId@(itemName), #cboConfirmUserId@(itemName) ,#cboProcessNo@(itemName)`).select2({
                    width: "100%"
                });
            }
            if ($("#MoIdType").val() == "Y") {
                countcounts()

            }
        }

        async function Save@(itemName)() {
            if ($(objForm@(itemName)).valid()) {
                let BarcodeListY = [];
                let BarcodeListN = [];
                var barocdeQtyPass = 0;
                var barocdeQtyScrap = 0;
                let MweDetailId = -1;
                let BarcodeListAmortizeTtypeY = [];
                let BarcodeListAmortizeTtypeN = [];
                var newbarocdeQtyScrap = 0;
                let QaResult = "N"

                if ($("#MoIdType").val() == "Y") {
                    $.each($("input[name='cbxBarcode@(itemName)']"), function () {
                        if ($(this).is(":checked")) {

                            if ($(this).data("barcode-status") == "P") {
                                barocdeQtyPass += $(this).data("barcode-qty")
                            }
                            else if ($(this).data("barcode-status") == "S"){
                                barocdeQtyScrap += $(this).data("barcode-qty")
                            }

                            BarcodeListY.push($(this).val());
                        }
                        else {
                            if (!$(this).is(":disabled")) {
                                BarcodeListN.push($(this).val());
                            }
                        }
                    });

                    $.each($("input[name='cbxBarcodeAmortize@(itemName)']"), function () {
                        if ($(this).is(":checked")) {



                            BarcodeListAmortizeTtypeY.push($(this).val());
                        }
                        else {
                            if (!$(this).is(":disabled")) {
                                BarcodeListAmortizeTtypeN.push($(this).val());
                            }
                        }
                    });

                    $("#txtReceiptQty@(itemName)").val(barocdeQtyPass + barocdeQtyScrap)

                    $("#txtAcceptQty@(itemName)").val(barocdeQtyPass)
                    if ($("#ScrapRegister").val() == "Y") {
                        switch (companyId@(itemName)) {
                            case 2:
                                if ($("#cboInventoryId@(itemName)").val() == 12) {
                                    $("#txtAcceptQty@(itemName)").val(barocdeQtyScrap)
                                    $("#txtScriptQty@(itemName)").val(0);
                                    $("#txtAvailableQty@(itemName)").val(barocdeQtyScrap);
                                }
                                else {
                                    $("#txtAcceptQty@(itemName)").val(barocdeQtyPass)
                                    $("#txtScriptQty@(itemName)").val(barocdeQtyScrap);
                                    $("#txtAvailableQty@(itemName)").val(barocdeQtyPass);
                                    countcounts();
                                    newbarocdeQtyScrap = parseInt($("#txtScriptQty@(itemName)").val());

                                }
                                break;
                            case 3:
                                if ($("#cboInventoryId@(itemName)").val() == 129) {
                                    $("#txtAcceptQty@(itemName)").val(barocdeQtyScrap)
                                    $("#txtScriptQty@(itemName)").val(0);
                                    $("#txtAvailableQty@(itemName)").val(barocdeQtyScrap);
                                }
                                else {
                                    $("#txtAcceptQty@(itemName)").val(barocdeQtyPass)
                                    $("#txtScriptQty@(itemName)").val(barocdeQtyScrap);
                                    $("#txtAvailableQty@(itemName)").val(barocdeQtyPass);
                                    countcounts();
                                    newbarocdeQtyScrap = parseInt($("#txtScriptQty@(itemName)").val());
                                }
                                break;
                            case 4:
                                if ($("#cboInventoryId@(itemName)").val() == 46) {
                                    $("#txtAcceptQty@(itemName)").val(barocdeQtyScrap)
                                    $("#txtScriptQty@(itemName)").val(0);
                                    $("#txtAvailableQty@(itemName)").val(barocdeQtyScrap);
                                }
                                else {
                                    $("#txtAcceptQty@(itemName)").val(barocdeQtyPass)
                                    $("#txtScriptQty@(itemName)").val(barocdeQtyScrap);
                                    $("#txtAvailableQty@(itemName)").val(barocdeQtyPass);
                                    countcounts();
                                    newbarocdeQtyScrap = parseInt($("#txtScriptQty@(itemName)").val());
                                }
                                break;
                            case 5:
                                if ($("#cboInventoryId@(itemName)").val() == 115) {
                                    $("#txtAcceptQty@(itemName)").val(barocdeQtyScrap)
                                    $("#txtScriptQty@(itemName)").val(0);
                                    $("#txtAvailableQty@(itemName)").val(barocdeQtyScrap);
                                }
                                else {
                                    $("#txtAcceptQty@(itemName)").val(barocdeQtyPass)
                                    $("#txtScriptQty@(itemName)").val(barocdeQtyScrap);
                                    $("#txtAvailableQty@(itemName)").val(barocdeQtyPass);
                                    countcounts();
                                    newbarocdeQtyScrap = parseInt($("#txtScriptQty@(itemName)").val());
                                }
                                break;
                            default:
                                alert("資料錯誤")
                                return
                        }
                    }
                    else {
                        $("#txtAcceptQty@(itemName)").val(barocdeQtyPass)
                        $("#txtScriptQty@(itemName)").val(barocdeQtyScrap);
                        $("#txtAvailableQty@(itemName)").val(barocdeQtyPass);
                    }
                    if (BarcodeListY.length <= 0 ) {
                        alert("【入庫管理錯誤】- 請選擇條碼!")
                        return
                    }
                    
                }

                if ($("#ScrapRegister").val() == "Y") {
                    if ($("#cboMweErpPrefixMoWarehouseEnryManagment").val() != "5903") {
                        if ($("#BarcodeListStatus").val() == "S") {
                            if ($("#MweDetailIdScrap").val() > 0) {
                                MweDetailId = parseInt($("#MweDetailIdScrap").val());
                            }
                            switch (companyId@(itemName)) {
                                case 2:
                                    if ($("#cboInventoryId@(itemName)").val() != "12") {
                                        alert("目前是報廢品列表,入庫庫別請選擇【待報廢倉】")
                                        return
                                    }
                                    break;
                                case 3:
                                    if ($("#cboInventoryId@(itemName)").val() != "129") {
                                        alert("目前是報廢品列表,入庫庫別請選擇【待報廢倉】")
                                        return
                                    }
                                    break;
                                case 4:
                                    if ($("#cboInventoryId@(itemName)").val() != "46") {
                                        alert("目前是報廢品列表,入庫庫別請選擇【待報廢倉】")
                                        return
                                    }
                                    break;
                                case 5:
                                    if ($("#cboInventoryId@(itemName)").val() != "155") {
                                        alert("目前是報廢品列表,入庫庫別請選擇【待報廢倉】")
                                        return
                                    }
                                    break;
                                default:
                                    alert("資料錯誤")
                                    return
                            }
                        }
                        else if ($("#BarcodeListStatus").val() == "P") {
                            if ($("#MweDetailIdPass").val() > 0) {
                                MweDetailId = parseInt($("#MweDetailIdPass").val());
                            }
                            switch (companyId@(itemName)) {
                                case 2:
                                    if ($("#cboInventoryId@(itemName)").val() == "12") {
                                        alert("【入庫管理錯誤】- 目前是良品列表,入庫庫別請選擇良品倉")
                                        return
                                    }
                                    break;
                                case 3:
                                    if ($("#cboInventoryId@(itemName)").val() == "129") {
                                        alert("【入庫管理錯誤】- 目前是良品列表,入庫庫別請選擇良品倉")
                                        return
                                    }
                                    break;
                                case 4:
                                    if ($("#cboInventoryId@(itemName)").val() == "46") {
                                        alert("【入庫管理錯誤】- 目前是良品列表,入庫庫別請選擇良品倉")
                                        return
                                    }
                                    break;
                                case 5:
                                    if ($("#cboInventoryId@(itemName)").val() == "155") {
                                        alert("【入庫管理錯誤】- 目前是良品列表,入庫庫別請選擇良品倉")
                                        return
                                    }
                                    break;
                                default:
                                    alert("資料錯誤")
                                    return
                            }
                        }
                    }
                    else {
                        MweDetailId = parseInt($("#MweDetailId").val());

                    }
                }
                else {
                    MweDetailId = parseInt($("#MweDetailId").val());
                }

                //AmountCalculation()
                
                if ($("#MeasureType").val() == "0") {
                    $("#cboQcStatus@(itemName)").val("0")
                }
                else {
                    if ($("#txtReceiptQty@(itemName)").val() == $("#txtAcceptQty@(itemName)").val()) {
                        $("#cboQcStatus@(itemName)").val("2")
                    }
                    else {
                        $("#cboQcStatus@(itemName)").val("3")
                    }
                }
                if ($("#txtAcceptQty@(itemName)").val() > 0 && $("#LotManagement").val() != "N") {
                    let CheckResult = CheckMoIdDateQa()
                    switch (CheckResult) {
                        case "A":
                        case "Y":
                            break;
                        case "S":
                            return
                            break;
                        case "N":
                            const result = await swal.fire({
                                titleText: "請確認是否要執行入庫?",
                                text: "最新品異單判定為報廢,該次入庫會將選取的良品條碼或良品數量全歸入報廢",
                                icon: "warning",
                                allowOutsideClick: false,
                                allowEscapeKey: false,
                                showCancelButton: true,
                                confirmButtonColor: '#d33',
                                reverseButtons: true
                            });

                            if (result.isConfirmed) {
                                alert("確認");
                                QaResult = "Y"
                                // 在這裡可以放入確認後的邏輯
                            } else {
                                alert("拒絕");
                                // 在這裡放入拒絕後的邏輯
                                return; // 終止函數執行
                            }
                            break;
                    }
                }
                


                if (MweDetailId <= 0) {
                    let targetUrl = "@Url.Action("AddMweDetail", "Inventory")";
                    let postData = {
                        "MweId": $("#MweId").val(),
                        "MoId": $("#txtMoId@(itemName)").val(),
                        "MtlItemId": $("#txtMtlItemId@(itemName)").val(),
                        "UomId": $("#cboUomId@(itemName)").val(),
                        "InventoryId": $("#cboInventoryId@(itemName)").val(),
                        "AcceptanceDate": $("#txtAcceptanceDate@(itemName)").val(),
                        "ReceiptQty": $("#txtReceiptQty@(itemName)").val(),
                        "AcceptQty": $("#txtAcceptQty@(itemName)").val(),
                        "AvailableQty": $("#txtAvailableQty@(itemName)").val(),
                        "ScriptQty": $("#txtScriptQty@(itemName)").val(),
                        "ReturnQty": $("#txtReturnQty@(itemName)").val(),
                        "OrigUnitPrice": $("#txtOrigUnitPrice@(itemName)").val(),
                        "OrigAmount": $("#txtOrigAmount@(itemName)").val(),
                        "OrigDiscountAmt": $("#txtOrigDiscountAmt@(itemName)").val(),
                        "ReceiptExpense": $("#txtReceiptExpense@(itemName)").val(),
                        "OrigPreTaxAmt": $("#txtOrigPreTaxAmt@(itemName)").val(),
                        "OrigTaxAmt": $("#txtOrigTaxAmt@(itemName)").val(),
                        "PreTaxAmt": $("#txtPreTaxAmt@(itemName)").val(),
                        "TaxAmt": $("#txtTaxAmt@(itemName)").val(),
                        "DiscountDescription": $("#txtDiscountDescription@(itemName)").val(),
                        "Remark": $("#txtRemark@(itemName)").val(),
                        "ProjectCode": $("#txtProject@(itemName)").val(),
                        "ProcessCode": $("#cboProcessNo@(itemName)").val(),
                        "QcStatus": $("#cboQcStatus@(itemName)").val(),
                        "Overdue": ($("#cbxOverdue@(itemName)").is(":checked") ? "Y" : "N"),
                        "ReserveTaxCode": ($("#cbxReserveTaxCode@(itemName)").is(":checked") ? "Y" : "N"),
                        "PaymentHold": ($("#cbxPaymentHold@(itemName)").is(":checked") ? "Y" : "N"),
                        "BarcodeNoY": BarcodeListY.join(","),
                        "BarcodeNoN": BarcodeListN.join(","),
                        "ScrapRegister": $("#ScrapRegister").val(),
                        "LotNumber": $("#txtLotNumber@(itemName)").val(),
                        "AvailableDate": $("#txtAvailableDate@(itemName)").val(),
                        "ReCheckDate": $("#txtReCheckDate@(itemName)").val(),
                        "BarcodeListAmortizeTtypeY": BarcodeListAmortizeTtypeY.join(","),
                        "IsAmortize": ($("#cbxIsAmortize@(itemName)").is(":checked") ? "Y" : "N"),
                        "AmortizeNewCount": newbarocdeQtyScrap,
                        "QaResult": QaResult,
                        "QcRecordId": $("#QcRecordId").val(),
                        "OverMsg": OverMsg
                    };

                    let data = DataAccess.EditContinued(targetUrl, postData, false);

                    if (data.result.OverMsg == "N") {
                        const result = await swal.fire({
                            titleText: "請確認是否要執行入庫?",
                            text: "【單據設定警告超入】生產數量超過製令預計產量!!!!",
                            icon: "warning",
                            allowOutsideClick: false,
                            allowEscapeKey: false,
                            showCancelButton: true,
                            confirmButtonColor: '#d33',
                            reverseButtons: true
                        });

                        if (result.isConfirmed) {
                            OverMsg = "P"
                            Save@(itemName)()

                        } else {
                            alert("拒絕");
                            return; 
                        }
                    }
                    else {
                        if ($("#ScrapRegister").val() == "Y") {
                            if ($("#cboMweErpPrefixMoWarehouseEnryManagment").val() == "5903") {
                                Return@(itemName)();
                                EditMoWarehouseEnryManagment($("#MweId").val(), $("#ScrapRegister").val())
                                return
                            }

                            if ($("#MoIdType").val() == "Y") {
                                $("#txtReceiptQty@(itemName)").attr("readonly", true);
                                $("#txtAcceptQty@(itemName)").attr("readonly", true);
                                $("#txtScriptQty@(itemName)").attr("readonly", true);
                                $(".choose-MoId").hide()
                                GetWipOrderRequisitionSetQty()
                                alert("【入庫管理】- 儲存成功!!!", "success");
                                $.each(data.result, function (i, item) {

                                    if (i == "MweDetailId") {
                                        MweDetailId = item
                                    }
                                    if ($("#ScrapRegister").val() == "Y") {
                                        if ($("#BarcodeListStatus").val() == "P") {
                                            $("#MweDetailIdPass").val(MweDetailId);
                                        }
                                        else if ($("#BarcodeListStatus").val() == "S") {
                                            $("#MweDetailIdScrap").val(MweDetailId);
                                        }
                                    }
                                    else if ($("#ScrapRegister").val() == "N") {
                                        $("#MweDetailId").val(MweDetailId);
                                    }
                                });
                                EditMoWarehouseEnryManagment($("#MweId").val(), $("#ScrapRegister").val())

                                
                                OverMsg = ""
                            }
                            else {
                                alert("【入庫管理】- 儲存成功!!!", "success");
                                Return@(itemName)();
                                return
                            }
                        }
                        else if ($("#ScrapRegister").val() == "N"){
                            Return@(itemName)();
                            EditMoWarehouseEnryManagment($("#MweId").val())
                        }
                    }
                } else {
                    let targetUrl = "@Url.Action("UpdateMweDetail", "Inventory")";
                    let postData = {
                        "MweDetailId": MweDetailId,
                        "MweId": $("#MweId").val(),
                        "InventoryId": $("#cboInventoryId@(itemName)").val(),
                        "AcceptanceDate": $("#txtAcceptanceDate@(itemName)").val(),
                        "ReceiptQty": $("#txtReceiptQty@(itemName)").val(),
                        "AcceptQty": $("#txtAcceptQty@(itemName)").val(),
                        "AvailableQty": $("#txtAvailableQty@(itemName)").val(),
                        "ScriptQty": $("#txtScriptQty@(itemName)").val(),
                        "ReturnQty": $("#txtReturnQty@(itemName)").val(),
                        "OrigUnitPrice": $("#txtOrigUnitPrice@(itemName)").val(),
                        "OrigAmount": $("#txtOrigAmount@(itemName)").val(),
                        "OrigDiscountAmt": $("#txtOrigDiscountAmt@(itemName)").val(),
                        "ReceiptExpense": $("#txtReceiptExpense@(itemName)").val(),
                        "DiscountDescription": $("#txtDiscountDescription@(itemName)").val(),
                        "OrigPreTaxAmt": $("#txtOrigPreTaxAmt@(itemName)").val(),
                        "OrigTaxAmt": $("#txtOrigTaxAmt@(itemName)").val(),
                        "PreTaxAmt": $("#txtPreTaxAmt@(itemName)").val(),
                        "TaxAmt": $("#txtTaxAmt@(itemName)").val(),
                        "Remark": $("#txtRemark@(itemName)").val(),
                        "ProjectCode": $("#txtProject@(itemName)").val(),
                        "ProcessCode": $("#cboProcessNo@(itemName)").val(),
                        "QcStatus": $("#cboQcStatus@(itemName)").val(),
                        "Overdue": ($("#cbxOverdue@(itemName)").is(":checked") ? "Y" : "N"),
                        "ReserveTaxCode": ($("#cbxReserveTaxCode@(itemName)").is(":checked") ? "Y" : "N"),
                        "PaymentHold": ($("#cbxPaymentHold@(itemName)").is(":checked") ? "Y" : "N"),
                        "MoIdType": $("#MoIdType").val(),
                        "BarcodeNoY": BarcodeListY.join(","),
                        "BarcodeNoN": BarcodeListN.join(","),
                        "ScrapRegister": $("#ScrapRegister").val(),
                        "LotNumber": $("#txtLotNumber@(itemName)").val(),
                        "AvailableDate": $("#txtAvailableDate@(itemName)").val(),
                        "ReCheckDate": $("#txtReCheckDate@(itemName)").val(),
                        "BarcodeListAmortizeTtypeY": BarcodeListAmortizeTtypeY.join(","),
                        "AmortizeNewCount": newbarocdeQtyScrap,
                        "IsAmortize": ($("#cbxIsAmortize@(itemName)").is(":checked") ? "Y" : "N"),
                        "QaResult": QaResult,
                        "QcRecordId": $("#QcRecordId").val(),
                        "OverMsg": OverMsg
                    };

                    let data = DataAccess.EditContinued(targetUrl, postData, false);

                    if (data.result.OverMsg == "N") {
                        const result = await swal.fire({
                            titleText: "請確認是否要執行入庫?",
                            text: "【單據設定警告超入】生產數量超過製令預計產量!!!!",
                            icon: "warning",
                            allowOutsideClick: false,
                            allowEscapeKey: false,
                            showCancelButton: true,
                            confirmButtonColor: '#d33',
                            reverseButtons: true
                        });

                        if (result.isConfirmed) {
                            OverMsg = "P"
                            Save@(itemName)()

                        } else {
                            alert("拒絕");
                            return;
                        }
                    }
                    else if (data.result.OverMsg == "P") {
                            if ($("#MweDetailIdScrap").val() > 0 || $("#MweDetailIdPass").val() > 0) {
                                if ($("#MweDetailId").val() > 0) {
                                    $("#MweDetailId").val("")
                                    Return@(itemName)();
                                    EditMoWarehouseEnryManagment($("#MweId").val())
                                }
                                else {
                                    OverMsg = ""
                                    GetWipOrderRequisitionSetQty()
                                    EditMoWarehouseEnryManagment($("#MweId").val(), $("#ScrapRegister").val())
                                }
                            }
                            else
                            {
                                 $("#MweDetailId").val("")
                                 Return@(itemName)();
                                 EditMoWarehouseEnryManagment($("#MweId").val())
                            }
                            alert("【入庫管理】- 更新成功!!!", "success");

                    }else{
                         $("#MweDetailId").val("")
                         Return@(itemName)();
                         EditMoWarehouseEnryManagment($("#MweId").val())
                    }
                }
            }
        }


        //數量公式檢查
        function checkNum() {
            var sumNum, returnNum, badNum, checkNum, enterNum, MakeQty
            //進貨數量更動
            $("#txtReceiptQty@(itemName)").change(function () {
                if ($("#MoIdType").val() == "N") {
                    return
                }
                //列表固定數值取值
                PlanQty = $("#desPlanQty@(itemName)").text(); //預計產量
                EnterQty = $("#desEnterQty@(itemName)").text(); //已經入庫數量
                NoEnterQty = $("#desNoEnterQty@(itemName)").text(); //可以驗收數量
                NoNgQty = $("#desNoNgQty@(itemName)").text(); //可以報廢數量
                MakeQty = $("#desMakeQty@(itemName)").text(); //可進貨數量
                if ($("#cboMweErpPrefixMoWarehouseEnryManagment").val() == "5903") {
                    MakeQty = MakeQty ; //可進貨數量
                }
                else {
                    MakeQty = parseInt($("#desNoEnterQty@(itemName)").text()) + parseInt($("#desNoNgQty@(itemName)").text()) ; //可進貨數量
                }

                //輸入框欄位取值
                enterNum = $("#txtReceiptQty@(itemName)").val() //進貨
                checkNum = $("#txtAcceptQty@(itemName)").val();  //驗收
                badNum = $("#txtScriptQty@(itemName)").val();  //報廢1

                if ($("#cboMweErpPrefixMoWarehouseEnryManagment").val() == "5903") {
                    if (parseInt(enterNum) > parseInt(MakeQty)) {
                        alert(`【入庫管理錯誤】- 可進貨數量為${(parseInt(MakeQty))},已經超過可進貨數量`);
                        $("#txtReceiptQty@(itemName)").val(MakeQty)
                        $("#txtAvailableQty@(itemName)").val(MakeQty); //計價
                        AmountCalculation()
                        return;
                    }
                    if (parseInt(enterNum) < parseInt(0)) {
                        alert(`【入庫管理錯誤】- 可進貨數量不能為負數`);
                        $("#txtReceiptQty@(itemName)").val(0)
                        $("#txtAvailableQty@(itemName)").val(0); //計價
                        AmountCalculation()
                        return;
                    }
                    if (parseInt(enterNum) <= parseInt(MakeQty)) {
                        $("#txtReceiptQty@(itemName)").val(enterNum)
                        $("#txtAcceptQty@(itemName)").val(enterNum);
                        $("#txtAvailableQty@(itemName)").val(enterNum); //計價
                        $("#txtScriptQty@(itemName)").val(0);
                        AmountCalculation()
                        return;
                    }
                    return
                }
                //進貨數量 小於 0
                if (parseInt(enterNum) <= 0) {
                    alert(`【入庫管理錯誤】- 驗收數不可小於等於0`);
                    $("#txtReceiptQty@(itemName)").val(0);
                    $("#txtAcceptQty@(itemName)").val(0);  //驗收
                    $("#txtScriptQty@(itemName)").val(0); //報廢
                    $("#txtAvailableQty@(itemName)").val(0); //計價
                    AmountCalculation()
                    return;
                }
                //進貨數量 大於 可以進貨數量 =>直接將各欄位帶入正確值
                if (parseInt(enterNum) > parseInt(MakeQty)) {
                    alert(`【入庫管理錯誤】- 可進貨數量為${(parseInt(MakeQty))},已經超過可進貨數量`);
                    $("#txtReceiptQty@(itemName)").val((parseInt(MakeQty)));
                    $("#txtAcceptQty@(itemName)").val(NoEnterQty)  //驗收
                    $("#txtScriptQty@(itemName)").val(NoNgQty) //報廢
                    $("#txtAvailableQty@(itemName)").val(NoEnterQty); //計價
                    AmountCalculation()
                    return;
                }
                //進貨數量 小於 可以進貨數量 且大於 可驗收數量
                if (parseInt(enterNum) < parseInt(MakeQty) && parseInt(enterNum) > (parseInt(NoEnterQty))) {
                    $("#txtReceiptQty@(itemName)").val((parseInt(enterNum)));
                    $("#txtAcceptQty@(itemName)").val(NoEnterQty)  //驗收
                    $("#txtScriptQty@(itemName)").val(parseInt(enterNum) - parseInt(NoEnterQty) ) //報廢
                    $("#txtAvailableQty@(itemName)").val(NoEnterQty); //計價
                    AmountCalculation()
                    return;
                }
                //進貨數量 小於 可以進貨數量 且小於 可驗收數量
                if (parseInt(enterNum) < parseInt(MakeQty) && parseInt(enterNum) < (parseInt(NoEnterQty))) {
                    $("#txtReceiptQty@(itemName)").val((parseInt(enterNum)));
                    $("#txtAcceptQty@(itemName)").val(parseInt(enterNum))  //驗收
                    $("#txtScriptQty@(itemName)").val(0) //報廢
                    $("#txtAvailableQty@(itemName)").val(parseInt(enterNum)); //計價
                    AmountCalculation()
                    return;
                }
            })
            //驗收數量更動
            $("#txtAcceptQty@(itemName)").change(function () {
                if ($("#MoIdType").val() == "N") {
                    return
                }
                //列表固定數值取值
                PlanQty = $("#desPlanQty@(itemName)").text(); //預計產量
                NoEnterQty = $("#desNoEnterQty@(itemName)").text(); //可以驗收數量
                NoNgQty = $("#desNoNgQty@(itemName)").text(); //可以報廢數量
                MakeQty = $("#desMakeQty@(itemName)").text(); //可進貨數量
                if ($("#cboMweErpPrefixMoWarehouseEnryManagment").val() == "5903") {
                    MakeQty = MakeQty ; //可進貨數量
                }
                else {
                    MakeQty = parseInt($("#desNoEnterQty@(itemName)").text()) + parseInt($("#desNoNgQty@(itemName)").text()) ; //可進貨數量
                }
                //輸入框欄位取值
                enterNum = $("#txtReceiptQty@(itemName)").val() //進貨
                checkNum = $("#txtAcceptQty@(itemName)").val();  //驗收
                badNum = $("#txtScriptQty@(itemName)").val();  //報廢

                if ($("#cboMweErpPrefixMoWarehouseEnryManagment").val() == "5903") {
                    if (parseInt(checkNum) > parseInt(enterNum)) {
                        alert(`【入庫管理錯誤】- 驗收數量為${(parseInt(enterNum))},已經超過進貨數量`);
                        $("#txtAcceptQty@(itemName)").val(enterNum) //驗收
                        $("#txtScriptQty@(itemName)").val(0) //報廢
                        $("#txtAvailableQty@(itemName)").val(enterNum); //計價
                        AmountCalculation()
                        return
                    }
                    if (parseInt(checkNum) < parseInt(0)) {
                        alert(`【入庫管理錯誤】- 可進貨數量不能為負數`);
                        $("#txtAcceptQty@(itemName)").val(0) //驗收
                        $("#txtScriptQty@(itemName)").val(enterNum) //報廢
                        $("#txtAvailableQty@(itemName)").val(0); //計價
                        AmountCalculation()
                        return
                    }
                    if (parseInt(checkNum) <= parseInt(enterNum)) {
                        $("#txtAcceptQty@(itemName)").val(checkNum) //驗收
                        $("#txtScriptQty@(itemName)").val(enterNum - checkNum) //報廢
                        $("#txtAvailableQty@(itemName)").val(checkNum); //計價
                        AmountCalculation()
                        return
                    }

                    return
                }

                //進貨數 不等於 驗收數+報廢數時 進貨數不動 =>
                //驗收數是否有大於可驗收數 有:用可驗收數判定  否:用驗收數判定
                //情境A.驗收數的大於進貨數 那驗收數 等於 進貨數 報廢數為0
                //情境B.驗收數小於進貨數  那 驗收數 + 報廢數 等於 進貨數
                //情境C.驗收數小於0且報廢數小於進貨數  那 驗收數,計價數 = 進貨數 - 可報廢數 ; 報廢數 = 可報廢數
                //情境D.驗收數小於0且報廢數大於進貨數  那 驗收數,計價數 = 0 ; 報廢數 = 進貨數
                if (parseInt(enterNum) != parseInt(checkNum) + parseInt(badNum)) {
                    if (parseInt(checkNum) <= parseInt(NoEnterQty)) { //驗收數小於可以驗收數 用驗收數判定
                        if (parseInt(checkNum) > parseInt(enterNum)) {
                            $("#txtAcceptQty@(itemName)").val(enterNum)  //驗收
                            $("#txtScriptQty@(itemName)").val(0) //報廢
                            $("#txtAvailableQty@(itemName)").val(enterNum); //計價
                            AmountCalculation()
                            return;
                        }
                        else {
                            if (parseInt(checkNum) < 0) {
                                alert("驗收數不可以小於0");
                                if (parseInt(enterNum) <= parseInt(NoNgQty)) {
                                    $("#txtAcceptQty@(itemName)").val(0);  //驗收
                                    $("#txtScriptQty@(itemName)").val(enterNum); //報廢
                                    $("#txtAvailableQty@(itemName)").val(0); //計價
                                    AmountCalculation()
                                    return;
                                }
                                else {
                                    $("#txtAcceptQty@(itemName)").val(parseInt(enterNum) - parseInt(NoNgQty));  //驗收
                                    $("#txtScriptQty@(itemName)").val(NoNgQty); //報廢
                                    $("#txtAvailableQty@(itemName)").val(parseInt(enterNum) - parseInt(NoNgQty)); //計價
                                    AmountCalculation()
                                    return;
                                }
                            }

                            if (parseInt(enterNum) - parseInt(checkNum) > parseInt(NoNgQty)) {
                                $("#txtAcceptQty@(itemName)").val(parseInt(enterNum) - parseInt(NoNgQty))  //驗收
                                $("#txtScriptQty@(itemName)").val(NoNgQty) //報廢
                                $("#txtAvailableQty@(itemName)").val(parseInt(enterNum) - parseInt(NoNgQty)); //計價
                                AmountCalculation()
                                return;
                            }
                            else {
                                $("#txtAcceptQty@(itemName)").val(checkNum)  //驗收
                                $("#txtScriptQty@(itemName)").val(parseInt(enterNum) - parseInt(checkNum)) //報廢
                                $("#txtAvailableQty@(itemName)").val(checkNum); //計價
                                AmountCalculation()
                                return;
                            }
                        }
                    }
                    else { //驗收數大於可以驗收數 要用可驗收數判定
                        if (parseInt(NoEnterQty) > parseInt(enterNum)) {
                            $("#txtAcceptQty@(itemName)").val(enterNum)  //驗收
                            $("#txtScriptQty@(itemName)").val(0) //報廢
                            $("#txtAvailableQty@(itemName)").val(enterNum); //計價
                            AmountCalculation()
                            return;
                        }
                        else {
                            if (parseInt(enterNum) - parseInt(NoEnterQty) > parseInt(NoNgQty)) {
                                $("#txtAcceptQty@(itemName)").val(parseInt(enterNum) - parseInt(NoNgQty))  //驗收
                                $("#txtScriptQty@(itemName)").val(NoNgQty) //報廢
                                $("#txtAvailableQty@(itemName)").val(parseInt(enterNum) - parseInt(NoNgQty)); //計價
                                AmountCalculation()
                                return;
                            }
                            else {
                                $("#txtAcceptQty@(itemName)").val(NoEnterQty)  //驗收
                                $("#txtScriptQty@(itemName)").val(parseInt(enterNum) - parseInt(NoEnterQty)) //報廢
                                $("#txtAvailableQty@(itemName)").val(NoEnterQty); //計價
                                AmountCalculation()
                                return;
                            }
                        }
                    }

                }
            })
            //報廢數量更動
            $("#txtScriptQty@(itemName)").change(function () {
                if ($("#MoIdType").val() == "N") {
                    return
                }
                //列表固定數值取值
                PlanQty = $("#desPlanQty@(itemName)").text(); //預計產量
                NoEnterQty = $("#desNoEnterQty@(itemName)").text(); //可以驗收數量
                NoNgQty = $("#desNoNgQty@(itemName)").text(); //可以報廢數量
                MakeQty = $("#desMakeQty@(itemName)").text(); //可進貨數量
                if ($("#cboMweErpPrefixMoWarehouseEnryManagment").val() == "5903") {
                    MakeQty = MakeQty ; //可進貨數量
                }
                else {
                    MakeQty = parseInt($("#desNoEnterQty@(itemName)").text()) + parseInt($("#desNoNgQty@(itemName)").text()) ; //可進貨數量
                }
                //輸入框欄位取值
                enterNum = $("#txtReceiptQty@(itemName)").val() //進貨
                checkNum = $("#txtAcceptQty@(itemName)").val();  //驗收
                badNum = $("#txtScriptQty@(itemName)").val();  //報廢


                if ($("#cboMweErpPrefixMoWarehouseEnryManagment").val() == "5903") {
                    if (parseInt(badNum) > parseInt(enterNum)) {
                        alert(`【入庫管理錯誤】- 驗收數量為${(parseInt(enterNum))},已經超過進貨數量`);
                        $("#txtAcceptQty@(itemName)").val(0) //驗收
                        $("#txtScriptQty@(itemName)").val(enterNum) //報廢
                        $("#txtAvailableQty@(itemName)").val(0); //計價
                        AmountCalculation()
                        return
                    }
                    if (parseInt(badNum) < parseInt(0)) {
                        alert(`【入庫管理錯誤】- 可進貨數量不能為負數`);
                        $("#txtAcceptQty@(itemName)").val(enterNum) //驗收
                        $("#txtScriptQty@(itemName)").val(0) //報廢
                        $("#txtAvailableQty@(itemName)").val(enterNum); //計價
                        AmountCalculation()
                        return
                    }
                    if (parseInt(badNum) <= parseInt(enterNum)) {

                        $("#txtAcceptQty@(itemName)").val(enterNum - badNum) //驗收
                        $("#txtScriptQty@(itemName)").val(badNum) //報廢
                        $("#txtAvailableQty@(itemName)").val(enterNum - badNum); //計價
                        AmountCalculation()
                        return
                    }
                    return
                }

                //進貨數 不等於 驗收數+報廢數時 進貨數不動 =>
                //報廢數是否有大於可報廢數 有:用可報廢數判定  否:用報廢數判定
                //情境A.報廢數的大於可報廢數 那驗收數 = 進貨數-報廢數 報廢數=可報廢數
                //情境B.報廢數的小於可報廢數 那驗收數 = 進貨數-報廢數 報廢數=報廢數
                //情境C.報廢數小於0且驗收數小於進貨數 那驗收數 = 驗收數 報廢數 = 進貨數 - 驗收數
                //情境C.報廢數小於0且驗收數大於進貨數 那驗收數 = 驗收數 報廢數 = 0

                if (parseInt(enterNum) != parseInt(checkNum) + parseInt(badNum)) {
                    if (parseInt(badNum) <= parseInt(NoNgQty)) { //報廢數小於可報廢數
                        if (parseInt(badNum) > parseInt(enterNum)) {
                            $("#txtAcceptQty@(itemName)").val(0)  //驗收
                            $("#txtScriptQty@(itemName)").val(enterNum) //報廢
                            $("#txtAvailableQty@(itemName)").val(0); //計價
                            AmountCalculation()
                            return;
                        }
                        else {
                            if (parseInt(badNum) < 0) {
                                if (parseInt(enterNum) < parseInt(NoEnterQty)) {
                                    $("#txtAcceptQty@(itemName)").val(enterNum)  //驗收
                                    $("#txtScriptQty@(itemName)").val(0) //報廢
                                    $("#txtAvailableQty@(itemName)").val(enterNum); //計價
                                    AmountCalculation()
                                    return;
                                }
                                else {
                                    $("#txtAcceptQty@(itemName)").val(NoEnterQty)  //驗收
                                    $("#txtScriptQty@(itemName)").val(parseInt(enterNum) - parseInt(NoEnterQty)) //報廢
                                    $("#txtAvailableQty@(itemName)").val(NoEnterQty); //計價
                                    AmountCalculation()
                                    return;
                                }
                            }
                            else {
                                if (parseInt(enterNum) - parseInt(badNum) > parseInt(NoEnterQty)) {
                                    $("#txtAcceptQty@(itemName)").val(NoEnterQty)  //驗收
                                    $("#txtScriptQty@(itemName)").val(enterNum - NoEnterQty) //報廢
                                    $("#txtAvailableQty@(itemName)").val(NoEnterQty); //計價
                                    AmountCalculation()
                                    return;
                                }
                                else {
                                    $("#txtAcceptQty@(itemName)").val(parseInt(enterNum) - parseInt(badNum))  //驗收
                                    $("#txtScriptQty@(itemName)").val(badNum) //報廢
                                    $("#txtAvailableQty@(itemName)").val(parseInt(enterNum) - parseInt(badNum)); //計價
                                    AmountCalculation()
                                    return;
                                }
                            }
                        }

                    }
                    else { //報廢數大於可報廢數
                        if (parseInt(NoNgQty) > parseInt(enterNum)) {
                            $("#txtAcceptQty@(itemName)").val(0)  //驗收
                            $("#txtScriptQty@(itemName)").val(enterNum) //報廢
                            $("#txtAvailableQty@(itemName)").val(0); //計價
                            AmountCalculation()
                            return;
                        }
                        else {
                            $("#txtAcceptQty@(itemName)").val(parseInt(enterNum) - parseInt(NoNgQty))  //驗收
                            $("#txtScriptQty@(itemName)").val(NoNgQty) //報廢
                            $("#txtAvailableQty@(itemName)").val(parseInt(enterNum) - parseInt(NoNgQty)); //計價
                            AmountCalculation()
                            return;
                        }
                    }
                }
            })
        }

        function AmountCalculation() {
            var qty = parseFloat($("#txtAvailableQty@(itemName)").val())
            var price = parseFloat($("#txtOrigUnitPrice@(itemName)").val())
            var TaxRate = parseFloat($("#txtTaxRateMoWarehouseEnryManagment").val())
            var Exchange = parseFloat($("#txtExchangeMoWarehouseEnryManagment").val())
            var discount = parseFloat($("#txtOrigDiscountAmt@(itemName)").val())

            $("#txtOrigAmount@(itemName)").val(Math.round((qty * price - discount) * 100) / 100) //加工金額
            $("#txtOrigPreTaxAmt@(itemName)").val(Math.round((qty * price - discount) * 100) / 100) //原幣未稅金額
            $("#txtOrigTaxAmt@(itemName)").val(Math.round(((qty * price - discount) * TaxRate) * 100) / 100) //原幣稅額
            $("#txtPreTaxAmt@(itemName)").val(Math.round(((qty * price - discount) * Exchange) * 100) / 100) //本幣未稅金額
            $("#txtTaxAmt@(itemName)").val(Math.round((((qty * price - discount) * Exchange) * TaxRate) * 100) / 100) //本幣稅額

            var TypeNo = $("#cboQcStatus@(itemName)").val();
            if (TypeNo != "0") {
                if (parseFloat($("#txtScriptQty@(itemName)").val()) > 0 || parseFloat($("#txtReturnQty@(itemName)").val()) > 0) {
                    $("#cboQcStatus@(itemName)").val("3");
                }
                else if (parseFloat($("#txtAcceptQty@(itemName)").val()) > 0 && parseFloat($("#txtScriptQty@(itemName)").val()) == 0 && parseFloat($("#txtReturnQty@(itemName)").val()) == 0) {
                    $("#cboQcStatus@(itemName)").val("2");
                }
                else if (parseFloat($("#txtAcceptQty@(itemName)").val()) == 0 && parseFloat($("#txtScriptQty@(itemName)").val()) == 0 && parseFloat($("#txtReturnQty@(itemName)").val()) == 0) {
                    $("#cboQcStatus@(itemName)").val("1");
                }
            }
        }

        //單身刪除
        function Delete@(itemName)(MweId, MweDetailId) {
            swal.fire({
                titleText: "確認要刪除嗎?",
                text: "此動作無法復原，請確認是否要執行!",
                icon: "warning",
                allowOutsideClick: false,
                allowEscapeKey: false,
                showCancelButton: true,
                confirmButtonColor: '#d33',
                reverseButtons: true
            }).then((result) => {
                if (result.isConfirmed) {
                    let targetUrl = "@Url.Action("DeleteMweDetail", "Inventory")";
                    let postData = {
                        "MweId": MweId,
                        "MweDetailId": MweDetailId
                    };

                    let result = DataAccess.Delete(targetUrl, postData, false, true);

                    if (result) {
                        Query@(itemName)();
                        EditMoWarehouseEnryManagment($("#MweId").val())

                    }
                }
            });
        }


        //取得該製令已領套數數量
        function GetWipOrderRequisitionSetQty(MweDetailId) {
            let targetUrl = "@Url.Action("GetWipOrderRequisitionSetQty", "Inventory")";
            let postData = {
                "MoId": $("#txtMoId@(itemName)").val(),
                "MweId": $("#MweId").val(),
                "MweDetailId": MweDetailId,
                "ConfirmStatus":$("#ConfirmStatus").val(),
                "MoIdType": $("#MoIdType").val()
            };
            let data = DataAccess.Get(targetUrl, postData, false);
            if (data.status == "success") {
                let ModeId = data.result[10]
                $("#desPlanQty@(itemName)").text(data.result[0]);
                $("#desMakeQty@(itemName)").text(data.result[1]);
                $("#desNoMakeQty@(itemName)").text(data.result[2]);
                $("#desEnterQty@(itemName)").text(data.result[3]);
                $("#desNoEnterQty@(itemName)").text(data.result[4]);
                $("#desNoNgQty@(itemName)").text(data.result[5]);

                //正式上線切換
                //if (ModeId == 17) {
                //    $(".MFGQC").hide()
                //}
                //else {
                //    $(".MFGQC").show()
                //}

                $("#LotManagement").val(data.result[7]);
                if ($("#LotManagement").val() != "N") {
                    if ($("#SecondaryData").attr('aria-expanded') === "true") {
                    } else {
                        $("#SecondaryData").click()
                    }
                    $("#txtLotNumber@(itemName)").attr("readonly", false);
                    var DocDate = $("#txtDocDateMoWarehouseEnryManagment").val()

                    var EfficientDays = parseInt(data.result[8]);
                    var RetestDays = parseInt(data.result[9]);
                    var efficientDate = new Date(DocDate);
                    var retestDate = new Date(DocDate);
                    efficientDate.setDate(efficientDate.getDate() + EfficientDays);
                    retestDate.setDate(retestDate.getDate() + RetestDays);
                    var year = efficientDate.getFullYear();
                    var month = (efficientDate.getMonth() + 1).toString().padStart(2, '0'); // 月份從0開始，需要加1，並且補零
                    var day = efficientDate.getDate().toString().padStart(2, '0'); // 補零
                    var EfficientDate = year + '-' + month + '-' + day;
                    year = retestDate.getFullYear();
                    month = (retestDate.getMonth() + 1).toString().padStart(2, '0'); // 月份從0開始，需要加1，並且補零
                    day = retestDate.getDate().toString().padStart(2, '0'); // 補零
                    var RetestDate = year + '-' + month + '-' + day;
                    $("#txtAvailableDate@(itemName)").val(EfficientDate)
                    $("#txtReCheckDate@(itemName)").val(RetestDate)
                }
                
                if($("#MoIdType").val() != "Y"){
                    @*$("#txtReceiptQty@(itemName)").val(parseInt(data.result[4]) + parseInt(data.result[5])) //進貨
                    $("#txtAcceptQty@(itemName)").val(parseInt(data.result[1]) - parseInt(data.result[5]))  //驗收
                    $("#txtScriptQty@(itemName)").val(data.result[5]) //報廢
                    $("#txtAvailableQty@(itemName)").val(data.result[1]); //計價*@
                    if ($("#cboMweErpPrefixMoWarehouseEnryManagment").val() == "5903") {
                        @*$("#txtReceiptQty@(itemName)").val(parseInt(data.result[1])) //進貨
                        $("#txtAcceptQty@(itemName)").val(parseInt(data.result[1]))  //驗收
                        $("#txtScriptQty@(itemName)").val(0) //報廢
                        $("#txtAvailableQty@(itemName)").val(data.result[1]); //計價*@
                    }
                    else {
                        @*$("#txtReceiptQty@(itemName)").val(parseInt(data.result[4]) + parseInt(data.result[5])) //進貨
                        $("#txtAcceptQty@(itemName)").val(parseInt(data.result[4]))  //驗收
                        $("#txtScriptQty@(itemName)").val(data.result[5]) //報廢
                        $("#txtAvailableQty@(itemName)").val(parseInt(data.result[4])); //計價*@
                    }
                }
                if (data.result[6] != "") {
                    alert(data.result[6], "alert", 0);
                }

            } else {
                setTimeout(function () { MweDetailInit@(itemName)()}, 500)
                alert(data.msg, "alert", 0);
            }
        }


        //取得加工廠商NO
        function GetSupplierNo() {
            var SupplierId = $("#cboSupplierIdMoWarehouseEnryManagment").val()
            let targetUrl = "@Url.Action("GetSupplierNo", "Inventory")";
            let postData = {
                "SupplierId": SupplierId
            };
            let data = DataAccess.Get(targetUrl, postData, false);
            if (data.status == "success") {
                $.each(data.result, function (i, item) {
                    $("#SupplierNo").val(item.SupplierNo);
                });
            }
        }

        //條碼功能

        //檢查MES製令是否有產品條碼
        function CheckMoIdType(MoId, MweDetailId) {
            var MoId = MoId
            let targetUrl = "@Url.Action("GetCheckMoIdType", "Inventory")";
            let postData = {
                "MoId": MoId,
                "MweDetailId": MweDetailId
            };
            let data = DataAccess.Get(targetUrl, postData, false);
            if (data.status == "success") {
                var ConfirmStatus = data.result[0];
                var BarcodeCtrl = data.result[1];
                var OutputBarcodeFlag = data.result[2];

                if (ConfirmStatus == "V") {
                    $("#MoIdType").val("N");
                }
                else {
                    if (BarcodeCtrl == "N") {
                        if (OutputBarcodeFlag == "Y") {
                            $("#MoIdType").val("Y");
                        }
                        else if (OutputBarcodeFlag == "N") {
                            $("#MoIdType").val("N");
                        }
                    }
                    else if (BarcodeCtrl == "Y") {
                        $("#MoIdType").val("Y");
                    }
                    else {
                        alert("是否有產品條碼的狀態錯誤")
                        return
                    }
                }
            } else {
                setTimeout(function () { MweDetailInit@(itemName)()}, 500)
                alert(data.msg, "alert", 0);
            }
        }

        //檢查MES製令是否報廢品是否要入報廢倉
        function CheckScrapRegister(MoId) {
            var MoId = MoId
            let targetUrl = "@Url.Action("GetCheckScrapRegister", "Inventory")";
            let postData = {
                "MoId": MoId
            };
            let data = DataAccess.Get(targetUrl, postData, false);
            if (data.status == "success") {
                $.each(data.result, function (i, item) {
                    $("#ScrapRegister").val(item.ScrapRegister);
                    if (item.MeasureType == "0") {
                        $("#cboQcStatus@(itemName)").val("0")
                        $("#MeasureType").val("0")
                    }
                    else {
                        $("#MeasureType").val(item.MeasureType)
                    }
                });
                if ($("#ScrapRegister").val() == "Y") {
                    $(".scrapRegister").show()
                    $(".scrapRegisterNo").hide()

                }
                else {
                    $(".scrapRegister").hide()
                    $(".scrapRegisterNo").show()
                }
            } else {
                setTimeout(function () { MweDetailInit@(itemName)()}, 500)
                alert(data.msg, "alert", 0);
            }
        }
        //取得條碼 - 全部
        function GetMoIdBarcode@(itemName)() {
            let targetUrl = "@Url.Action("GetMoIdBarcode", "Inventory")";
            let postData = {
                "MoId": $("#txtMoId@(itemName)").val(),
                "MweDetailId": $("#MweDetailId").val(),
                "BarcodeNo": $("#txtBarcodeNoQ@(itemName)").val()
            };
            //每次讀取都重置
            BarcodeAttributesObj = {}
            BarcodeListOutPut(targetUrl, postData)
        }

        var TemporaryPassList = [];
        var TemporaryScrapList = [];

        //取得條碼(良品)
        function GetMoIdBarcodePass@(itemName)() {
            $("#BarcodeListStatus").val("P");
            let MweDetailId = -1;

            //待報廢倉模式-未退出當下紀錄其列表勾選項目,以供供後續切換列表使用
            if ($("#MweDetailIdScrap").val() == "") {
                TemporaryScrapList = [];

                $.each($("input[name='cbxBarcode@(itemName)']"), function () {
                    if ($(this).is(":checked")) {
                        TemporaryScrapList.push($(this).val());
                    }
                });
            }
            //列表切換用
            if ($("#MweDetailIdPass").val() > 0) {
                MweDetailId = $("#MweDetailIdPass").val()
            }
            else {
                if ($("#MweDetailId").val() > 0) {
                    MweDetailId = $("#MweDetailId").val()
                }
            }


            //全選按鈕去消勾選
            let cbxSelectAll = document.getElementById("cbxSelectAll@(itemName)");
            cbxSelectAll.checked = false;
            //設定入庫庫別
            $("#cboInventoryId@(itemName)").val($("#InventoryPass").val()).trigger("change.select2");

            let targetUrl = "@Url.Action("GetMoIdBarcodePass", "Inventory")";
            let postData = {
                "MoId": $("#txtMoId@(itemName)").val(),
                "MweDetailId": MweDetailId,
                "CurrentProdStatus": "P,M,R,NK"
            };
            BarcodeAttributesObj = {}
            BarcodeListOutPut(targetUrl, postData)
        }
        

        //取得條碼(報廢)
        function GetMoIdBarcodeScrap@(itemName)() {
            $("#BarcodeListStatus").val("S");
            let MweDetailId = -1;

            //待報廢倉模式-未退出當下紀錄其列表勾選項目,以供供後續切換列表使用
            if ($("#MweDetailIdPass").val() == "") {
                TemporaryPassList = [];
                $.each($("input[name='cbxBarcode@(itemName)']"), function () {
                    if ($(this).is(":checked")) {
                        TemporaryPassList.push($(this).val());
                    }
                });
            }
            //列表切換用

            if ($("#MweDetailIdScrap").val() > 0) {
                MweDetailId = $("#MweDetailIdScrap").val()

            }
            else {
                if ($("#MweDetailId").val() > 0) {
                    MweDetailId = $("#MweDetailId").val()
                }
            }
            //全選按鈕去消勾選
            var cbxSelectAll = document.getElementById("cbxSelectAll@(itemName)");
            cbxSelectAll.checked = false;
            //各公司待報廢倉
            switch (companyId@(itemName)) {
                case 2:
                    $("#cboInventoryId@(itemName)").val(12).trigger("change.select2");
                    break
                case 3:
                    $("#cboInventoryId@(itemName)").val(129).trigger("change.select2");
                    break
                case 4:
                    $("#cboInventoryId@(itemName)").val(46).trigger("change.select2");
                    break
                case 5:
                    $("#cboInventoryId@(itemName)").val(115).trigger("change.select2");
                    break
                default:
                    alert("資料錯誤")
                    return
            }

            let targetUrl = "@Url.Action("GetMoIdBarcodePass", "Inventory")";
            let postData = {
                "MoId": $("#txtMoId@(itemName)").val(),
                "MweDetailId": MweDetailId,
                "CurrentProdStatus": "S"
            };
            BarcodeAttributesObj = {}
            BarcodeListOutPut(targetUrl, postData)
        }
        //取得現有條碼屬性
        function GetRoutingProcessItem() {
            let targetUrl = "@Url.Action("GetType", "BasicInformation")";
            let postData = {
                "TypeSchema": "RoutingProcessItem.ItemNo"
            };

            let data = DataAccess.Get(targetUrl, postData, false);
            if (data.status == "success") {
                $.each(data.result, function (i, item) {
                    attributeObj[item.TypeNo] = {
                        label: item.TypeName,
                        value: ""
                    }
                })
            }
        }

        //組成屬性資料
        function GetAttributesSum(ItemValue, SentObj) {
            //拆解屬性資料
            let AttributesSum = ``
            let NewAttributeObj = JSON.parse(JSON.stringify(attributeObj));
            if (ItemValue != null) {
                let itemValueArr = (ItemValue).toString().split(',') //將屬性分解成陣列
                itemValueArr.forEach(function (v) {
                    let AttributesColumn = v.toString().split(':')[0].trim()
                    let AttributesValue = v.toString().split(':')[1].trim()
                    for (var item1 in NewAttributeObj) {
                        if (item1 == AttributesColumn) {
                            NewAttributeObj[item1].value = `${NewAttributeObj[item1].label}:${AttributesValue}<br>`
                        }
                        if (AttributesColumn == "PotNumber") {
                            if (!BarcodeAttributesObj[AttributesColumn]) {
                                BarcodeAttributesObj[AttributesColumn] = {};
                            }

                            if (!BarcodeAttributesObj[AttributesColumn][AttributesValue]) {
                                BarcodeAttributesObj[AttributesColumn][AttributesValue] = [];
                            }
                            if (!BarcodeAttributesObj[AttributesColumn][AttributesValue].includes(SentObj)) {
                                BarcodeAttributesObj[AttributesColumn][AttributesValue].push(SentObj)
                            }
                        }
                    }
                    

                })
            }

            for (let key in NewAttributeObj) {
                if (!!NewAttributeObj[key].value) {
                    AttributesSum += NewAttributeObj[key].value
                }
            }

            if (AttributesSum != "") {
                SentObj.AttributesSum = AttributesSum
                return AttributesSum
            }
            else {
                return ""
            }
            
        }
        //條碼列表輸出
        function BarcodeListOutPut(targetUrl, postData) {
            let innerHtml

            let data = DataAccess.Get(targetUrl, postData, false);

            if (data.status == "success") {
                pageCount = data.result.length > 0 ? parseInt(data.result[0]["TotalCount"]) : 0;

                if (data.result[0].checkBarcode == "Y") {

                    alert("【入庫管理錯誤】- 該入庫單條碼已經轉移其他製令", "alert", 500)
                    innerHtml += `<tr>
                                        <td class="text-center" colspan="8" style="background-color: #fff3cd;">
                                          <i class="fal fa-exclamation-circle"></i>&nbsp;目前尚無資料
                                        </td>
                                      </tr>`;
                    $("#tblMoIdBarcodeData@(itemName) tbody").html(innerHtml);

                    return
                }
                else {
                    if (data.result.length > 0) {
                        $.each(data.result, function (i, item) {
                            const {
                                ItemValue,
                                CurrentProdStatus,
                                BarcodeStatus,
                                BarcodeId,
                                BarcodeNo,
                                BarcodeQty,
                                ProcessAlias,
                                TrayBarcode,
                                TrayNo,
                                MweDetailId,
                                NecessityStatus,
                                AmortizeTtype
                            } = item;
                            let BarcodeStatusName = BarcodeStatusContent(`S`, BarcodeStatus)
                            let sentBarcodeData = `${BarcodeId},${BarcodeNo}`

                            let sentObj = {
                                "BarcodeId": BarcodeId,
                                "BarcodeNo": BarcodeNo,
                                "TrayNo": TrayNo,
                                "BarcodeQty": BarcodeQty,
                                "BarcodeStatusName": BarcodeStatusName
                            }
                            
                            let AttributesSum = GetAttributesSum(ItemValue, sentObj)


                            //條碼狀態顯示
                            let BarcodeStatusHtml = ``
                            switch (CurrentProdStatus) {
                                case "NK":
                                    BarcodeStatusHtml = `<span class="erp-status color-ng"><span>異</span></span>`
                                    break;
                                case "S":
                                    BarcodeStatusHtml = `<span class="erp-status"><span>廢</span></span>`
                                    break;
                                default:
                                    BarcodeStatusHtml = `<span class="erp-status color-pass"><span>良</span></span>`
                                    break
                            }

                            //列表html
                            innerHtml += `<tr>
                            <td class="text-center active-content">
                                ${barcodeStutuse(BarcodeStatus, BarcodeId, BarcodeQty, MweDetailId, CurrentProdStatus == `F` ? CurrentProdStatus : CurrentProdStatus == `S` ? CurrentProdStatus : `P`, NecessityStatus)}
                            </td>
                            <td class="text-center active-content">
                                ${barcodeAmortize(BarcodeStatus, BarcodeId, BarcodeQty, MweDetailId, CurrentProdStatus == `F` ? CurrentProdStatus : CurrentProdStatus == `S` ? CurrentProdStatus : `P`, AmortizeTtype)}
                            </td>
                            <td>${i + 1}</td>
                            <td class="ellipsis" data-toggle="tooltip" title="${BarcodeNo}">${BarcodeStatusHtml} ${BarcodeNo}   ${TrayBarcode == `Y` ? `<br> Tray:` + TrayNo : ``} </td>
                            <td class="ellipsis" data-toggle="tooltip" title="${AttributesSum}">${!!AttributesSum.trim() ? AttributesSum : `無`}</td>
                            <td>${BarcodeQty}</td>
                            <td class="ellipsis" data-toggle="tooltip" title="${BarcodeStatus}" style="max-width: 200px;">${BarcodeStatusName}${CurrentProdStatus == `NK` ? `<br><span style="color:#f00">品異判定:不良品/流程更換</span>` : ``}</td>
                            <td class="ellipsis" data-toggle="tooltip" title="${ProcessAlias}" style="max-width: 200px;">${ProcessAlias}</td>
                        </tr>`;


                        });
                    }
                    else {
                        innerHtml += `<tr>
                                        <td class="text-center" colspan="8" style="background-color: #fff3cd;">
                                          <i class="fal fa-exclamation-circle"></i>&nbsp;目前尚無資料
                                        </td>
                                      </tr>`;
                    }
                }
            } else {
                //setTimeout(function () { MweDetailInit@(itemName)()}, 500)
                alert(data.msg, "alert", 0);
                return
            }
            

            $("#tblMoIdBarcodeData@(itemName) tbody").html(innerHtml);
            TableComponentInit();
            checkChecked()
            $("#modalMoIdBarcode@(itemName)").modal("hide");

            if ($("#IsAmortizeType@(itemName)").val() == "Y") {
                $("input[type='checkbox'][name='cbxBarcodeAmortize@(itemName)']").show();
            }
            else {
                $("input[type='checkbox'][name='cbxBarcodeAmortize@(itemName)']").hide();
            }
        }

        //取得轉移條碼
        function GetMweBarcodeTransfer@(itemName)(MoId,MweDetailId) {

            let innerHtml = '';

            let targetUrl = "@Url.Action("GetMweBarcodeTransfer", "Inventory")";
            let postData = {
                "MoId": MoId,
                "MweDetailId": MweDetailId,
            };

            let data = DataAccess.Get(targetUrl, postData, false);

            if (data.status == "success") {
                pageCount = data.result.length > 0 ? parseInt(data.result[0]["TotalCount"]) : 0;

                if (data.result.length > 0) {
                    $.each(data.result, function (i, item) {
                        //let AttributesSum = GetAttributesSum(item.ItemValue)

                        const {
                            ItemValue,
                            BarcodeId,
                            BarcodeNo,
                            MweBarcodeQty,
                        } = item;

                        let sentObj = {
                            "BarcodeId": BarcodeId,
                            "BarcodeNo": BarcodeNo,
                            "BarcodeQty": MweBarcodeQty,
                        }

                        let AttributesSum = GetAttributesSum(ItemValue, sentObj)
                        
                        innerHtml += `<tr>
                                            <td>${i + 1}</td>
                                            <td class="ellipsis" data-toggle="tooltip" title="${item.BarcodeNo}" style="">${item.BarcodeNo}</td>
                                            <td>${item.MweBarcodeQty}</td>
                                            <td class="ellipsis" data-toggle="tooltip" title="${AttributesSum}">${!!AttributesSum.trim() ? AttributesSum : `無`}</td>
                                      </tr>`;
                    });
                }
                else {
                    innerHtml += `<tr>
                                        <td class="text-center" colspan="5" style="background-color: #fff3cd;">
                                          <i class="fal fa-exclamation-circle"></i>&nbsp;目前尚無資料
                                        </td>
                                      </tr>`;
                }
            } else {
                alert(data.msg, "alert", 0);
                return
            }
            $("#tblMoIdBarcodeTransferData@(itemName) tbody").html(innerHtml);
            TableComponentInit();
            $("#modalMoIdBarcode@(itemName)").modal("hide");
            //Edit@(itemName)($("#MweId").val(),MweDetailId)
        }

        function barcodeStutuse(BarcodeStatus, BarcodeId, BarcodeQty, MweDetailId, CurrentProdStatus, NecessityStatus) {
            var testStr = ""
            if ($("#BarcodeListStatus").val() == "P") {//條碼-良品列表
                if (TemporaryPassList.length > 0) {

                    if (TemporaryPassList.indexOf(String(BarcodeId)) != -1) {
                        //1.應該沒有執行
                        //2.已入庫 目前開起該入庫單單據中
                        //3.已入庫 目前開起非該入庫單單據中
                        if (BarcodeStatus == `0` || BarcodeStatus == `7`) { if (CurrentProdStatus != "F") testStr = `<input type="checkbox" id="cbxBarcode@(itemName)${BarcodeId}" name="cbxBarcode@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" checked="checked" onchange="checkChecked()"/>` }
                        else if (BarcodeStatus == `8` && MweDetailId != null) { testStr = `<input type="checkbox" id="cbxBarcode@(itemName)${BarcodeId}" name="cbxBarcode@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" checked="checked" onchange="checkChecked()" />` }
                        else if (BarcodeStatus == `8` && MweDetailId == null) { testStr = `<input type="checkbox" id="cbxBarcode@(itemName)${BarcodeId}" name="cbxBarcode@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" disabled />` }
                    }
                    else {
                        //1.未入庫
                        //2.已入庫 目前開起該入庫單單據中
                        //3.已入庫 目前開起非該入庫單單據中
                        if (BarcodeStatus == `0` || BarcodeStatus == `7`) { if (CurrentProdStatus != "F") testStr = `<input type="checkbox" id="cbxBarcode@(itemName)${BarcodeId}" name="cbxBarcode@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" onchange="checkChecked()"/>` }
                        else if (BarcodeStatus == `8` && MweDetailId != null) { testStr = `<input type="checkbox" id="cbxBarcode@(itemName)${BarcodeId}" name="cbxBarcode@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" checked="checked" onchange="checkChecked()" />` }
                        else if (BarcodeStatus == `8` && MweDetailId == null) { testStr = `<input type="checkbox" id="cbxBarcode@(itemName)${BarcodeId}" name="cbxBarcode@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" disabled />` }
                    }
                }
                else {
                    //1.未入庫
                    //2.未入庫 狀態是1且是最後一個必要過站
                    //3.已入庫 目前開起該入庫單單據中
                    //4.已入庫 目前開起非該入庫單單據中
                    if (BarcodeStatus == `0` || BarcodeStatus == `7`) { if (CurrentProdStatus != "F") testStr = `<input type="checkbox" id="cbxBarcode@(itemName)${BarcodeId}" name="cbxBarcode@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" onchange="checkChecked()"/>` }
                    else if (BarcodeStatus == `1` && NecessityStatus == `Y`) {
                        testStr = `<input type="checkbox" id="cbxBarcode@(itemName)${BarcodeId}" name="cbxBarcode@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" onchange="checkChecked()"/>`;
                    }
                    else if (BarcodeStatus == `8` && MweDetailId != null) { testStr = `<input type="checkbox" id="cbxBarcode@(itemName)${BarcodeId}" name="cbxBarcode@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" checked="checked" onchange="checkChecked()" />` }
                    else if (BarcodeStatus == `8` && MweDetailId == null) { testStr = `<input type="checkbox" id="cbxBarcode@(itemName)${BarcodeId}" name="cbxBarcode@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" disabled />` }
                }
                @*if (BarcodeStatus == `0` || BarcodeStatus == `7`) {
                    if (TemporaryPassList.length > 0 && TemporaryPassList.indexOf(String(BarcodeId)) != -1) {
                        if (CurrentProdStatus != "F") {
                            testStr = `<input type="checkbox" id="cbxBarcode@(itemName)${BarcodeId}" name="cbxBarcode@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" checked="checked" onchange="checkChecked()"/>`;
                        }
                    } else {
                        testStr = `<input type="checkbox" id="cbxBarcode@(itemName)${BarcodeId}" name="cbxBarcode@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" onchange="checkChecked()"/>`;
                    }
                } else if (BarcodeStatus == `8`) {
                    if (TemporaryPassList.length > 0 && TemporaryPassList.indexOf(String(BarcodeId)) != -1 && MweDetailId != null) {
                        testStr = `<input type="checkbox" id="cbxBarcode@(itemName)${BarcodeId}" name="cbxBarcode@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" checked="checked" onchange="checkChecked()" />`;
                    } else if (TemporaryPassList.length > 0 && TemporaryPassList.indexOf(String(BarcodeId)) != -1 && MweDetailId == null) {
                        testStr = `<input type="checkbox" id="cbxBarcode@(itemName)${BarcodeId}" name="cbxBarcode@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" disabled />`;
                    } else {
                        console.log(BarcodeStatus+"A")
                        testStr = `<input type="checkbox" id="cbxBarcode@(itemName)${BarcodeId}" name="cbxBarcode@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" checked="checked" onchange="checkChecked()" />`;
                    }
                }
                else if (BarcodeStatus == `1` && NecessityStatus == `Y`) {
                        testStr = `<input type="checkbox" id="cbxBarcode@(itemName)${BarcodeId}" name="cbxBarcode@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" onchange="checkChecked()"/>`;
                }*@
            }
            else if ($("#BarcodeListStatus").val() == "S") {//條碼-報廢列表
                if (TemporaryScrapList.length > 0) {
                    if (TemporaryScrapList.indexOf(String(BarcodeId)) != -1) {
                        if (BarcodeStatus == `0` || BarcodeStatus == `7`) { if (CurrentProdStatus != "F") testStr = `<input type="checkbox" id="cbxBarcode@(itemName)${BarcodeId}" name="cbxBarcode@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" checked="checked" onchange="checkChecked()"/>` }
                        else if (BarcodeStatus == `8` && MweDetailId != null) { testStr = `<input type="checkbox" id="cbxBarcode@(itemName)${BarcodeId}" name="cbxBarcode@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" checked="checked" onchange="checkChecked()" />` }
                        else if (BarcodeStatus == `8` && MweDetailId == null) { testStr = `<input type="checkbox" id="cbxBarcode@(itemName)${BarcodeId}" name="cbxBarcode@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" disabled />` }
                    }
                    else {
                        if (BarcodeStatus == `0` || BarcodeStatus == `7`) { if (CurrentProdStatus != "F") testStr = `<input type="checkbox" id="cbxBarcode@(itemName)${BarcodeId}" name="cbxBarcode@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" onchange="checkChecked()"/>` }
                        else if (BarcodeStatus == `8` && MweDetailId != null) { testStr = `<input type="checkbox" id="cbxBarcode@(itemName)${BarcodeId}" name="cbxBarcode@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" checked="checked" onchange="checkChecked()" />` }
                        else if (BarcodeStatus == `8` && MweDetailId == null) { testStr = `<input type="checkbox" id="cbxBarcode@(itemName)${BarcodeId}" name="cbxBarcode@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" disabled />` }
                    }
                }
                else {
                    if (BarcodeStatus == `0` || BarcodeStatus == `7`) { if (CurrentProdStatus != "F") testStr = `<input type="checkbox" id="cbxBarcode@(itemName)${BarcodeId}" name="cbxBarcode@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" onchange="checkChecked()"/>` }
                    else if (BarcodeStatus == `8` && MweDetailId != null) { testStr = `<input type="checkbox" id="cbxBarcode@(itemName)${BarcodeId}" name="cbxBarcode@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" checked="checked" onchange="checkChecked()" />` }
                    else if (BarcodeStatus == `8` && MweDetailId == null) { testStr = `<input type="checkbox" id="cbxBarcode@(itemName)${BarcodeId}" name="cbxBarcode@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" disabled />` }
                }
            }
            else {//條碼-全部列表
                if (BarcodeStatus == `0` || BarcodeStatus == `7`) { if (CurrentProdStatus != "F") testStr = `<input type="checkbox" id="cbxBarcode@(itemName)${BarcodeId}" name="cbxBarcode@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" onchange="checkChecked()"/>` }
                else if (BarcodeStatus == `8` && MweDetailId != null) { testStr = `<input type="checkbox" id="cbxBarcode@(itemName)${BarcodeId}" name="cbxBarcode@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" checked="checked" onchange="checkChecked()" />` }
                else if (BarcodeStatus == `8` && MweDetailId == null) { testStr = `<input type="checkbox" id="cbxBarcode@(itemName)${BarcodeId}" name="cbxBarcode@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" disabled />` }
                else if (BarcodeStatus == `1` && NecessityStatus == `Y`) {
                        testStr = `<input type="checkbox" id="cbxBarcode@(itemName)${BarcodeId}" name="cbxBarcode@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" onchange="checkChecked()"/>`;
                }
            }

            

            return testStr
        }

        function barcodeAmortize(BarcodeStatus, BarcodeId, BarcodeQty, MweDetailId, CurrentProdStatus, AmortizeTtype) {
            var testStr = ""
            if ($("#BarcodeListStatus").val() == "P") {
                if (TemporaryPassList.length > 0) {

                    if (TemporaryPassList.indexOf(String(BarcodeId)) != -1) {
                        if (BarcodeStatus == `0` || BarcodeStatus == `7`) { if (CurrentProdStatus != "F") testStr = `<input type="checkbox" id="cbxBarcodeAmortize@(itemName)${BarcodeId}" name="cbxBarcodeAmortize@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" checked="checked" onchange="checkCheckedAmortize(${BarcodeId})" />` }
                        else if ((BarcodeStatus == `8` && MweDetailId != null) && AmortizeTtype == `Y`) { testStr = `<input type="checkbox" id="cbxBarcodeAmortize@(itemName)${BarcodeId}" name="cbxBarcodeAmortize@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" checked="checked" onchange="checkCheckedAmortize(${BarcodeId})" />` }
                        else if (BarcodeStatus == `8` && MweDetailId == null) { testStr = `<input type="checkbox" id="cbxBarcodeAmortize@(itemName)${BarcodeId}" name="cbxBarcodeAmortize@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" disabled />` }
                        else if (BarcodeStatus == `8` && MweDetailId != null && (AmortizeTtype == `N` || AmortizeTtype == null)) { testStr = `<input type="checkbox" id="cbxBarcodeAmortize@(itemName)${BarcodeId}" name="cbxBarcodeAmortize@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" onchange="checkCheckedAmortize(${BarcodeId})" />` }

                    } else {
                        if (BarcodeStatus == `0` || BarcodeStatus == `7`) { if (CurrentProdStatus != "F") testStr = `<input type="checkbox" id="cbxBarcodeAmortize@(itemName)${BarcodeId}" name="cbxBarcodeAmortize@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" onchange="checkCheckedAmortize(${BarcodeId})"/>` }
                        else if ((BarcodeStatus == `8` && MweDetailId != null) && AmortizeTtype == `Y`) { testStr = `<input type="checkbox" id="cbxBarcodeAmortize@(itemName)${BarcodeId}" name="cbxBarcodeAmortize@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" checked="checked" onchange="checkCheckedAmortize(${BarcodeId})" />` }
                        else if (BarcodeStatus == `8` && MweDetailId == null) { testStr = `<input type="checkbox" id="cbxBarcodeAmortize@(itemName)${BarcodeId}" name="cbxBarcodeAmortize@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" disabled />` }
                        else if (BarcodeStatus == `8` && MweDetailId != null && (AmortizeTtype == `N` || AmortizeTtype == null)) { testStr = `<input type="checkbox" id="cbxBarcodeAmortize@(itemName)${BarcodeId}" name="cbxBarcodeAmortize@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" onchange="checkCheckedAmortize(${BarcodeId})" />` }

                    }

                } else {

                    if (BarcodeStatus == `0` || BarcodeStatus == `7`) { if (CurrentProdStatus != "F") testStr = `<input type="checkbox" id="cbxBarcodeAmortize@(itemName)${BarcodeId}" name="cbxBarcodeAmortize@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" onchange="checkCheckedAmortize(${BarcodeId})"/>` }
                    else if ((BarcodeStatus == `8` && MweDetailId != null) && AmortizeTtype == `Y`) { testStr = `<input type="checkbox" id="cbxBarcodeAmortize@(itemName)${BarcodeId}" name="cbxBarcodeAmortize@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" checked="checked" onchange="checkCheckedAmortize(${BarcodeId})" />` }
                    else if (BarcodeStatus == `8` && MweDetailId == null) { testStr = `<input type="checkbox" id="cbxBarcodeAmortize@(itemName)${BarcodeId}" name="cbxBarcodeAmortize@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" disabled />` }
                    else if (BarcodeStatus == `8` && MweDetailId != null && (AmortizeTtype == `N` || AmortizeTtype == null)) { testStr = `<input type="checkbox" id="cbxBarcodeAmortize@(itemName)${BarcodeId}" name="cbxBarcodeAmortize@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" onchange="checkCheckedAmortize(${BarcodeId})" />` }

                }

            } else if ($("#BarcodeListStatus").val() == "S") {
                if (TemporaryScrapList.length > 0) {
                    if (TemporaryScrapList.indexOf(String(BarcodeId)) != -1) {
                        if (BarcodeStatus == `0` || BarcodeStatus == `7`) { if (CurrentProdStatus != "F") testStr = `<input type="checkbox" id="cbxBarcodeAmortize@(itemName)${BarcodeId}" name="cbxBarcodeAmortize@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" checked="checked" onchange="checkCheckedAmortize(${BarcodeId})"/>` }
                        else if ((BarcodeStatus == `8` && MweDetailId != null) && AmortizeTtype == `Y`) { testStr = `<input type="checkbox" id="cbxBarcodeAmortize@(itemName)${BarcodeId}" name="cbxBarcodeAmortize@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" checked="checked" onchange="checkCheckedAmortize(${BarcodeId})" />` }
                        else if (BarcodeStatus == `8` && MweDetailId == null) { testStr = `<input type="checkbox" id="cbxBarcodeAmortize@(itemName)${BarcodeId}" name="cbxBarcodeAmortize@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" disabled />` }
                        else if (BarcodeStatus == `8` && MweDetailId != null && (AmortizeTtype == `N` || AmortizeTtype == null)) { testStr = `<input type="checkbox" id="cbxBarcodeAmortize@(itemName)${BarcodeId}" name="cbxBarcodeAmortize@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" onchange="checkCheckedAmortize(${BarcodeId})" />` }

                    } else {
                        if (BarcodeStatus == `0` || BarcodeStatus == `7`) { if (CurrentProdStatus != "F") testStr = `<input type="checkbox" id="cbxBarcodeAmortize@(itemName)${BarcodeId}" name="cbxBarcodeAmortize@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" onchange="checkCheckedAmortize(${BarcodeId})"/>` }
                        else if ((BarcodeStatus == `8` && MweDetailId != null) && AmortizeTtype == `Y`) { testStr = `<input type="checkbox" id="cbxBarcodeAmortize@(itemName)${BarcodeId}" name="cbxBarcodeAmortize@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" checked="checked" onchange="checkCheckedAmortize(${BarcodeId})" />` }
                        else if (BarcodeStatus == `8` && MweDetailId == null) { testStr = `<input type="checkbox" id="cbxBarcodeAmortize@(itemName)${BarcodeId}" name="cbxBarcodeAmortize@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" disabled />` }
                        else if (BarcodeStatus == `8` && MweDetailId != null && (AmortizeTtype == `N` || AmortizeTtype == null)) { testStr = `<input type="checkbox" id="cbxBarcodeAmortize@(itemName)${BarcodeId}" name="cbxBarcodeAmortize@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" onchange="checkCheckedAmortize(${BarcodeId})" />` }

                    }

                } else {
                    if (BarcodeStatus == `0` || BarcodeStatus == `7`) { if (CurrentProdStatus != "F") testStr = `<input type="checkbox" id="cbxBarcodeAmortize@(itemName)${BarcodeId}" name="cbxBarcodeAmortize@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" onchange="checkCheckedAmortize(${BarcodeId})"/>` }
                    else if ((BarcodeStatus == `8` && MweDetailId != null) && AmortizeTtype == `Y`) { testStr = `<input type="checkbox" id="cbxBarcodeAmortize@(itemName)${BarcodeId}" name="cbxBarcode@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" checked="checked" onchange="checkCheckedAmortize(${BarcodeId})" />` }
                    else if (BarcodeStatus == `8` && MweDetailId == null) { testStr = `<input type="checkbox" id="cbxBarcodeAmortize@(itemName)${BarcodeId}" name="cbxBarcode@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" disabled />` }
                    else if (BarcodeStatus == `8` && MweDetailId != null && (AmortizeTtype == `N` || AmortizeTtype == null)) { testStr = `<input type="checkbox" id="cbxBarcodeAmortize@(itemName)${BarcodeId}" name="cbxBarcodeAmortize@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" onchange="checkCheckedAmortize(${BarcodeId})" />` }

                }

            } else {
                if (BarcodeStatus == `0` || BarcodeStatus == `7`) { if (CurrentProdStatus != "F") testStr = `<input type="checkbox" id="cbxBarcodeAmortize@(itemName)${BarcodeId}" name="cbxBarcodeAmortize@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" onchange="checkCheckedAmortize(${BarcodeId})"/>` }
                else if ((BarcodeStatus == `8` && MweDetailId != null) && AmortizeTtype == `Y`) { testStr = `<input type="checkbox" id="cbxBarcodeAmortize@(itemName)${BarcodeId}" name="cbxBarcodeAmortize@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" checked="checked" onchange="checkCheckedAmortize(${BarcodeId})" />` }
                else if (BarcodeStatus == `8` && MweDetailId == null) { testStr = `<input type="checkbox" id="cbxBarcodeAmortize@(itemName)${BarcodeId}" name="cbxBarcodeAmortize@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" disabled />` }
                else if (BarcodeStatus == `8` && MweDetailId != null && (AmortizeTtype == `N` || AmortizeTtype == null)) { testStr = `<input type="checkbox" id="cbxBarcodeAmortize@(itemName)${BarcodeId}" name="cbxBarcodeAmortize@(itemName)" value="${BarcodeId}" data-barcode-qty="${BarcodeQty}" data-barcode-status="${CurrentProdStatus}" onchange="checkCheckedAmortize(${BarcodeId})" />` }
            }


            if ($("#IsAmortizeType@(itemName)").val() == "Y") {
                $(`cbxBarcodeAmortize@(itemName)${BarcodeId}`).show();
            } else {
                $(`cbxBarcodeAmortize@(itemName)${BarcodeId}`).hide();
            }
        
            

            return testStr
        }

        //找尋條碼流程狀態
        let CurrentProdStatusList = [];
        let BarcodeStatusList = [];
        function BarcodeStatusContent(Type, BarcodeStatus) {
            switch (Type) {
                case "S":
                    if (BarcodeStatusList.length <= 0) {
                        let targetUrl = "@Url.Action("GetBarcodeStatusContent", "Inventory")";
                        let postData = {
                            "Type": Type,
                            "StatusSchema": "Barcode.BarcodeStatus"
                        };
                        let data = DataAccess.Get(targetUrl, postData, false);
                        if (data.status == "success") {
                            $.each(data.result, function (i, item) {
                                BarcodeStatusList.push(item.StatusNo+","+item.StatusName)
                            });
                        } else {
                            alert(data.msg, "alert", 0);
                            return
                        }
                    }
                    var BarcodeStatusName = "";
                    BarcodeStatusList.forEach(function (v) {
                        if (v.split(',')[0] == BarcodeStatus) {
                            BarcodeStatusName = v.split(',')[1]
                        }
                    })
                    return BarcodeStatusName
                    break
                case "T":
                    if (CurrentProdStatusList.length <= 0) {
                        let targetUrl = "@Url.Action("GetBarcodeStatusContent", "Inventory")";
                        let postData = {
                            "Type": Type,
                            "StatusSchema": "Barcode.CurrentProdStatus"
                        };
                        let data = DataAccess.Get(targetUrl, postData, false);
                        if (data.status == "success") {
                            $.each(data.result, function (i, item) {
                                CurrentProdStatusList.push(item.TypeNo + "," + item.TypeName)
                            });
                        } else {
                            alert(data.msg, "alert", 0);
                            return
                        }
                    }
                    var BarcodeStatusName = "";
                    CurrentProdStatusList.forEach(function (v) {
                        if (v.split(',')[0] == BarcodeStatus) {
                            BarcodeStatusName = v.split(',')[1]
                        }
                    })
                    return BarcodeStatusName
                    break
            }

        }
       

        function checkChecked() {
            let BarcodeListY = [];
            let BarcodeListN = [];
            var barocdeQty = 0;
            var enterQty = 0;
            var passQty = 0;
            var ngQty = 0;
            $.each($("input[name='cbxBarcode@(itemName)']"), function () {
                if ($(this).is(":checked")) {
                    BarcodeListY.push($(this).val());
                    barocdeQty = $(this).data("barcode-qty")
                    if ($(this).data("barcode-status") == "P") {
                        passQty += barocdeQty
                    }
                    else if ($(this).data("barcode-status") == "S") {
                        ngQty += barocdeQty
                    }
                    else {
                        alert("【入庫管理錯誤】- 入庫條碼當前狀態資料有問題!")
                        return
                    }
                }
                else {
                    if (!$(this).is(":disabled")) {
                        BarcodeListN.push($(this).val());
                    }
                }
            });

            enterQty = passQty + ngQty;
            $("#txtReceiptQty@(itemName)").val(enterQty)

            if ($("#ScrapRegister").val() == "Y")  {

                switch (companyId@(itemName)) {
                    case 2:
                        if ($("#cboInventoryId@(itemName)").val() == 12) {
                            $("#txtAcceptQty@(itemName)").val(ngQty)
                            $("#txtScriptQty@(itemName)").val(0);
                            $("#txtAvailableQty@(itemName)").val(ngQty);
                        }
                        else {
                            $("#txtAcceptQty@(itemName)").val(passQty)
                            $("#txtScriptQty@(itemName)").val(ngQty);
                            $("#txtAvailableQty@(itemName)").val(passQty);
                        }
                        break;
                    case 3:
                        if ($("#cboInventoryId@(itemName)").val() == 129) {
                            $("#txtAcceptQty@(itemName)").val(ngQty)
                            $("#txtScriptQty@(itemName)").val(0);
                            $("#txtAvailableQty@(itemName)").val(ngQty);
                        }
                        else {
                            $("#txtAcceptQty@(itemName)").val(passQty)
                            $("#txtScriptQty@(itemName)").val(ngQty);
                            $("#txtAvailableQty@(itemName)").val(passQty);
                        }
                        break;
                    case 4:
                        if ($("#cboInventoryId@(itemName)").val() == 46) {
                            $("#txtAcceptQty@(itemName)").val(ngQty)
                            $("#txtScriptQty@(itemName)").val(0);
                            $("#txtAvailableQty@(itemName)").val(ngQty);
                        }
                        else {
                            $("#txtAcceptQty@(itemName)").val(passQty)
                            $("#txtScriptQty@(itemName)").val(ngQty);
                            $("#txtAvailableQty@(itemName)").val(passQty);
                        }
                        break;
                    case 5:
                        if ($("#cboInventoryId@(itemName)").val() == 115) {
                            $("#txtAcceptQty@(itemName)").val(ngQty)
                            $("#txtScriptQty@(itemName)").val(0);
                            $("#txtAvailableQty@(itemName)").val(ngQty);
                        }
                        else {
                            $("#txtAcceptQty@(itemName)").val(passQty)
                            $("#txtScriptQty@(itemName)").val(ngQty);
                            $("#txtAvailableQty@(itemName)").val(passQty);
                        }
                        break;
                    default:
                        alert("資料錯誤")
                        return
                }

            }
            else {
                $("#txtAcceptQty@(itemName)").val(passQty)
                $("#txtScriptQty@(itemName)").val(ngQty);
                $("#txtAvailableQty@(itemName)").val(passQty);
            }


            countcounts();
            AmountCalculation()
        }
        //檢查攤提用
        function checkCheckedAmortize(barcodeId) {
            let BarcodeListY = [];
            let BarcodeListN = [];

            if ($(`#cbxBarcode@(itemName)${barcodeId}`).is(":checked")) { }

                if ($(`#cbxBarcode@(itemName)${barcodeId}`).is(":checked")) {

                    $.each($("input[name='cbxBarcodeAmortize@(itemName)']").not(":disabled"), function () {
                        if ($(this).is(":checked")) {
                            BarcodeListY.push($(this).val());
                            barocdeQty = $(this).data("barcode-qty")
                            if ($(this).data("barcode-status") == "P") {
                            }
                            else if ($(this).data("barcode-status") == "S") {
                                $(`#cbxBarcodeAmortize@(itemName)${barcodeId}`).attr("disable", true);
                                $(`#cbxBarcodeAmortize@(itemName)${barcodeId}`).prop("checked", false);

                            }
                            else {
                                alert("【入庫管理錯誤】- 入庫條碼當前狀態資料有問題!")
                                return
                            }
                        }
                        else {
                            if (!$(this).is(":disabled")) {
                                BarcodeListN.push($(this).val());
                            }
                        }
                    });

                } else {
                    $(`#cbxBarcodeAmortize@(itemName)${barcodeId}`).attr("disable", true);
                    $(`#cbxBarcodeAmortize@(itemName)${barcodeId}`).prop("checked", false);
                }
            countcounts();
            AmountCalculation()
        }
        //
        function countcounts() {
            let scriptQty = 0;
            let amortizeQty = 0;

            var enterQty = 0;
            var passQty = 0;
            var ngQty = 0;

            $.each($("input[name='cbxBarcode@(itemName)']"), function () {
                var iddd = $(this).val()
                if ($(this).is(":checked")) {
                } else {
                    $(`#cbxBarcodeAmortize@(itemName)${iddd}`).prop("checked", false);
                }
            });


            if ($("input[type='checkbox'][name='cbxBarcode@(itemName)']:checked").length > 0) {

                $.each($("input[type='checkbox'][name='cbxBarcode@(itemName)']:checked"), function (i) {
                    enterQty  += $(this).data("barcode-qty");


                    if ($(this).data("barcode-status") == "P") {
                        passQty += $(this).data("barcode-qty");
                    } else if ($(this).data("barcode-status") == "S") {
                        scriptQty += $(this).data("barcode-qty");
                    }

                });
                @*if (soDetailId@(itemName)) ElementSetValue(soDetailId@(itemName), detailList, "change");*@
            }

            if ($("input[type='checkbox'][name='cbxBarcodeAmortize@(itemName)']:checked").length > 0) {
                let ggtr = 0;
                $.each($("input[type='checkbox'][name='cbxBarcodeAmortize@(itemName)']:checked"), function (i) {

                    if ($(this).data("barcode-status") == "P") {
                        amortizeQty += $(this).data("barcode-qty");
                        //ngQty += $(this).data("barcode-qty");
                    }

                });
                @*if (soDetailId@(itemName)) ElementSetValue(soDetailId@(itemName), detailList, "change");*@
            }

            //enterQty = passQty + ngQty;
            let oldscript = 0;
            oldscript = parseInt($("#txtScriptQty@(itemName)").val());
            $("#txtReceiptQty@(itemName)").val(enterQty)//進或

            $("#txtAcceptQty@(itemName)").val(passQty - amortizeQty)//驗收ngQty
            $("#txtScriptQty@(itemName)").val((amortizeQty + scriptQty));//報廢passQty
            $("#txtAvailableQty@(itemName)").val(passQty - amortizeQty);//計價
        }

        
       

        //產品入庫檢查產品條碼(刷取用)
        function checkBarcode() {
            let BarcodeType = $("#cboBarcodeType@(itemName)").val()
            switch (BarcodeType) {
                case "PotNumber":
                    let PotNumber = $("#txtBarcodeNo@(itemName)").val().trim()
                    let SentDataArr = BarcodeAttributesObj[BarcodeType][PotNumber]
                    if (typeof SentDataArr === "undefined") {
                        alert("鍋次不存在,請重新確認!!!")
                        return
                    }
                    else {
                        ShowPotNumberBarcodeList(PotNumber, SentDataArr)
                    }
                    
                    break;
                default:
                    let targetUrl = "@Url.Action("GetCheckBarcode", "Inventory")";
                    let postData = {
                        "MoId": $("#txtMoId@(itemName)").val(),
                        "BarcodeNo": $("#txtBarcodeNo@(itemName)").val().trim(),
                        "InventoryId": $("#cboInventoryId@(itemName)").val(),
                        "BarcodeType": $("#cboBarcodeType@(itemName)").val()
                    };
                    let data = DataAccess.Get(targetUrl, postData, false);
                    if (data.status == "success") {
                        $.each(data.result, function (i, item) {

                            switch (BarcodeType) {
                                case "Package":
                                    PopViewPackageList($("#txtBarcodeNo@(itemName)").val().trim())
                                    break;
                                default:
                                    sentBarcode(item.BarcodeId);
                                    break;
                            }
                        });
                    } else {
                        alert(data.msg, "alert", 0);
                    }
                    break;
            }
        }

        //輸入條碼檢核
        function sentBarcode(BarcodeId) {
            if ($("#txtBarcodeNo@(itemName)").val() != "") {
                if ($(`#cbxBarcode@(itemName)${BarcodeId}`).prop("disabled")) {
                    alert("該條碼已經入庫")
                    return
                }
                else {
                    $(`#cbxBarcode@(itemName)${BarcodeId}`).prop("checked", true);
                }

                let BarcodeListY = [];
                let BarcodeListN = [];
                var barocdeQty = 0;
                var enterQty = 0;
                var passQty = 0;
                var ngQty = 0;

                $.each($("input[name='cbxBarcode@(itemName)']"), function () {

                    if ($(this).is(":checked")) {

                        BarcodeListY.push($(this).val());
                        barocdeQty = $(this).data("barcode-qty")
                        if ($(this).data("barcode-status") == "P") {
                            passQty += barocdeQty
                        }
                        else if ($(this).data("barcode-status") == "S") {
                            ngQty += barocdeQty
                        }
                        else {
                            alert("【入庫管理錯誤】- 入庫條碼當前狀態資料有問題!")
                            return
                        }
                    }
                    else {
                        if (!$(this).is(":disabled")) {
                            BarcodeListN.push($(this).val());
                        }
                    }
                });
                enterQty = passQty + ngQty;
                $("#txtReceiptQty@(itemName)").val(enterQty)
                if ($("#ScrapRegister").val() == "Y")  {
                    switch (companyId@(itemName)) {
                        case 2:
                            if ($("#cboInventoryId@(itemName)").val() == 12) {
                                $("#txtAcceptQty@(itemName)").val(ngQty)
                                $("#txtScriptQty@(itemName)").val(0);
                                $("#txtAvailableQty@(itemName)").val(ngQty);
                            }
                            else {
                                $("#txtAcceptQty@(itemName)").val(passQty)
                                $("#txtScriptQty@(itemName)").val(ngQty);
                                $("#txtAvailableQty@(itemName)").val(passQty);
                            }
                            break;
                        case 3:
                            if ($("#cboInventoryId@(itemName)").val() == 129) {
                                $("#txtAcceptQty@(itemName)").val(ngQty)
                                $("#txtScriptQty@(itemName)").val(0);
                                $("#txtAvailableQty@(itemName)").val(ngQty);
                            }
                            else {
                                $("#txtAcceptQty@(itemName)").val(passQty)
                                $("#txtScriptQty@(itemName)").val(ngQty);
                                $("#txtAvailableQty@(itemName)").val(passQty);
                            }
                            break;
                        case 4:
                            if ($("#cboInventoryId@(itemName)").val() == 46) {
                                $("#txtAcceptQty@(itemName)").val(ngQty)
                                $("#txtScriptQty@(itemName)").val(0);
                                $("#txtAvailableQty@(itemName)").val(ngQty);
                            }
                            else {
                                $("#txtAcceptQty@(itemName)").val(passQty)
                                $("#txtScriptQty@(itemName)").val(ngQty);
                                $("#txtAvailableQty@(itemName)").val(passQty);
                            }
                            break;
                        case 5:
                            if ($("#cboInventoryId@(itemName)").val() == 115) {
                                $("#txtAcceptQty@(itemName)").val(ngQty)
                                $("#txtScriptQty@(itemName)").val(0);
                                $("#txtAvailableQty@(itemName)").val(ngQty);
                            }
                            else {
                                $("#txtAcceptQty@(itemName)").val(passQty)
                                $("#txtScriptQty@(itemName)").val(ngQty);
                                $("#txtAvailableQty@(itemName)").val(passQty);
                            }
                            break;
                        default:
                            alert('沒有符合的條件');
                            return
                    }
                }
                else {
                    $("#txtAcceptQty@(itemName)").val(passQty)
                    $("#txtScriptQty@(itemName)").val(ngQty);
                    $("#txtAvailableQty@(itemName)").val(passQty);
                }
                if ($("#cboBarcodeType@(itemName)").val() != "Package") {
                    $("#txtBarcodeNo@(itemName)").val("");
                }
                AmountCalculation()

            }
        }

        //入庫產品條碼全刪除
        function DeleteBarcodeAll@(itemName)() {
            swal.fire({
                titleText: "確認要清空條碼列表嗎?",
                text: "此動作無法復原，請確認是否要執行!",
                icon: "warning",
                allowOutsideClick: false,
                allowEscapeKey: false,
                showCancelButton: true,
                confirmButtonColor: '#d33',
                reverseButtons: true
            }).then((result) => {
                if ($("#ScrapRegister").val() == "Y") {
                    if ($("#BarcodeListStatus").val() == "P") {
                        MweDetailId = $("#MweDetailIdPass").val();
                    }
                    else if ($("#BarcodeListStatus").val() == "S") {
                        MweDetailId = $("#MweDetailIdScrap").val();
                    }
                }
                else if ($("#ScrapRegister").val() == "N") {
                    MweDetailId = $("#MweDetailId").val();
                }
                if (result.isConfirmed) {
                    let targetUrl = "@Url.Action("DeleteBarcodeAll", "Inventory")";
                    let postData = {
                        "MweId": $("#MweId").val(),
                        "MweDetailId": MweDetailId,
                    };

                    let data = DataAccess.EditContinued(targetUrl, postData, false);
                    if (data.status == "success") {
                        MweDetailInit@(itemName)()
                        TemporaryPassList = [];
                        TemporaryScrapList = [];
                        EditMoWarehouseEnryManagment($("#MweId").val(), $("#ScrapRegister").val())
                    }
                }
            });
        }

        function Return@(itemName)() {
            ResetForm(objForm@(itemName));
            Switch("#listData@(itemName)", "#editData@(itemName)");
            $("#txtMoId@(itemName)").siblings().find(".pop-clear").trigger("click")
            $('#txtAcceptanceDate@(itemName)').dateDropper('destroy');
            $("#IsAmortizeType@(itemName)").val("N");
            $("#cbxIsAmortize@(itemName)").prop("disabled", false);
            $("#cbxIsAmortize@(itemName)").attr("checked", false);
            OverMsg = ""

            //$(".read-status").show()
            //if ($("#TransferStatus").val() == "Y") {
            //    $(".read-status").hide()
            //}

            $(".BarcodeVersion").hide()
            $("#txtReceiptQty@(itemName)").attr("readonly", false);
            $("#txtAcceptQty@(itemName)").attr("readonly", false);
            $("#txtScriptQty@(itemName)").attr("readonly", false);
            $("#MoIdType").val("")
            $("#ScrapRegister").val("")
            $("#ConfirmStatus").val("")
            $("#BarcodeListStatus").val("")
            $("#MweDetailIdPass").val("")
            $("#MweDetailIdScrap").val("")
            $("#InventoryPass").val("")
            $("#LotManagement").val("")



            ComboBoxs.Default("#cboCurrentProdStatusQ@(itemName)", "@Url.Action("GetType", "BasicInformation")", { "TypeSchema": "Barcode.CurrentProdStatus" }, "", "NA", "", "TypeName", "TypeNo");
            ComboBoxs.Default("#cboBarcodeStatusQ@(itemName)", "@Url.Action("GetType", "BasicInformation")", { "TypeSchema": "Barcode.BarcodeStatus" }, "", "NA", "", "TypeName", "TypeNo");
            $("#txtBarcodeNoQ@(itemName)").val("")
            $("#cboCurrentProdStatusQ@(itemName)").val("")
            $("#cboBarcodeStatusQ@(itemName)").val("")
            $("#cboBarcodeType@(itemName)").val("").trigger("change.select2")
            $("#tblMoIdBarcodeData@(itemName) tbody").html("");

            const nodata = `<tr>
                                <td class="text-center" colspan="4" style="background-color: #fff3cd;">
                                    <i class="fal fa-exclamation-circle"></i>&nbsp;目前尚無資料
                                </td>
                            </tr>`
            $("#tblMoIdBarcodeTransferData@(itemName) tbody").html(nodata);


            TemporaryPassList = [];
            TemporaryScrapList = [];
            CurrentProdStatusList = [];
            BarcodeStatusList = [];

            Query@(itemName)();
        }
        function MweDetailInit@(itemName)() {
            ComboBoxs.Default("#cboUomId@(itemName)", "@Url.Action("GetUnitOfMeasure", "PdmBasicInformation")", { "Status": "A"}, "", "NA", "", "UomNo", "UomId"); //加工單位
            ComboBoxs.Default("#cboInventoryId@(itemName)", "@Url.Action("GetInventory", "ScmBasicInformation")", {}, "", "NA", "", "InventoryWithNo", "InventoryId"); //入庫庫別
            $("#cboUomId@(itemName)").val("");
            $("#cboInventoryId@(itemName)").val("");
            $("#txtReceiptQty@(itemName)").val(0);
            $("#txtAcceptQty@(itemName)").val(0);
            $("#txtAvailableQty@(itemName)").val(0);
            $("#txtScriptQty@(itemName)").val(0);
            $("#txtLotNumber@(itemName)").val("");
            $("#txtProject@(itemName)").val("");
            $("#txtAvailableDate@(itemName)").val("");
            $("#txtReCheckDate@(itemName)").val("");
            $(".BarcodeVersion").hide();
            $("#cboInventoryId@(itemName)").attr("disabled", false);
            $("#txtReceiptQty@(itemName)").attr("readonly", false);
            $("#txtAcceptQty@(itemName)").attr("readonly", false);
            $("#txtScriptQty@(itemName)").attr("readonly", false);
            $(".choose-MoId").show();
            $("#txtMoId@(itemName)").siblings().find(".pop-clear").trigger("click");
            $("#MweDetailId").val(-1);
            $("#InventoryPass").val("")
            if ($("#ScrapRegister").val() == "Y") {
                if ($("#BarcodeListStatus").val() == "S") {
                    $("#MweDetailIdScrap").val(-1)
                }
                else if ($("#BarcodeListStatus").val() == "P") {
                    $("#MweDetailIdPass").val(-1)
                }
            }
        }

        function PopView() {
            var LotManagement = $("#LotManagement").val()
            var MtlItemNo = $("#desMtlItemNo@(itemName)").text()
            var InventoryId = $("#cboInventoryId@(itemName)").val()

            if (LotManagement == "N") {
                alert("該品號不需要維護批號!!!", "warning")
                return
            }
            else {
                if (MtlItemNo == "") {
                    alert("品號不可為空!!")
                    return
                }
                if (InventoryId == "") {
                    alert("庫別不可為空!!")
                    return
                }
                PopViewLotNumberInventory(MtlItemNo, InventoryId,"Mwe")
            }
        }

        function CheckMoIdDateQa() {
            $("#QcRecordId").val()

            let returnStatus = ""
            let CheckResult 
            let CheckMsg 
            let CheckQty 
            let targetUrl = "@Url.Action("GetCheckMoIdDateQa", "Inventory")";
            let postData = {
                "MweId": $("#MweId").val(),
                "MoId": $("#txtMoId@(itemName)").val(),
                "LotNumber": $("#txtLotNumber@(itemName)").val(),
                "CheckMode": ($("#cbxCheckMode@(itemName)").is(":checked") ? "Y" : "N")
            };

            let data = DataAccess.Get(targetUrl, postData, false);
            if (data.status == "success") {
                CheckResult = data.result[0]
                CheckMsg = data.result[1]
                CheckQty = data.result[2]
                QcRecordId = data.result[3]
                returnStatus = CheckResult

                switch (CheckResult) {
                    case "A":
                        break;
                    case "S":
                        alert(CheckMsg, "alert", 0);
                        break;
                    case "Y":
                        //alert(CheckMsg, "success", 0);
                        $("#QcRecordId").val(QcRecordId)
                        break;
                    case "N":
                        alert(CheckMsg, "warning", 0);
                        $("#QcRecordId").val(QcRecordId)
                        break;
                }
            } else {
                returnStatus = "S"
                alert(data.msg, "alert", 0);
            }

            return returnStatus
        }


        function ShowPotNumberBarcodeList(PotNumber, SentDataObj) {
            let innerHtml = ""
            $('#SavePotNumberBarcodeList').off('click');
            Object.values(SentDataObj).forEach((item, index) => {

                let _row = (index + 1) + ".";
                innerHtml += `<tr>
                    <td class="">${_row}</td>
                    <td class="ellipsis" data-toggle="tooltip" title="${item.BarcodeNo}" style="max-width: 200px;">${item.BarcodeNo}<br>${item.TrayNo != null ? item.TrayNo : ``}</td>
                    <td class="ellipsis" data-toggle="tooltip" title="${item.BarcodeQty}" style="max-width: 200px;">${item.BarcodeQty}</td>
                    <td class="ellipsis" data-toggle="tooltip" title="${item.AttributesSum}" style="max-width: 200px;">${item.AttributesSum}</td>
                    <td class="ellipsis" data-toggle="tooltip" title="${item.BarcodeStatusName}" style="max-width: 200px;">${item.BarcodeStatusName}</td>
                 </tr>`;
            });
            $("#modalPotNumberBarcodeList@(itemName)").modal("show");
            $("#tblPotNumberBarcodeList@(itemName) tbody").html(innerHtml);
            $('#SavePotNumberBarcodeList').on('click', function () {
                let SentDataErr = false
                Object.values(SentDataObj).forEach((item, index) => {
                    if (SentDataErr) {
                        return
                    }
                    let BarcodeId = item.BarcodeId
                    let BarcodeNo = item.BarcodeNo
                    let TrayNo = item.TrayNo
                    if (!$(`#cbxBarcode@(itemName)${BarcodeId}`).prop('checked')) {
                        let targetUrl = "@Url.Action("GetCheckBarcode", "Inventory")";
                        let postData = {
                            "MoId": $("#txtMoId@(itemName)").val(),
                            "BarcodeNo": BarcodeNo,
                            "InventoryId": $("#cboInventoryId@(itemName)").val(),
                            "BarcodeType": $("#cboBarcodeType@(itemName)").val()
                        };
                        let data = DataAccess.Get(targetUrl, postData, false);
                        if (data.status == "success") {
                            $(`#cbxBarcode@(itemName)${BarcodeId}`).not(":disabled").prop("checked", true);
                        } else {
                            alert(`鍋次:${PotNumber},尚有條碼未完工不可以入庫`, "alert", 0);
                            SentDataErr = true
                        }
                    }
                    else {
                        $(`#cbxBarcode@(itemName)${BarcodeId}`).not(":disabled").prop("checked", false);
                    }
                });
                if (SentDataErr) {
                    Object.values(SentDataObj).forEach((item) => {
                        let BarcodeId = item.BarcodeId;
                        $(`#cbxBarcode@(itemName)${BarcodeId}`).not(":disabled").prop("checked", false);
                    });
                }
                checkChecked()

                ClosePotNumberBarcodeList@(itemName)()
            });
            return
        }



        

        function ClosePotNumberBarcodeList@(itemName)() {
            $("#modalPotNumberBarcodeList@(itemName)").modal("hide");
            $("#tblPotNumberBarcodeList@(itemName) tbody").html("");
            $("#txtBarcodeNo@(itemName)").val("")
        }



    </script>
                                                                        )