@using Business_Manager.Helpers
@{
    string itemName = "TrayManagment";
    string itemNameText = "托盤資料管理";
    string authority = ViewBag.authority;
    ViewBag.Title = itemNameText;
}

@Html.Resource("css",
    @<style>
    </style>
                                )

<input type="hidden" id="pageAuthority" value="@authority" />

<div class="row">
    <div class="col-12 title-block">
        <h1 class="pt-2 pb-3">@(itemNameText)</h1>
        <div class="unit-block">
            <div class="button-block mb-1">
                <button type="button" class="btn btn-secondary" onclick="Return@(itemName)()"><i class="fas fa-undo"></i>返回</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modalQuery@(itemName)">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">搜尋</h5>
                <button class="close" data-dismiss="modal" type="button">
                    <span aria-hidden="true"><i class="fas fa-times"></i></span>
                </button>
            </div>
            <div class="modal-body">
                <form class="container custom-form-container" autocomplete="off" id="queryForm@(itemName)">
                    <fieldset>
                        <div class="form-group row">
                            <label class="form-label col-12" for="txtMoNoQ@(itemName)">MES製令</label>
                            <div class="col-12">
                                <input type="text" class="form-control" id="txtMoNoQ@(itemName)" name="txtMoNoQ@(itemName)" placeholder="請輸入MES製令" />
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="form-label col-12" for="txtBarcodeNoQ@(itemName)">條碼</label>
                            <div class="col-12">
                                <input type="text" class="form-control" id="txtBarcodeNoQ@(itemName)" name="txtBarcodeNoQ@(itemName)" placeholder="請輸入條碼" />
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="form-label col-12" for="txtTrayNoQ@(itemName)">托盤編號</label>
                            <div class="col-12">
                                <input type="text" class="form-control" id="txtTrayNoQ@(itemName)" name="txtTrayNoQ@(itemName)" placeholder="請輸入托盤編號" />
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="form-label col-12" for="txtTrayNameQ@(itemName)">托盤名稱</label>
                            <div class="col-12">
                                <input type="text" class="form-control" id="txtTrayNameQ@(itemName)" name="txtTrayNameQ@(itemName)" placeholder="請輸入托盤名稱" />
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-12">創建開時時間區間 <input type="checkbox" id="cbxCreatTimeQ@(itemName)" checked /></label>
                            <div class="col-6">
                                <input type="datetime-local" id="txtCreatTimeStartQ@(itemName)" name="txtCreatTimeStartQ@(itemName)">
                            </div>
                            <div class="col-6">
                                <input type="datetime-local" id="txtCreatTimeEndQ@(itemName)" name="txtCreatTimeEndQ@(itemName)">
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="form-label col-12" for="cboCreateUserIdQ@(itemName)">創建人員</label>
                            <div class="col-12">
                                <select class="form-control" id="cboCreateUserIdQ@(itemName)" name="cboCreateUserIdQ@(itemName)"
                                        data-msg-required="請選擇創建人員"></select>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="form-label col-12">是否有綁定條碼</label>
                            <div class="col-lg-3 col-md-4 col-6">
                                <label class="control control-solid control-solid-info control--checkbox">
                                    是
                                    <input type="checkbox" id="cbxBindStatusQ@(itemName)A" name="cbxBindStatusQ@(itemName)" value="Y" />
                                    <span class="control__indicator"></span>
                                </label>
                            </div>
                            <div class="col-lg-3 col-md-4 col-6">
                                <label class="control control-solid control-solid-info control--checkbox">
                                    否
                                    <input type="checkbox" id="cbxBindStatusQ@(itemName)S" name="cbxBindStatusQ@(itemName)" value="N" />
                                    <span class="control__indicator"></span>
                                </label>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="form-label col-12">狀態</label>
                            <div class="col-lg-3 col-md-4 col-6">
                                <label class="control control-solid control-solid-info control--checkbox">
                                    啟用
                                    <input type="checkbox" id="cbxStatusQ@(itemName)A" name="cbxStatusQ@(itemName)" value="A" checked />
                                    <span class="control__indicator"></span>
                                </label>
                            </div>
                            <div class="col-lg-3 col-md-4 col-6">
                                <label class="control control-solid control-solid-info control--checkbox">
                                    停用
                                    <input type="checkbox" id="cbxStatusQ@(itemName)S" name="cbxStatusQ@(itemName)" value="S" />
                                    <span class="control__indicator"></span>
                                </label>
                            </div>
                        </div>
                    </fieldset>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" onclick="Query@(itemName)()" style="margin: auto;"><i class="fal fa-wrench"></i>套用</button>
            </div>
        </div>
    </div>
</div>

<div class="row" id="listData@(itemName)">
    <div class="col-12">
        <div class="card card-shadow mb-4">
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-6 col-sm-6 col-md-6">
                        <a class="btn btn-primary" data-backdrop="static" data-keyboard="false" data-toggle="modal" data-target="#modalQuery@(itemName)" href="javascript:void(0);">
                            <i class="fal fa-search"></i>搜尋
                        </a>
                    </div>
                    <div class="col-6 col-sm-6 col-md-6 text-right">
                        <a class="btn btn-info auth-add" href="javascript:Edit@(itemName)();"><i class="fas fa-plus"></i>新增</a>
                        <a class="btn btn-info auth-add" href="javascript:PopViewTrayDeleteBatch();"><i class="fas fa-plus"></i>批量刪除</a>
                        <a class="btn btn-info auth-add" href="javascript:PopViewTrayUnBind();"><i class="fas fa-plus"></i>解除綁定</a>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12">
                        <div class="table-custom">
                            <table class="table table-bordered table-striped table-sticky" id="tblData@(itemName)">
                                <thead>
                                    <tr>
                                        <th scope="col" style="min-width: 75px;">#</th>
                                        <th scope="col" style="min-width: 150px;">托盤編號</th>
                                        <th scope="col" style="min-width: 200px;">托盤名稱</th>
                                        <th scope="col" style="min-width: 200px;">製令編號</th>
                                        <th scope="col" style="min-width: 200px;">目前綁定條碼編號</th>
                                        <th scope="col" style="min-width: 200px;">創建者</th>
                                        <th scope="col" style="min-width: 200px;">創建時間</th>
                                        <th class="text-center" scope="col" style="min-width: 125px;">狀態</th>
                                        <th class="text-center" scope="col" style="min-width: 125px;">操作</th>
                                    </tr>
                                    <tr>
                                        <td class="text-center" colspan="9" style="background-color: #fff3cd;">
                                            <i class="fal fa-exclamation-circle"></i>&nbsp;請至搜尋下條件取資料。
                                        </td>
                                    </tr>`
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                        <div class="pagination" id="page@(itemName)"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row" id="editData@(itemName)" style="display: none;">
    <div class="col-12">
        <div class="card card-shadow mb-4">
            <div class="card-body">
                <form class="container custom-form-container" autocomplete="off" id="editForm@(itemName)">
                    <fieldset>
                        <input type="hidden" id="TrayId" name="TrayId" value="-1" />
                        <div class="form-group row">
                            <label class="col-12 col-md-3 col-lg-3 col-form-label" for="txtTrayNo@(itemName)">托盤編號</label>
                            <div class="col-12 col-md-9 col-lg-9">
                                <input type="text" class="form-control" id="txtTrayNo@(itemName)" name="txtTrayNo@(itemName)" placeholder="請輸入托盤編號"
                                       data-msg-required="請輸入托盤編號"
                                       data-msg-maxlength="必須少於 100 個字元" maxlength="100" disabled />
                            </div>
                        </div>
                        <div class="form-group row TrayPrefix">
                            <label class="col-12 col-md-3 col-lg-3 col-form-label" for="txtTrayPrefix@(itemName)">托盤前綴 <span class="text-danger">*</span></label>
                            <div class="col-12 col-md-9 col-lg-9">
                                <input type="text" class="form-control" id="txtTrayPrefix@(itemName)" name="txtTrayPrefix@(itemName)" placeholder="請輸入托盤前綴"
                                       data-msg-required="請輸入托盤前綴" data-rule-required="true" onkeyup="this.value=Check(this.value.toUpperCase().replace(/[^\w\s-]+/g,''))"
                                       data-msg-maxlength="必須少於 10 個字元" maxlength="10" />
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-12 col-md-3 col-lg-3 col-form-label" for="txtTrayName@(itemName)">托盤名稱 <span class="text-danger">*</span></label>
                            <div class="col-12 col-md-9 col-lg-9">
                                <input type="text" class="form-control" id="txtTrayName@(itemName)" name="txtTrayName@(itemName)" placeholder="請輸入托盤名稱"
                                       data-msg-required="請輸入托盤名稱" data-rule-required="true"
                                       data-msg-maxlength="必須少於 100 個字元" maxlength="100" />
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-12 col-md-3 col-lg-3 col-form-label" for="txtTrayCapacity@(itemName)">托盤容量 <span class="text-danger">*</span></label>
                            <div class="col-12 col-md-9 col-lg-9">
                                <input type="number" class="form-control" id="txtTrayCapacity@(itemName)" name="txtTrayCapacity@(itemName)" placeholder="請輸入托盤容量"
                                       data-msg-required="請輸入托盤容量" data-rule-required="true" />
                            </div>
                        </div>
                        <div class="form-group row Serial">
                            <label class="col-12 col-md-3 col-lg-3 col-form-label" for="txtSerial@(itemName)">流水碼數</label>
                            <div class="col-12 col-md-9 col-lg-9">
                                <input type="number" class="form-control" id="txtSerial@(itemName)" name="txtSerial@(itemName)" placeholder="請輸入流水碼數"
                                       data-msg-required="請輸入流水碼數" data-rule-required="true" value="1" />
                            </div>
                        </div>
                        <div class="form-group row SuffixCode">
                            <label class="col-12 col-md-3 col-lg-3 col-form-label" for="cbxSuffixCode@(itemName)">是否要加【-】<span class="text-danger">*</span></label>
                            <div class="col-12 col-md-9 col-lg-9" style="display: flex;align-items: center;">
                                <input type="checkbox" id="cbxSuffixCode@(itemName)" name="cbxSuffixCode@(itemName)" />
                            </div>
                        </div>
                        <div class="form-group row showItem">
                            <label class="col-12 col-md-3 col-lg-3 col-form-label" for="txtSerialNumber@(itemName)">流水編號模式</label>
                            <div class="col-12 col-md-9 col-lg-9">
                                <input type="number" class="form-control" id="txtSerialNumber@(itemName)" name="txtSerialNumber@(itemName)" placeholder="請輸入流水編號"
                                       data-msg-required="請輸入流水編號" data-rule-required="true" value="" />
                            </div>
                        </div>
                        <div class="form-group row showItem">
                            <label class="col-12 col-md-3 col-lg-3 col-form-label" for="txtFabrication@(itemName)">生產托盤數量模式</label>
                            <div class="col-12 col-md-9 col-lg-9">
                                <input type="number" class="form-control" id="txtFabrication@(itemName)" name="txtFabrication@(itemName)" placeholder="請輸入欲生產托盤數量"
                                       data-msg-required="請輸入欲生產托盤數量" data-rule-required="true" value="" />
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-12 col-md-12">
                                <div class="form-group row">
                                    <label class="col-12 col-md-3 col-lg-3 col-form-label" for="txtRemark@(itemName)">備註</label>
                                    <div class="col-12 col-md-9 col-lg-9">
                                        <textarea class="form-control" id="txtRemark@(itemName)" name="txtRemark@(itemName)"
                                                  data-msg-maxlength="必須少於 255 個字元" maxlength="255" rows="2" placeholder="請輸入備註"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-12 col-md-3 col-lg-3 col-form-label" for="txtBarcodeNo@(itemName)">目前綁定條碼</label>
                            <div class="col-12 col-md-9 col-lg-9">
                                <input type="text" class="form-control" id="txtBarcodeNo@(itemName)" name="txtBarcodeNo@(itemName)" placeholder="請輸入目前綁定條碼"
                                       data-msg-required="請輸入目前綁定條碼" disabled />
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-12 col-md-3 col-lg-3 col-form-label" for="txtUseTimes@(itemName)">使用次數</label>
                            <div class="col-12 col-md-9 col-lg-9">
                                <input type="number" class="form-control" id="txtUseTimes@(itemName)" name="txtUseTimes@(itemName)" placeholder="請輸入使用次數"
                                       data-msg-required="請輸入使用次數" disabled />
                            </div>
                        </div>
                    </fieldset>
                </form>
            </div>
            <div class="card-footer text-center text-lg-right">
                <button type="button" class="btn btn-success" onclick="Save@(itemName)()"><i class="fas fa-save"></i>儲存</button>
            </div>
        </div>
    </div>
</div>

<div class="advanced-block">
    <div class="row">
        <div class="col-12">
            <ul class="nav flag-tabs nav-fill" role="tablist">
                <li class="flag-item">
                    <a class="flag-link" data-toggle="tab" href="#tabTrayBarcodeLog">
                        <i class="fas fa-code-branch"></i> 托盤過往綁定資料紀錄
                    </a>
                </li>
            </ul>
        </div>
    </div>
    <div class="tab-content">
        <div class="tab-pane active" id="tabTrayBarcodeLog">
            @Html.Partial("TrayBarcodeLog")
        </div>
    </div>
</div>

@Html.Partial("ViewTrayDeleteBatch")
@Html.Partial("ViewTrayUnBind")


@Html.Resource("js",

@<script>
    let objPage@(itemName) = {
        "pageIndex": 0,
         "pageSize": 200
    };
    let objForm@(itemName) = "#editForm@(itemName)";
    let userId@(itemName);
    let companyId@(itemName);
    let userNo@(itemName);

    $(document).ready(function () {
        //Query@(itemName)();
        GetUserInfo@(itemName)()

        ComboBoxs.Default("#cboCreateUserIdQ@(itemName)", "@Url.Action("GetUser", "BasicInformation")", {"CompanyId": companyId@(itemName), "Status": "A"}, "", "NA", "", "UserWithNo", "UserId"); //檢驗人員

        $("#txtSerialNumber@(itemName)").change(function () {
            let SerialNumber = $("#txtSerialNumber@(itemName)").val()
            if (SerialNumber > 0) {
                $("#txtFabrication@(itemName)").val(0)
            }
        })
        $("#txtFabrication@(itemName)").change(function () {
            let Fabrication = $("#txtFabrication@(itemName)").val()
            if (Fabrication > 0) {
                $("#txtSerialNumber@(itemName)").val(0)
            }
        })

        $("#cboCreateUserIdQ@(itemName)").select2({
            dropdownAutoWidth: true,
            width: "100%"
        });
    });

    function Query@(itemName)() {
        objPage@(itemName).pageIndex = 0;
        InitData@(itemName)(objPage@(itemName));

        $("#modalQuery@(itemName)").modal("hide");
    }

    function InitData@(itemName)(objPage) {
        let innerHtml = '';
        let pageCount = 0;

        let bindStatusList = [];
        $.each($("input[name='cbxBindStatusQ@(itemName)']:checked"), function () {
            bindStatusList.push($(this).val());
        });

        let statusList = [];
        $.each($("input[name='cbxStatusQ@(itemName)']:checked"), function () {
            statusList.push($(this).val());
        });

        let targetUrl = "@Url.Action("GetTray", "MesBasicInformation")";
        let postData = {
            "OrderBy": "",
            "PageIndex": (objPage.pageIndex + 1),
            "PageSize": objPage.pageSize,
            "MoNo": $("#txtMoNoQ@(itemName)").val(),
            "BarcodeNo": $("#txtBarcodeNoQ@(itemName)").val().trim(),
            "TrayNo": $("#txtTrayNoQ@(itemName)").val().trim(),
            "TrayName": $("#txtTrayNameQ@(itemName)").val().trim(),
            "CreateUserId": $("#cboCreateUserIdQ@(itemName)").val(),
            "CreatTimeStart": ($("#cbxCreatTimeQ@(itemName)").is(":checked") ? $("#txtCreatTimeStartQ@(itemName)").val() : ""),
            "CreatTimeEnd": ($("#cbxCreatTimeQ@(itemName)").is(":checked") ? $("#txtCreatTimeEndQ@(itemName)").val() : ""),
            "BindStatus": bindStatusList.join(","),
            "Status": statusList.join(",")
        };

        let data = DataAccess.Get(targetUrl, postData, false);

        if (data.status == "success") {
            pageCount = data.result.length > 0 ? parseInt(data.result[0]["TotalCount"]) : 0;

            if (pageCount > 0) {
                objPage = PageCaculate(pageCount, objPage);

                $.each(data.result, function (i, item) {
                    let _row = (objPage.pageSize * objPage.pageIndex + (i + 1)) + ".";

                    innerHtml += `<tr>
                                        <td>${_row}</td>
                                        <td class="ellipsis" data-toggle="tooltip" title="${item.TrayNo}" style="max-width: 200px;">${item.TrayNo}</td>
                                        <td class="ellipsis" data-toggle="tooltip" title="${item.TrayName}" style="max-width: 200px;">${item.TrayName}</td>
                                        <td class="ellipsis" data-toggle="tooltip" title="${item.MoNo}" style="max-width: 200px;">${item.MoNo}</td>
                                        <td class="ellipsis" data-toggle="tooltip" title="${item.BarcodeNo}" style="max-width: 200px;">${item.BarcodeNo}</td>
                                        <td class="ellipsis" data-toggle="tooltip" title="${item.CreateUser}" style="max-width: 200px;">${item.CreateUser}</td>
                                        <td class="ellipsis" data-toggle="tooltip" title="${item.CreateDate}" style="max-width: 200px;">${item.CreateDate}</td>
                                        <td class="text-center auth-status-switch">
                                          <input type="checkbox" name="chkStatus@(itemName)" data-tray-id="${item.TrayId}" ${item.Status == `A` ? `checked` : ``} />
                                        </td>
                                        <td class="text-center un-auth auth-status-switch">${StatusName(`Status`, item.Status)}</td>
                                        <td class="text-center active-content">
                                          <a class="active-link auth-update" href="javascript:Edit@(itemName)(${item.TrayId});"><i class="fas fa-edit"></i></a>
                                        </td>
                                      </tr>`;
                });
            } else {
                innerHtml += `<tr>
                                    <td class="text-center" colspan="8" style="background-color: #fff3cd;">
                                      <i class="fal fa-exclamation-circle"></i>&nbsp;目前尚無資料。
                                    </td>
                                  </tr>`;
            }
        } else {
            alert(data.msg, "alert", 0);
        }

        $("#tblData@(itemName) tbody").html(innerHtml);
        TableComponentInit();
        Pager("#page@(itemName)", pageCount, objPage, InitData@(itemName));

        $("input[name='chkStatus@(itemName)']").bootstrapToggle({
            on: "啟用",
            off: "停用",
            onstyle: "success",
            offstyle: "danger",
            size: "mini"
        });

        $("input[name='chkStatus@(itemName)'][data-tray-id]").change(StatusSwitch@(itemName));
    }

    function Edit@(itemName)(TrayId) {
        $("#TrayId").val(TrayId ? TrayId : 0);

        Switch("#editData@(itemName), .unit-block", "#listData@(itemName)");
        $(".showItem").show()
        $(".TrayPrefix").show()
        $(".Serial").show()
        $(".SuffixCode").show()

        if (TrayId > 0) {
            $(".showItem").hide()
            $(".TrayPrefix").hide()
            $(".Serial").hide()
            $(".SuffixCode").hide()
            let targetUrl = "@Url.Action("GetTray", "MesBasicInformation")";
            let postData = {
                "TrayId": TrayId
            };

            let data = DataAccess.Get(targetUrl, postData, false);

            if (data.status == "success") {
                $.each(data.result, function (i, item) {
                    $("#txtTrayNo@(itemName)").val(item.TrayNo);
                    $("#txtTrayPrefix@(itemName)").val(item.TrayNo.split('-')[0]);
                    $("#txtTrayName@(itemName)").val(item.TrayName);
                    $("#txtTrayCapacity@(itemName)").val(item.TrayCapacity);
                    $("#txtBarcodeNo@(itemName)").val(item.BarcodeNo);
                    $("#txtUseTimes@(itemName)").val(item.UseTimes);
                    $("#txtRemark@(itemName)").val(item.Remark);
                });
                ExpandTrayBarcodeLog();
            } else {
                alert(data.msg, "alert", 0);
            }
        }
    }

    function Save@(itemName)() {
        if ($(objForm@(itemName)).valid()) {
            let TrayId = parseInt($("#TrayId").val());
            if (parseInt($("#txtFabrication@(itemName)").val()) < 0) {
                alert("生產數量不能為負")
            }
            if (TrayId <= 0) {
                let targetUrl = "@Url.Action("AddTray", "MesBasicInformation")";
                let postData = {
                    "ViewCompanyId": companyId@(itemName),
                    "TrayPrefix": $("#txtTrayPrefix@(itemName)").val(),
                    "TrayName": $("#txtTrayName@(itemName)").val(),
                    "TrayCapacity": $("#txtTrayCapacity@(itemName)").val(),
                    "SerialNumber": $("#txtSerialNumber@(itemName)").val(),
                    "Fabrication": $("#txtFabrication@(itemName)").val(),
                    "Serial": $("#txtSerial@(itemName)").val(),
                    "SuffixCode": $("#cbxSuffixCode@(itemName)").is(":checked") ? "Y" : "N",
                    "Remark": $("#txtRemark@(itemName)").val()
                };

                let result = DataAccess.EditContinued(targetUrl, postData, false);

                if (result) {
                    if (result.result != "") {
                        alert(result.result)
                    } else {
                        Return@(itemName)();
                    }
                }
            } else {
                let targetUrl = "@Url.Action("UpdateTray", "MesBasicInformation")";
                let postData = {
                    "TrayId": TrayId,
                    "TrayName": $("#txtTrayName@(itemName)").val(),
                    "TrayCapacity": $("#txtTrayCapacity@(itemName)").val(),
                    "Remark": $("#txtRemark@(itemName)").val()
                };

                let result = DataAccess.Update(targetUrl, postData, false, true);

                if (result) {
                    Return@(itemName)();
                }
            }
        }
    }

    function Delete@(itemName)(TrayId) {
        alert("停用!")
        return
        swal.fire({
            titleText: "確認要刪除嗎?",
            text: "此動作無法復原，請確認是否要執行!",
            icon: "warning",
            allowOutsideClick: false,
            allowEscapeKey: false,
            showCancelButton: true,
            confirmButtonColor: '#d33',
            reverseButtons: true
        }).then((result) => {
            if (result.isConfirmed) {
                let targetUrl = "@Url.Action("DeleteTray", "MesBasicInformation")";
                let postData = {
                    "TrayId": TrayId,
                };

                let result = DataAccess.Delete(targetUrl, postData, false, true);

                if (result) {
                    Query@(itemName)();
                }
            }
        });
    }

    function GetUserInfo@(itemName)() {
        let targetUrl = "@Url.Action("GetLoginByKey", "User")";
        let postData = {
            "UserNo": $.cookie("Login"),
            "KeyText": $.cookie("LoginKey")
        };

        let data = DataAccess.Get(targetUrl, postData, false);

        if (data.status == "success") {
            userId@(itemName) = data.returnData.UserId;
            companyId@(itemName) = data.returnData.CompanyId;
            userNo@(itemName) = data.returnData.UserNo;
                
        } else {
            alert(data.msg, "alert", 0);
        }
    }

    function Return@(itemName)() {
        ResetForm(objForm@(itemName));
        Switch("#listData@(itemName)", "#editData@(itemName), .unit-block, .advanced-block");
        Query@(itemName)();
    }

    function StatusSwitch@(itemName)() {
        var TrayId = $(this).data("tray-id");

        let targetUrl = "@Url.Action("UpdateTrayStatus", "MesBasicInformation")";
        let postData = {
            "TrayId": TrayId
        };

        let result = DataAccess.Update(targetUrl, postData, false, true);

        if (result) {
            Return@(itemName)();
        }
    }

    function Check(str) {
        var temp = "";
        for (var i = 0; i < str.length; i++) {
            if (str.charCodeAt(i) > 0 && str.charCodeAt(i) < 255) {
                temp += str.charAt(i)
            }
        }
        return temp
    }
</script>
                                )