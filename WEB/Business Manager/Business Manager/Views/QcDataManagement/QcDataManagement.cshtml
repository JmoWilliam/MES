@using Business_Manager.Helpers
@{
    string itemName = "QcDataManagement";
    string itemNameText = "量測資料上傳彙整系統";
    string authority = ViewBag.authority;
    ViewBag.Title = itemNameText;

    string QcRecordId = Request["QcRecordId"] ?? "";
}

@Html.Resource("css",
    @<style>
         .help-block {
             display: none;
             margin: 5px 0 0;
             border: 3px dashed #b1b1b1;
             border-radius: 5px;
             padding: 5px 10px;
         }

         dt {
             float: left;
             clear: left;
             width: 110px;
         }

             dt::after {
                 content: "：";
             }

         dd {
             margin: 0 0 0 80px;
             padding: 0;
             color: #36a2f5;
             font-weight: bold;
         }

         .qc-file-info {
             padding: 18px;
             background: #f7f4f4c4;
             border-radius: 15px;
             margin-bottom: 15px;
             box-shadow: 5px 5px 10px rgb(137 137 137 / 19%);
         }

         .qc-file-body {
             overflow: scroll;
             max-height: 65vh;
             margin-bottom: 15px;
         }

        .qc-file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: #e9e9e9;
            border-radius: 15px;
            margin-bottom: 15px;
        }

         .item-file {
             width: 100%;
             display: flex;
             align-items: center;
             font-size: 16px;
             font-weight: 600;
         }

         .qc-machine {
             width: 100%;
         }

         .check-all {
             padding: 10px;
             display: flex;
             font-weight: 600;
             font-size: 18px;
         }

             .check-all input {
                 width: 18px;
                 margin-right: 8px;
             }

         .qc-file-check-box {
             margin-right: 8px;
         }

         .qc-file-footer {
             display: flex;
             justify-content: flex-end;
         }

         .btn-resolve {
             background-color: #686973;
             border-radius: 5px;
             color: #fff;
             display: inline-block;
             padding: 0.1875rem 0.5rem;
             min-width: 35px;
             height: 35px;
             line-height: 30px;
             text-align: center;
         }

             .btn-resolve:hover {
                 background-color: #8684ad;
                 color: #fff;
             }

         .btn-remove-resolve {
             background-color: #e55151;
             border-radius: 5px;
             color: #fff;
             display: inline-block;
             padding: 0.1875rem 0.5rem;
             min-width: 35px;
             height: 35px;
             line-height: 30px;
             text-align: center;
         }

             .btn-remove-resolve:hover {
                 background-color: #8684ad;
                 color: #fff;
             }

         .check-all {
             display: flex;
             align-items: center;
         }

         .parameter-bar {
             width: 100%;
             display: flex;
         }

         #loading {
             display: none;
             position: fixed;
             top: 50%;
             left: 50%;
             transform: translate(-50%, -50%);
             padding: 20px;
             border-radius: 5px;
             z-index: 9999;
         }

         .confirm-item {
             display: flex;
             justify-content: flex-start;
             margin-bottom: 15px;
         }

         .confirm-btn {
             width: 100%;
             text-align: center;
             padding: 65px;
             background: #6d9b77;
             font-size: 30px;
             font-weight: 600;
             color: aliceblue;
             display: flex;
             align-items: center;
             justify-content: center;
         }

             .confirm-btn:hover {
                 background: #9dc3a6;
                 color: aliceblue;
             }

         .reconfirm-btn {
             width: 100%;
             text-align: center;
             padding: 65px;
             background: #d5778c;
             font-size: 30px;
             font-weight: 600;
             color: aliceblue;
             display: flex;
             align-items: center;
             justify-content: center;
         }

             .reconfirm-btn:hover {
                 background: #df98a8;
                 color: aliceblue;
             }

         .start-btn {
             width: 100%;
             text-align: center;
             padding: 65px;
             background: #4191b9;
             font-size: 30px;
             font-weight: 600;
             color: aliceblue;
             display: flex;
             align-items: center;
             justify-content: center;
         }

             .start-btn:hover {
                 background: #8cbcd3;
                 color: aliceblue;
             }

         .urgent {
             background: #ffc6c6 !important;
         }

         .table-sticky thead .col-sticky:nth-last-child(1) {
             right: 0;
         }

         .table-sticky tbody .col-sticky:nth-last-child(1) {
             right: 0;
         }

        .tag-group {
            display: flex;
            align-items: center;
            gap: 12px;
            background-color: #ebebeb;
            border-radius: 4px;
            cursor: text;
            line-height: 1;
            padding: 0.35rem 0.5rem;
            margin: 0.15rem 0.375rem 0.15rem 0;
            white-space: nowrap;
            color: #0580ff;
            font-weight: 700;
        }
    </style>
                                                        )

<input type="hidden" id="pageAuthority" value="@authority" />

<div class="row">
    <div class="col-12 title-block">
        <h1 class="pt-2 pb-3">@(itemNameText)</h1>
        <div class="unit-block">
            <div class="button-block mb-1">
                <a class="btn btn-info auth-add" href="javascript:Edit@(itemName)();"><i class="fas fa-plus"></i>新增</a>
                <button type="button" class="btn btn-secondary" onclick="Return@(itemName)()"><i class="fas fa-undo"></i>返回</button>
            </div>
        </div>
    </div>
</div>

<!--搜尋-->
<div class="modal fade" id="modalQuery@(itemName)">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">搜尋</h5>
                <button class="close" data-dismiss="modal" type="button">
                    <span aria-hidden="true"><i class="fas fa-times"></i></span>
                </button>
            </div>
            <div class="modal-body" style="max-height: 60vh; overflow: scroll;">
                <form class="container" autocomplete="off" id="queryForm@(itemName)">
                    <fieldset>
                        <div class="form-group row">
                            <label class="col-12 col-form-label">ERP製令單號</label>
                            <div class="col-12">
                                <input type="text" class="form-control" id="txtWoErpFullNoQ@(itemName)" name="txtWoErpFullNoQ@(itemName)"
                                       placeholder="請輸入ERP製令單號 EX:5101-20230302001(1)">
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-12 col-form-label">量測單號</label>
                            <div class="col-12">
                                <input type="text" class="form-control" id="txtQcRecordIdQ@(itemName)" name="txtQcRecordIdQ@(itemName)"
                                       placeholder="請輸入量測單號">
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-12 col-form-label">MES製令編號</label>
                            <div class="col-12">
                                <input type="text" class="form-control" id="txtMoIdQ@(itemName)" name="txtMoIdQ@(itemName)"
                                       placeholder="請輸入MES製令編號 EX:1568">
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-12 col-form-label">品號</label>
                            <div class="col-12">
                                <input type="text" class="form-control" id="txtMtlItemNoQ@(itemName)" name="txtMtlItemNoQ@(itemName)"
                                       placeholder="請輸入品號">
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-12 col-form-label">品名</label>
                            <div class="col-12">
                                <input type="text" class="form-control" id="txtMtlItemNameQ@(itemName)" name="txtMtlItemNameQ@(itemName)"
                                       placeholder="請輸入品名">
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-12 col-form-label">生產模式</label>
                            <div class="col-12">
                                <select class="form-control" id="cboModeIdQ@(itemName)" name="cboModeIdQ@(itemName)"></select>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-12 col-form-label">量測類型</label>
                            <div class="col-12">
                                <select class="form-control" id="cboQcTypeQ@(itemName)"></select>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-12 col-form-label">上傳狀態</label>
                            <div class="col-12">
                                <select class="form-control" id="cboCheckQcMeasureDataQ@(itemName)">
                                    <option value="" selected>全部</option>
                                    <option value="Y">已上傳</option>
                                    <option value="N">未上傳</option>
                                    <option value="P">已上傳但未判定</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-12 col-form-label">建單日期</label>
                            <div class="col-6">
                                <input type="text" class="form-control" id="txtStartDateQ@(itemName)" name="txtStartDateQ@(itemName)"
                                       placeholder="請輸入建單日期"
                                       data-msg-required="請輸入建單日期" data-rule-required="true"
                                       data-msg-extraRegex="請輸入正確的日期格式" data-rule-extraRegex="([12]\d{3}\-(0[1-9]|1[0-2])\-(0[1-9]|[12]\d|3[01]))" />
                            </div>
                            <div class="col-6">
                                <input type="text" class="form-control" id="txtEndDateQ@(itemName)" name="txtEndDateQ@(itemName)"
                                       placeholder="請輸入建單日期"
                                       data-msg-required="請輸入建單日期" data-rule-required="true"
                                       data-msg-extraRegex="請輸入正確的日期格式" data-rule-extraRegex="([12]\d{3}\-(0[1-9]|1[0-2])\-(0[1-9]|[12]\d|3[01]))" />
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-12 col-form-label">建立人員</label>
                            <div class="col-12">
                                <select class="form-control" id="cboUserIdQ@(itemName)"></select>
                            </div>
                        </div>
                    </fieldset>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" onclick="Query@(itemName)()" style="margin: auto;"><i class="fal fa-wrench"></i>套用</button>
            </div>
        </div>
    </div>
</div>

<!--列表-->
<div class="row" id="listData@(itemName)">
    <div class="col-12">
        <div class="card card-shadow mb-4">
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-6 col-sm-6 col-md-6">
                        <a class="btn btn-primary" data-backdrop="static" data-keyboard="false" data-toggle="modal" data-target="#modalQuery@(itemName)" href="javascript:void(0);"><i class="fal fa-search"></i>搜尋</a>
                        <a class="btn btn-dark" data-backdrop="static" data-keyboard="false" data-toggle="modal" data-target="#modalPrint2@(itemName)" href="javascript:void(0);"><i class="fal fa-print"></i>批次列印標籤</a>
                        <a class="btn btn-danger" href="javascript:PopLotPrintView@(itemName)();"><i class="fas fa-file-excel"></i>開啟列印</a>
                    </div>
                    <div class="col-6 col-sm-6 col-md-6 text-right">
                        <a class="btn btn-info auth-add" href="javascript:Edit@(itemName)();"><i class="fas fa-plus"></i>新增</a>
                        <a class="btn btn-danger auth-add" href="javascript:PopViewModalImportExcel@(itemName)();"><i class="fas fa-file-excel"></i>匯入EXCEL</a>
                        <a class="btn btn-danger auth-add" href="javascript:PopViewModalImportExcel@(itemName)('Multi');"><i class="fas fa-file-excel"></i>匯入EXCEL(多項目版本)</a>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12">
                        <div class="table-custom">
                            <table class="table table-bordered table-striped table-sticky" id="tblData@(itemName)">
                                <thead>
                                    <tr>
                                        <th scope="col" style="max-width: 75px;">#</th>
                                        <th class="text-center checkbox-mode" scope="col" style="min-width: 110px;">
                                            <label class="col-12 col-form-label">
                                                列印 <input type="checkbox" id="cbxSelectAll2@(itemName)" />
                                            </label>
                                        </th>
                                        <th scope="col" style="max-width: 100px;">急件</th>
                                        <th class="text-center" scope="col" style="max-width: 100px;">操作</th>
                                        <th scope="col" style="max-width: 100px;">量測單號</th>
                                        <th scope="col" style="min-width: 110px;">製令</th>
                                        <th scope="col" style="min-width: 100px;">製令編號</th>
                                        <th scope="col" style="max-width: 200px;">品號</th>
                                        <th scope="col" style="max-width: 200px;">品名</th>
                                        <th scope="col" style="max-width: 200px;">量測類型</th>
                                        <th scope="col" style="max-width: 200px;">量測製程</th>
                                        <th scope="col" style="max-width: 200px;">建單日期</th>
                                        <th scope="col" style="max-width: 150px;">上傳狀態</th>
                                        <th scope="col" style="max-width: 150px;">排程狀態</th>
                                        <th scope="col" style="max-width: 200px;">建立人員</th>
                                        <th scope="col" style="max-width: 200px; min-width: 115px;">備註</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                        <div class="pagination" id="page@(itemName)"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!--新增/編輯-->
<div class="row" id="editData@(itemName)" style="display: none;">
    <div class="col-12">
        <div class="card card-shadow mb-4">
            <div class="card-body">
                <form class="container" autocomplete="off" id="editForm@(itemName)">
                    <fieldset>
                        <input type="hidden" id="QcRecordId" />
                        <div class="row">
                            <div class="col-lg-12 col-md-12">
                                <div class="form-group row">
                                    <label class="col-12 col-form-label" for="txtMoId@(itemName)">綁定MES製令<span class="text-danger">*</span></label>
                                    <div class="col-12">
                                        <input type="hidden" id="txtModeId@(itemName)" value="" />
                                        <input type="hidden" id="txtMoId@(itemName)" value="" />
                                        <div class="input-group">
                                            <input type="text" class="form-control" id="txtWoErpFullNo@(itemName)" name="txtWoErpFullNo@(itemName)" placeholder="請輸入製令" />
                                            <div class="input-group-append">
                                                <a class="btn btn-success pop-view" href="javascript:void(0);"><i class="fal fa-search"></i></a>
                                                <a class="btn btn-outline-danger pop-clear" href="javascript:Clear@(itemName)();"><i class="fas fa-eraser"></i></a>
                                            </div>
                                        </div>
                                        <dl class="help-block">
                                            <dt>品號</dt>
                                            <dd id="desMtlItemNo@(itemName)"></dd>
                                            <dt>品名</dt>
                                            <dd id="desMtlItemName@(itemName)"></dd>
                                        </dl>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row" style="display: none;">
                            <div class="col-lg-12 col-md-12">
                                <div class="form-group row">
                                    <label class="col-12 col-form-label" for="txtQcNoticeId@(itemName)">綁定量測需求單<code>(不強制綁定，可直接上傳EXCEL)</code></label>
                                    <div class="col-12">
                                        <input type="hidden" id="txtQcNoticeId@(itemName)" />
                                        <div class="input-group">
                                            <input type="text" class="form-control" id="txtQcNoticeNo@(itemName)" name="txtQcNoticeNo@(itemName)" placeholder="請輸入量測單號" />
                                            <div class="input-group-append">
                                                <a class="btn btn-success pop-view" href="javascript:void(0);"><i class="fal fa-search"></i></a>
                                                <a class="btn btn-outline-danger pop-clear" href="javascript:Clear@(itemName)();"><i class="fas fa-eraser"></i></a>
                                            </div>
                                        </div>
                                        <dl class="help-block">
                                            <dt>送檢數量</dt>
                                            <dd id="desQcNoticeQty@(itemName)"></dd>
                                        </dl>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-lg-6 col-md-12 ">
                                <div class="form-group row">
                                    <label class="form-label col-12" for="cboQcTypeId@(itemName)">檢驗類別<span class="text-danger">*</span></label>
                                    <div class="col-12">
                                        <select id="cboQcTypeId@(itemName)" class="form-control" required></select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 col-md-12 ">
                                <div class="form-group row">
                                    <label class="form-label col-12" for="cboSupportAqFlag@(itemName)">是否支援品異單 <code>(此參數會影響後續NG品是否會建立品異單)</code><span class="text-danger">*</span></label>
                                    <div class="col-12">
                                        <select id="cboSupportAqFlag@(itemName)" class="form-control" required>
                                            <option value="Y">是</option>
                                            <option value="N">否</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row mo-process-id" style="display: none;">
                            <div class="col-lg-12 col-md-12 ">
                                <div class="form-group row">
                                    <label class="form-label col-12" for="cboMoProcessId@(itemName)">檢驗製程<span class="text-danger">*</span></label>
                                    <div class="col-12">
                                        <select id="cboMoProcessId@(itemName)" class="form-control" required></select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-lg-12 col-md-12 ">
                                <div class="form-group row">
                                    <label class="form-label col-12" for="cboInputType@(itemName)">輸入格式<span class="text-danger">*</span></label>
                                    <div class="col-12">
                                        <select id="cboInputType@(itemName)" class="form-control" required>
                                            <option value="Lettering" selected>刻字</option>
                                            <option value="Cavity">穴號</option>
                                            <option value="BarcodeNo">條碼</option>
                                            <option value="LotNumber">批號</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="divRemind@(itemName)" class="row">
                            <div class="col-12 mt-2">
                                <div class="alert alert-info border-0">
                                    <ul style="padding-inline-start: 20px;">
                                        <li>輸入格式說明:</li>
                                        <li>穴號模式，請用<mark><code>-</code></mark>代表第幾穴第幾片；EX：<code>1-1、2-2</code></li>
                                        <li>刻字模式請直接輸入刻字流水號碼，EX: <code>1、2</code></li>
                                        <li>條碼模式請輸入模仁上號碼或是紙本條碼，EX: <code>143501、1603001</code></li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-lg-12 col-md-12 ">
                                <div class="form-group row">
                                    <label class="form-label col-12" for="txtQcRecordFile@(itemName)">設計圖資訊</label>
                                    <div class="col-12">
                                        <table class="table table-bordered table-striped table-sticky" id="tblRdDesignData@(itemName)">
                                            <thead>
                                                <tr>
                                                    <th>客戶部番</th>
                                                    <th>客戶設計圖</th>
                                                    <th>2D研發設計圖</th>
                                                    <th>2D-PDF研發設計圖</th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-lg-12 col-md-12 ">
                                <div class="form-group row">
                                    <label class="form-label col-12" for="txtQcRecordFile@(itemName)">量測檔案(EXCEL)</label>
                                    <div class="col-12">
                                        <input type="file" accept=".xlsx" id="fileCurrentFile@(itemName)" name="fileCurrentFile@(itemName)" multiple />
                                        <input type="hidden" id="txtCurrentFile@(itemName)" name="txtCurrentFile@(itemName)" />
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row" @*style="display: none;"*@>
                            <div class="col-lg-12 col-md-12 ">
                                <div class="form-group row">
                                    <label class="form-label col-12" for="txtResolveFile@(itemName)">解析檔案</label>
                                    <div class="col-12">
                                        <input type="file" id="fileResolveFile@(itemName)" name="fileResolveFile@(itemName)" accept=".txt,.csv,.json,.xlsx" multiple />
                                        <input type="hidden" id="txtResolveFile@(itemName)" name="txtResolveFile@(itemName)" />
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="qc-file-info" @*style="display: none;"*@>
                            <div class="check-all">
                                <input type="checkbox" id="cbxSelectAll@(itemName)" /> <label for="cbxSelectAll@(itemName)" style="margin-right: 10px;">全選</label>
                                <select style="width: 50%;" id="cboQcClassId@(itemName)" class="form-control"></select>
                                <select style="width: 50%;" id="cboSelectAllMachineNumber@(itemName)" class="form-control"></select>
                            </div>
                            <div class="qc-file-body">
                            </div>
                            <div class="qc-file-footer">
                                <a class="btn-remove-resolve" style="margin-right: 10px;" href="javascript:RemoveResolveFile@(itemName)();"><i class="fas fa-trash-alt"> 刪除暫存</i></a>
                                <a class="btn-resolve" href="javascript:ResolveFile@(itemName)();"><i class="fas fa-file-search"> 解析檔案</i></a>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-lg-12 col-md-12 ">
                                <div class="form-group row">
                                    <label class="form-label col-12" for="txtQcRecordFile@(itemName)">其他檔案</label>
                                    <div class="col-12">
                                        <input type="file" @*accept=".alx,.aly,.png"*@ id="fileQcRecordFile@(itemName)" name="fileQcRecordFile@(itemName)" multiple />
                                        <input type="hidden" id="txtQcRecordFile@(itemName)" name="txtQcRecordFile@(itemName)" />
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-lg-12 col-md-12 ">
                                <div class="form-group row">
                                    <label class="form-label col-12" for="cboQcRecordFile@(itemName)">其它檔案<code>(共夾上傳方式)</code><span class="text-danger"></span></label>
                                    <div class="col-12">
                                        <div style="display: flex;" class="btn-group btn-group-inv@(itemName)">
                                            <select id="cboQcRecordFile@(itemName)" name="cboQcRecordFile@(itemName)" class="form-control"></select>
                                            <a class="btn btn-success pop-view" href="javascript: PopViewLocalFile@(itemName)('QcRecordFile', 'Y');"><i class="fal fa-search"></i></a>
                                            <a class="btn pop-view" style="background-color: #ef3f5f !IMPORTANT;" href="javascript: RemoveQcRecordFile@(itemName)();"><i style="color: white;" class="fas fa-eraser"></i></a>
                                        </div>
                                        <dl id="QcRecordFileHelp@(itemName)" class="help-block qc-help">
                                            <dt>檔案預覽</dt>
                                            <dd style="display: none;" id="desQcRecordFile@(itemName)" class="absolute-path"></dd>
                                            <dd id="desQcRecordFilePreview@(itemName)" class="cad-preview"></dd>
                                        </dl>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-lg-12 col-md-12 ">
                                <div class="form-group row">
                                    <label class="form-label col-12" for="txtRemark@(itemName)">備註</label>
                                    <div class="col-12">
                                        <textarea class="form-control" id="txtRemark@(itemName)" name="txtRemark@(itemName)" rows="2"
                                                  placeholder="請輸入備註"
                                                  data-msg-required="請輸入備註"
                                                  data-msg-maxlength="必須少於 50 個字元" maxlength="50"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </fieldset>
                </form>
            </div>
            <div class="card-footer text-center text-lg-right">
                <button type="button" class="btn btn-success" onclick="Save@(itemName)()"><i class="fas fa-save"></i>儲存</button>
            </div>
        </div>
    </div>
</div>

<!--其他分頁-->
<div class="advanced-block">
    <div class="row">
        <div class="col-12">
            <ul class="nav flag-tabs nav-fill" role="tablist">
                <li class="flag-item">
                    <a id="aQcDataDetail@(itemName)" class="flag-link  active" data-toggle="tab" href="#tabQcDataDetail">
                        <i class="fas fa-sliders-h"></i> 設定量測記錄詳細資料
                    </a>
                </li>
                <li class="flag-item">
                    <a id="aQcFileManagement@(itemName)" class="flag-link" data-toggle="tab" href="#tabQcFileManagement">
                        <i class="fas fa-cogs"></i> 單據檔案管理
                    </a>
                </li>
            </ul>
        </div>
    </div>
    <div class="tab-content">
        <div class="tab-pane active" id="tabQcDataDetail">
            @Html.Partial("QcDataDetail")
        </div>
        <div class="tab-pane" id="tabQcFileManagement">
            @Html.Partial("QcFileManagement")
        </div>
    </div>
</div>

<!--選擇列印機台-->
<div class="modal fade" id="modalPrint@(itemName)">
    <div class="modal-dialog modal-lg" style="padding-top:7%;">
        <div class="modal-content working-content" style="min-width:350px;">
            <input type="hidden" id="txtPrintQcRecordId@(itemName)" />
            <div class="modal-header" style="align-items: center;">
                <h5 class="modal-title">
                    列印標籤條碼
                    <span class="sub-title">製令: <span class="sub-text" id="desPrintWoErpFullNo@(itemName)"></span></span>
                    <span class="sub-title">品號: <span class="sub-text" id="desPrintMtlItemNo@(itemName)"></span></span>
                    <span class="sub-title">品名: <span class="sub-text" id="desPrintMtlItemName@(itemName)"></span></span>
                </h5>
                <button class="close" data-dismiss="modal" type="button">
                    <span aria-hidden="true"><i class="fas fa-times"></i></span>
                </button>
            </div>
            <div class="modal-body">
                <select class="form-control" id="cboLabelPrintMachine@(itemName)"></select>
            </div>
            <div class="modal-footer">
                <a id="aPrint@(itemName)" class="btn btn-success" href="javascript: Print@(itemName)();"><i class="fas fa-paper-plane"></i>列印</a>
            </div>
        </div>
    </div>
</div>

<!--批量列印-->
<div class="modal fade" id="modalPrint2@(itemName)">
    <div class="modal-dialog modal-xl" style="padding-top:7%;">
        <div class="modal-content working-content" style="min-width:350px;">
            <div class="modal-header" style="align-items: center;">
                <h5 class="modal-title">
                    列印標籤條碼
                    
                </h5>
                <button class="close" data-dismiss="modal" type="button">
                    <span aria-hidden="true"><i class="fas fa-times"></i></span>
                </button>
            </div>
            <div class="modal-body">
                <select class="form-control" id="cboLabelPrintMachine2@(itemName)"></select>
                <div class="row">
                    <div class="col-12">
                        <div class="table-custom">
                            <table class="table table-bordered table-striped table-sticky" id="tblLabData@(itemName)">
                                <thead>
                                    <tr>
                                        <th scope="col" style="width: 100px;">張數</th>
                                        <th scope="col" style="width: 150px;">日期</th>
                                        <th scope="col" style="max-width: 100px;">量測單</th>
                                        <th scope="col" style="max-width: 100px;">製令</th>
                                        <th scope="col" style="max-width: 100px;">品號</th>
                                        <th scope="col" style="max-width: 100px;">品名</th>

                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <a id="aPrint2@(itemName)" class="btn btn-success" href="javascript: LotPrint@(itemName)();"><i class="fas fa-paper-plane"></i>列印</a>
            </div>
        </div>
    </div>
</div>

<!--收貨確認Modal-->
<div class="modal fade" @*data-backdrop="static" data-keyboard="false"*@ id="modalReceiptGoods@(itemName)">
    <div class="modal-dialog modal-lg" style="padding-top:7%;">
        <div class="modal-content working-content" style="min-width:350px;">
            <input type="hidden" id="txtPrintQcRecordId@(itemName)" />
            <div class="modal-header" style="align-items: center;">
                <h5 class="modal-title">
                    確認收貨
                    <span class="sub-title">製令: <span class="sub-text" id="desGoodsWoErpFullNo@(itemName)"></span></span>
                    <span class="sub-title">品號: <span class="sub-text" id="desGoodsMtlItemNo@(itemName)"></span></span>
                    <span class="sub-title">品名: <span class="sub-text" id="desGoodsMtlItemName@(itemName)"></span></span>
                </h5>
                <button class="close" data-dismiss="modal" type="button">
                    <span aria-hidden="true"><i class="fas fa-times"></i></span>
                </button>
            </div>
            <div class="modal-body">
                <div class="confirm-item">
                    <a class="confirm-btn" href="javascript: CheckGoods@(itemName)('C');">確認收貨</a>
                    <a class="reconfirm-btn" href="javascript: CheckGoods@(itemName)('F');">駁回單據</a>
                    <a class="start-btn" href="javascript: CheckGoods@(itemName)('S');">開始量測</a>
                </div>
                <div class="confirm-remark">
                    <textarea id="txtDisallowance@(itemName)" class="form-control" placeholder="請輸入駁回原因..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                @*<button type="button" class="btn btn-secondary" onclick="Return@(itemName)()"><i class="fas fa-undo"></i>返回</button>*@
            </div>
        </div>
    </div>
</div>

<!--匯入EXCEL-->
<div class="modal fade" id="modalImportExcel@(itemName)" data-keyboard="false" data-backdrop="static">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title expand-modal-title">匯入EXCEL</h5>
                <button class="close" data-dismiss="modal" type="button">
                    <span aria-hidden="true"><i class="fas fa-times"></i></span>
                </button>
            </div>
            <div class="modal-body">
                <form autocomplete="off" id="importForm@(itemName)">
                    <div class="expand-container bom-expand">
                        <div class="form-item">
                            <label>上傳EXCEL檔案</label>
                            <input type="file" accept=".xlsx" id="fileExcelFile@(itemName)" name="fileExcelFile@(itemName)" multiple />
                            <input type="hidden" id="txtExcelFile@(itemName)" name="txtExcelFile@(itemName)" />
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <a class="btn btn-success" style="font-weight: 600;" href="javascript: ImportExcel@(itemName)();"><i class="fas fa-save"></i> 批次新增量測單據</a>
            </div>
        </div>
    </div>
</div>

<div class="loadingdiv" id="loading" style="display: none">
    <img src="~/assets/images/loading.gif" style="width: 75px;" />
</div>

@Html.Partial("ViewQcNotice")
@Html.Partial("../Inventory/ViewManufactureOrder")
@Html.Partial("QcMeasurementPlanning")
@Html.Partial("ViewLocalFile")

<script src="@Url.Content("~/Scripts/dhtmlx/spreadsheet.commercial/4.3.0/spreadsheet.min.js")"></script>

@Html.Resource("js",
    @<script>
        let objPage@(itemName) = {
            "pageIndex": 0,
            "pageSize": 10
        };
        let objForm@(itemName) = "#editForm@(itemName)";

        let defaultFileId@(itemName);
        let checkQcMeasureData@(itemName);
        let modeId@(itemName);

        let resolveFileJson@(itemName) =
        {
            resolveFileInfo: []
        };

        let qmmDetailJson@(itemName) =
        {
            qmmDetailInfo: []
        };
        let qcRecordIdJson@(itemName) =
        {
            qcRecordIds: []
        };

        $(document).ready(function () {
            Suites.DateDropper("#txtStartDateQ@(itemName), #txtEndDateQ@(itemName)");
            let currentDate = new Date();
            Suites.SetDateDropper("#txtEndDateQ@(itemName)", currentDate);
            currentDate.setDate(currentDate.getDate() - 90);
            Suites.SetDateDropper("#txtStartDateQ@(itemName)", currentDate);

            if ("@QcRecordId") {
                $("#txtQcRecordIdQ@(itemName)").val("@QcRecordId");
                $("#cboCheckQcMeasureDataQ@(itemName)").val("");
                $("#txtStartDateQ@(itemName)").val("1999-01-01");
                Edit@(itemName)("@QcRecordId", "P");
            }

            Query@(itemName)();

            ResetQmmDetailJson@(itemName)();

            resolveFileJson@(itemName).resolveFileInfo = [];

            if (!isMobile) {
                $("#cboUserIdQ@(itemName), #cboMoProcessId@(itemName), #cboQcTypeId@(itemName), #cboQcTypeQ@(itemName), #cboModeIdQ@(itemName), #cboLabelPrintMachine@(itemName), #cboCheckQcMeasureDataQ@(itemName)").select2({
                    dropdownAutoWidth: true,
                    width: "100%"
                });
            }

            ComboBoxs.Default("#cboQcTypeQ@(itemName)", "@Url.Action("GetType", "BasicInformation")", { "TypeSchema": "QcItem.QcType" }, "", "NA", "", "TypeName", "TypeNo");

            ComboBoxs.Default("#cboUserIdQ@(itemName)", "@Url.Action("GetUser", "BasicInformation")", { "CompanyId": "@Session["CompanyId"]", "Status": "A" }, "", "ALL", "", "UserWithNo", "UserId");

            ComboBoxs.Default("#cboModeIdQ@(itemName)", "@Url.Action("GetProdMode", "MesBasicInformation")", {}, "", "NA", "", "txtProdModeWithText", "ModeId");

            ComboBoxs.Default("#cboLabelPrintMachine@(itemName)", "@Url.Action("GetLabelPrintMachine", "ProductionHistory")", {}, "", "NA", "", "LabelPrintName", "LabelPrintNo");
            ComboBoxs.Default("#cboLabelPrintMachine2@(itemName)", "@Url.Action("GetLabelPrintMachine", "ProductionHistory")", {}, "", "CHOOSE", "請選擇標籤機", "LabelPrintName", "LabelPrintNo");
        

            ComboBoxs.Default("#cboCheckQcMeasureDataQ@(itemName)", "@Url.Action("GetStatus", "BasicInformation")", { "StatusSchema": "QcRecord.CheckQcMeasureData" }, "", "NA", "", "StatusName", "StatusNo");

            @*$("#txtWoErpFullNoQ@(itemName), #txtQcNoticeNoQ@(itemName), #txtMtlItemNoQ@(itemName), #txtMtlItemNameQ@(itemName), #txtMoIdQ@(itemName)").keydown(function (event) {
                if (event.keyCode == 13) {
                    Query@(itemName)();
                    return false;
                }
            });*@

            $("#txtQcRecordIdQ@(itemName)").keydown(function (event) {
                if (event.keyCode == 13) {
                    GetQcRecordWithId@(itemName)($("#txtQcRecordIdQ@(itemName)").val())
                    return false;
                }
            });

            $("#txtQcNoticeNo@(itemName)").keydown(function (event) {
                if (event.keyCode == 13) {
                    QueryQcNotice@(itemName)();
                    return false;
                }
            });

            $("#txtWoErpFullNo@(itemName)").keydown(function (event) {
                if (event.keyCode == 13) {
                    QueryManufactureOrder@(itemName)();
                    let ModeId = $("#txtModeId@(itemName)").val();
                    ComboBoxs.Default("#cboQcTypeId@(itemName)", "@Url.Action("GetQcType", "QcDataManagement")", { "ModeId": ModeId }, "", "NA", "", "QcTypeName", "QcTypeId");
                    return false;
                }
            });

            $(window).keydown(function (event) {
                if (event.keyCode == 13) {
                    event.preventDefault();
                    return false;
                }
            });

            $("#txtQcNoticeId@(itemName)").change(function () {
                setTimeout(function () {
                    let QcNoticeType = $("#desQcNoticeType@(itemName)").text();
                    if (QcNoticeType == "IPQC") {
                        $(".mo-process-id").show();
                        $("#cboMoProcessId@(itemName)").prop("required", true);

                        let MoId = $("#txtMoId@(itemName)").val();
                        if (parseInt(MoId) >= 0) {
                            ComboBoxs.Default("#cboMoProcessId@(itemName)", "@Url.Action("GetMoProcess", "Production")", { "MoId": MoId }, "", "ALL", "", "ProcessAlias", "MoProcessId");
                        }
                    }
                    else {
                        $(".mo-process-id").hide();
                        $("#cboMoProcessId@(itemName)").prop("required", false);
                    }
                }, 500);
            });

            $("#txtMoId@(itemName)").change(function () {
                setTimeout(function () {
                    let MoId = $("#txtMoId@(itemName)").val();
                    let ModeId = $("#txtModeId@(itemName)").val();
                    if (parseInt(MoId) >= 0) {
                        ComboBoxs.Default("#cboMoProcessId@(itemName)", "@Url.Action("GetMoProcess", "Production")", { "MoId": MoId }, "", "ALL", "", "ProcessAlias", "MoProcessId");
                        ComboBoxs.Default("#cboQcTypeId@(itemName)", "@Url.Action("GetQcType", "QcDataManagement")", { "ModeId": ModeId }, "", "NA", "", "QcTypeName", "QcTypeId");
                    }
                }, 500);
            });

            $("#cboQcTypeId@(itemName)").change(function () {
                let qcTypeId = $(this).val();
                let supportProcessFlag = GetQcTypeSupportProcessFlag@(itemName)(qcTypeId);
                let qcType = $("#cboQcTypeId@(itemName)").find(":selected").text();
                if (supportProcessFlag == "Y") {
                    let MoId = $("#txtMoId@(itemName)").val();
                    $(".mo-process-id").show();
                    ComboBoxs.Default("#cboMoProcessId@(itemName)", "@Url.Action("GetMoProcess", "Production")", { "MoId": MoId }, "", "ALL", "", "ProcessAlias", "MoProcessId");
                }
                else {
                    if (qcType == "全吋檢" || qcType == "成型工程檢") {
                        $("#cboInputType@(itemName)").val("Cavity");
                    }
                    $(".mo-process-id").hide();
                }
            });

            $("#cboSelectAllMachineNumber@(itemName)").change(function () {
                let machineNumber = $(this).val();
                $.each($("input[type='checkbox'][data-file-id]:checked"), function (i) {
                    let fileId = $(this).data("file-id");
                    ComboBoxs.Default(`#cboQmmDetail@(itemName)${fileId}`, "@Url.Action("GetQmmDetail", "QcDataManagement")", {}, "", "NA", "", "MachineName", "MachineNumber");
                    $(`#cboQmmDetail@(itemName)${fileId}`).val(machineNumber);

                    $.each(resolveFileJson@(itemName).resolveFileInfo, function (j, item2) {
                        if (fileId == item2.FileId) {
                            resolveFileJson@(itemName).resolveFileInfo[j]["MachineNumber"] = machineNumber;
                        }
                    });
                });

                $.each(resolveFileJson@(itemName).resolveFileInfo, function (i, item) {
                    resolveFileJson@(itemName).resolveFileInfo[i]["AllMachineNumber"] = $("#cboSelectAllMachineNumber@(itemName)").val();
                });
            });

            $("#txtResolveFile@(itemName)").change(function () {
                ReloadResoloveFileJson@(itemName)();
            });

            $("#cbxSelectAll@(itemName)").off("click").on("click", function () {
                if ($("#cbxSelectAll@(itemName)").is(":checked")) {
                    $("input[type='checkbox'][data-file-id][data-type='ResolveFile']").not(":disabled").prop("checked", true);
                } else {
                    $("input[type='checkbox'][data-file-id][data-type='ResolveFile']").not(":disabled").prop("checked", false);
                }
            });

            $("#cboQcClassId@(itemName)").change(function (i, item) {
                $.each(resolveFileJson@(itemName).resolveFileInfo, function (i, item) {
                    resolveFileJson@(itemName).resolveFileInfo[i]["QcClassId"] = $("#cboQcClassId@(itemName)").val();
                });
            });

            $("#aQcFileManagement@(itemName)").click(function () {
                ExpandQcFileManagement();
            });
        });

        function ChangeMachineNumber@(itemName)(e) {
            let machineNumber = $(e).val();
            let fileId = $(e).data("file-id");
            $.each(resolveFileJson@(itemName).resolveFileInfo, function (i, item) {
                if (item.FileId == fileId) {
                    resolveFileJson@(itemName).resolveFileInfo[i]["MachineNumber"] = machineNumber;
                    return false;
                }
            });
        }

        @*function SelectQmmDetail@(itemName)(e) {
            let val = $(e).val();
            $.each($("input[type='checkbox'][data-file-id]:checked"), function (i) {
                let fileId = $(this).data("file-id");
                ComboBoxs.Default(`#cboQmmDetail@(itemName)${fileId}`, "@Url.Action("GetQmmDetail", "QcDataManagement")", {}, "", "NA", "", "MachineName", "MachineNumber");
                $(`#cboQmmDetail@(itemName)${fileId}`).val(val);
            });
        }*@

        function Query@(itemName)() {
            objPage@(itemName).pageIndex = 0;
            InitData@(itemName)(objPage@(itemName));

            $("#modalQuery@(itemName)").modal("hide");
        }

        function InitData@(itemName)(objPage) {
            let innerHtml = '';
            let pageCount = 0;
            let targetUrl = "@Url.Action("GetQcRecord", "QcDataManagement")";

            let postData = {
                "OrderBy": "",
                "PageIndex": (objPage.pageIndex + 1),
                "PageSize": objPage.pageSize,
                "WoErpFullNo": $("#txtWoErpFullNoQ@(itemName)").val(),
                "MtlItemNo": $("#txtMtlItemNoQ@(itemName)").val(),
                "MtlItemName": $("#txtMtlItemNameQ@(itemName)").val(),
                "QcType": $("#cboQcTypeQ@(itemName)").val(),
                "CheckQcMeasureData": $("#cboCheckQcMeasureDataQ@(itemName)").val(),
                "UserId": $("#cboUserIdQ@(itemName)").val(),
                "StartDate": $("#txtStartDateQ@(itemName)").val(),
                "EndDate": $("#txtEndDateQ@(itemName)").val(),
                "MoId": $("#txtMoIdQ@(itemName)").val(),
                "QcRecordId": $("#txtQcRecordIdQ@(itemName)").val(),
                "ModeId": $("#cboModeIdQ@(itemName)").val()
            };

            let data = DataAccess.Get(targetUrl, postData, false);

            if (data.status == "success") {
                pageCount = data.result.length > 0 ? parseInt(data.result[0]["TotalCount"]) : 0;
                if (pageCount > 0) {
                    objPage = PageCaculate(pageCount, objPage);
                    $.each(data.result, function (i, item) {
                        defaultFileId@(itemName) = item.DefaultFileId;
                        let _row = (objPage.pageSize * objPage.pageIndex + (i + 1)) + ".";
                        innerHtml += `<tr>
                                        <td ${item.UrgentFlag == `Y` ? `class="urgent"` : ``} style="max-width: 75px;">${_row}</td>
                                        <td class="text-center">
                                            <label class="control control-solid control-solid-info control--checkbox">
                                                <input type="checkbox" name="lotPrintLabel"  data-qcrecord-id="${item.QcRecordId}" value="${item.QcRecordId}" data-wofullno = "${item.WoErpFullNo}" data-mtlitemno = "${item.MtlItemNo}"data-mtlitemname = "${item.MtlItemName}"/>
                                                <span class="control__indicator"></span>
                                            </label>
                                        </td>
                                        <td class="text-center ${item.UrgentFlag == `Y` ? `urgent` : ``}" style="min-width: 75px;">
                                            <label class="control control-solid control-solid-info control--checkbox">
                                                <input type="checkbox" data-qc-record-id="${item.QcRecordId}" onclick="Urgent@(itemName)(${item.QcRecordId})" value="${item.QcRecordId}" ${item.UrgentFlag == `Y` ? `checked` : ``} />
                                                <span class="control__indicator"></span>
                                            </label>
                                        </td>
                                        <td class="text-center active-content" ${item.UrgentFlag == `Y` ? `urgent` : ``}"">
                                          <div class="btn-group mb-4 show" style="margin-bottom: 0 !important; position: static;">
                                            <button type="button" class="btn btn-primary dropdown-toggle" data-so-id="${item.QcRecordId}" style="padding-top: 0; padding-bottom: 0;">動作</button>
                                            <div class="dropdown-menu btn-text-left-block" data-so-id="${item.QcRecordId}" style="overflow-y: auto; z-index: 999; max-height: 150px;">
                                            <a class="dropdown-item btn-text-left auth-update" href="javascript:Edit@(itemName)('${item.QcRecordId}', '${item.CheckQcMeasureData}', '${item.ModeId}');"><i class="fas fa-edit"></i>修改</a>
                                            <a class="dropdown-item btn-text-left auth-delete" href="javascript:Delete@(itemName)('${item.QcRecordId}');"><i class="fas fa-file-times"></i>刪除</a>                                          
                                            <a class="dropdown-item btn-text-left auth-delete" href="javascript:Void@(itemName)('${item.QcRecordId}');"><i class="fas fa-trash-alt"></i>作廢</a>
                                            @*<a class="active-link auth-update" href="javascript:ExportExcel@(itemName)('${item.QcRecordId}', '${item.FileId}', '${item.DefaultFileId}');"><i class="fas fa-file-excel"></i> 匯出報表</a>*@
                                            <a class="dropdown-item btn-text-left auth-planning" href="javascript:MeasurementPlanning@(itemName)('${item.QcRecordId}', '${item.MtlItemName}', '${item.MeasurementPlanning}');"><i class="fas fa-clock"></i> 量測排程</a>
                                            <a class="dropdown-item btn-text-left auth-update" href="javascript:PopModalPrint@(itemName)('${item.QcRecordId}', '${item.WoErpFullNo}(${item.WoSeq})', '${item.MtlItemNo}', '${item.MtlItemName}');"><i class="fas fa-print"></i> 列印單據</a>
                                            </div>
                                          </div>
                                        </td>
                                        <td class="text-primary ${item.UrgentFlag == `Y` ? `urgent` : ``}" style="min-width: 100px;">
                                          <a href="@Url.Action("IframeMeasurementRecord", "MesReport")?QcRecordId=${item.QcRecordId}" target="_blank">
                                          ${item.QcRecordId}
                                          </a>
                                        </td>
                                        <td class="text-primary ${item.UrgentFlag == `Y` ? `urgent` : ``}" style="max-width: 250px; min-width: 180px;">
                         
                                            <a href="@Url.Action("IframeMeasurementRecord", "MesReport")?WoErpFullNo=${item.WoErpFullNo}&WoSeq=${item.WoSeq}" target="_blank">
                                          ${item.WoErpFullNo}(${item.WoSeq})
                                          </a>
                                        </td>
                                        <td class="ellipsis ${item.UrgentFlag == `Y` ? `urgent` : ``}" data-toggle="tooltip" title="${item.MoId}" style="min-width: 100px;">${item.MoId}</td>
                                        <td class="ellipsis ${item.UrgentFlag == `Y` ? `urgent` : ``}" data-toggle="tooltip" title="${item.MtlItemNo}" style="max-width: 200px; min-width: 135px;">${item.MtlItemNo}</td>
                                        <td class="ellipsis ${item.UrgentFlag == `Y` ? `urgent` : ``}" data-toggle="tooltip" title="${item.MtlItemName}" style="max-width: 200px;">${item.MtlItemName}</td>
                                        <td class="ellipsis ${item.UrgentFlag == `Y` ? `urgent` : ``}" data-toggle="tooltip" title="${item.QcTypeName}(${item.QcTypeNo})" style="max-width: 200px; min-width: 100px;">${item.QcTypeName}<code>(${item.QcTypeNo})</code></td>
                                        <td class="ellipsis ${item.UrgentFlag == `Y` ? `urgent` : ``}" data-toggle="tooltip" title="${item.ProcessAlias}" style="max-width: 200px; min-width: 135px;">${item.ProcessAlias}</td>
                                        <td class="ellipsis ${item.UrgentFlag == `Y` ? `urgent` : ``}" data-toggle="tooltip" title="${item.CreateDate}" style="max-width: 200px;">${item.CreateDate}</td>
                                        ${JudgeCheckQcMeasureData@(itemName)(`${item.CheckQcMeasureData}`, `${item.CheckQcMeasureDataName}`)}
                                        ${JudgeMeasurementPlanning@(itemName)(`${item.MeasurementPlanning}`)}
                                        <td class="ellipsis ${item.UrgentFlag == `Y` ? `urgent` : ``}" data-toggle="tooltip" title="${item.UserNo}${item.UserName}" style="min-width: 150px;"><i class="fas fa-user"></i>&nbsp;<code>${item.UserNo}</code>&nbsp;${item.UserName}</td>
                                        <td class="ellipsis ${item.UrgentFlag == `Y` ? `urgent` : ``}" data-toggle="tooltip" title="${item.Remark}" style="max-width: 200px;">${item.Remark}</td>

                                      </tr>`;

                        function JudgeCheckQcMeasureData@(itemName)(checkQcMeasureData, checkQcMeasureDataName) {
                            let innerHtml = '';
                            if (checkQcMeasureData == "Y") {
                                innerHtml += `<td class="ellipsis ${item.UrgentFlag == `Y` ? `urgent` : ``}" data-toggle="tooltip" title="${checkQcMeasureDataName}" style="max-width: 150;"><i style="color: #338b33; font-weight: 600;" class="fad fa-badge-check"></i> ${checkQcMeasureDataName}</td>`;
                            }
                            else if (checkQcMeasureData == "P") {
                                innerHtml += `<td class="ellipsis ${item.UrgentFlag == `Y` ? `urgent` : ``}" data-toggle="tooltip" title="${checkQcMeasureDataName}" style="max-width: 150;"><i style="color: #4b66c7; font-weight: 600;" class="fas fa-exclamation-circle"></i> ${checkQcMeasureDataName}</td>`;
                            }
                            else if (checkQcMeasureData == "N") {
                                innerHtml += `<td class="ellipsis ${item.UrgentFlag == `Y` ? `urgent` : ``}" data-toggle="tooltip" title="${checkQcMeasureDataName}" style="max-width: 150;"><i style="color: #d15f84; font-weight: 600;" class="fas fa-exclamation-circle"></i> ${checkQcMeasureDataName}</td>`;
                            }
                            else if (checkQcMeasureData == "A") {
                                innerHtml += `<td class="ellipsis ${item.UrgentFlag == `Y` ? `urgent` : ``}" data-toggle="tooltip" title="${checkQcMeasureDataName}" style="max-width: 150;"><i style="color: #3e60c3; font-weight: 600;" class="fas fa-paper-plane"></i> ${checkQcMeasureDataName}</td>`;
                            }
                            else if (checkQcMeasureData == "C") {
                                innerHtml += `<td class="ellipsis ${item.UrgentFlag == `Y` ? `urgent` : ``}" data-toggle="tooltip" title="${checkQcMeasureDataName}" style="max-width: 150;"><i style="color: #52974e; font-weight: 600;" class="fas fa-user-check"></i> ${checkQcMeasureDataName}</td>`;
                            }
                            else if (checkQcMeasureData == "F") {
                                innerHtml += `<td class="ellipsis ${item.UrgentFlag == `Y` ? `urgent` : ``}" data-toggle="tooltip" title="${checkQcMeasureDataName}" style="max-width: 150;"><i style="color: #82a7ab; font-weight: 600;" class="fas fa-exclamation-triangle"></i> ${checkQcMeasureDataName}</td>`;
                            }
                            else if (checkQcMeasureData == "S") {
                                innerHtml += `<td class="ellipsis ${item.UrgentFlag == `Y` ? `urgent` : ``}" data-toggle="tooltip" title="${checkQcMeasureDataName}" style="max-width: 150;"><i style="color: #c56ab5; font-weight: 600;" class="fas fa-play-circle"></i> ${checkQcMeasureDataName}</td>`;
                            }
                            else if (checkQcMeasureData == "V") {
                                innerHtml += `<td class="ellipsis ${item.UrgentFlag == `Y` ? `urgent` : ``}" data-toggle="tooltip" title="${checkQcMeasureDataName}" style="max-width: 150;"><i style="color: #c56ab5; font-weight: 600;" class="fas fa-trash-alt"></i> ${checkQcMeasureDataName}</td>`;
                            }
                            else {
                                innerHtml += `<td class="ellipsis ${item.UrgentFlag == `Y` ? `urgent` : ``}" data-toggle="tooltip" title="${checkQcMeasureDataName}" style="max-width: 150;"> ${checkQcMeasureDataName}</td>`;
                            }

                            return innerHtml;
                        }

                        function JudgeSystemStatus@(itemName)(qcStatus, statusName) {
                            let innerHtml = '';
                            if (qcStatus == "P") {
                                innerHtml += `<td class="ellipsis ${item.UrgentFlag == `Y` ? `urgent` : ``}" data-toggle="tooltip" title="${item.statusName}" style="max-width: 150;"><i style="color: green; font-weight: 600;" class="fad fa-badge-check"></i> ${statusName}</td>`;
                            }
                            else if (qcStatus == "F") {
                                innerHtml += `<td class="ellipsis ${item.UrgentFlag == `Y` ? `urgent` : ``}" data-toggle="tooltip" title="${item.statusName}" style="max-width: 150;"><i style="color: red; font-weight: 600;" class="fas fa-exclamation-triangle"></i> ${statusName}</td>`;
                            }
                            else if (qcStatus == "M") {
                                innerHtml += `<td class="ellipsis ${item.UrgentFlag == `Y` ? `urgent` : ``}" data-toggle="tooltip" title="${statusName}" style="max-width: 150px;"><i style="color: brown;" class="fad fa-flag-checkered"></i> ${statusName}</td>`;
                            }
                            else if (qcStatus == "R") {
                                innerHtml += `<td class="ellipsis ${item.UrgentFlag == `Y` ? `urgent` : ``}" data-toggle="tooltip" title="${statusName}" style="max-width: 150px;"><i style="color: cornflowerblue;" class="fas fa-user-edit"></i> ${statusName}</td>`;
                            }
                            else if (qcStatus == "A") {
                                innerHtml += `<td class="ellipsis ${item.UrgentFlag == `Y` ? `urgent` : ``}" data-toggle="tooltip" title="${statusName}" style="max-width: 150px;"><i style="color: cornflowerblue;" class="fas fa-paper-plane"></i> ${statusName}</td>`;
                            }
                            else {
                                innerHtml += `<td class="ellipsis ${item.UrgentFlag == `Y` ? `urgent` : ``}" data-toggle="tooltip" title="${statusName}" style="max-width: 150px;">${statusName}</td>`;
                            }
                            return innerHtml;
                        }

                        function JudgeMeasurementPlanning@(itemName)(measurementPlanning) {
                            let innerHtml = '';
                            let planningStatus = "";
                            switch (measurementPlanning) {
                                case "Y":
                                    planningStatus = "已安排";
                                    innerHtml += `<td class="ellipsis ${item.UrgentFlag == `Y` ? `urgent` : ``}" data-toggle="tooltip" title="${planningStatus}" style="max-width: 150;"><i style="color: #aacdaa;" class="fas fa-clock"></i> ${planningStatus}</td>`;
                                    break;
                                case "N":
                                    planningStatus = "未安排";
                                    innerHtml += `<td class="ellipsis ${item.UrgentFlag == `Y` ? `urgent` : ``}" data-toggle="tooltip" title="${planningStatus}" style="max-width: 150;"><i style="color: #f55050;" class="fas fa-exclamation-circle"></i> ${planningStatus}</td>`;
                                    break
                                default:
                                    innerHtml += `<td class="ellipsis ${item.UrgentFlag == `Y` ? `urgent` : ``}" data-toggle="tooltip" title="${planningStatus}" style="max-width: 150;">${planningStatus}</td>`;
                                    break;
                            }

                            return innerHtml;
                        }
                    });
                }
                else {
                    innerHtml += `<tr>
                                    <td class="text-center" colspan="15" style="background-color: #fff3cd;">
                                        <i class="fal fa-exclamation-circle"></i>&nbsp;目前尚無資料。
                                    </td>
                                  </tr>`;
                }
            }
            else {
                alert(data.msg, "alert", 0);
            }

            $("#tblData@(itemName) tbody").html(innerHtml);
            TableComponentInit();
            Pager("#page@(itemName)", pageCount, objPage, InitData@(itemName));


            $(".dropdown-toggle").off("click").on("click", function () {
                let soId = $(this).data("so-id");

                if ($(`.dropdown-menu[data-so-id='${soId}']`).hasClass("show")) {
                    $(".dropdown-menu").removeClass("show");
                } else {
                    $(".dropdown-menu").removeClass("show");

                    $(`.dropdown-menu[data-so-id='${soId}']`).addClass("show");
                    $(`.dropdown-menu[data-so-id='${soId}']`).css({
                        top: `${$(this).position().top + $(this).height() + 5}px`,
                        left: `${$(this).position().left - $(this).width() + 38}px`
                    });
                }
            });

            $("body").off("click").on("click", function (e) {
                if ($(".dropdown-menu").hasClass("show")) {
                    if (!$(e.target).hasClass("dropdown-toggle")
                        && !$(e.target).parents().hasClass("dropdown-toggle")) {
                        $(".dropdown-menu").removeClass("show");
                    }
                }
            });

            $("#cbxSelectAll2@(itemName)").off("click").on("click", function () {
                if ($("#cbxSelectAll2@(itemName)").is(":checked")) {
                    $("input[type='checkbox'][name='lotPrintLabel']").not(":disabled").prop("checked", true);
                } else {                      
                    $("input[type='checkbox'][name='lotPrintLabel']").not(":disabled").prop("checked", false);
                }
            });
        }

        function Edit@(itemName)(qcRecordId, checkQcMeasureData, modeId) {
            $("#QcRecordId").val(qcRecordId ? qcRecordId : 0);
            Switch("#editData@(itemName), .unit-block", "#listData@(itemName)");

            $("#txtWoErpFullNo@(itemName)").prop("readonly", false);
            $("#txtQcNoticeNo@(itemName)").prop("readonly", false);
            $(".input-group-append").show();

            $("#txtCurrentFile@(itemName)").val("");
            $("#txtQcRecordFile@(itemName)").val("");
            $("#txtResolveFile@(itemName)").val("");
            $("#txtWoErpFullNo@(itemName)").val("");
            $("#txtWoErpFullNo@(itemName)").val("");
            $("#txtRemark@(itemName)").val("");

            resolveFileJson@(itemName).resolveFileInfo = [];

            uploadFileJson@(itemName).uploadFileInfo = [];
            $("#QcRecordFileHelp@(itemName)").hide();

            $(".qc-file-body").empty();

            $("#txtMoId@(itemName)").val("");
            $("#txtMoId@(itemName)").siblings(".help-block").hide();

            $("#txtQcNoticeId@(itemName)").val("");
            $("#txtQcNoticeId@(itemName)").siblings(".help-block").hide();

            $(".advanced-block").hide();

            $("#cboMoProcessId@(itemName)").val("");
            $(".mo-process-id").hide();

            $("#cboQcTypeId@(itemName)").empty();

            //ComboBoxs.Default("#cboQcTypeId@(itemName)", "@Url.Action("GetType", "BasicInformation")", { "TypeSchema": "QcItem.QcType" }, "", "NA", "", "TypeName", "TypeNo");

            if (!isMobile) {
                $("#cboSelectAllMachineNumber@(itemName)").select2({
                    width: "25%"
                });
                $("#cboQcClassId@(itemName)").select2({
                    width: "25%"
                });
                $("#cboQcRecordFile@(itemName)").select2({
                    width: "100%"
                });
            }
            ComboBoxs.Default("#cboSelectAllMachineNumber@(itemName)", "@Url.Action("GetQmmDetail", "QcDataManagement")", { }, "", "NA", "", "MachineName", "MachineNumber");

            ComboBoxs.Default("#cboQcClassId@(itemName)", "@Url.Action("GetQcClass", "QcDataManagement")", {}, "", "NA", "", "QcClassFullNo", "QcClassId");

            ComboBoxs.Default("#cboQcRecordFile@(itemName)", "@Url.Action("GetUploadWhitelist", "BasicInformation")", { "ListNo": "QC" }, "", "NA", "", "FolderPath", "ListId");

            $("#tblRdDesignData@(itemName) tbody").empty();

            checkQcMeasureData@(itemName) = "N";

            $("#aQcDataDetail@(itemName)").click();

            $("#cboQcRecordFile@(itemName)").change(function () {
                PopViewLocalFile@(itemName)("QcRecordFile", "Y");
            });

            if (qcRecordId > 0) {
                checkQcMeasureData@(itemName) = checkQcMeasureData
                $("#txtWoErpFullNo@(itemName)").prop("readonly", true);
                $("#txtQcNoticeNo@(itemName)").prop("readonly", true);
                $(".input-group-append").hide();
                let targetUrl = "@Url.Action("GetQcRecord", "QcDataManagement")";
                let postData = {
                    "QcRecordId": qcRecordId
                };

                let data = DataAccess.Get(targetUrl, postData, false);

                if (data.status == "success") {
                    $.each(data.result, function (i, item) {

                        if (item.CheckQcMeasureData == "A") {
                            //$("#modalReceiptGoods@(itemName)").modal("show");
                            $("#txtDisallowance@(itemName)").val("");
                            $("#desGoodsWoErpFullNo@(itemName)").html(item.WoErpFullNo + "(" + item.WoSeq + ")");
                            $("#desGoodsMtlItemNo@(itemName)").html(item.MtlItemNo);
                            $("#desGoodsMtlItemName@(itemName)").html(item.MtlItemName);
                        }

                        ComboBoxs.Default("#cboQcTypeId@(itemName)", "@Url.Action("GetQcType", "QcDataManagement")", { "ModeId": modeId }, "", "NA", "", "QcTypeName", "QcTypeId");

                        defaultFileId@(itemName) = item.DefaultFileId;
                        ExpandQcDataDetail(qcRecordId, item.FileId, item.MoId, item.WoErpFullNo + "(" + item.WoSeq + ")", item.QcTypeNo, item.InputType, item.MoProcessId, item.DefaultFileId, item.CheckQcMeasureData);
                        if (item.QcNoticeId != null) {
                            $("#txtQcNoticeId@(itemName)").siblings(".help-block").show();
                            $("#txtQcNoticeId@(itemName)").val(item.QcNoticeId);
                            $("#txtQcNoticeNo@(itemName)").val(item.QcNoticeNo);
                            $("#desQcNoticeQty@(itemName)").html(item.QcNoticeQty);
                        }
                        $("#cboQcTypeId@(itemName)").val(item.QcTypeId);
                        $("#txtMoId@(itemName)").siblings(".help-block").show();
                        $("#txtMoId@(itemName)").val(item.MoId);
                        $("#txtWoErpFullNo@(itemName)").val(item.WoErpFullNo + "(" + item.WoSeq + ")");
                        $("#desMtlItemNo@(itemName)").html(item.MtlItemNo);
                        $("#desMtlItemName@(itemName)").html(item.MtlItemName);
                        $("#cboMoProcessId@(itemName)").val(item.MoProcessId);
                        $("#txtCurrentFile@(itemName)").val(item.FileId != null && item.FileId != -1 ? item.FileId : "");
                        $("#cboInputType@(itemName)").val(item.InputType);
                        $("#txtRemark@(itemName)").val(item.Remark);
                        $("#cboSupportAqFlag@(itemName)").val(item.QcSupportAqFlag);

                        if (item.SupportProcessFlag == "Y") {
                            $(".mo-process-id").show();
                            ComboBoxs.Default("#cboMoProcessId@(itemName)", "@Url.Action("GetMoProcess", "Production")", { "MoId": item.MoId }, item.MoProcessId, "ALL", "", "ProcessAlias", "MoProcessId");
                        }
                        else {
                            $(".mo-process-id").hide();
                        }

                        if (item.QcRecordFile != null) {
                            let qcRecordFileJson = JSON.parse(item.QcRecordFile);
                            let qcRecordFileList = [];
                            $.each(qcRecordFileJson.data, function (j, item2) {
                                qcRecordFileList.push(item2.FileId);
                            });
                            $("#txtQcRecordFile@(itemName)").val(qcRecordFileList.toString());
                        }

                        if (item.QcRecordFileByNas != null) {
                            let qcRecordFileJson = JSON.parse(item.QcRecordFileByNas);
                            $.each(qcRecordFileJson.data, function (j, item2) {
                                let fileName = "";
                                if (typeof (item2.PhysicalPath) != `undefined`) {
                                    fileName = item2.PhysicalPath.split("\\").pop();
                                }
                                else {
                                    return false;
                                }

                                let inputInfo =
                                {
                                    "FileId": item2.FileId,
                                    "FileName": fileName,
                                    "FilePath": item2.PhysicalPath
                                };
                                uploadFileJson@(itemName).uploadFileInfo.push(inputInfo);
                            });

                            let innerHtml = `<div class="preview-group">`;
                            $.each(uploadFileJson@(itemName).uploadFileInfo, function (i, item) {
                                innerHtml += `<span class="tag-group">
                                                <div class="tag-info">
                                                    <a class="active-link mr-1" href="${item.FileId ? `/Web/GetFile?FileId=${item.FileId}` : `/BasicInformation/GetUploadFile?FilePath=${item.FilePath}&DownloadFlag=RD`}"><i class="fas fa-download"></i></a>${item.FileName}
                                                </div>
                                                <div class="tag-delete">
                                                    <a href="javascript:DeleteTag('${item.FileName}', '#QcRecordFileHelp@(itemName)');">
                                                        <i style="color:slategrey" class="fas fa-times"></i>
                                                    </a>
                                                </div>
                                              </span>`;
                            });
                            innerHtml += `</div>`;
                            $("#desQcRecordFilePreview@(itemName)").html(innerHtml);
                            $("#QcRecordFileHelp@(itemName)").show();
                        }

                        if ((item.ResolveFile != null && item.ResolveFile != "") && item.ResolveFileJson == null) {
                            let resolveFileJson = JSON.parse(item.ResolveFile);
                            let resolveFileList = [];
                            $.each(resolveFileJson.data, function (i, item) {
                                resolveFileList.push(item.FileId);
                            });
                            $("#txtResolveFile@(itemName)").val(resolveFileList.toString());
                            ReloadResoloveFileJson@(itemName)();
                        }

                        if (item.ResolveFileJson != null && item.ResolveFileJson != "") {
                            resolveFileJson@(itemName) = JSON.parse(item.ResolveFileJson);
                            let resolveFileList = [];
                            $.each(resolveFileJson@(itemName).resolveFileInfo, function (i, item) {
                                resolveFileList.push(item.FileId);
                            });
                            $("#txtResolveFile@(itemName)").val(resolveFileList.toString());
                            ReloadResoloveFileJson@(itemName)();
                        }

                        let innerHtml = "";
                        let cadInfoJson = JSON.parse(item.CadInfo);
                        let cadFileAbsolutePathInfoJson = JSON.parse(item.CadFileAbsolutePathInfo);
                        if (cadInfoJson == null) {
                            return false;
                        }

                        if (cadInfoJson.data[0]["CadInfoData"] != null) {
                            $.each(cadInfoJson.data, function (j, item2) {
                                let cadInfoDataJson = item2.CadInfoData;
                                if (typeof (cadInfoDataJson) == `undefined`) {
                                    return false;
                                }
                                $.each(cadInfoDataJson.data, function (k, item3) {
                                    innerHtml = `<tr>
                                                    <td class="active-content ellipsis" data-toggle="tooltip" title="${item3.CustomerMtlItemNo}" style="max-width: 250px;">
                                                        ${item3.CustomerMtlItemNo}
                                                    </td>
                                                    <td class="active-content ellipsis" data-toggle="tooltip" title="${item3.CustomerCadFileFullName != null ? item3.CustomerCadFileFullName : `尚無資料`}" style="max-width: 250px;">
                                                        <a class="active-link mr-1" href="/Drawing/GetPdmFile?fileId=${item3.CadFile}"><i class="fas fa-download"></i></a>
                                                        ${item3.CustomerCadFileFullName != null ? item3.CustomerCadFileFullName : `尚無資料`}
                                                    </td>
                                                    <td class="active-content ellipsis" data-toggle="tooltip" title="${item3.Cad2DFileFullName != null ? item3.Cad2DFileFullName : `尚無資料`}" style="max-width: 250px;">
                                                        <a class="active-link mr-1" href="/Drawing/GetPdmFile?fileId=${item3.Cad2DFile}"><i class="fas fa-download"></i></a>
                                                        ${item3.Cad2DFileFullName != null ? item3.Cad2DFileFullName : `尚無資料`}
                                                    </td>
                                                    <td class="active-content ellipsis" data-toggle="tooltip" title="${item3.Pdf2DFileFullName != null ? item3.Pdf2DFileFullName : `尚無資料`}" style="max-width: 250px;">
                                                        <a class="active-link mr-1" href="/Drawing/GetPdmFile?fileId=${item3.Pdf2DFile}"><i class="fas fa-download"></i></a>
                                                        ${item3.Pdf2DFileFullName != null ? item3.Pdf2DFileFullName : `尚無資料`}
                                                    </td>
                                                 </tr>`;
                                });
                            });
                        }
                        else if (cadFileAbsolutePathInfoJson.data[0]["CadInfoData"] != null) {
                            $.each(cadFileAbsolutePathInfoJson.data, function (j, item2) {
                                let cadFileAbsolutePathInfoDataJson = item2.CadInfoData;
                                $.each(cadFileAbsolutePathInfoDataJson.data, function (k, item3) {
                                    let customerCadFileFullName = "尚無資料";
                                    if (item3.CadFileAbsolutePath != null) {
                                        let customerCadFileFullNameList = item3.CadFileAbsolutePath.split('\\');
                                        customerCadFileFullName = customerCadFileFullNameList[customerCadFileFullNameList.length - 1];
                                    }

                                    let cad2DFileFullName = "尚無資料";
                                    if (item3.Cad2DFileAbsolutePath != null) {
                                        let cad2DFileFullNameList = item3.Cad2DFileAbsolutePath.split('\\');
                                        cad2DFileFullName = cad2DFileFullNameList[cad2DFileFullNameList.length - 1];
                                    }

                                    let pdf2DFileFullName = "尚無資料";
                                    if (item3.Pdf2DFileAbsolutePath != null) {
                                        let pdf2DFileFullNameList = item3.Pdf2DFileAbsolutePath.split('\\');
                                        pdf2DFileFullName = pdf2DFileFullNameList[pdf2DFileFullNameList.length - 1];
                                    }

                                    innerHtml = `<tr>
                                                    <td class="active-content ellipsis" data-toggle="tooltip" title="${item3.CustomerMtlItemNo}" style="max-width: 250px;">
                                                        ${item3.CustomerMtlItemNo}
                                                    </td>
                                                    <td class="active-content ellipsis" data-toggle="tooltip" title="${customerCadFileFullName}" style="max-width: 250px;">
                                                        <a class="active-link mr-1" href="/Drawing/GetCadFile?FilePath=${item3.CadFileAbsolutePath}"><i class="fas fa-download"></i></a>
                                                        ${customerCadFileFullName}
                                                    </td>
                                                    <td class="active-content ellipsis" data-toggle="tooltip" title="${cad2DFileFullName}" style="max-width: 250px;">
                                                        <a class="active-link mr-1" href="/Drawing/GetCadFile?FilePath=${item3.Cad2DFileAbsolutePath}"><i class="fas fa-download"></i></a>
                                                        ${cad2DFileFullName}
                                                    </td>
                                                    <td class="active-content ellipsis" data-toggle="tooltip" title="${pdf2DFileFullName}" style="max-width: 250px;">
                                                        <a class="active-link mr-1" href="/Drawing/GetCadFile?FilePath=${item3.Pdf2DFileAbsolutePath}"><i class="fas fa-download"></i></a>
                                                        ${pdf2DFileFullName}
                                                    </td>
                                                 </tr>`;
                                });
                            });
                        }
                        else {
                            innerHtml = `<tr>
                                            <td class="text-center" colspan="4" style="background-color: #fff3cd;">
                                                <i class="fal fa-exclamation-circle"></i>&nbsp;此製令尚未綁定設計圖資料。
                                            </td>
                                         </tr>`;
                        }

                        $("#tblRdDesignData@(itemName) tbody").html(innerHtml);
                    });
                } else {
                    alert(data.msg, "alert", 0);
                }
            }

            let popConfig = {
                targetSelector: "#txtQcNoticeId@(itemName)",
                popFunction: "PopViewQcNotice",
                objectQcNoticeId: "#txtQcNoticeId@(itemName)",
                objectQcNoticeNo: "#txtQcNoticeNo@(itemName)",
                objectQcNoticeType: "#cboQcTypeId@(itemName)",
                objectQcNoticeQty: "#desQcNoticeQty@(itemName)"
            };

            InitPopView(popConfig);

            let popConfig2 = {
                targetSelector: "#txtMoId@(itemName)",
                popFunction: "PopViewManufactureOrder",
                objectMoId: "#txtMoId@(itemName)",
                objectWoErpFullNo: "#txtWoErpFullNo@(itemName)",
                objectMtlItemNo: "#desMtlItemNo@(itemName)",
                objectMtlItemName: "#desMtlItemName@(itemName)",
                objectMtlItemSpec: "#desMtlItemSpec@(itemName)",
                objectQuantity: "#txtQuantity@(itemName)",
                objectInventoryId: "#cboInventoryId@(itemName)",
                objectPlanQty: "#desPlanQty@(itemName)",
                objectRequisitionSetQty: "#desRequisitionSetQty@(itemName)",
                objectStockInQty: "#desStockInQty@(itemName)",
                objectUomId: "#cboUomId@(itemName)",
                objectModeId: "#txtModeId@(itemName)"
            };
            InitPopView(popConfig2);

            let uploadConfig = {
                fileSelector: "#fileCurrentFile@(itemName)",
                targetSelector: "#txtCurrentFile@(itemName)",
                required: false,
                uploadPath: "/QcDataManagement/QcDataManagement",
                allowedFileExtensions: ['xlsx'],
                maxFileCount: 1,
                defaultFile: $("#txtCurrentFile@(itemName)").val()
            };
            Suites.FileUpload(uploadConfig);

            let uploadConfig2 = {
                fileSelector: "#fileQcRecordFile@(itemName)",
                targetSelector: "#txtQcRecordFile@(itemName)",
                required: false,
                uploadPath: "/QcDataManagement/QcDataManagement",
                maxFileCount: 999,
                defaultFile: $("#txtQcRecordFile@(itemName)").val()
            };
            Suites.FileUpload(uploadConfig2);

            let uploadConfig3 = {
                fileSelector: "#fileResolveFile@(itemName)",
                targetSelector: "#txtResolveFile@(itemName)",
                required: false,
                uploadPath: "/QcDataManagement/QcDataManagement",
                maxFileCount: 999,
                defaultFile: $("#txtResolveFile@(itemName)").val()
            };
            Suites.FileUpload(uploadConfig3);
        }

        function QueryQcNotice@(itemName)() {
            let targetUrl = "@Url.Action("GetQcNotice", "QcItemSetting")";

            let postData = {
                "QcNoticeNo": $("#txtQcNoticeNo@(itemName)").val()
            };

            let data = DataAccess.Get(targetUrl, postData, false);

            if (data.status == "success") {
                if (data.result.length > 0) {
                    $.each(data.result, function (i, item) {
                        $("#txtQcNoticeId@(itemName)").val(item.QcNoticeId);
                        $("#txtQcNoticeNo@(itemName)").val(item.QcNoticeNo);
                        $("#desQcNoticeType@(itemName)").html(item.QcNoticeType);
                        $("#desQcNoticeQty@(itemName)").html(item.QcNoticeQty);
                        $("#txtQcNoticeId@(itemName)").siblings(".help-block").show();

                        if (item.QcNoticeType == "IPQC") {
                            $(".mo-process-id").show();
                            $("#cboMoProcessId@(itemName)").prop("required", true);
                        }
                        else {
                            $(".mo-process-id").hide();
                            $("#cboMoProcessId@(itemName)").prop("required", false);
                        }
                    });
                }
                else {
                    alert("查無此量測通知單資料!");
                    $("#txtQcNoticeNo@(itemName)").val("");
                    $("#txttxtQcNoticeId@(itemName)").val("");
                    $("#txttxtQcNoticeId@(itemName)").siblings(".help-block").hide();
                }
            }
        }

        function QueryManufactureOrder@(itemName)() {
            let woErpFullNo = $("#txtWoErpFullNo@(itemName)").val();
            if (woErpFullNo.indexOf("-") != -1 && woErpFullNo.indexOf("(") == -1) {
                alert("請連同製令序號一起輸入! EX: 5101-20230226(1)");
                return false;
            }

            let targetUrl = "@Url.Action("GetManufactureOrder", "Production")";

            let postData = {
                "OtherInfo": $("#txtWoErpFullNo@(itemName)").val()
            };

            let data = DataAccess.Get(targetUrl, postData, false);

            if (data.status == "success") {
                if (data.result.length > 0) {
                    $.each(data.result, function (i, item) {
                        $("#txtMoId@(itemName)").val(item.MoId);
                        $("#txtModeId@(itemName)").val(item.ModeId);
                        $("#txtWoErpFullNo@(itemName)").val(item.WoErpPrefix + "-" + item.WoErpNo + "(" + item.WoSeq + ")");
                        $("#desMtlItemNo@(itemName)").html(item.MtlItemNo);
                        $("#desMtlItemName@(itemName)").html(item.MtlItemName);
                        $("#txtMoId@(itemName)").siblings(".help-block").show();

                        ComboBoxs.Default("#cboMoProcessId@(itemName)", "@Url.Action("GetMoProcess", "Production")", { "MoId": item.MoId }, "", "ALL", "", "ProcessAlias", "MoProcessId");
                    });
                }
                else {
                    alert("查無製令資料!");
                    $("#txtMoId@(itemName)").val("");
                    $("#txtWoErpFullNo@(itemName)").val("");
                    $("#txtMoId@(itemName)").siblings(".help-block").hide();
                }
            }
            else {
                alert(data.msg);
            }
        }

        function Save@(itemName)() {
            if ($(objForm@(itemName)).valid()) {
                let QcRecordId = parseInt($("#QcRecordId").val());
                if (QcRecordId <= 0) {
                    let targetUrl = "@Url.Action("AddQcRecord", "QcDataManagement")";
                    let postData = {
                        "QcNoticeId": $("#txtQcNoticeId@(itemName)").val(),
                        "QcTypeId": $("#cboQcTypeId@(itemName)").val(),
                        "MoId": $("#txtMoId@(itemName)").val(),
                        "MoProcessId": $("#cboMoProcessId@(itemName)").val(),
                        "CurrentFileId": $("#txtCurrentFile@(itemName)").val(),
                        "QcRecordFile": $("#txtQcRecordFile@(itemName)").val(),
                        "QcRecordFileByNas": JSON.stringify(uploadFileJson@(itemName)),
                        "Remark": $("#txtRemark@(itemName)").val(),
                        "InputType": $("#cboInputType@(itemName)").val(),
                        "SupportAqFlag": $("#cboSupportAqFlag@(itemName)").val(),
                        "ResolveFile": $("#txtResolveFile@(itemName)").val(),
                        "ResolveFileJson": JSON.stringify(resolveFileJson@(itemName))
                    };

                    let data = DataAccess.EditContinued(targetUrl, postData, false);
                    if (data) {
                        let qcRecordId;
                        let fileId;
                        $.each(data.result, function (i, item) {
                            qcRecordId = item.QcRecordId;
                            fileId = item.CurrentFileId;
                        });
                        let moId = $("#txtMoId@(itemName)").val();
                        $("#QcRecordId").val(qcRecordId);
                        let woErpFullNo = $("#txtWoErpFullNo@(itemName)").val();
                        let qcType = $("#cboQcTypeId@(itemName)").find(":selected").text();
                        let qcTypeId = $("#cboQcTypeId@(itemName)").val();
                        let inputType = $("#cboInputType@(itemName)").val();
                        let moProcessId = $("#cboMoProcessId@(itemName)").val();
                        Query@(itemName)();
                        Edit@(itemName)(qcRecordId);
                        ExpandQcDataDetail(qcRecordId, fileId, moId, woErpFullNo, qcType, inputType, moProcessId, defaultFileId@(itemName), "N");
                    }
                }
                else {
                    let targetUrl = "@Url.Action("UpdateQcRecord", "QcDataManagement")";
                    let postData = {
                        "QcRecordId": QcRecordId,
                        "QcNoticeId": $("#txtQcNoticeId@(itemName)").val(),
                        "QcTypeId": $("#cboQcTypeId@(itemName)").val(),
                        "MoId": $("#txtMoId@(itemName)").val(),
                        "MoProcessId": $("#cboMoProcessId@(itemName)").val(),
                        "CurrentFileId": $("#txtCurrentFile@(itemName)").val(),
                        "QcRecordFile": $("#txtQcRecordFile@(itemName)").val(),
                        "QcRecordFileByNas": JSON.stringify(uploadFileJson@(itemName)),
                        "Remark": $("#txtRemark@(itemName)").val(),
                        "InputType": $("#cboInputType@(itemName)").val(),
                        "SupportAqFlag": $("#cboSupportAqFlag@(itemName)").val(),
                        "ResolveFile": $("#txtResolveFile@(itemName)").val(),
                        "ResolveFileJson": JSON.stringify(resolveFileJson@(itemName))
                    };

                    let result = DataAccess.Update(targetUrl, postData, false, true);

                    if (result) {
                        let fileId = $("#txtCurrentFile@(itemName)").val();
                        let moId = $("#txtMoId@(itemName)").val();
                        let woErpFullNo = $("#txtWoErpFullNo@(itemName)").val();
                        let qcType = $("#cboQcTypeId@(itemName)").find(":selected").text();
                        let inputType = $("#cboInputType@(itemName)").val();
                        let moProcessId = $("#cboMoProcessId@(itemName)").val();
                        ExpandQcDataDetail(QcRecordId, fileId, moId, woErpFullNo, qcType, inputType, moProcessId, defaultFileId@(itemName), checkQcMeasureData@(itemName));
                    }
                }
            }
        }

        function Delete@(itemName)(qcRecordId) {
            swal.fire({
                titleText: "確認要刪除嗎?",
                text: "此動作無法復原，請確認是否要執行!",
                icon: "warning",
                allowOutsideClick: false,
                allowEscapeKey: false,
                showCancelButton: true,
                confirmButtonColor: '#d33',
                reverseButtons: true
            }).then((result) => {
                if (result.isConfirmed) {
                    let targetUrl = "@Url.Action("DeleteQcRecord", "QcDataManagement")";
                    let postData = {
                        "QcRecordId": qcRecordId
                    };

                    let result = DataAccess.Delete(targetUrl, postData, false, true);

                    if (result) {
                        Return@(itemName)();
                    }
                }
            });
        }

        function Void@(itemName)(qcRecordId) {
            swal.fire({
                titleText: "確認要作廢嗎?",
                text: "此動作無法復原，請確認是否要執行!",
                icon: "warning",
                allowOutsideClick: false,
                allowEscapeKey: false,
                showCancelButton: true,
                confirmButtonColor: '#d33',
                reverseButtons: true
            }).then((result) => {
                if (result.isConfirmed) {
                    let targetUrl = "@Url.Action("VoidQcRecord", "QcDataManagement")";
                    let postData = {
                        "QcRecordId": qcRecordId
                    };

                    let result = DataAccess.Delete(targetUrl, postData, false, true);

                    if (result) {
                        Return@(itemName)();
                    }
                }
            });
        }

        function ExportExcel@(itemName)(qcRecordId, fileId, defaultFileId) {
            dataLoadingCheck = false;
            ResetSpreadsheetQcDataDetail();
            InitDataQcDataDetail(qcRecordId);
            setTimeout(function () {
                spreadsheet.export.xlsx();
            }, 250);
        }

        function PopModalPrint@(itemName)(qcRecordId, woErpFullNo, mtlItemNo, mtlItemName) {
            $("#txtPrintQcRecordId@(itemName)").val(qcRecordId);
            $("#desPrintWoErpFullNo@(itemName)").html(woErpFullNo);
            $("#desPrintMtlItemNo@(itemName)").html(mtlItemNo);
            $("#desPrintMtlItemName@(itemName)").html(mtlItemName);
            $("#modalPrint@(itemName)").modal("show");
        }

        function Print@(itemName)() {
            let QcRecordId = $("#txtPrintQcRecordId@(itemName)").val();
            let LabelPrintMachine = $("#cboLabelPrintMachine@(itemName)").val();
            let targetUrl = "@Url.Action("PrintQCLable", "PrintLabel")";
            let postData = {
                "QcRecordId": QcRecordId,
                "PrintMachineName": LabelPrintMachine
            };

            let result = DataAccess.Update(targetUrl, postData, false, true);

            if (result) {
                $("#modalPrint@(itemName)").modal("hide");
            }
        }
        let arrRecord = []

        function PopLotPrintView@(itemName)() {
            let currentDate = new Date();
            let objRecord = {}
            arrRecord = []
            let innerHtml =""
            if ($("input[type='checkbox'][name='lotPrintLabel']:checked").length > 0) {
                $.each($("input[type='checkbox'][name='lotPrintLabel']:checked"), function (i) {
                    let qcRecordId = $(this).val();
                    let WoErpFullNo = $(this).data("wofullno");
                    let MtlItemNo = $(this).data("mtlitemno");
                    let MtlItemName = $(this).data("mtlitemname");
                    objRecord[qcRecordId] = {
                        woErpFullNo: WoErpFullNo,
                        mtlItemNo: MtlItemNo,
                        mtlItemName: MtlItemName
                    };
                    arrRecord.push(qcRecordId)

                });
            }
            if (Object.keys(objRecord).length > 0) {
                Object.entries(objRecord).forEach(([qcRecordId, data]) => {
                    if (qcRecordId) {

                        innerHtml += `
                        <tr>
                           <td class="ellipsis" style="width: 100px;">
                                <input type="number" id="txtPrintQty@(itemName)${qcRecordId}" class="inputStyle" name="PrintQty" value="1" min="1"  style="width: 100%;" placeholder="請輸入數量"/> 
                           </td>
                           <td class="ellipsis" style="width: 230px;">
                                <input type="text" id="txtPrintDate@(itemName)${qcRecordId}" class="inputStyle" name="PrintDate" value=""  style="width: 100%;" placeholder="非必填(預設是單據日期)"/> 
                           </td>
                           <td class="ellipsis" data-toggle="tooltip" title="${qcRecordId}" style="max-width: 100px; min-width: 100px;">${qcRecordId}</td>
                           <td class="ellipsis" data-toggle="tooltip" title="${data.woErpFullNo}" style="max-width: 200px; min-width: 135px;">${data.woErpFullNo}</td>
                           <td class="ellipsis" data-toggle="tooltip" title="${data.mtlItemNo}" style="max-width: 200px; min-width: 135px;">${data.mtlItemNo}</td>
                           <td class="ellipsis" data-toggle="tooltip" title="${data.mtlItemName}" style="max-width: 200px; min-width: 135px;">${data.mtlItemName}</td>

                        </tr>
                        `

                        // 可以在這裡進一步操作，例如 push 到另一個陣列或送出 Ajax
                    }
                });

                $("#tblLabData@(itemName) tbody").html(innerHtml);

                arrRecord.forEach((Id) => {
                    Suites.DatePicker(`txtPrintDate@(itemName)${Id}`, "");
                })

                $("#modalPrint2@(itemName)").modal("show");
            }
            else {
                alert("請選擇欲列印單據!!")
            }
        }

        function LotPrint@(itemName)() {
            let qcRecordIds = [];
            let objRecordList = [];
            let LabelPrintMachine = $("#cboLabelPrintMachine2@(itemName)").val();
            if (LabelPrintMachine == "") {
                alert("標籤機尚未選擇,請重新確認")
                return
            }
            arrRecord.forEach((Id) => {
                let PrintQty = $(`#txtPrintQty@(itemName)${Id}`).val()
                let PrintDate = $(`#txtPrintDate@(itemName)${Id}`).val()
                let obj = {
                    RecordId: Id,
                    PrintQty: PrintQty,
                    PrintDate: PrintDate
                };

                objRecordList.push(obj); // 加入陣列中
            })

            if (objRecordList.length  > 0) {
                let targetUrl = "@Url.Action("PrintLotQCLable1", "PrintLabel")";
                let postData = {
                    "PrintMachineName": LabelPrintMachine,
                    "QcRecordObj": JSON.stringify(objRecordList)
                };
                let result = DataAccess.Add(targetUrl, postData, false, true);
                if (result) {
                    $("#modalPrint2@(itemName)").modal("hide");
                }
            }
            else {
                alert("至少需要選擇一個單據!");
            }
            
        }

        function ResolveFile@(itemName)() {
            let qcRecordId = $("#QcRecordId").val();
            if (qcRecordId <= 0) {
                alert("單據尚未建立完成，請先儲存後再進行解析!!");
                return false;
            }

            let qcClassId = $("#cboQcClassId@(itemName)").val();
            if (qcClassId.length <= 0) {
                alert("量測產品類型不能為空!!");
                return false;
            }

            let letterNoList = [];
            let qcData =
            {
                data: [
                    {
                        "cell": "A1",
                        "value": "序號",
                        "css": "title-class"
                    },
                    {
                        "cell": "B1",
                        "value": "球標",
                        "css": "title-class"
                    },
                    {
                        "cell": "C1",
                        "value": "檢測項目"
                    },
                    {
                        "cell": "D1",
                        "value": "檢測備註"
                    },
                    {
                        "cell": "E1",
                        "value": "量測設備"
                    },
                    {
                        "cell": "F1",
                        "value": "設計值"
                    },
                    {
                        "cell": "G1",
                        "value": "上限"
                    },
                    {
                        "cell": "H1",
                        "value": "下限"
                    },
                    {
                        "cell": "I1",
                        "value": "單位"
                    },
                    {
                        "cell": "J1",
                        "value": "Z軸"
                    },
                    {
                        "cell": "K1",
                        "value": "量測人員"
                    },
                    {
                        "cell": "L1",
                        "value": "量測工時(s)"
                    },
                ],
                "styles": {
                    "title-class": {
                        "background": "#7d8083",
                        "color": "#fff"
                    },
                    "design-value-class": {
                        "color": "red"
                    }
                }
            };

            let result;
            $.ajax({
                url: "@Url.Action("ResolveFile", "QcDataManagement")",
                method: "POST",
                dataType: "json",
                data: {
                    "QcRecordId": qcRecordId,
                    "QcClassId": qcClassId,
                    "ResolveFileJsonString": JSON.stringify(resolveFileJson@(itemName)),
                    "ResolveType": "IPQC"
                },
                async: true,  // 設置為非同步
                beforeSend: function () {
                    $('#loading').css("display", "block");
                    $("body").css("overflow", "hidden");
                },
                success: function (data) {
                    result = data;
                    if (result.status == "success") {
                        letterNoList = result.letterNo;
                        Swal.fire({
                            title: "解析數據成功!",
                            text: "請檢查下方數據解析是否無誤。",
                            icon: "success"
                        });
                    }
                    else {
                        alert(result.msg, 5000);
                        return false;
                    }

                    //Header
                    let startIndex = 13;
                    let doubleTitle = 0;
                    let count = 0;
                    $.each(letterNoList, function (i, item) {
                        let cell = "";

                        if (i <= 15) {
                            cell = String.fromCharCode(64 + startIndex + i) + "1";
                        }
                        else {
                            if (count > 15) {
                                count = 0;
                                doubleTitle++;
                            }
                            else {
                                cell = String.fromCharCode(64 + 1 + doubleTitle) + String.fromCharCode(64 + 1 + count) + "1";
                                count++;
                            }
                        }

                        let letterNo =
                        {
                            "cell": cell.toString(),
                            "value": item,
                            "format": "text"
                        }
                        qcData.data.push(letterNo);
                    });

                    //Body
                    if (result.data.length > 0) {
                        let row = 2;
                        $.each(result.data, function (i, item) {

                            let thisCellIndex = "";
                            let hasValue = qcData.data.some(function (item2) {
                                if (item2.value == item.QcItemNo) {
                                    thisCellIndex = item2.cell.toString().match(/\d+/)[0].toString();
                                }
                                return item2.value == item.QcItemNo;
                            });

                            if (!hasValue) {
                                let qcItemNo =
                                {
                                    "cell": "A" + row.toString(),
                                    "value": item.QcItemNo
                                }
                                qcData.data.push(qcItemNo);

                                let ballMark =
                                {
                                    "cell": "B" + row.toString(),
                                    "value": item.BallMark
                                }
                                qcData.data.push(ballMark);

                                let qcItemName =
                                {
                                    "cell": "C" + row.toString(),
                                    "value": item.QcItemName
                                }
                                qcData.data.push(qcItemName);

                                let qcItemDesc =
                                {
                                    "cell": "D" + row.toString(),
                                    "value": item.QcItemDesc
                                }
                                qcData.data.push(qcItemDesc);

                                let machineName =
                                {
                                    "cell": "E" + row.toString(),
                                    "value": item.MachineName
                                }
                                qcData.data.push(machineName);

                                let designValue =
                                {
                                    "cell": "F" + row.toString(),
                                    "value": item.DesignValue,
                                    "format": "text"
                                }
                                qcData.data.push(designValue);

                                let upperTolerance =
                                {
                                    "cell": "G" + row.toString(),
                                    "value": item.UpperTolerance,
                                    "format": "text"
                                }
                                qcData.data.push(upperTolerance);

                                let lowerTolerance =
                                {
                                    "cell": "H" + row.toString(),
                                    "value": item.LowerTolerance,
                                    "format": "text"
                                }
                                qcData.data.push(lowerTolerance);

                                let unit =
                                {
                                    "cell": "I" + row.toString(),
                                    "value": item.Unit,
                                    "format": "text"
                                }
                                qcData.data.push(unit);

                                let zAxis =
                                {
                                    "cell": "J" + row.toString(),
                                    "value": item.ZAxis,
                                    "format": "text"
                                }
                                qcData.data.push(zAxis);

                                let qcUser =
                                {
                                    "cell": "K" + row.toString(),
                                    "value": item.UserNo
                                }
                                qcData.data.push(qcUser);

                                row++;
                            }

                            let thisCellNo = "";
                            $.each(qcData.data, function (k, item2) {
                                let thisCell = item2.cell.toString();
                                if (thisCell.length == 2 && thisCell.split('')[1] == "1") {
                                    if (item2.value.toString() == item.LetteringNo) {
                                        thisCellNo = thisCell.split('')[0].toString();
                                        return false;
                                    }
                                }
                                else if (thisCell.length == 3 && thisCell.split('')[2] == "1") {
                                    if (item2.value.toString() == item.LetteringNo) {
                                        thisCellNo = thisCell.split('')[0].toString() + thisCell.split('')[1].toString();
                                        return false;
                                    }
                                }
                            });

                            //計算是否入規
                            let valueResult = "";
                            let thisMeasureValue = parseFloat(item.MeasureValue);
                            let designValue = item.DesignValue != null ? parseFloat(item.DesignValue) : -999;
                            let upperTolerance = item.UpperTolerance != null ? parseFloat(item.UpperTolerance) : 1;
                            let lowerTolerance = item.LowerTolerance != null ? parseFloat(item.LowerTolerance) : -1;

                            if (thisMeasureValue > (designValue + upperTolerance) || thisMeasureValue < (designValue + lowerTolerance)) {
                                valueResult = "design-value-class";
                            }
                            let measureValue =
                            {
                                "cell": thisCellNo + `${thisCellIndex.length <= 0 ? (row - 1).toString() : thisCellIndex.toString()}`,
                                "value": isNaN(item.MeasureValue) == false ? parseFloat(item.MeasureValue) : item.MeasureValue,
                                "format": "common",
                                "css": valueResult
                            }
                            qcData.data.push(measureValue);
                        });
                    }
                    spreadsheet.parse(qcData);
                    data = spreadsheet.serialize();

                    $("button[data-dhx-id='SaveTempJson']").click();
                },
                error: function (error) {
                    alert(result.msg);
                    return false;
                },
                complete: function () {
                    $('#loading').css("display", "none");
                    $("body").css("overflow", "auto");
                }
            });

            @*let targetUrl = "@Url.Action("ResolveFile", "QcDataManagement")";
            let postData = {
                "QcRecordId": qcRecordId,
                "QcClassId": qcClassId,
                "ResolveFileJsonString": JSON.stringify(resolveFileJson@(itemName))
            };

            let result = DataAccess.Get(targetUrl, postData, false);

            if (result.status == "success") {
                letterNoList = result.letterNo;
                Swal.fire({
                    title: "解析數據成功!",
                    text: "請檢查下方數據解析是否無誤。",
                    icon: "success"
                });
            }
            else {
                alert(result.msg);
                return false;
            }*@
        }

        function ReloadResoloveFileJson@(itemName)() {
            $(".qc-file-body").empty();

            let fileIdList = $("#txtResolveFile@(itemName)").val();

            if (fileIdList == "") {
                return false;
            }

            let targetUrl = "@Url.Action("GetFileInfo", "QcDataManagement")";
            let postData = {
                "FileIdList": fileIdList
            };
            let data = DataAccess.Get(targetUrl, postData, false);

            if (data.status == "success") {
                if (data.result.length > 0) {
                    $.each(data.result, function (i, item) {
                        let checkFileAlive = false;
                        $.each(resolveFileJson@(itemName).resolveFileInfo, function (j, item2) {
                            if (item.FileId == item2.FileId) {
                                checkFileAlive = true;
                                return false;
                            }
                        });

                        if (checkFileAlive == false) {
                            let inputResolveFileInfo =
                            {
                                "FileId": item.FileId,
                                "FileFullName": item.FileFullName,
                                "MachineNumber": $("#cboSelectAllMachineNumber@(itemName)").val(),
                                "UserNo": '@Session["UserNo"]',
                                "QcClassId": $("#cboQcClassId@(itemName)").val(),
                                "AllMachineNumber": $("#cboSelectAllMachineNumber@(itemName)").val()
                            };
                            resolveFileJson@(itemName).resolveFileInfo.push(inputResolveFileInfo);
                        }
                    });
                }
            }

            $.each(resolveFileJson@(itemName).resolveFileInfo, function (j, item2) {
                if (fileIdList.indexOf(item2.FileId) == -1) {
                    resolveFileJson@(itemName).resolveFileInfo.splice(j, 1);
                }
            });

            let innerHtml = "";
            $.each(resolveFileJson@(itemName).resolveFileInfo, function (i, item) {
                $("#cboQcClassId@(itemName)").val(item.QcClassId);
                $("#cboSelectAllMachineNumber@(itemName)").val(item.AllMachineNumber);

                innerHtml += `<div class="qc-file-item">
                                <input type="hidden" id="txtResolveFileId@(itemName)${item.FileId}" value="${item.FileId}">
                                <div class="item-file">
                                    <input type="checkbox" data-file-id="${item.FileId}" data-type="ResolveFile" value="${item.FileId}" />
                                    <p>檔案名稱: ${item.FileFullName}</p>
                                </div>
                                <div class="parameter-bar">
                                    <div class="qc-machine">
                                        ${GetMachineNumberCbo@(itemName)(`${item.FileId}`, `${item.MachineNumber}`)}
                                    </div>
                                    <div style="width: 100%" class="effective-diameter-r1">
                                        <input type="number" data-file-id="${item.FileId}" data-eff-type="EffectiveDiameterR1" class="form-control" id="txtEffectiveDiameterR1@(itemName)${item.FileId}" placeholder="請輸入R1有效徑..." oninput="SettingEffectiveDiameter@(itemName)(this);" value="${item.EffectiveDiameterR1}" />
                                    </div>
                                    <div style="width: 100%" class="effective-diameter-r2">
                                        <input type="number" data-file-id="${item.FileId}" data-eff-type="EffectiveDiameterR2" class="form-control" id="txtEffectiveDiameterR2@(itemName)${item.FileId}" placeholder="請輸入R2有效徑..." oninput="SettingEffectiveDiameter@(itemName)(this);" value="${item.EffectiveDiameterR2}" />
                                    </div>
                                </div>
                              </div>`;

                function GetMachineNumberCbo@(itemName)(fileId, machineNumber) {
                    let innerHtml = "";
                    innerHtml += `<select class="form-control qmm-detail" data-file-id="${fileId}" id="cboQmmDetail@(itemName)${fileId}" onchange="ChangeMachineNumber@(itemName)(this)">
                                    <option value="">請選擇</option>`;
                    $.each(qmmDetailJson@(itemName).qmmDetailInfo, function (i, item) {
                        innerHtml += `<option value="${item.MachineNumber}" ${item.MachineNumber == machineNumber ? `selected` : ``}>${item.MachineName}</option>`;
                    });
                    innerHtml += `</select>`;

                    return innerHtml;
                }
            });
            $(".qc-file-body").html(innerHtml);

            if (!isMobile) {
                $.each($(".qmm-detail[data-file-id]"), function (i, item) {
                    let fileId = $(this).data("file-id");
                    $(`#cboQmmDetail@(itemName)${fileId}`).select2({
                        width: "100%"
                    });
                });
            }
        }

        function SaveResolveFileJson@(itemName)() {
            let targetUrl = "@Url.Action("UpdateResolveFileJson", "QcDataManagement")";
            let postData = {
                "QcRecordId": QcRecordId,
                "ResolveFileJson": JSON.stringify(resolveFileJson@(itemName))
            };

            let result = DataAccess.Update(targetUrl, postData, false, true);
        }

        function RemoveResolveFile@(itemName)() {
            let qcRecordId = $("#QcRecordId").val();
            if (qcRecordId <= 0) {
                alert("尚無儲存的數據!!");
                return false;
            }
            swal.fire({
                titleText: "確認要刪除嗎?",
                text: "此動作無法復原，請確認是否要執行!",
                icon: "warning",
                allowOutsideClick: false,
                allowEscapeKey: false,
                showCancelButton: true,
                confirmButtonColor: '#d33',
                reverseButtons: true
            }).then((result) => {
                if (result.isConfirmed) {
                    let targetUrl = "@Url.Action("DeleteResolveFileJson", "QcDataManagement")";
                    let postData = {
                        "QcRecordId": qcRecordId
                    };

                    let result = DataAccess.Delete(targetUrl, postData, false, true);

                    if (result) {
                        resolveFileJson@(itemName).resolveFileInfo = [];
                        ReloadResoloveFileJson@(itemName)();
                    }
                }
            });
        }

        function GetQcTypeSupportProcessFlag@(itemName)(qcTypeId) {
            let targetUrl = "@Url.Action("GetQcType", "QcDataManagement")";
            let postData = {
                "QcTypeId": qcTypeId
            };

            let data = DataAccess.Get(targetUrl, postData, false);

            let supportProcessFlag = "";
            if (data) {
                $.each(data.result, function (i, item) {
                    supportProcessFlag = item.SupportProcessFlag;
                });
            }

            return supportProcessFlag;
        }

        function GetQcRecordWithId@(itemName)(qcTypeId) {
            const qcRecordId = $("#txtQcRecordIdQ@(itemName)").val();
            if (!qcRecordId || isNaN(qcRecordId)) {
                alert("請輸入正確的 QcRecordId");
                return;
            }

            let targetUrl = "@Url.Action("GetQcRecodDataQrcode2", "QcDataManagement")";
            let postData = {
                "QcRecordId": qcRecordId
            };

            let data = DataAccess.Get(targetUrl, postData, false);

            if (data && data.status === "success") {
                const qcPath = data.result;
                if (qcPath) {
                    window.location.href = qcPath;
                } else {
                    alert("查無對應網址");
                }
            } else {
                alert("取得資料失敗：" + (data.msg || "未知錯誤"));
            }
        
        }


        function SettingEffectiveDiameter@(itemName)(e) {
            clearTimeout(timer)
            timer = setTimeout(function () {
                let fileId = $(e).data("file-id");
                let effType = $(e).data("eff-type");
                let value = $(e).val();

                $.each($("input[type='checkbox'][data-file-id][data-type='ResolveFile']:checked"), function (i, item) {
                    let currentFileId = $(item).data("file-id");
                    $.each(resolveFileJson@(itemName).resolveFileInfo, function (j, item2) {
                        if (item2.FileId == currentFileId) {
                            resolveFileJson@(itemName).resolveFileInfo[j][effType] = value;
                            $(`#txt${effType}@(itemName)${currentFileId}`).val(value);
                            return false;
                        }
                    });
                });

                $.each(resolveFileJson@(itemName).resolveFileInfo, function (i, item) {
                    if (item.FileId == fileId) {
                        resolveFileJson@(itemName).resolveFileInfo[i][effType] = value;
                        return false;
                    }
                });
            }, 500);
        }

        function CheckGoods@(itemName)(status) {
            let qcRecordId = $("#QcRecordId").val();
            let targetUrl = "@Url.Action("UpdateCheckGoods", "QcDataManagement")";
            let postData = {
                "QcRecordId": qcRecordId,
                "CheckQcMeasureData": status,
                "Disallowance": $("#txtDisallowance@(itemName)").val()
            };

            let result = DataAccess.Update(targetUrl, postData, false, true);

            if (result) {
                $("#modalReceiptGoods@(itemName)").modal("hide");
                checkQcMeasureData@(itemName) = status;
                checkQcMeasureDataQcDataDetail = status;
            }
        }

        function ResetQmmDetailJson@(itemName)() {
            qmmDetailJson@(itemName).qmmDetailInfo = [];

            let targetUrl = "@Url.Action("GetQmmDetail", "QcDataManagement")";

            let postData = {
            };

            let data = DataAccess.Get(targetUrl, postData, false);

            if (data.status = "success") {
                if (data.result.length > 0) {
                    $.each(data.result, function (i, item) {
                        let inputQmmDetailInfo =
                        {
                            "MachineNumber": item.MachineNumber,
                            "MachineName": item.MachineName
                        }
                        qmmDetailJson@(itemName).qmmDetailInfo.push(inputQmmDetailInfo);
                    });
                }
            }
        }

        function Urgent@(itemName)(QcRecordId) {
            swal.fire({
                titleText: "確定要變更急件狀態嗎?",
                text: "此動作無法復原，請確認是否要執行!",
                icon: "warning",
                allowOutsideClick: false,
                allowEscapeKey: false,
                showCancelButton: true,
                confirmButtonColor: '#d33',
                reverseButtons: true
            }).then((result) => {
                if (result.isConfirmed) {
                    let targetUrl = "@Url.Action("UpdateUrgent", "QcDataManagement")";
                    let postData = {
                        "QcRecordId": QcRecordId
                    };

                    let result = DataAccess.Update(targetUrl, postData, false, true);

                    Query@(itemName)();

                    @*if (result) {
                        Return@(itemName)();
                    }*@
                }
                else {
                    Return@(itemName)();
                }
            });
        }

        function MeasurementPlanning@(itemName)(QcRecordId, MtlItemName, MeasurementPlanning) {
            Switch("#divQcMeasurementPlanning", "#listData@(itemName)");
            PopQcMeasurementPlanning(QcRecordId, MtlItemName, MeasurementPlanning);
        }

        let uploadFileJson@(itemName) =
        {
            uploadFileInfo: []
        };
        function PopViewLocalFile@(itemName)(fileType, multipleType) {
            let listId = $(`#cbo${fileType}@(itemName)`).val();
            let folderHtmlPath = `#cbo${fileType}@(itemName)`;
            let fileHtmlPath = `#des${fileType}@(itemName)`;
            let filePreviewHtmlPath = `#des${fileType}Preview@(itemName)`;
            let helpHtmlPath = `#${fileType}Help@(itemName)`;
            PopViewLocalFile(listId, multipleType, folderHtmlPath, fileHtmlPath, filePreviewHtmlPath, helpHtmlPath, "QC", uploadFileJson@(itemName), '@(itemName)');
        }

        function ResetUploadInfo@(itemName)() {
            uploadFileJson@(itemName).uploadFileInfo = uploadFileJson@(itemName).uploadFileInfo.filter((file, index, self) =>
                index === self.findIndex((f) => f.FileName === file.FileName)
            );

            let innerHtml = `<dt>檔案預覽</dt>
                                <div class="preview-group">`;
            $.each(uploadFileJson@(itemName).uploadFileInfo, function (i, item) {
                innerHtml += `<span class="tag-group">
                                <div class="tag-info">
                                    <a class="active-link mr-1" href="/BasicInformation/GetUploadFile?FilePath=${item.FilePath}&DownloadFlag=RD"><i class="fas fa-download"></i></a>${item.FileName}
                                </div>
                                <div class="tag-delete">
                                    <a href="javascript:DeleteTag@(itemName)('${item.FileName}');">
                                        <i style="color:slategrey" class="fas fa-times"></i>
                                    </a>
                                </div>
                                </span>`;
            });
            innerHtml += `</div>`;
            $("#QcRecordFileHelp@(itemName)").html(innerHtml);
        }

        function DeleteTag@(itemName)(FileName) {
            $.each(uploadFileJson@(itemName).uploadFileInfo, function (i, item) {
                if (item.FileName == FileName) {
                    uploadFileJson@(itemName).uploadFileInfo.splice(i, 1);
                    return false;
                }
            });

            ResetUploadInfo@(itemName)();
        }

        function RemoveQcRecordFile@(itemName)() {
            $("#QcRecordFileHelp@(itemName)").hide();
            ComboBoxs.Default("#cboQcRecordFile@(itemName)", "@Url.Action("GetUploadWhitelist", "BasicInformation")", { "ListNo": "QC" }, "", "NA", "", "FolderPath", "ListId");
            uploadFileJson@(itemName).uploadFileInfo = [];
        }

        function PopViewModalImportExcel@(itemName)(Type) {
            $("#txtExcelFile@(itemName)").val("");

            if (Type === 'Multi') {
                $('a[href="javascript: ImportExcel@(itemName)();"]').attr('href', "javascript: ImportExcelMulti@(itemName)();");
            }
            else {
                $(`a[href="javascript: ImportExcelMulti@(itemName)();"]`).attr('href', "javascript: ImportExcel@(itemName)();");
            }
            
            let uploadConfig = {
                fileSelector: "#fileExcelFile@(itemName)",
                targetSelector: "#txtExcelFile@(itemName)",
                required: false,
                uploadPath: "/QcDataManagement/QcDataManagement",
                allowedFileExtensions: ['xlsx'],
                maxFileCount: 10,
                defaultFile: $("#txtExcelFile@(itemName)").val()
            };
            Suites.FileUpload(uploadConfig);

            $("#modalImportExcel@(itemName)").modal("show");
        }

        function ImportExcel@(itemName)() {
            $.ajax({
                url: "@Url.Action("ImportExcelToAddQcRecord", "QcDataManagement")",
                method: "POST",
                dataType: "json",
                data: {
                    "FileId": $("#txtExcelFile@(itemName)").val()
                },
                async: true,  // 設置為非同步
                beforeSend: function () {
                    $('#loading').css("display", "block");
                    $("body").css("overflow", "hidden");
                },
                success: function (data) {
                    if (data.status == "success") {
                        Swal.fire(
                            "新增成功!", //標題 
                            "單號列表:" + data.qcRecordIds, //訊息內容(可省略)
                            "success",
                        );

                        $("#modalImportExcel@(itemName)").modal("hide");
                        Return@(itemName)();
                    }
                    else {
                        Swal.fire(
                            "新增失敗!", //標題 
                            data.msg,
                            "error",
                        );

                        $("#txtExcelFile@(itemName)").val("");
                        let uploadConfig = {
                            fileSelector: "#fileExcelFile@(itemName)",
                            targetSelector: "#txtExcelFile@(itemName)",
                            required: false,
                            uploadPath: "/QcDataManagement/QcDataManagement",
                            allowedFileExtensions: ['xlsx'],
                            maxFileCount: 10,
                            defaultFile: $("#txtExcelFile@(itemName)").val()
                        };
                        Suites.FileUpload(uploadConfig);
                    }
                },
                error: function (error) {
                    alert(result.msg);
                    return false;
                },
                complete: function () {
                    $('#loading').css("display", "none");
                    $("body").css("overflow", "auto");
                }
            });
        }

        function ImportExcelMulti@(itemName)() {
            $.ajax({
                url: "@Url.Action("ImportExcelToAddQcRecordMulti", "QcDataManagement")",
                method: "POST",
                dataType: "json",
                data: {
                    "FileId": $("#txtExcelFile@(itemName)").val()
                },
                async: true,  // 設置為非同步
                beforeSend: function () {
                    $('#loading').css("display", "block");
                    $("body").css("overflow", "hidden");
                },
                success: function (data) {
                    if (data.status == "success") {
                        Swal.fire(
                            "新增成功!", //標題 
                            "單號列表:" + data.qcRecordIds, //訊息內容(可省略)
                            "success",
                        );

                        $("#modalImportExcel@(itemName)").modal("hide");
                        Return@(itemName)();
                    }
                    else {
                        Swal.fire(
                            "新增失敗!", //標題 
                            data.msg,
                            "error",
                        );

                        $("#txtExcelFile@(itemName)").val("");
                        let uploadConfig = {
                            fileSelector: "#fileExcelFile@(itemName)",
                            targetSelector: "#txtExcelFile@(itemName)",
                            required: false,
                            uploadPath: "/QcDataManagement/QcDataManagement",
                            allowedFileExtensions: ['xlsx'],
                            maxFileCount: 10,
                            defaultFile: $("#txtExcelFile@(itemName)").val()
                        };
                        Suites.FileUpload(uploadConfig);
                    }
                },
                error: function (error) {
                    alert(result.msg);
                    return false;
                },
                complete: function () {
                    $('#loading').css("display", "none");
                    $("body").css("overflow", "auto");
                }
            });
        }

        function Return@(itemName)() {
            Switch("#listData@(itemName)", "#editData@(itemName), .unit-block, .advanced-block");
            ResetForm(objForm@(itemName));
            //Query@(itemName)();
            InitData@(itemName)(objPage@(itemName));
            $("#modalReceiptGoods@(itemName)").modal("hide");
        }
    </script>
                                        )