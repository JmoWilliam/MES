@using Business_Manager.Helpers
@{
    string itemName = "Account";
    string itemNameText = "點餐系統";

    ViewBag.Title = itemNameText;
}

<div class="body-mob bg-white lot-record" style="padding-top: 0; display: none;">
    <main class="main-share mian-account">
        <div class="block">
            <div class="logo">
                <img src="@Url.Content("~/Content/images/logo.png")" />
            </div>
            <div class="form" style="background-color:unset">
                <div>
                    <a class="alink" href="javascript:SingleRecord();">
                        <i class="fas fa-user"></i>個人
                    </a>
                    <a class="alink" href="javascript:LotRecord();">
                        <i class="fas fa-users"></i>代訂
                    </a>
                </div>
                <a class="btn-deny mt-4" href="javascript:Logout();" style="width:100%;">登出</a>
            </div>
        </div>
    </main>
</div>

<div class="body-mob bg-white single-record" style="padding-top: 0; display: none;">
    <main class="main-share mian-account">
        <div class="block">
            <div class="logo">
                <img src="@Url.Content("~/Content/images/logo.png")" />
            </div>
            <div class="form" style="background-color:unset">
                <div>
                    <a href="javascript:void(0);" class="alink current-order-link">目前點餐</a>
                    <a href="javascript:void(0);" class="alink complete-order-link">已完成點餐</a>
                </div>
                <a class="btn-deny mt-4" href="javascript:Logout();" style="width:100%;">登出</a>
            </div>
        </div>
    </main>
</div>

<!--彈窗：點選工號-->
<div class="modal fade" id="choose-member" tabindex="-1" role="dialog" aria-labelledby="add-object-title" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="exampleModalCenterTitle" style="font-weight:700; text-align:center">選取人員</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group row" style="max-width: 500px;">
                    <div class="col-12 col-md-9 col-lg-9" style="margin-right: auto; margin-left: auto;">
                        <select class="form-control" id="cboUserId@(itemName)" name="cboUserId@(itemName)"></select>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <div class="btn-block">
                    <a data-dismiss="modal" aria-label="Close" class="link">關閉</a>
                    <a href="javascript:LotLink();" aria-label="Close" class="link">確定</a>
                </div>
            </div>
        </div>
    </div>
</div>

<footer class="nav">
    <div class="nav-content">
        <ul class="nav-menu" style="">
            <li>
                <a href="@Url.Action("/", "FoodOrdering")" class="nav-link ">
                    <i class="far fa-home-lg"></i>
                    <span>首頁</span>
                </a>
            </li>
            <li>
                <a href="@Url.Action("DiningCar", "FoodOrdering")" class="nav-link">
                    <i class="fas fa-utensils-alt"></i>
                    <span>我的餐車</span>
                    <span class="number-display" style="display: none;"></span>
                </a>
            </li>
            <li>
                <a href="@Url.Action("Account", "FoodOrdering")" class="nav-link active">
                    <i class="fas fa-user-circle"></i>
                    <span>帳號</span>
                </a>
            </li>
        </ul>
    </div>
</footer>

@Html.Resource("js",
    @<script>
        $(document).ready(function () {
            //判斷餐車筆數
            if (sessionStorage.getItem("mealCart")) {
                cartJson = JSON.parse(sessionStorage.getItem("mealCart"));

                if (cartJson.mealInfo.length > 0) {
                    $(".number-display").show();
                    $(".number-display").html(cartJson.mealInfo.length);
                }
            }

            let targetUrl = "@Url.Action("GetStaffUserId", "FoodOrdering")";
            let postData = {};

            let data = DataAccess.Get(targetUrl, postData, false);

            if (data.status == "success") {
                if (data.result.length > 0) {
                    $(".lot-record").show();
                } else {
                    SingleRecord();
                }
            } else {
                alert(data.msg, "alert", 0);
            }
        });

        function SingleRecord() {
            $(".single-record").show();
            $(".lot-record").hide();

            $(".current-order-link").attr("href", "@Url.Action("CurrentHistory", "FoodOrdering")");
            $(".complete-order-link").attr("href", "@Url.Action("OrderHistory", "FoodOrdering")");
        }

        function LotRecord() {
            LotSelect();
        }

        function LotSelect() {
            //觸發彈跳視窗
            $("#choose-member").modal({
                backdrop: "static",
                keyboard: false,
                show: true
            });

            ComboBoxs.Default("#cboUserId@(itemName)", "@Url.Action("GetStaffUserId", "FoodOrdering")", {}, "", "CHOOSE", "", "StaffUserName", "StaffUserId");
        }

        function LotLink() {
            $("#choose-member").modal("hide");

            $(".single-record").show();
            $(".lot-record").hide();

            $(".current-order-link").attr("href", `@Url.Action("CurrentHistory", "FoodOrdering")?UserId=${$(`#cboUserId@(itemName)`).val()}`);
            $(".complete-order-link").attr("href", `@Url.Action("OrderHistory", "FoodOrdering")?UserId=${$(`#cboUserId@(itemName)`).val()}`);
        }
    </script>
)